#+TITLE: Introduction To Model Theory

#+AUTHOR: Will Johnson
#+EXPORT_FILE_NAME: ../latex/IntroductionToModelTheory/IntroductionToModelTheory.tex
#+STARTUP: overview
#+LATEX_HEADER: \graphicspath{{../../books/}}
#+LATEX_HEADER: \input{preamble.tex}
#+LATEX_HEADER: \makeindex
#+LATEX_HEADER: \def \EF {\text{EF}}
#+LATEX_HEADER: \def \tint {\text{int}}
#+LATEX_HEADER: \DeclareMathOperator{\Ex}{Ex}
#+LATEX_HEADER: \DeclareMathOperator{\Bd}{Bd}
#+LATEX_HEADER: \DeclareMathOperator{\tbd}{bd}

* Back-and-forth Equivalence \rom{1}
    Convention: Relations and functions are sets of pairs \((x,y)\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *binary relation* is a pair \((E,R)\) where \(E\) is a set and \(R\subseteq E^2\). We call \(E\) the
    *universe* of the relation. For \(a,b\in E\), write \(aEb\) if \((a,b)\in R\)
    #+END_definition

    We abbreviate \((E,R)\) as \(R\) or \(E\), if \(E\) or \(R\) is clear

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \((\R,<)\), \((\R,=)\), \((\R,\ge)\),\((\Z,<)\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A binary relation \(R\) is said to be
    - *reflexive* if \(aRa\) (\(\forall a\in E\))
    - *symmetric* if \(aRb\Rightarrow bRa\) (\(\forall a,b\in E\))
    - *transitive* if \(aRb\wedge bRc\Rightarrow aRc\) (\(\forall a,b,c\in E\))
    - *antisymmetric* if \(aRb\wedge bRa\Rightarrow a=b\) (\(\forall a,b\in E\))
    - *total* if \(aRb\vee bRa\) (\(\forall a,b\in E\))
    - an *equivalence relation* if it's reflexive, symmetric and transitive
    - a *partial order* if it's reflexive, antisymmetric and transitive
    - a *linear order*  if it's a total partial order
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(=\) is an equivalence relation

    \(\subseteq\) is a partial order

    \(\le\) is a linear order
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    An *isomorphism* from \((E,R)\) to \((E',R')\) is a bijection \(f:E\to E'\) s.t. for any \(a,b\in E\),
    \(aRb\Leftrightarrow f(a)R'f(b)\). Two binary relations \((E,R)\) and \((E',R')\) are *isomorphic* (\(\cong\)) if
    there is an isomorphism between them
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(f:(\Z,<)\to(2\Z,>)\) and \(f(x)=-2x\) is an isomorphism. \(x<y\Leftrightarrow -2x>-2y\)
    #+END_examplle

    \(\cong\) is an equivalence relation

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *local isomorphism* from \(R\) to \(R'\) is an isomorphism from a finite restriction of \(R\) to
    a finite restriction of \(R'\). The set of local isomorphisms from \(R\) to \(R'\) is
    denoted \(S_0(R,R')\). For \(f\in S_0(R,R')\), \(\dom(f)\) and \(\im(f)\) denote the domain and
    range of \(f\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
     \((\Z,<)\) is a restriction of \((\R,<)\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(R=R'=(\Z,<)\), there is \(f\in S_0(R,R')\) given by \(\dom(f)​=\{1,2,3\}\)
    and \(\im(f)​=\{10,20,30\}\) and \(f(1)=10\),\(f(2)=20\), \(f(3)=30\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \(f,g\) be local isomorphisms from \(R\) to \(R'\). Then \(f\) is a *restriction* of \(g\)
    if \(f\subseteq g\) and \(f\) is an *extension* of \(g\) if \(f\supseteq g\).
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(g:\{0,1,2,3\}\to\{5,10,20,30\}\), \(g\) extends \(f\) in the previous example
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \(R,R'\) be binary relations with universe \(E,E'\). A *Karpian family* for \((R,R')\) is a
    set \(K\subseteq S_0(R,R')\) satisfying the following two conditions for any \(f\in K\)
    1. (*forth*) if \(a\in E\) then there is \(g\in K\) with \(g\supseteq f\) and \(a\in\dom(g)\)
    2. (*back*) if \(b\in E'\) then there is \(g\in K\) with \(g\supseteq f\) and \(b\in\im(g)\)


    \(R\) and \(R'\) are *\(\infty\)-equivalent*, write \(R\sim_\infty R'\), if there is a non-empty
    Karpian family
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(f:(E,R)\to(E',R')\) an isomorphism and \(K=\{g\subseteq f:g\text{ is finite}\}\), then \(K\) is Karpian
    and \(R\sim_\infty R'\)
    #+END_proposition

    #+BEGIN_proof
    Suppose \(g\in K\)
    * (forth) Suppose \(a\in E\), take \(b=f(a)\) and let \(h=g\cup\{(a,b)\}\). Then \(h\subseteq f\),
      so \(h\in K\), \(h\supseteq g\), \(a\in\dom(h)\)
    * (back) similarly
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \((E,R)\) and \((E',R')\) are countable and \(R\sim_\infty R'\), then \(R\cong R'\)
    #+END_proposition

    #+BEGIN_proof
    Let \(K\subseteq S_0(R,R')\) be Karpian, \(K\neq\emptyset\), \(E=\{e_1,e_2,e_3,\dots\}\), \(E'=\{e_1',e_2',e_3',\dots\}\)

    Recursively build \(f_1\subseteq f_2\subseteq\cdots\), \(f_i\in K\)

    Let \(f_1\) be anything in \(K\) as \(K\) is non-empty.

    \(f_{2i}\) some extension of \(f_{2i-1}\) with \(e_i\in\dom(f_{2i})\)

    \(f_{2i+1}\) some extension of \(f_{2i}\) with \(e_i'\in\im(f_{2i+1})\)

    Now let \(g=\bigcup_{i=1}^\infty f_i\), then \(g\) is an isomorphism
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *dense linear order without endpoints* (DLO) is a linear order \((C,\le)\) satisfying
    1. \(C\neq\emptyset\)
    2. \(\forall x,y\in C\), \(x<y\Rightarrow\exists z\in C\; x<z<y\)
    3. \(\forall x\in C\), \(\exists y,z\in C\;y<x<z\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \((\Q,\le)\), \((\R,\le)\)

    non-example: \((\Z,\le)\), \(([0,1],\le)\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Let \((C,\le)\) and \((C',\le)\) be DLO's. Then \(S_0(C,C')\) is Karpian. So \(C\sim_\infty C'\)
    #+END_proposition

    #+BEGIN_proof
    Let \(f\in S_0(C,C')\), \(\dom(f)=\{a_1,\dots,a_n\}\), \(a_1<\dots<a_n\)
    and \(\im(f)=b_1,\dots,b_n\), \(b_1<\dots<b_n\). Since \(f\) is a local isomorphism, \(f(a_i)=b_i\)
    * (forth) Suppose \(a\in C\). We want \(b\in C'\) s.t. \(f\cup\{(a,b)\}\in S_0(C,C')\).
      + if \(a_i<a<a_{i+1}\). We take \(b\in C'\) s.t. \(b_i<b<b_{i+1}\) since dense
      + if \(a<a_1\). We take \(b\in C'\) s.t. \(b<b_1\) since no endpoints
      + if \(a>a_n\), take \(b\in C'\) s.t. \(b>b_n\)
      + if \(a=a_i\), take \(b=b_i\)
    * (back) similar
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \((C,\le)\) and \((C',\le)\) are countable DLOs, then \(C\sim_\infty C'\), so \(C\cong C'\)
    #+END_proposition
    Hence
    \begin{align*}
    (\Q,\le)&\cong(\Q\setminus\{0\},\le)\\
    &\cong(\Q\cup\{\sqrt{2}\},\le)\\
    &\cong(\Q\cap(0,1),\le)
    \end{align*}
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \(R,R'\) be binary relations with universe \(E,E'\)
    * A *0-isomorphism* from \(R\) to \(R'\) is a local isomorphism from \(R\) to \(R'\)
    * For \(p>0\), a *\(p\)-isomorphism* from \(R\) to \(R'\) is a local isomorphism \(f\) from \(R\)
      to \(R'\) satisfying the following two conditions
      1. (*forth*) For any \(a\in E\), there is a \((p-1)\)-isomorphism \(g\supseteq f\) with \(a\in\dom(g)\)
      2. (*back*) For any \(b\in E'\), there is a \((p-1)\)-isomorphism \(g\supseteq f\) with \(b\in\im(g)\)
    * An *\omega-isomorphism* from \(R\) to \(R'\) is a local isomorphism \(f\) from \(R\) to \(R'\)
      s.t. \(f\) is a \(p\)-isomorphism for all \(p<\omega\)


    The set of \(p\)-isomorphisms from \(R\) to \(R'\) is denoted \(S_p(R,R')\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(R=R'=(\Z,<)\), \(f:\{2,4\}\to\{1,2\}\) is a local isomorphism with \(f(2)=1\) and \(f(4)=2\).
    Then \(f\notin S_1(\Z,\Z)\) (forth) fails. For \(a=3\), there is no \(b\) s.t. \(1<b<2\)

    \(g:\{2,4\}\to\{1,5\}\) is a 1-isomorphism but not a 2-isomorphism
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(f\in S_p(R,R')\) and \(g\subseteq f\), then \(g\in S_p(R,R')\)
    #+END_proposition

    #+BEGIN_proof
    if \(p=0\) easy

    if \(p>0\) (forward), \(\forall a\in E\), \(\exists h\in S_{p-1}(R,R')\) has \(a\in\dom(h)\) and \(h\supseteq f\supseteq g\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    \(S_p(R,R')\neq\emptyset\) iff \(\emptyset\in S_p(R,R')\)
    #+END_proposition

    #+BEGIN_proof
    \(\Leftarrow\) immediate

    \(\Rightarrow\). Suppose \(f\in S_p(R,R')\). Then \(\emptyset\subseteq f\). Hence \(\emptyset\in S_p(R,R')\).
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(R\) and \(R'\) are *\(p\)-equivalent*, written \(R\sim_p R'\), if there is a \(p\)-isomorphism
    from \(R\to R'\)
    #+END_definition

    \(R\) and \(R'\) are *\omega-equivalent* or *elementarily equivalent*, written \(R\sim_\omega R'\)
    or \(R\equiv R'\), if there is an \omega-isomorphism from \(R\) to \(R'\)

    Note: \(R\sim_\omega R'\) iff \(S_\omega(R,R')\neq\emptyset\) iff \(\emptyset\in S_\omega(R,R')\) iff \(\forall p\;\emptyset\in S_p(R,R')\)
    iff \(\forall p\; R\sim_pR'\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \(R,R'\) be binary relations with universe \(E,E'\). The Ehfrenfeucht-Fraïssé game of
    length \(n\), denoted \(\EF_n(R,R')\) is played as follows
    * There are two players, the Duplicator and Spoiler
    * There are \(n\) rounds
    * In the \(i\)th round, the Spoiler chooses either an \(a_i\in E\) or a \(b_i\in E'\)
    * The Duplicator responds with a \(b_i\in E'\) or an \(a_i\in E\) respectively
    * At the ends of the game, the Duplicator wins
      \begin{equation*}
      \{(a_i,b_i),\dots,(a_n,b_n)\}
      \end{equation*}
      is a local isomorphism from \(R\) to \(R'\)
    * Otherwise, the Spoiler wins
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    For \(\EF_3(\Q,\R)\)
    | \(\Q\)        | \(\R\)             |
    |--------------+-------------------|
    | S:\(a_1=7\)   | D:\(b_1=7\)        |
    | D:\(a_2=1.4\) | S:\(b_2=\sqrt{2}\) |
    | D:\(a_3=-10\) | S:\(b_3=1.41\)     |

    So \(D\) wins
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(\EF_3(\R,\Z)\)

    | \(\R\)         | \(\Z\)      |
    | D:\(a_1=1\)    | S:\(b_1=1\) |
    | D:\(a_2=1.1\)  | S:\(b_2=2\) |
    | S:\(a_3=1.01\) |              |
    D fails
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    \(\EF_n(R,R')\) is a win for Duplicator iff \(R\sim_nR'\)
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    In \(\EF_n(R,R')\) if moves so far are \(a_1,b_1,\dots,a_i,b_i\), \(p=n-1\), \(f=\{(a_1,b_1),\dots,(a_i,b_i)\}\).
    Then Duplicator wins iff \(f\in S_p(R,R')\)
    #+END_proposition
* Back-and-forth Equivalence \rom{2}
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \((M,R)\), \((M',R')\) be binary relations.. The Ehfrenfeucht-Fraïssé game of
    length \(n\), denoted \(\EF_n(M,M')\) is played as follows
    * There are two players, the Duplicator and Spoiler
    * There are \(n\) rounds
    * In the \(i\)th round, the Spoiler chooses either an \(a_i\in M\) or a \(b_i\in M'\)
    * The Duplicator responds with a \(b_i\in M'\) or an \(a_i\in M\) respectively
    * At the ends of the game, the Duplicator wins
      \begin{equation*}
      \{(a_i,b_i),\dots,(a_n,b_n)\}
      \end{equation*}
      is a local isomorphism from \(R\) to \(R'\)
    * Otherwise, the Spoiler wins
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Suppose we are playing \(\EF_n(M,M')\) and there have been \(q\) rounds so far, with \(p=n-q\)
    rounds remaining. Suppose the moves so far are \((a_1,b_1),\dots,(a_n,b_n)\).
    Let \(f=\{(a_1,b_1),\dots,(a_q,b_q)\}\). Then the following are equivalent
    * Duplicator has a winning strategy
    * \(f\) is a \(p\)-isomorphism
    #+END_lemma

    #+BEGIN_proof
    By induction on \(p\).

    if \(p=0\), then the game is over, so Duplicator wins iff \(f\in S_0(M,M')\)

    \(p>0\). If \(f\) isn't a local isomorphism, then Duplicator will definitely lose, and \(f\)
    isn't a \(p\)-isomorphism. So we may assume \(f\in S_0(M,M')\). Then the following are equivalent
    * Duplicator wins
    * For any \(a_{q+1}\in M\), there is a \(b_{q+1}\in M'\) s.t. Duplicator wins in the
      position \((a_1,b_1,\dots,a_{q+1},b_{q+1})\),  AND for any \(b_{q+1}\in M'\), there is a \(a_{q+1}\in M\) s.t. Duplicator wins in the
      position \((a_1,b_1,\dots,a_{q+1},b_{q+1})\),
    * For any \(a_{q+1}\in M\) there is a \(b_{q+1}\in M'\)
      s.t. \(f\cup\{(a_{q+1},b_{q+1})\}\in S_{p-1}(M,M')\) (by induction) , AND ...
    * For any \(a_{q+1}\in M\), there is \(g\in S_{p-1}(M,M')\) s.t. \(g\supseteq f\) and \(a_{q+1}\in\dom(g)\),
      AND ....
    * \(f\in S_p(M,M')\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(M\) is \(p\)-equivalent to \(M'\), then \(\EF_p(M,M')\) is a win for the Duplicator.
    Otherwise it is a win for the Spoiler
    #+END_theorem

    #+BEGIN_proof
    We need to prove \(\emptyset\in\EF_p(M,M')\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Every \((p+1)\)-isomorphism is a \(p\)-isomorphism
    #+END_theorem

    #+BEGIN_proof
    By induction on \(p\).

    \(p=0\): every 1-isomorphism is a 0-isomorphism.
    #+END_proof

    So \(S_0(M,M')\supseteq S_1(M,M')\supseteq S_2(M,M')\supseteq\cdots\) In terms of the Ehfrenfeucht-Fraïssé game

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \(s\in S_p(M,M')\) and \(t\in S_p(M',M'')\) and \(\dom(t)=\im(s)\). Then \(u:=t\circ s\in S_p(M,M'')\)
    #+END_theorem

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(M\sim_pM'\) and \(M'\sim_pM''\), then \(M\sim_pM''\)
    #+END_corollary

    #+BEGIN_proof
    \(\emptyset\in S_p(M,M')\) and \(\emptyset\in S_p(M',M'')\), hence \(\emptyset\in S_p(M,M'')\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \(s\in S_p(M,M')\). Then \(s^{-1}\in S_p(M,M')\)
    #+END_theorem

    #+BEGIN_proof
    Since \(s\in S_p(M,M')\), \(s\) is a local isomorphism from \(M\) onto \(M'\). As \(s\) is an
    bijection, \(s^{-1}\) is also a bijection.
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(M\sim_pM'\), then \(M'\sim_pM\)
    #+END_corollary

    \(\sim_p\) is an equivalence relation

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Let \(K\) be a Karpian family for \((M,R)\) and \((M',R')\). Then \(K\subseteq S_p(M,M')\) for
    all \(p\). (also for all \alpha)
    #+END_theorem

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(M,M'\) are DLOs, then \(S_0(M,M')=S_p(M,M')\) for all \(p\). \(M\sim_\omega M'\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    \(A\cong B\)\(\Longrightarrow\)\(A\sim_\infty B\Longrightarrow A\sim_\omega B\Rightarrow A\sim_pB\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    \(\sim_p\) and \(\sim_\omega\) are equivalence relations
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \((\Q,\le)\sim_\omega(C,R)\). Then \((C,R)\) is a DLO
    #+END_theorem

    #+BEGIN_proof
    Suppose \((C,R)\) is not a DLO and break into cases
    * \(R\) is not reflexive. As \(\emptyset\in S_1(\Q,C)\). Spoiler chooses \(b_1\in C\) s.t. \((b_1,b_1)\notin R\). Then duplicator must
      choose \(a_1\in\Q\) s.t. \(a_1\not\le a_1\), impossible
    * \(R\) is antisymmetric. \(\emptyset\in S_2(\Q,C)\). Let \(b_1,b_2\in C\) s.t. \(b_1Rb_2\) and \(b_2Rb_1\). We want
      to show that \(b_1=b_2\). Since \(\emptyset\in S_2(\Q,C)\), we have a local
      isomorphism \(\{(a_1,b_1),(a_2,b_2)\}\in S_0(\Q,C)\). Hence \(a_1\le a_2\) and \(a_2\le a_1\). As so \(a_1=a_2\).
      As this is a bijection, \(b_1=b_2\).
    * \(R\) is transitive. \(\emptyset\in S_3(\Q,C)\). Let \(b_1,b_2,b_3\in C\) s.t. \(b_1Rb_2\) and \(b_2Rb_3\).  因此存
      在\(a_1,a_2,a_3\in\Q\) s.t. \(\{(a_1,b_1),(a_2,b_2),(a_3,b_3)\}\in S_0(\Q,C)\).
    * \(R\) is total. 依靠、\(S_2(\Q,C)\).
    * \((C,R)\) has no maximum. \(\forall b_1\in C\)
    * \((C,R)\) has no minimum
    * \((C,R)\) is dense. For any \(b_1\neq b_2\in C\) s.t. \(b_1Rb_2\). \(S_3(\Q,C)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    The class of DLOs is the \(\sim_\omega\)-equivalence class of \((\Q,\le)\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A linear order \((C,\le)\) is *discrete* without endpoints if \(C\neq\emptyset\) and
    \begin{align*}
    &\forall a\exists b:a\lhd b\\
    &\forall b\exists a:a\lhd b
    \end{align*}
    where \(a\lhd b\) means \(a<b\)  and not \(\exists c:a<c<b\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \((\Z,\le)\). So is \((C,\le)\), where
    \begin{align*}
    C=&\{\dots,-3,-2,-1\}\cup\\
    &\{-1/2,-1/3,-1/4,-1/5,\dots\}\cup\\
    &\{\dots,1/5,1/4,1/3,1/2\}\cup\\
    &\{1,2,3,\dots\}
    \end{align*}
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \((C,<)\) be discrete. If \(a\le b\in C\), then \(d(a,b)\) is the size
    of \([a,b)=\{x\in C:a\le x<b\}\) or \(\infty\) if infinite. If \(a>b\), then \(d(a,b)=d(b,a)\) (definition)
    #+END_definition

    \(d(a,b)=0\Leftrightarrow a=b\)

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \((C,<)\) and \((C',<)\) be discrete linear orders without endpoints. Suppose \(a_1<\dots<a_n\)
    in \(C\) and \(b_1<\dots<b_n\) in \(C'\). Let \(f\) be the local isomorphism \(f(a_i)=b_i\). Suppose
    that for every \(1\le i<n\), we have
    \begin{equation*}
    d(a_i,a_{i+1})=d(b_i,b_{i+1})\text{ or }d(a_i,a_{i+1})\ge 2^p\le d(b_i,b_{i+1})
    \end{equation*}
    Then \(f\) is a \(p\)-isomorphism
    #+END_lemma

    IDEA: a 0-isomorphism needs to respect the order. A 1-isomorphism needs to respect the order
    plus the relation \(d(x,y)=1\) (to make sure we can find the point). A 2-isomorphism needs to
    respect the order plus the
    relation \(d(x,y)=i\) for \(i=1,2,3\). A 3-isomorphism needs to respect the order plus the
    relations \(d(x,y)=i\) for \(i=1,2,3,\dots,7\)

    this is like binary search algorithm:D

    #+BEGIN_proof
    - \(a_i<a<a_{i+1}\)
      * if \(d(a_i,a_{i+1}=d(b_i,b_{i+1}))\)

        which means they are finite
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Let \((C,\le)\) and \((C',\le')\) be discrete linear orders without points. Then \(\emptyset\)is
    a \(p\)-equivalence from \((C,\le)\) to \((C',\le)\) for all \(p\). Therefore \((C,\le)\sim\omega(C',\le)\).
    #+END_theorem

    #+BEGIN_remark
    If \((\Z,\le)\sim_\omega(C,R)\), then \((C,R)\) is a dense linear order
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \((M,R)\), \((M',R')\) be binary relations.. The *infinite Ehfrenfeucht-Fraïssé game*,
    denoted \(\EF_\infty(M,M')\) is played as follows
    * There are two players, the Duplicator and Spoiler
    * There are infinitely many rounds (indexed by \omega)
    * In the \(i\)th round, the Spoiler chooses either an \(a_i\in M\) or a \(b_i\in M'\)
    * The Duplicator responds with a \(b_i\in M'\) or an \(a_i\in M\) respectively
    * if \(\{(a_1,b_1),\dots,(a_n,b_n)\}\) is not a local isomorphism, then the Spoiler immediately wins
    * The Duplicator wins if the Spoiler has not won by the end of the game
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    TFAE
    1. \(R\sim_\infty R'\), i.e., there is a non-empty Karpian family \(K\)
    2. Duplicator has a winning strategy for \(\EF_\infty(M,M')\)
    3. Spoiler does not have a winning strategy for \(\EF_\infty(M,M')\)
    #+END_theorem

    #+BEGIN_proof
    \(1\to 2\). Karpian family is the winning strategy
    #+END_proof




* Connections to Back-and-Forth Technique
    #+ATTR_LATEX: :options [Fraïssé’s Theorem]
    #+BEGIN_theorem
    Let \((M,R)\) and \((N,S)\) be \(m\)-ary relations, let \(\bara\in M^n\) and \(\barb\in N^n\).
    Then \(\bara\) and \(\barb\) are \(p\)-equivalent iff
    \begin{equation*}
    (M,R)\vDash f(\bara)\Longleftrightarrow(N,S)\vDash f(\barb)
    \end{equation*}
    for any formula \(f(\barx)\) with quantifier rank at most \(p\)
    #+END_theorem

    #+BEGIN_proof
    \(\Rightarrow\). Induction on \(p\). If \(\bara\sim_0\barb\), then by definition, they satisfy the same
    atomic formulas. Therefore they satisfy the same quantifier-free formulas.

    Suppose that \(\bara\sim_{p+1}\barb\). The formula \(f:=(\exists y)g(\barx,y)\) has quantifier rank at
    most \(p+1\). So \(g(\barx,y)\) is a formula of quantifier rank at
    most \(p\). \((M,R)\vDash f(\bara)\) iff there is a \(c\in M\) s.t. \((M,R)\vDash g(\bara,c)\). Then there
    is a \(d\in N\) s.t. \(\bara c\sim_p\barb d\). By IH, \((N,S)\vDash g(\barb,d)\) and
    thus \((N,S)\vDash(\exists y)g(\barb,y)\). Another direction is similar

    #+END_proof

    To prove the converse we need the following lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If the arity \(m\) of a relation, and the integers \(n\) and \(p\) are fixed, there is only
    finite number \(C(n,p)\) of \(p\)-equivalence classes of \(n\)-tuples
    #+END_lemma

    \((M,R_1,\bara_1),\dots,(M,R_n,\bara_n)\). For any \((M,R)\) and \(\bara\in M\), \(\exists 1\le i\le n\) s.t. \(\bara\sim_p\bara_i\)

    #+BEGIN_proof
    Induction on \(p\). If \(p=0\), then consider a set of symbols \(X=\{x_1,\dots,x_n\}\). There are at
    most finitely many \(m\)-ary relations defined on \(X\). Also there are at most finitely many
    ways to interpret the relation "=" on \(X\). Let \((M,R)\) and \((N,S)\) be \(m\)-ary
    relations, \(\bara\in M^n\) and \(\barb\in N^n\). Let \(A =\{a_1,\dots,a_n\}\) and \(B =\{b_1,\dots,b_n\}\).
    Let \(R_A =R\cap A^m\) and \(S_B =S\cap B^m\). If \(p=0\), \(\bara\sim_0\barb\) iff \(R_A\) is isomorphic
    to \(R_B\) via \(a_i\mapsto b_i\), \(i=1,\dots,n\). So there are at most finitely many 0-equivalence classes
    of \(n\)-tuples

    By IH, there exists relations \(\{(M_k,R_k)\mid k\le C(n+1,p)\}\)
    and \(\{\bard_k\in M_k^{n+1}\mid k\le C(n+1,p)\}\) s.t. each \(n+1\)-tuple is \(p\)-equivalent to
    some \(\bard_k\). Now consider an arbitrary relation \((M,R)\) and an \(n\)-tuple \(\bara\), we
    define \([\bara]=\{k\mid\exists c\in M(\bara c\sim_p\bard_k)\}\). For any relation \((N,S)\)
    and \(\barb\in N^n\), \(\bara\sim_{p+1}\barb\Leftrightarrow[\bara]=[\barb]\)
    #+END_proof

    #+ATTR_LATEX: :options [Proof (continued)]
    #+BEGIN_proof
    We now show that if \(\bara\) and \(\barb\) satisfy the same formulas of QR at most \(p\),
    then \(\bara\sim_p\barb\).

    Claim: For each \(p\)-equivalence class \(C\), there is a formula \(f_C\) of QR \(p\) s.t. the
    tuples in \(C\) are exactly those satisfy \(f_C\). \((M,R,\bara)\in C\Leftrightarrow R\vDash f_C(\bara)\).

    Induction on \(p\). If \(p=0\), given an \(n\)-tuple \(\bara\), there are finitely many atomic
    formulas with variables \(x_1,\dots,x_n\). \(n^2+n^m\). \(\{x_i=x_j\mid i,j\le n\}\)
    and \(\{r(x_{i_1},\dots,x_{i_m})\mid i_j\le n\}\).

    Let \(f_C\) be the conjunction of those satisfied
    by \(\bara\) and negation of the others. Then \(f_C\) characterizes the 0-equivalence class
    of \(\bara\). (characterizes \(\restr{R}{\{a_1,\dots,a_n\}}\))

    Now prove \(p+1\). Let \(\bara\) be an \(n\)-tuple of \((M,R)\).
    Let \(f_1(\barx,y),\dots,f_k(\barx,y)\) characterize all the \(p\)-equivalence classes \(C_1,\dots,C_k\)
    on \(n+1\)-tuples. Let \(\la\bara\ra=\{i\le k\mid(M,R)\vDash(\exists y)f_i(\bara,y)\}\). \(\la\bara\ra=[\bara]\)

    Let
    \(f_C(\barx)=\bigwedge_{i\in\la\bara\ra}(\exists y)f_i(\barx,y)\wedge\bigwedge_{i\notin\la\bara\ra}\neg(\exists y)f_i(\barx,y)\).
    \(\barb\sim_{p+1}\bara\) iff \([\bara]=[\barb]\) iff \(\la\bara\ra=\la\barb\ra\) iff \(f_C(\barb)\) holds
    #+END_proof

    bracket system
* Compactness
** Ultraproducts
    If \(I\) is a nonempty set, a *filter* is a set \(F\) of subsets of \(I\) s.t.
    * \(I\in F\), \(\emptyset\in F\)
    * if \(X,Y\in F\), then \(X\cap Y\in F\)
    * if \(X\in F\) and \(X\subset Y\), then \(Y\in F\)


    A *filter prebase* \(B\) is a set of subsets of \(I\) contained in a filter; this means that the
    intersection of a finite number of elements of \(B\) is never empty. The filter \(F_B\)
    consisting of subsets of \(I\) containing a finite intersection of elements of \(B\) is the
    smallest filter containing \(B\); we call it the filter *generated* by \(B\). If, in addition, the
    intersection of two elements of \(B\) is always in \(B\), we call \(B\) a *filter base*

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Let \(J\) be a set and \(I\) the set of finite subsets of \(J\); for every \(i\in I\),
    let \(I_i=\{j:j\in I,j\supset i\}\), and let \(B\) be the set of all the \(I_i\).
    Then \(I_i\cap I_j=I_{i\cup J}\); \(B\) is closed under finite intersections and does contain \(\emptyset\); It
    is therefore a filter base.
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    A filter \(F\) of subsets of \(I\) is an ultrafilter iff for every subset \(A\) of \(I\),
    either \(A\) or its complement \(I-A\) is in \(F\)
    #+END_theorem

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Let \(U\) be an ultrafilter of subsets of \(I\). If \(I\) is covered by finitely many
    subsets \(A_1,\dots,A_n\), then one of the \(A_i\) is in \(U\); moreover, if the \(A_i\) are pairwise
    disjoint, exactly one of the \(A_i\) is in \(U\)
    #+END_theorem

    [[https://u.cs.biu.ac.il/~tsaban/RT/Book/Chapter2.pdf][Ultrafilter and Compactness]]

    A topological space X is compact if and only if every ultrafilter in \(X\) is convergent
** Applications of Compactness
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If \(M\) and \(N\) are elementarily equivalent structures, then \(M\) can be embedded into an
    ultraproduct of \(N\)
    #+END_lemma

    #+BEGIN_proof
    Let \(I\) be the set of injections from finite subset of \(M\) to \(N\). If \(f(\bara)\) is a
    formula with parameters \(\bara\) in \(M\), \(M\vDash f(\bara)\), let \(I_{f(\bara)}\) denote the set
    of such injections \(s\) whose universe contains \(\bara\) and s.t. \(N\vDash f(s(\bara))\). The
    set \(I_{f(\bara)}\) is never empty, as \(M\vDash f(\bara)\), so \(M\vDash\exists\barx(f(\barx)\wedge D(\barx))\),
    where \(D\) is the conjunction of the formulas \(x_i=x_j\) if \(a_i=a_j\), and \(x_i\neq x_j\)
    otherwise, and \(N\) also satisfies this formula. On the other
    hand, \(I_{f(\bara)}\cap I_{g(\barb)}=I_{f(\bara)\wedge g(\barb)}\), so the \(I_{f(\bara)}\) form a
    filter base, which can be extended to an ultrafilter

    Define a function \(S\) from \(M\) to \(N^U\) as follows: If \(a\in M\), the \(i\)th coordinate
    of \(Sa\) is \(ia\) if \(i\) is defined at \(a\), and any element of \(N\) otherwise (We are
    excluding the case of empty universes, which is trivial.) Note
    that \(\{i:i\text{ is defined at }a\}=I_{a=a}\), and that changing the coordinates outside
    of \(I_{a=a}\) will not change \(Sa\) modulo \(U\), so \(S\) is well-defined.
    #+LATEX: \wu{
    If \(a=b\), then \(S(a)=S(b)\) iff \(\{i:N\vDash i(a)=i(b)\}=I_{a=b}\in U\). If \(a\neq b\) ,
    then \(I_{a\neq b}\in U\), hence \(S\) is an injection.
    #+LATEX: }

    \(N^U\vDash\phi(S(\bara))\) iff \(\{i:N\vDash\phi(i(\bara))\}\in U\). If \(M\vDash\phi(\bara)\), then \(\{i:N\vDash\phi(i(\bara))\}=I_{\phi(\bara)}\).
    #+END_proof

* Quantifier elimination
    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If two structures \(M\) and \(N\) are elementarily equivalent and \omega-saturated, they
    are \(\infty\)-equivalent: More precisely, two tuples of the same type (over \(\emptyset\)), one in \(M\) and
    the other in \(N\), can be matched up by an infinite back-and-forth construction
    #+END_theorem

    If \(M\) is \omega-saturated, then for every \(\bara\) of \(M\) and every \(p\)
    of \(S_n(\bara)\), \(p\) is realised in \(M\)

    An \omega-saturated model therefore realises all absolute \(n\)-types for all \(n\). This condition,
    however, is not sufficient for a model to be \omega-saturated. Example: let \(T\) be the theory of
    discrete order without endpoints; \(M\) is \omega-saturated iff it has the form \(\Z\times\C\) where \(\C\)
    is a dense chain without endpoints, while it realizes all pure \(n\)-types iff it has the
    form \(\Z\times\C\) where \(\C\) is an infinite chain
    <<Problem1>>

    If \(T\) is a complete theory and \(M\) is an \omega-saturated model of \(T\), then every denumerable
    model \(N\) of \(T\) can be elementarily embedded in \(M\). In fact, if \(N=\{a_0,a_1,\dots,a_n,\dots\}\),
    we can successively realize, in \(M\), the type of \(a_0\), then the type of \(a_1\)
    over \(a_0\), \dots, the type of \(a_{n+1}\) over \((a_0,\dots,a_n)\), \(\dots\)

    As two denumerable, elementarily equivalent, \omega-saturated structures are isomorphic. Under what
    conditions does a complete theory \(T\) have a (unique) \omega-saturated denumerable model? That
    happens iff for every \(n\), \(S_n(T)\) is (finite or) denumerable. (Here, we do not assume that
    \(T\) is denumerable)

    In fact, this condition further implies that for every \(\bara\in M\), \(S_1(\bara)\) is
    denumerable (because to say that \(b\) and \(c\) have the same type over \(\bara\) is to say
    that \(\bara b\) and \(\bara c\) have the same type over \(\emptyset\)) . It is clearly necessary,
    because a denumerable model can realize only denumerable many \(n\)-types. To see that it is
    sufficient: Let \(A_1\) be a denumerable subset of \(M\) that realizes all 1-types over \(\emptyset\);
    then let \(A_2\) be a denumerable subset of \(M\) that realises all 1-types over finite subsets
    of \(A_1\); etc. Let \(A=\bigcup A_n\). \(A\) satisfies Tarski's test so it is an elementary submodel
    of \(M\)

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:thm5.3
    Let \(T\) be a theory, not necessarily complete, and let \(F\) be a nonempty set of
    formulas \(f(\barx)\) in the language \(L\) of \(T\), having for free variables
    only \(\barx=(x_1,\dots,x_n)\), s.t. two \(n\)-tuples from models of \(T\) have the same type
    whenever they satisfy the same formulas of \(F\). Then for every formula \(g(\barx)\) of \(L\)
    in these variables, there is some \(f(\barx)\) that is a Boolean combination of elements
    of \(F\) s.t. \(T\vDash\forall\barx(f(\barx)\leftrightarrow g(\barx))\)
    #+END_theorem

    #+BEGIN_proof
    Consider the clopen set \([g(\barx)]\) in \(S_n(T)\). If \([g]=\emptyset\), then \([g]=[f\wedge\neg f]\), and
    if \([g]=S_n(T)\), then \([g]=[f\vee\neg f]\), where \(f\) is an arbitrary element of \(F\), which is
    nonempty. Consider \(p\in[g]\) and \(q\notin[g]\). There is \(f_{p,q}\in F\) s.t. \(p\vDash f_{p,q}(\barx)\)
    and \(q\vDash\neg f_{p,q}(\barx)\)
    #+LATEX: \wu{
    If \(p\) and \(q\) are different, then they are realised by two tuples satisfying different
    formulas of \(F\). Here we consider the model amalgamated by the model realising \(p\) and the
    model realising \(q\). Thus such \(f_{p,q}\) exists
    #+LATEX: }

    Keeping \(p\) fixed and varying \(q\), all the \([f_{p,q}]\) and \(\neg[g]\) form a family of
    closed sets whose intersection is empty;
    #+LATEX: \wu{
    \(\bigcup[\neg f_{p,q}]\supset[\neg g]\).
    #+LATEX: }
    by compactness, one of its finite subfamilies must have
    empty intersection, meaning that for some \(h_p=f_{p,q}\wedge\dots\wedge f_{p,q_n}\in[h_p]\subset[g]\)

    Now when we vary \(p\), \([g]\) is a compact set that is covered by the open sets \([h_p]\), so
    a finite number of them are enough to cover it; the disjunction of these \(h_p\), module \(T\),
    is equivalent to \(g\)
    #+END_proof

    Note that if we want that every sentence be equivalent module \(T\) to a quantifier-free
    sentence; that requires, naturally, that the set of sentences without quantifiers be nonempty,
    meaning that the language *involves* constant symbols, or else nullary relation symbols.

    A theory \(T\) is *model complete* if it has the following property: If \(M,N\vDash T\) and
    if \(N\subseteq M\), then \(N\preceq M\)

    Two theories \(T_1\) and \(T_2\) in the same language \(L\), are *companions* if every model of one
    can be embedded into a model of the other

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Two theories are companions of each other iff they have the same universal consequences (a
    sentence being called *universal* if it is of the form \(\forall x_1,\dots,x_n\;f(x_1,\dots,x_n)\) with \(f\)
    quantifier-free)
    #+END_theorem

    #+BEGIN_proof
    A universal sentence \(f\) that is true in a structure is always true in its substructure;
    if \(T_1\vDash f\) and if there is a model of \(T_2\) that doesn't satisfy \(f\), it cannot be extended
    to a model of \(T_1\)

    Conversely, suppose that \(T_1\) and \(T_2\) have the same universal consequences, and
    let \(M_1\vDash T_1\). We name each element of \(M_1\) by a new constant, and let \(D(M_1)\) be the set
    of all /quantifier-free/ sentences in the new language that are true in \(M_1\).
    If \(D(M_1)\vDash f(a_1,\dots,a_n)\), then \(M\vDash\exists\barx\;f(\barx)\), so \(\forall\barx\neg f(\barx)\) is not a
    consequence of \(T_1\), and therefore not of \(T_2\). There is therefore some model \(M_2\vDash T_2\)
    with \(\barb\in M_2\) s.t. \(M_2\vDash f(\barb)\). By compactness, this means that \(D(M_1)\cup T_2\) is
    consistent, in other words, that \(M_1\) embeds into a model of \(T_2\)
    #+END_proof

    A theory \(T\) therefore has a minimal companion, which we shall denote by \(T_\forall\), which is
    axiomatized by the universal consequences of \(T\).

    A theory \(T'\) is a *model companion* of \(T\) if it is a companion of \(T\) that is model complete

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    A theory has at most one model companion
    #+END_theorem

    #+BEGIN_proof
    Let \(T_1\) and \(T_2\) be model companions of \(T\). Therefore \(T_1\) and \(T_2\) are companions.
    Let \(M_1\vDash T_1\); it embeds into a \(N_1\vDash T_2\), which embeds into a \(M_2\vDash T_1\). We get a chain
    \(M_1\subset N_1\subset M_2\subset N_2\subset\cdots\subset M_n\subset N_n\subset\cdots\), whose limit we call \(P\). As \(T_1\) is model complete, the
    chain of \(M_n\) is elementary, and \(P\) is an elementary extension of \(M_1\);
    similarly \(N_1\preceq P\). Therefore \(M_1\)is also a model of \(T_2\); by symmetry \(T_1\) and \(T_2\)
    have the same models, meaning \(T_1=T_2\)
    #+END_proof

    We say that \(T'\) is a *model completion* of \(T\) if it is a model companion of \(T\) and also
    the following condition is satisfied: if \(M\vDash T\), embeds into a model \(M_1\vDash T'\) and into a
    model \(M_2\vDash T'\), then a tuple \(\bara\) of \(M\) satisfies the same formulas in \(M_1\) and in \(M_2\)

    Naturally a model complete theory is its own model completion, and it is clear that a theory
    that admits quantifier elimination is the model completion of every one of its companions. A
    theory is the model completion of every one of its companions iff it is the model completion of
    the weakest of them all, \(T_\forall\)

    In the particular case where for every \(n>0\) we can take for \(F\) the quantifier-free
    formulas, we say that the theory \(T\) *eliminates quantifiers* or *admits quantifier elimination*.

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    The model completion of a universal theory (i.e., one that is axiomatized by universal
    sentences) admits quantifier elimination
    #+END_theorem

    #+BEGIN_proof
    Let \(\bara\) and \(\barb\) satisfying the same quantifier-free formulas, be in two
    models \(M_1\) and \(M_2\) of this theory \(T'\), and let \(N_1\subseteq M_1\), \(N_2\subseteq M_2\) generated
    by \(\bara\) and \(\barb\) respectively.
    #+END_proof



    \(\DLO\) has quantifier elimination

    Facts. In \(\DLO\), any 0-isomorphism is an \omega-isomorphism.

    Suppose \(\qftp(\bara)=\qftp(\barb)\), want \(\tp(\bara)=\tp(\barb)\)

    \(\exists f:\la\bara\ra_{\fM}\to\la\barb\ra_{\fN}\) an isomorphism by Theorem 6, \(f\in S_0(\fM,\fN)=S_\omega(\fM,\fN)\). Then by Fraïssé's
    theorem, \(\tp(\bara)=\tp(\barb)\)

    \(M\equiv N\Leftrightarrow\la\emptyset\ra_M\cong\la\emptyset\ra_N\Leftrightarrow char(M)=char(N)\)

    same characteristic determine same minimal subring

    \(M^n/\Aut(M/A)\cong S_n(A)\)

    Algebraically closed fields are axiomatized by the field axioms plus the axiom schema
    \begin{equation*}
    \forall y_0,\dots,y_n\left( y_n\neq 0\to\exists x\sum_{i=0}^ny_ix^i=0 \right)
    \end{equation*}
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If \(K\vDash\ACF\), then \(K\) is infinite
    #+END_lemma

    #+BEGIN_proof
    If \(K=\{a_1,\dots,a_n\}\), then \(P(x)=1+\prod_{i=1}^n(x-a_i)\) has no root in \(K\)
    #+END_proof

    If \(M\vDash\ACF\) and \(K\) is a subfield, then \(K^{\alg}\) denotes the set of \(a\in M\) algebraic
    over \(K\)

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:24
    Given uncountable \(M,N\vDash\ACF\), suppose \(\bara\in M^n\) and \(\barb\in N^n\)
    and \(\qftp^M(\bara)=\qftp^N(\barb)\). Suppose \(\alpha\in M\). Then there is \(\beta\in N\) s.t. \(\qftp^M(\bara,\alpha)=\qftp^N(\barb,\beta)\)
    #+END_lemma

    #+BEGIN_proof
    Let \(A=\la\bara\ra_M\) and \(B=\la\barb\ra_N\). There is an isomorphism \(f:A\to B\) and we can
    extend \(f\) to an isomorphism \(f:\Frac(A)\to\Frac(B)\) (Note that \(A\) and \(B\) are subrings
    since they are only closed under multiplication and addition). Moving \(N\) by an isomorphism we may
    assume \(\Frac(A)=\Frac(B)\) and \(f=id_{\Frac(A)}\). (In particular, \(\bara=\barb\)).
    let \(K=\Frac(A)\). Let \(K=\Frac(A)\)

    *Claim*. There is \(\beta\in N\) with \(I(\alpha)=I(\beta)\) in \(K\)

    Suppose \alpha is algebraic over \(K\) with minimal polynomial \(P(x)\). Take \(\beta\in N\)
    with \(P(\beta)=0\). Let \(Q(x)\) be the minimal polynomial over \beta over \(K\).
    Then \(P(x)\in Q(x)\cdot K[x]\). But \(P(x)\) is irreducible, so \(P(x)=Q(x)\). Then \(I(\alpha)=I(\beta)\)

    suppose \alpha is transcendental, since there are only countable many solutions, there is
    transcendental \(\beta\in N\). Then \(I(\alpha)=I(\beta)=0\)

    Take such \beta, let \(I=I(\alpha)=I(\beta)\)
    * If \(P(x)\in K[x]\), \(P(\alpha)=0\Leftrightarrow P(x)\in I\Leftrightarrow P(\beta)=0\)
    * If \(P(x),Q(x)\in K[x]\), then \(P(\alpha)=Q(\alpha)\Leftrightarrow(P-Q)(\alpha)=0\Leftrightarrow(P-Q)(\beta)=0\Leftrightarrow P(\beta)=Q(\beta)\)
    * Hence if \(\varphi(x)\) is an atomic \(\call(K)\)-formula, then \(M\vDash\varphi(\alpha)\Leftrightarrow N\vDash\varphi(\beta)\)
    * so is quantifier-free \(\varphi(x)\in\call(K)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Lemma ref:24 holds if we replace "uncountable" with "\omega-saturated"
    #+END_lemma

    #+BEGIN_proof
    Take uncountable \(M'\succeq M\) and \(N'\succeq N\), this is possible since models of \(\ACF\) are
    infinite. By Lemma ref:24, there is \(\beta_0\in N'\) s.t. \(\qftp(\bara,\alpha)=\qftp(\barb,\beta_0)\). By
    \omega-saturation, we can find \(\beta\in N\) s.t. \(\tp(\beta/\barb)=\tp(\beta_0/\barb)\). Then \(\tp(\barb,\beta)=\tp(\barb,\beta_0)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    \(\ACF\) has quantifier elimination
    #+END_theorem

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \(M,N\vDash\ACF\), then \(M\equiv N\Leftrightarrow\tchar(M)=\tchar(N)\)
    #+END_theorem

    #+BEGIN_proof
    TFAE
    * \(M\equiv N\)
    * for every sentence \varphi, \(M\vDash\varphi\Leftrightarrow N\vDash\varphi\)
    * for every quantifier-free sentence \varphi, \(M\vDash\varphi\Leftrightarrow N\vDash\varphi\)
    * for every atomic sentence \varphi, \(M\vDash\varphi\Leftrightarrow N\vDash\varphi\)
    * for any terms \(t_1,t_2\), \(M\vDash t_1=t_2\Leftrightarrow N\vDash t_1=t_2\)
    * for any term \(t\), \(M\vDash t=0\Leftrightarrow N\vDash t=0\)
    * for any \(n\in\Z\), \(M\vDash n=0\Leftrightarrow N\vDash n=0\)
    * \(\{n\in\Z:n^M=0\}=\{n\in\Z:n^N=0\}\)
    * \(\tchar(M)=\tchar(N)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    \(\ACF_p\) is complete for each \(p\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    \(\C\) is completely axiomatized by \(\ACF_0\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \(M\) be algebraically closed. Let \(K\) be a field. Let \(\varphi(x)\) be an \(\call(K)\)-formula in
    one variable. Let \(D=\varphi(M)\). Then there is a finite subset \(S\subseteq K^{\alg}\) s.t. \(D=S\)
    or \(D=M\setminus S\), that is, either \(D\subseteq K^{\alg}\) or \(M\setminus K\subseteq K^{\alg}\)
    #+END_lemma

    #+BEGIN_proof
    By Q.E., we may assume \varphi is quantifier-free. Then \varphi is a boolean combination of atomic formulas

    Let \(\calf=\{S:S\subseteq_fK^{\alg}\}\cup\{M\setminus S:S\subseteq_fK^{\alg}\}\). Note that \(\calf\) is closed under boolean
    combinations. So we may assume \varphi is an atomic formula

    Then \(\varphi(x)\) is \((P(x)=0)\) for some \(P(x)\in K[x]\). If \(P(x)\equiv 0\), then \(\varphi(M)=M\in\calf\).
    Otherwise \(\varphi(M)\subseteq_fK^{\alg}\), so \(\varphi(M)\in\calf\)
    #+End_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:34
    Suppose \(M\preceq N\vDash\ACF\) and \(K\) is a subfield of \(M\). Suppose \(c\in N\) is algebraic
    over \(K\). Then \(c\in M\)
    #+END_lemma

    #+BEGIN_proof
    Let \(P(x)\) be the minimal polynomial of \(c\) over \(K\). Let \(b_1,\dots,b_n\) be the roots
    of \(P(x)\) in \(M\). Then
    \begin{equation*}
    M\vDash\forall x\left( P(x)=0\to\bigvee_{i=1}^nx=b_i \right)
    \end{equation*}
    so the same holds in \(N\). Then \(P(c)=0\Rightarrow c\in\{b_1,\dots,b_n\}\subseteq M\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(M\vDash\ACF\) and \(K\) is a subfield, then \(K^{\alg}\) is a subfield of \(M\) and \((K^{\alg})^{\alg}=K^{\alg}\)
    #+END_theorem

    #+BEGIN_proof
    Suppose \(a,b\in K^{\alg}\). We claim \(a+b\in K^{\alg}\). Let \(P(x)\) and \(Q(y)\) be the minimal
    polynomials of \(a,b\) over \(K\). Let \(\varphi(z)\) be the \(\call(K)\)-formula
    \begin{equation*}
    \exists x,y(P(x)=0\wedge Q(y)=0\wedge x+y=z)
    \end{equation*}
    Then \(M\vDash\varphi(a+b)\) and \(\varphi(M)=\{x+y:P(x)=0=Q(y)\}\) is finite. Thus \(a+b\in\varphi(M)\subseteq K^{\alg}\)

    A similar argument shows \(K^{\alg}\) is closed under the field operations, so \(K^{\alg}\) is a
    subfield of \(M\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \(M\vDash\ACF\) and \(K\) is a subfield. TFAE
    1. \(K=K^{\alg}\)
    2. \(K\vDash\ACF\)
    3. \(K\preceq M\)
    #+END_theorem

    #+BEGIN_proof
    \(1\to 2\): suppose \(P(x)\in K[x]\) has degree \(>0\). Then there is \(c\in M\) s.t. \(P(c)=0\). By
    definition, \(c\in K^{\alg}=K\)

    \(2\to 3\): quantifier elimination

    \(3\to 1\). ref:34
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(M\vDash\ACF\) and \(K\) is a subfield, then \(K^{\alg}\vDash\ACF\)
    #+END_corollary

    \(K^{\alg}\) is called the *algebraic closure* of \(K\). It is independent of \(M\):
    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Let \(M,N\) be two algebraically closed fields extending \(K\). Let \((K^{\alg})_M\)
    and \((K^{\alg})_N\) be \(K^{\alg}\) in \(M\) and \(N\), respectively. Then \((K^{\alg})_M\cong(K^{\alg})_N\)
    #+END_theorem


* Saturated Models
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \(S_0\subseteq S_1\subseteq\cdots\subseteq S_\alpha\subseteq\cdots\) be an increasing chain of sets indexed by \(\alpha<\kappa\) for some regular
    cardinal \kappa. If \(A\subseteq\bigcup_{\alpha<\kappa}S_\alpha\) and \(\abs{A}<\kappa\), then \(A\subseteq S_\alpha\) for some \(\alpha<\kappa\)
    #+END_lemma

    #+BEGIN_proof
    define \(f:A\to\kappa\) by \(f(x)=\min\{\alpha:x\in S_\alpha\}\). Then \(\abs{f(A)}\le\abs{A}<\kappa\),
    so \(\alpha:=\sup f(A)<\kappa\). For any \(x\in A\), we have \(f(x)\le\alpha\) and so \(x\in S_{f(x)}\subseteq S_\alpha\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(M\) is a structure and \kappa is a cardinal, there is a \kappa-saturated \(N\succeq M\)
    #+END_theorem

    #+BEGIN_proof
    Build an elementary chain
    \begin{equation*}
    M_0\preceq M_1\preceq\cdots\preceq M_\alpha\preceq\cdots
    \end{equation*}
    of length \(\kappa^+\), where
    1. \(M_0=M\)
    2. \(M_{\alpha+1}\) is an elementary extension of \(M_\alpha\) realizing every type in \(S_1(M_\alpha)\)
    3. If \alpha is a limit ordinal, then \(M_\alpha=\bigcup_{\beta<\alpha}M_\beta\)


    Let \(N=\bigcup_{\alpha<\kappa^+}M_\alpha\). If \(A\subseteq N\) and \(\abs{A}<\kappa\), then \(A\subseteq M_\alpha\) for some \(\alpha<\kappa^+\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \(M\) is \kappa-saturated. If \(A\subseteq M\) and \(\abs{A}<\kappa\), then every \(p\in S_n(A)\) is
    realized in \(M\)
    #+END_theorem

    #+BEGIN_proof
    Take \(N\succeq M\) containing a realization \(\bara\) of \(p\). We can extend the partial elementary
    map to\(\id_A:A\to A\) to \(f:A\cup\{a_1,\dots,a_n\}\to B\) where \(B\subseteq M\). Then
    \(\tp^M(f(\bara)/A)=\tp^N(\bara/A)=p\), so \(f(\bara)\) realizes \(p\) in \(M\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    For any \(M\) there is an elementary extension \(N\succeq M\) with the following properties:
    * Every type over \(M\) is realized in \(N\)
    * If \(A,B\subseteq M\) and \(f:A\to B\) is a partial elementary map, then there is \(\sigma\in\Aut(N)\)
      with \(\sigma\supseteq f\)
    #+END_lemma

    #+BEGIN_proof
    Build an elementary chain
    \begin{equation*}
    M=M_0\preceq M_1\preceq\cdots
    \end{equation*}
    of length \omega, where \(M_{i+1}\) is \(\abs{M_i}^+\)-saturated. Every \(p\in S_n(M)\) is realized
    in \(M_1\)

    For the second point, let \(f:A\to B\) be given. Recursively build an increasing chain of partial
    elementary maps \(f_n\) with \(\dom(f_n),\im(f_n)\subseteq M_n\) as follows:
    * \(f_0=f\)
    * If \(n>0\) is odd, then \(f_n\) is a partial elementary map extending \(f_{n-1}\)
      with \(\dom(f_n)=M_{n-1}\) and \(\im(f_n)\subseteq M_n\)
    * If \(n>0\) is even, then \(f_n\) is a partial elementary map extending \(f_{n-1}\)
      with \(\dom(f_n)\subseteq M_n\) and \(\im(f_n)=M_{n-1}\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(M\) is a structure and \kappa is a cardinal, there is a strongly \kappa-homogeneous
    \kappa-saturated \(N\succeq M\)
    #+END_theorem

    #+BEGIN_proof
    Build an elementary chain
    \begin{equation*}
    M_0\preceq M_1\preceq\cdots\preceq M_\alpha\preceq\cdots
    \end{equation*}
    of length \(\kappa^+\).
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \(M\) be a \kappa-saturated \(L\)-structure. For \(L_0\subseteq L\), the reduct \(M\uhr L_0\) is \kappa-saturated
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:12.3
    Let \(M\) be an \(L\)-structure and \kappa be a cardinal. There is an \(L\)-structure \(N\succeq M\) s.t.
    for every \(L_0\subseteq L\), the reduct \(N\uhr L_0\) is \kappa-saturated and \kappa-strongly homogeneous
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \(T\) be an \(L(R)\)-theory
    1. \(R\) is *implicitly defined* in \(T\) if for every \(L\)-structure \(M\), there is at most
       one \(R\subseteq M^n\) s.t. \((M,R)\vDash T\)
    2. \(R\) is *explicitly defined* in \(T\) if there is an \(L\)-formula \(\phi(x_1,\dots,x_n)\) s.t. \(T\vdash\forall\barx(R(\barx)\leftrightarrow\phi(\barx))\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Suppose \(R\) is not explicitly defined in \(T\). Then there are \(M,N\vDash T\)
    and \(\bara\in M^n\), \(\barb\in N^n\) s.t.
    * \(\tp^L(\bara)=\tp^L(\barb)\)
    * \(M\vDash R(\bara)\) and \(N\vDash\neg R(\barb)\)
    #+END_lemma

    #+BEGIN_proof
    Suppose not. Let \(S=\{\tp^L(\bara):M\vDash T,\bara\in M^n\}\). For \(p\in S\), one of two things happends
    1. Every realization of \(p\) satisfies \(R\)
    2. Every realization of \(p\) satisfies \(\neg R\)


    Otherwise we can find a realization \(\bara\) satisfying \(R\) and a realization \(\barb\)
    satisfying \(\neg R\), as desired.

    By compactness, for each \(p\in S\) there is an \(L\)-formula \(\phi_p(\barx)\in p(\barx)\)  s.t. one
    of two things happens
    1. \(T\cup\{\phi_p(\barx)\}\vdash R(\barx)\)
    2. \(T\cup\{\phi_p(\barx)\}\vdash\neg R(\barx)\)


    Let \(\Sigma(\barx)=T\cup\{\neg\phi_p(\barx):p\in S\}\). If \(\Sigma(\barx)\) is consistent, there is \(M\vDash T\)
    and \(\bara\in M^n\) satisfying \(\Sigma(\barx)\). Let \(p=\tp^L(\bara)\), so it satisfies \(\phi_p\) but it
    also satisfies \(\neg\phi_p\), a contradiction

    Therefore \(\Sigma(\barx)\) is inconsistent. By compactness there are \(p_1,\dots,p_n,q_1,\dots,q_m\in S\) s.t.
    \begin{gather*}
    T\vdash\bigvee_{i=1}^n\phi_{p_i}(\barx)\vee\bigvee_{i=1}^m\phi_{q_i}(\barx)\\
    T\cup\{\phi_{p_i}(\barx)\}\vdash R(\barx)\quad\text{ for }i=1,\dots,n\\
    T\cup\{\phi_{q_i}(\barx)\}\vdash \neg R(\barx)\quad\text{ for }i=1,\dots,n\\
    \end{gather*}
    Then \(T\vdash\forall\barx(R(\barx)\leftrightarrow\bigvee_{i=1}^n\phi_{p_i}(\barx))\). The \(\leftarrow\) is by the choice of the \(\phi_{p_i}\).
    The \(\to\) is because if none of the \(\phi_{p_i}\) hold, then one of the \(\phi_{q_i}\) holds, and
    then \(\neg R\) must hold.

    Finally \(\vee_{i=1}^n\phi_{p_i}(\barx)\) is an explicit definition of \(R\)

    If \(m=0\), then \(T\vdash R(\barx)\), if \(n=0\), then \(T\vdash \neg R(\barx)\)
    #+END_proof

    #+ATTR_LATEX: :options [beth]
    #+BEGIN_theorem
    If \(R\) is implicitly defined in \(T\), then \(R\) is explicitly defined in \(T\)
    #+END_theorem

    #+BEGIN_proof
    *Case 1*: \(T\) is complete.

    If \(R\) is not explicitly defined, we obtain \(M,N\vDash T\) and \(\bara\in M^n\), \(\barb\in N^n\)
    with \(\tp^L(\bara)=\tp^L(\barb)\) but \(M\vDash R(\bara)\) and \(N\vDash\neg R(\bara)\). Since \(T\) is
    complete, we have \(M\equiv N\). By elementary amalgamation, we may find elementary
    embeddings \(M\to N'\), \(N\to N'\). Replacing \(M\) and \(N\) by \(N'\) and \(N'\), we may
    choose \(M=N\). By Lemma ref:12.3, we may replace \(M\) with an elementary extension and
    assume \(M\) and \(M\uhr L\) are \(\aleph_0\)-saturated and \(\aleph_0\)-strongly homogeneous. The fact
    that \(\tp^L(\bara)=\tp^L(\barb)\) implies that there is an automorphism \(\sigma\in\Aut(M\uhr L)\) with
    \(\sigma(\bara)=\barb\). Let \(R'=\sigma(R)\). Let \(M'=(M\uhr L,R')\). Then \sigma is an isomorphism
    from \(M\) to \(M'\), so \(M'\vDash T\). But \(M'\uhr L=M\uhr L\). Because \(R\) is implicitly
    defined, \(R=R'\). But then
    \begin{equation*}
    \bara\in R\Leftrightarrow\sigma(\bara)\in\sigma(R)\Leftrightarrow\barb\in R'\Leftrightarrow\barb\in R
    \end{equation*}
    contradicting the fact that \(M\vDash R(\bara)\) and \(M\vDash\neg R(\barb)\)

    *Case 2*: \(T\) is not complete. Any completion of \(T\) implicitly defines \(R\). By Case 1, any
    completion of \(T\) explicitly defines \(R\). So in any model \(M\vDash T\), there is
    an \(L\)-formula \(\phi_M\) s.t. \(M\vDash\forall\barx(R(\barx)\leftrightarrow\phi_M(\barx))\)

    Assume \(R\) is not explicitly defined, there are \(M,N\vDash T\) and \(\bara\in M^n\), \(\barb\in N^n\),
    with \(\tp^L(\bara)=\tp^L(\barb)\) and \(M\vDash R(\bara)\) and \(N\vDash\neg R(\bara)\). Let \(T'\) be the
    \(L\)-theory obtained from \(T\) by replacing every \(R\) with \(\phi_M\). Then \(M\vDash T'\). The
    type \(\tp^L(\bara)\) contains the following
    * \(\phi_M(\barx)\)
    * sentences in \(T'\)


    So \(N\vDash\phi_M(\barb)\) and \(N\vDash T'\).

    Let \(R'=\{\barc\in N^n:N\vDash\phi_M(\barc)\}\). Then \((N\uhr L,R')\vDash T\) because \(N\vDash T'\).
    Therefore \(R'=R\) because \(R\) is implicitly defined. But \(N\vDash\phi_M(\barb)\)
    and \(N\vDash\neg R(\barb)\), a contradiction
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Let \(T\) be a complete theory. Then \(T\) has a countable \omega-saturated model iff \(T\) is small
    #+END_theorem

    #+BEGIN_proof
    \(\Rightarrow\): trivial

    \(\Leftarrow\): Suppose \(S_n(T)\) is countable for any \(n\). Take some \omega-saturated model \(M^+\). For
    each finite set \(A\subseteq M^+\) and type \(p\in S_1(A)\), take some element \(c_{A,p}\in M\)
    realizing \(p\). Define an increasing chain of countable subsets \(A_0\subseteq A_1\subseteq\cdots M^+\) as follows
    * \(A_0=\emptyset\)
    * \(A_{i+1}=A_i\cup\{c_{A,p}:A\subseteq_fA_i,p\in S_1(A)\}\)


    each \(A_i\) is countable, and define \(M=\bigcup_{i=0}^\infty A_i\), which is countable

    Now we only need to prove that \(M\) is \omega-saturated and \(M\preceq M^+\)
    #+END_proof

* Prime models

** Omitting types theorem
    #+ATTR_LATEX: :options [Baire Category Theorem for \(S_n(A)\)]
    #+BEGIN_theorem
    Let \(U_1,U_2,\dots\) be dense open sets. Then \(\bigcap_{i=1}^\infty U_i\) is dense
    #+END_theorem

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:13.7
    \(S_n(A)\) is finite iff all types in \(S_n(A)\) are isolated
    #+END_lemma

    #+BEGIN_proof
    If each \(p\in S_n(A)\) is isolated. The family \(\{\{p\}:p\in S_n(A)\}\) covers \(S_n(A)\), so there is
    a finite cover. This is impossible unless \(S_n(A)\) is finite
    #+END_proof


    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A set \(X\subseteq S_n(A)\) is *comeager* if \(X\supseteq\bigcap_{i=1}^\infty U_i\) for some dense open sets \(U_i\)
    #+END_definition
    Work in \(S_\omega(T)\).

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If \(X_1,X_2,\dots\) are comeager, then \(\bigcap_{i=1}^\infty X_i\) is comeager
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    For any formula \(\phi(x_0,\dots,x_n,y)\), there is a dense open set \(Z_\phi\) s.t. if \(M\vDash T\)
    , \(\barc\in M^\omega\), \(\tp^M(\barc)\in Z_\phi\) and \(M\vDash\exists y\phi(c_0,\dots,c_n,y)\), then there is \(i<\omega\)
    s.t. \(M\vDash\phi(c_0,\dots,c_n,c_i)\)
    #+END_lemma

    #+BEGIN_proof
    Take \(A=[\neg\exists y\phi(x_0,\dots,x_n,y)]\) and \(B_i=[\phi(x_0,\dots,x_n,x_i)]\) for \(i<\omega\).
    Let \(Z_\phi=A\cup\bigcup_{i=0}^\infty B_i\), which is open. If \(p=\tp^M(\barc)\in Z_\phi\) and \(M\vDash\exists y\phi(c_0,\dots,c_n,y)\)
    then \(p\notin A\), so there is \(i<\omega\) s.t. \(p\in B_i\) meaning \(M\vDash\phi(c_0,\dots,c_n,c_i)\)

    It remains to show that \(Z_\phi\) is dense. Take non-empty \([\psi]\subseteq S_\omega(T)\); we claim \(Z_\phi\cap[\psi]\neq\emptyset\).
    Take \(p=\tp^M(\bare)\in[\psi]\). We may assume \(p\notin Z_\phi\), or we are done. Then \(p\notin A\),
    so \(M\vDash\exists y\phi(e_0,\dots,e_n,y)\). Take \(b\in M\) s.t. \(M\vDash\phi(e_0,\dots,e_n,b)\). Take \(i>n\) large enough
    that \(x_i\) doesn't appear in \phi.
    Let \(\barc=(e_0,\dots,e_{i-1},b,e_{i+1},e_{i+2},\dots)\). We have \(M\vDash\psi(\bare)\)
    because \(\tp(\bare)\in[\psi]\) and therefore \(M\vDash\psi(\barc)\), so \(\tp(\barc)\in[\psi]\). Also \(M\vDash\phi(c_0,\dots,c_n,c_i)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    There is a comeager set \(W\subseteq S_\omega(T)\) s.t. if \(\tp^M(\barc)\in W\), then \(\{c_i:i<\omega\}\preceq M\)
    #+END_proposition

    #+BEGIN_proof
    Let \(W=\bigcap_\phi Z_\phi\). Suppose \(\tp^M(\barc)\in M\). Then for any \(\phi(x_0,\dots,x_n,y)\),
    if \(M\vDash\exists y\phi(c_0,\dots,c_n,y)\), then there is \(i<\omega\) s.t. \(M\vDash\phi(c_0,\dots,c_n,c_i)\). By
    Tarski-Vaught, \(\{c_i:i<\omega\}\preceq M\).
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \(p\in S_n(T)\) be non-isolated. For any \((j_1,\dots,j_n)\in\N^n\), there is a dense open
    set \(V_{p,\barj}\subseteq S_\omega(T)\) s.t. \(\tp^M(\barc)\in V_{p,\barj}\Leftrightarrow\tp^M(c_{j_1},\dots,c_{j_n})\neq p\)
    #+END_lemma

    #+BEGIN_proof
    Let \(V_{p,\barj}=V=\bigcup_{\phi\in p}[\neg\phi(x_{j_1},\dots,x_{j_n})]\). If \(\tp^M(\barc)\in V\), then there is
    some \(\phi\in p\) s.t. \(M\vDash\neg\phi(c_{j_1},\dots,c_{j_n})\), and so \(\tp^M(c_{j_1},\dots,c_{j_n})\neq p\). Conversely,
    if \(\tp^M(c_{j_1},\dots,c_{j_n})\neq p\), there is \(\phi\in p\) s.t. \(M\vDash\neg\phi(c_{j_1},\dots,c_{j_n})\), and
    then \(\tp^M(\barc)\in V\)

    It remains to show that \(V\) is dense. Suppose \([\psi]\subseteq S_\omega(T)\) is non-empty.
    Take \(q=\tp^M(\bare)\in[\psi]\). We may assume \(q\notin V\). By choice
    of \(V\), \(\tp^M(e_{j_1},\dots,e_{j_n})=p\). Take \(m\) large enough so that  \(m\ge\max(j_1,\dots,j_n)\)  and \psi is a formula
    in \(x_0,\dots,x_m\). Let \(\phi(y_1,\dots,y_n)\) be
    \begin{equation*}
    \exists x_0,\dots,x_m\;\psi(x_0,\dots,x_m)\wedge\bigwedge_{i=1}^n(y_i=x_{j_i})
    \end{equation*}
    Then \((e_{j_1},\dots,e_{j_n})\) satisfies \phi, and so \(\phi\in p\). As \(p\) is non isolated, there
    is \(N\vDash\phi(d_1,\dots,d_n)\) with \(\tp^N(d_1,\dots,d_n)\neq p\). By definition of \phi there are \(c_0,\dots,c_m\in N\)
    with \(N\vDash\psi(c_0,\dots,c_m)\) and \((d_1,\dots,d_n)=(c_{j_1},\dots,c_{j_n})\). Choose \(c_{m+1},c_{m+2},\dots\in N\)
    arbitrarily. Then \(\barc=(c_i:i<\omega)\in N^\omega\) and \(\tp(\barc)\in[\psi]\),
    and \(\tp(c_{j_1},\dots,c_{j_n})=\tp(d_1,\dots,d_n)\neq p\), so \(\tp(\barc)\in V\), showing \(V\cap[\psi]\neq\emptyset\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Let \(p\in S_n(T)\) be non-isolated. There is a comeager set \(V_p\subseteq S_\omega(T)\) s.t.
    if \(\tp^M(\barc)\in V_p\), then \(p\) is not realized by a tuple in \(\{c_i:i<\omega\}\)
    #+END_proposition

    #+BEGIN_proof
    Let \(V_p=\bigcap_{\barj\in\N^n}V_{p,\barj}\). If \(\tp^M(\barc)\in V_p\), then for any \(j_1,\dots,j_n\in\N\)
    \begin{equation*}
    \tp^M(c_{j_1},\dots,c_{j_n})\neq p
    \end{equation*}
    #+END_proof

    #+ATTR_LATEX: :options [Omitting types theorem]
    #+BEGIN_theorem
    label:13.19
    Let \(\Pi\) be a countable set of pairs \((p,n)\), where \(n<\omega\) and \(p\) is a non-isolated type
    in \(S_n(T)\). There is a countable model \(M\vDash T\) omitting \(p\) for every \((p,n)\in\Pi\)
    #+END_theorem

    #+BEGIN_proof
    The set \(Q=W\cap\bigcap_{(p,n)\in\Pi}V_p\) is comeager, hence non-empty. Take \(\tp^N(\barc)\in Q\).
    Then \(M:=\{c_i:i<\omega\}\preceq N\) because \(\tp^N(\barc)\in W\). For \((p,n)\in\Pi\), \(M\) omits \(p\)
    because \(\tp(\barc)\in V_p\)
    #+END_proof

    #+ATTR_LATEX: :options [Ryll-Nardzewski]
    #+BEGIN_theorem
    Let \(T\) be a complete theory in a countable language. Then \(T\) is \omega-categorical
    iff \(S_n(T)\) is finite for every \(n<\omega\)
    #+END_theorem

    #+BEGIN_proof
    Suppose \(S_n(T)\) is infinite for some \(n\). By ref:13.7 there is a
    non-isolated \(p\in S_n(T)\). By ref:13.19 there is a countable model \(M_0\vDash T\) omitting \(p\).
    Take an elementary  extension \(M_1\succeq M_0\) where \(p\) is realized by \(\bara\in M_1^n\). By
    Löwenheim–Skolem Theorem we may assume \(M_1\) is countable. Then \(M_1\not\cong M_0\)
    #+END_proof



* Heirs and definable types

** Definable types
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(p(\barx)\) is a *definable type* if for every formula \(\varphi(\barx;\bary)\) the set
    \begin{equation*}
    \{\barb\in M:\varphi(\barx,\barb)\in p(\barx)\}
    \end{equation*}
    is definable, defined by some \(L(M)\)-formula \(d\varphi(\bary)\)
    #+END_definition


    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(T\) is strongly minimal and \(M\vDash T\), there is a 1-type \(p(x)\in S_1(M)\) s.t.
    \begin{equation*}
    \varphi(x,\barb)\in p(x)\Leftrightarrow\exists^{\infty}a\in M:M\vDash\varphi(a,\barb)
    \end{equation*}
    Moreover, \(p=\tp(c/M)\) for any \(N\succeq M\) and \(c\in N\setminus M\)
    #+END_proposition

    #+BEGIN_proof
    Take \(N\succ M\) and \(c\in N\setminus M\); let \(p(x)=\tp(c/M)\). We must show that
    \begin{equation*}
    N\vDash\varphi(c,\barb)\Leftrightarrow\exists^{\infty}a\in M:M\vDash\varphi(a,\barb)
    \end{equation*}
    \(\Rightarrow\): if not, \(N\vDash\varphi(c,\barb)\) but \(\varphi(M,\barb)\) is finite, then \(c\in M\)

    \(\Leftarrow\): if \(N\vDash\neg\varphi(c,\barb)\), then \(\neg\varphi(M,\barb)\) is infinite and so \(\varphi(M,\barb)\) is finite
    #+END_proof

    \(p(x)\) is called the *transcendental 1-type*

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(T\) is strongly minimal
    1. \(T\) eliminates the \(\exists^\infty\) quantifier
    2. If \(M\vDash T\), the transcendental 1-type \(p\in S_1(M)\) is definable
    #+END_proposition

    #+BEGIN_proof
    1. For any \(\varphi(x,y)\), there is \(n_\varphi<\omega\) s.t. for every \(M\vDash T\) and \(\barb\in M\)
       \begin{equation*}
       \abs{\varphi(M,\barb)}<n_\varphi\text{ or }\abs{\neg\varphi(M,\barb)}<n_\varphi
       \end{equation*}
    2. For each \(\varphi(x,\bary)\), \(d\varphi(\bary)\) is the formula \(\exists^\infty x\;\varphi(x,\bary)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(p\in S_1(M)\) and \(M\) is strongly minimal, then \(p\) is definable
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A theory \(T\) is *stable* if all \(n\)-types over models are definable
    #+END_definition
** Heirs and strong heirs
    Suppose \(M\preceq N\) and \(p\in S_n(M)\). An *extension* or *son* of \(p\) is \(q\in S_n(N)\)
    with \(q\supseteq p\), i.e., \(p=q\uhr M\)

    #+ATTR_LATEX: :options [Heirs]
    #+BEGIN_definition
    \(q\in S_n(N)\) is an *heir* of \(p\), written \(p\sqsubseteq q\), if for
    any \(\varphi(\barx,\barb,\barc)\in q(\barx)\) with \(\barb\in M\) and \(\barc\in N\), there
    is \(\barc'\in M\) with \(\varphi(\barx,\barb,\barc)\in p(\barx)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Suppose \(M_1\preceq M_2\preceq M_3\) and \(p_i\in S_n(M_i)\) for \(i=1,2,3\), with \(p_1\subseteq p_2\subseteq p_3\)
    1. If \(p_1\sqsubseteq p_2\sqsubseteq p_3\), then \(p_1\sqsubseteq p_3\)
    2. If \(p_1\sqsubseteq p_3\), then \(p_1\sqsubseteq p_2\)
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(p\in S_n(M)\), then \((M,dp)\) is the expansion of \(M\) be relation symbols \(d\varphi(\bary)\)
    for each \(\varphi(\barx,\bary)\), interpreted as follows:
    \begin{equation*}
    (M,dp)\vDash d\varphi(\barb)\Leftrightarrow\varphi(\barx,\barb)\in p(\barx)
    \end{equation*}
    #+END_definition

    #+BEGIN_remark
    \(p\) is definable iff the new relations in \((M,dp)\) are definable in the old structure \(M\)
    #+END_remark

    #+BEGIN_remark
    The class of structures of the form \((M,dp)\) with \(M\vDash T\) and \(p\in S_n(M)\) is an elementary
    class, axiomatized by \(T\) plus the following:
    \begin{gather*}
    \forall\bary_1\dots\bary_m\left( \bigwedge_{i=1}^md\varphi_i(\bary)\to\exists\barx\bigwedge_{i=1}^m\varphi_i(\barx,\bary_i) \right)
    \text{ for formulas }\varphi_1(\barx,\bary_1),\dots,\varphi_n(\barx,\bary_n)\\
    \forall\bary(d\varphi(\bary)\vee d\neg\varphi(\bary))\text{ for each formula }\varphi(\barx,\bary)
    \end{gather*}

    Any model of such theory has an underlying \(p\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If \((M,dp)\preceq(N,dq)\), then \(M\preceq N\) and \(p\sqsubseteq q\)
    #+END_lemma

    #+BEGIN_proof
    \((N,dq)\succeq(M,dp)\) implies \(N\succeq M\). Then:
    * \(q\supseteq p\): if \(\varphi(\barx,\barb)\in p(\barx)\) (with \(\barb\in M\)), then \((M,dp)\vDash d\varphi(\barb)\),
      so \((N,dq)\vDash d\varphi(\barb)\), and \(\varphi(\barx,\barb)\in q(\barx)\)
    * \(q\sqsupseteq p\): suppose \(\varphi(\barx,\barb,\barc)\in q(\barx)\), with \(\barb\in M\) and \(\barc\in N\).
      Then \((N,dq)\vDash d\varphi(\barb,\barc)\), and \((N,dq)\vDash\exists\barz\;d\varphi(\barb,\barz)\).
      Then \((M,dp)\vDash\exists\barz\;d\varphi(\barb,\barz)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(p\in S_n(M)\), then there is \(M_0\preceq M\) with \(\abs{M_0}\le\abs{T}\), s.t. \(p\sqsupseteq(p\uhr M_0)\)
    #+END_corollary

    #+BEGIN_proof
    Apply downward Löwenheim–Skolem theorem to \((M,dp)\) to find \((M_0,dq)\preceq(M,dp)\)
    with \(\abs{M_0}\le\abs{T}\). Then \(q=p\uhr M_0\) and \(p\sqsupseteq q\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(M\preceq N\) and \(p\in S_n(M)\) and \(q\in S_n(N)\), then \(q\) is a *strong heir* of \(p\) if \((N,dq)\succeq(M,dp)\)
    #+END_definition

    #+ATTR_LATEX: :options [Types have heirs]
    #+BEGIN_proposition
    Suppose \(M\preceq N\) and \(p\in S_n(M)\)
    1. There is \(N'\succeq N\) and \(q'\in S_n(N')\) a strong heir of \(p\)
    2. There is \(q\in S_n(N)\) an heir of \(p\)
    #+END_proposition

    #+BEGIN_proof
    1. Let \(\barc\) be an infinite tuple enumerating \(N\). Then \(\tp^L(\barc/M)\) is finitely
       satisfiable in \(M\), hence finitely satisfiable in the expansion \((M,dp)\). Therefore it is
       satisfied in some \((N',dq)\succeq(M,dp)\). So there is \(\bare\) in \(N'\)
       with \(\tp^L(\bare/M)=\tp^L(\barc/M)\). Then the map \(f(c_i)=e_i\) is an \(L\)-elementary
       embeddings of \(N\) into \(N\) extending \(\id_M:M\to M\). Moving \(N'\) by an isomorphism, we
       may assume \(N'\succeq N\)
    2. Take \(N'\succeq N\) and \(q'\in S_n(N')\) a strong heir of \(p\). Let \(q=q'\uhr N\).
       Then \(q'\supseteq q\supseteq p\) and \(q'\sqsupseteq p\), so \(q\sqsupseteq p\).
    #+END_proof
** Heirs and definable types
    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Let \(p\in S_n(M)\) be definable and \(N\succeq M\)
    1. \(p\) has a unique heir \(q\in S_n(N)\)
    2. For \(\varphi(\barx,\bary)\) and \(\barb\in N\)
       \begin{equation*}
       \varphi(\barx,\barb)\in q(\barx)\Leftrightarrow N\vDash d_p\varphi(\barb)\tag{*}
       \end{equation*}
    3. In particular, \(q\) is definable with \(d_q\varphi=d_p\varphi\) for all \varphi
    #+END_proposition

    #+BEGIN_proof
    *Claim*. If \(q\in S_n(N)\) and \(q\sqsupseteq p\), then \(q\) satisfies (*)

    Take \(\bara\in N'\succeq N\) realizing \(q\). If (*​) fails then
    \begin{gather*}
    (\varphi(\barx,\barb))\in q(\barx)\not\Leftrightarrow N\vDash d_p\varphi(\barb)\\
    N'\vDash\neg(\varphi(\bara,\barb)\leftrightarrow d_p\varphi(\barb))\\
    \neg(\varphi(\barx,\barb)\leftrightarrow d_p\varphi(\barb))\in q(\barx)
    \end{gather*}
    As \(q\sqsupseteq p\), there is \(b'\in M\) s.t.
    \begin{gather*}
    \neg(\varphi(\barx,\barb')\leftrightarrow d_p\varphi(\barb'))\in p(\barx)\\
    N'\vDash\neg(\varphi(\bara,\barb')\leftrightarrow d_p\varphi(\barb'))\\
    \varphi(\barx,\barb')\in p(\barx)\not\Leftrightarrow M\vDash d_p\varphi(\barb')
    \end{gather*}
    a contradiction

    There is at least one heir, and at most one heir satisfying (*)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(T\) is strongly minimal and \(M\preceq N\) are models of \(T\). Let \(p\) and \(q\) be the
    transcendental 1-types over \(M\) and \(N\). For any \(\varphi(x,\bary)\)
    \begin{equation*}
    d_p\varphi(\bary)\equiv(\exists^\infty x\;\varphi(x,\bary))\equiv d_q\varphi(\bary)
    \end{equation*}
    so \(q\) is the unique heir of \(p\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    TFAE for \(p\in S_n(M)\)
    1. \(p\) is definable
    2. For every \(N\succeq M\), \(p\) has a unique heir over \(N\)
    #+END_proposition

    #+BEGIN_proof
    Suppose \(p\) has unique heirs. Then for any \(N\succeq M\), \(p\) has at most one strong heir
    over \(N\). Therefore there is at most one way to expand \(N\) to an elementary extension
    of \((M,dp)\). Then the elementary diagram \((M,dp)\) implicityly defines the relations \(d\varphi\).
    By Beth's implicit definability theorem, \((M,dp)\) is a expansion of \(M\) by definable
    relations, meaning \(p\) is definable
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Suppose \(M_1\preceq M_2\preceq M_3\) and \(p_i\in S_n(M_i)\) for \(i=1,2,3\) with \(p_1\subseteq p_2\subseteq p_3\). Suppose \(p_1\)
    is definable. Then \(p_1\sqsubseteq p_2\sqsubseteq p_3\) iff \(p_1\sqsubseteq p_3\)
    #+END_proposition

    #+BEGIN_proof
    We only need to show the implication \(p_1\sqsubseteq p_3\Rightarrow p_2\sqsubseteq p_3\). Suppose \(p_1\sqsubseteq p_3\).
    Take \(p_2'\sqsupseteq p_1\) and \(p_3'\sqsupseteq p_2'\). By the uniqueness of heirs of definable types, \(p_2'=p_2\)
    and \(p_2\) is definable. Then \(p_3'=p_3\)
    #+END_proof
** Types in ACF
    A *positive quantifier free formula* is a quantifier-free formula that doesn't use \(\neg\)

    Fix a model \(M\vDash\ACF\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A set \(V\subseteq M^n\) is an *algebraic set* if
    \begin{equation*}
    V=\varphi(M^n;\barb)=\{\bara\in M^n:M\vDash\varphi(\bara,\barb)\}
    \end{equation*}
    where \varphi is positive quantifier free.
    #+END_definition

    #+BEGIN_remark
    \(V\) is an algebraic set iff \(V\) is defined by finitely many polynomial equations
    \begin{equation*}
    V=\{\bara\in M^n:P_1(\bara)=\dots=P_m(\bara)=0\}
    \end{equation*}

    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    1. \(M^n\) and \(\emptyset\) are algebraic sets
    2. If \(V,W\subseteq M^n\) are algebraic sets, then \(V\cap W\) and \(V\cup W\) are algebraic sets
    3. Any finite subset of \(M^n\) is an algebraic set
    #+END_lemma

    #+ATTR_LATEX: :options [Quantifier elimination]
    #+BEGIN_fact
    Every definable set \(D\subseteq M^n\) is a finite boolean combination of algebraic sets
    #+END_fact

    #+ATTR_LATEX: :options [Consequence of Hilbert's basis theorem]
    #+BEGIN_fact
    The class of algebraic sets has the descending chain condition (DCC): there is no infinite chain
    of algebraic sets \(V_0\supsetneq V_1\supsetneq V_2\supsetneq\cdots\)
    #+END_fact

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(\cals\) is a non-empty collection of algebraic sets, then \(\cals\) contains at least one minimal element
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    An infinite intersection \(\bigcap_{i\in I}V_i\) of algebraic sets is an algebraic set
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(S\subseteq K[\barx]\) is any set of polynomials, possibly infinite, then the subset of \(M^n\)
    defined by \(S\) is an algebraic set. All algebraic sets arise this way
    #+END_corollary

    #+ATTR_LATEX: :options [Noetherian induction]
    #+BEGIN_corollary
    Let \(\cals\) be a class of algebraic sets. Suppose the following holds
    #+BEGIN_center
    If \(X\) is an algebraic set, and every algebraic set \(Y\subsetneq X\) is in \(\cals\), then \(X\in\cals\)
    #+END_center
    Then every algebraic set is in \(\cals\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    An algebraic set \(V\) is *reducible* if \(V=W_1\cup W_2\) for algebraic sets \(W_1,W_2\subsetneq V\). A
    *variety* is a non-empty irreducible algebraic set
    #+END_definition

    #+BEGIN_remark
    label:24.26
    If \(V\) is an algebraic variety, then the set of algebraic proper subsets of \(V\) is closed
    under finite unions
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(V\) is an algebraic set, then \(V\) is a finite union of varieties
    #+END_proposition

    #+BEGIN_proof
    * \(V=\emptyset\): \(V\) is a union of zero varieties
    * \(V\) is irreducible: \(V\) is a union of one variety
    * \(V\) is reducible: \(V=X\cup Y\) where \(X,Y\subsetneq V\). By Noetherian induction!
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    The *generic type* of \(V\) is the type generated by the following formulas
    1. \(x\in V\)
    2. \(x\notin W\) for each algebraic proper subset \(W\subsetneq V\)


    We will write this type as \(p_V(\barx)\)
    #+END_definition

    Note that \(x\in V\) and \(x\notin W\) is all definable

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Let \(V\) be a variety
    1. \(p_V(\barx)\) is a consistent complete type
    2. If \(W\) is an algebraic set, then \(p_V(\barx)\vdash\barx\in W\) \(\Leftrightarrow\) \(W\supseteq V\)
    #+END_proposition

    #+BEGIN_proof
    Finite satisfiability: given finitely many proper algebraic subsets \(W_1,\dots,W_m\subsetneq V\), we
    have \(V\supsetneq\bigcup_{i=1}^mW_i\), so there is \(\bara\in V\) and \(\bara\notin W_i\) for \(1\le i\le m\)

    2. If \(W\supseteq V\), then \(p_V(\barx)\vdash\barx\in V\vdash\barx\in W\). If \(W\not\supseteq V\),
       then \((W\cap V)\subsetneq V\), so \(p_V(\barx)\vdash\barx\notin W\cap V\). But \(p_V(\barx)\vdash\barx\in V\)
       so \(p_V(\barx)\vdash\barx\notin W\)


    Completeness: by 2, for any positive quantifier-free formula \(\varphi(\barx)\)
    \begin{equation*}
    p_V(\barx)\vdash\varphi(\barx)\text{ or }p_V(\barx)\vdash\neg\varphi(\barx)
    \end{equation*}
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    The map \(V\mapsto p_V\) is a bijection from the set of varieties \(V\subseteq M^n\) to \(S_n(M)\)
    #+END_theorem

    #+BEGIN_proof
    Injectivity: suppose \(V,W\) are varieties and \(V\neq W\). WLOG, \(V\not\subseteq W\).
    Then \(p_W(\barx)\vdash \barx\in W\) but \(p_V(\barx)\not\vdash\barx\in W\), so \(p_V\neq p_W\)

    Surjectivity: fix \(p\in S_n(M)\). Take \(V\) a minimal algebraic set s.t. \(p(\barx)\vdash\barx\in V\).
    (There is at least one such \(V\), namely \(M^n\)). \(V\) is non-empty because \(p\) is
    consistent. If \(V\) is reducible as \(V=X\cup Y\) for smaller algebraic sets \(X,Y\),
    then \(p(\barx)\vdash\barx\in X\) or \(p(\barx)\vdash\barx\in Y\) by completeness, contradicting the choice
    of \(V\). Thus \(V\) is a variety. By choice of \(V\), \(p(\barx)\vdash\barx\in V\).
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    \(N\succeq M\), let \(V\subseteq M^n\) be a variety, defined by a formula \varphi
    1. \varphi defines a variety \(V_N\subseteq N^n\)
    2. \(V_N\) depends only on \(V\), not on the choice of \varphi
    #+END_proposition

    #+BEGIN_proof
    Take \psi a positive quantifier-free formula defining \(V\). Then \(\forall\barx(\varphi(\barx)\leftrightarrow\psi(\barx))\) is
    satisfied by \(M\), and therefore by \(N\). Let \(V_N=\psi(N)\). As \psi is positive quantifier
    free, \(V_N\) is an algebraic set. As \(M\vDash\exists\barx\psi(\barx)\), \(V_N\) is non-empty.
    If \(V_N=W_1\cup W_2\) where \(W_1,W_2\) are algebraic proper subsets of \(V_N\) defined
    by \(\theta_i(\barx,\barb_i)\) for some positive quantifier-free \(L\)-formula \(\theta_i\) and tuple of
    parameters \(\barb_i\in N\). Then
    \begin{equation*}
    N\vDash\exists\bary_1\bary_2\left( \forall\barx
    \left( \psi(\barx)\leftrightarrow\bigvee_{i=1}^2\theta_i(\barx,\bary_i) \right)\wedge
    \bigwedge_{i=1}^2\exists\barx(\psi(\barx)\wedge\neg\theta_i(\barx,\bary_i)) \right)
    \end{equation*}
    which implies \(V\)  is reducible
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Let \(M\preceq N\) be models of \(\ACF\). Let \(V\subseteq M^n\) be a variety, and let \(V_N\subseteq N^n\) be its
    extension. Then \(p_{V_N}\in S_n(N)\) is the unique heir of \(p_V\in S_n(M)\)
    #+END_theorem

    #+BEGIN_proof
    Let \(q\in S_n(N)\) be an heir of \(p_V\). Let \varphi be an \(L(M)\)-formula defining \(V\)
    and \(V_N\). Then \(\varphi(\barx)\in p_V(\barx)\subseteq q(\barx)\), so \(q(\barx)\vdash\barx\in V_N\).
    Suppose \(q(\barx)\not\vdash\barx\notin W\) for some algebraic \(W\subsetneq V_N\), \(q(\barx)\vdash\barx\in W\).
    Let \(\psi(\barx,\barb)\) be a positive quantifier-free formula defining \(W\). Let \(\theta(\barb)\) be
    the \(L(M)\)-formula
    \begin{equation*}
    \forall\barx(\psi(\barx,\barb)\to\varphi(\barx))\wedge\exists\barx(\varphi(\barx)\wedge\neg\psi(\barx,\barb))
    \end{equation*}
    which says \(\psi(M^n,\barb)\subsetneq\varphi(M^n)\). \(N\vDash\theta(\barb)\) since \(W\subsetneq V\).
    Then \(q(\barx)\vdash\psi(\barx,\barb)\wedge\theta(\barb)\). Because \(q\sqsupseteq p_V\), there is \(\barb'\in M\) s.t.
    \begin{equation*}
    p_V(\barx)\vdash\psi(\barx,\barb')\wedge\theta(\barb')
    \end{equation*}
    Thus we find an algebraic proper subset of \(V\)
    #+END_proof








    General fact: If \(q\sqsupseteq p\), suppose \(\forall\barb(\varphi(\barb)\Rightarrow\psi(\barx,\barb)\in p(\barx))\),
    then \(\forall\barb\in N\), \(\varphi(\barb)\Rightarrow\psi(\barx,\barb)\in q(\barx)\)
** 1-types in \texorpdfstring{\(\DLO\)}{DLO}
* Stable Theories
** Strong heirs from ultrapowers
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(p\in S_n(M)\), \(I\) set, \(\calu\) ultrafilter on \(I\), \(M^{\calu}=M^I/\calu\). The *ultrapower
    type* \(p^{\calu}\in S_n(M^{\calu})\) is the strong heir of \(p\) s.t. \((M^{\calu},dp^{\calu})=(M,dp)^{\calu}\)

    #+END_definition

    \(p^{\calu}\) is a strong heir of \(p\)

    If \(\varphi(\barx,\bary)\in L\), \(\barb\in M^{\calu}\) represented
    by
    \((\barb:i\in I)\in M^I\),

    \(\varphi(\barx,\barb)\in p^{\calu}\Leftrightarrow(M,dp)^{\calu}\vDash d\varphi(\barb)\Leftrightarrow\) \(\{i\in I\mid(M,dp)\vDash d\varphi(\barb_i)\}\in\calu\)
    \(\Leftrightarrow\) \(\{i\in I\mid \varphi(x,\barb_i)\in p(x)\}\in\calu\)

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:3.3.2
    Suppose \(M\preceq N\), \(p\in S_n(M)\), \(q\in S_n(N)\), \(q\sqsupseteq p\). Then there is \(I\),
    ultrafilter \(\calu\) on \(I\) s.t. (for some copy of \(M^{\calu}\), moved by isomorphism), \(M\preceq N\preceq M^{\calu}\), \(p\subseteq q\subseteq p^{\calu}\)
    #+END_proposition

    #+BEGIN_proof
    Let \(I=\{f:N\to M\mid f\supseteq\id_M\}\).

    Note that if \(\phi(\barx,\barb)\in q(\barx)\), \(\barb\in N\), there
    is \(f\in I\), \(\phi(\barx,f(\barb))\in p(\barx)\). (has some duplicate variable problem,
    if \(b_1=b_2\), but \(c_1\neq c_2\), but maybe we could take some equivalent formulas)

    For each \(\phi(\barx,\barb)\), \(\barb\in N\),
    let \(S_{\varphi,\barb}=\{f\in I\mid\phi(\barx,f(\barb))\in p(\barx)\}\).
    Let \(\calf=\{S_{\phi,\barb}\mid\phi(\barx,\barb)\in q(\barx)\}\)

    *Claim* \(\calf\) has F.I.P

    Suppose \(\phi_i(\barx,\barb_i)\in q(\barx)\), \(1\le i\le m\). So \(\bigwedge_{i=1}^m\phi_i(\barx,\barb_i)\in q(\barx)\),
    then there is \(f\in I\) s.t. \(\bigwedge_{i=1}^m\phi_i(\barx,f(\barb_i)\in p(\barx))\).
    Then \(f\in S_{\varphi_i,\barb_i}\), so \(\bigcap_{i=1}^nS_{\phi_i,b_i}\neq\emptyset\)

    Thus there is \(\calu\supseteq\calf\). Form \(M^{\calu}\), \(p^{\calu}\). Let \(g:N\to M^{\calu}\) as follows.
    If \(c\in N\), \(g(c)=[(f(c):f\in I)]\). Note if \(c\in M\), then \(f(c)=c\) for all \(f\), and
    so \(g\mid M=\id_M\)

    For any \(\phi(\barx,\bary)\), \(\barb\in N\), \(\phi(\barx,\barb)\in q(\barx)\) \(\Rightarrow\) \(S_{\phi,\barb}\in\calf\) \(\Rightarrow\) \(S_{\phi,\barb}\in\calu\) \(\Rightarrow\)
    \(\{f\in I\mid\phi(\barx,f(\barb))\in p(\barx)\}\in\calu\) \(\Leftrightarrow\) \(\phi(\barx,g(\barb))\in p^{\calu}\)

    So \(g:N\to M^{\calu}\), \(\phi(\barx,\barb)\in q(\barx)\Rightarrow\phi(\barx,g(\barb))\in p^{\calu}\).
    \(N\vDash\phi(\barb)\Rightarrow M^{\calu}\vDash\phi(g(\barb))\). WLOG, \(N\preceq M^{\calu}\) and \(g\supseteq\id_N\).
    \(\phi(\barx,\barb)\in q(\barx)\Rightarrow\phi(\barx,\barb)\in p^{\calu}\). \(q\subseteq p^{\calu}\).
    #+END_proof

    Since we can prove compactness by ultrapower. Everything we get from compactness can be got by
    some ultrapower

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    Every heir of \(p\) extends to a strong heir of \(p\)
    #+END_corollary
** Stability
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \alpha is an ordinal, then \(2^\alpha=\) strings of length \alpha in alphabet \(\{0,1\}\)
    #+END_definition


    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\varphi(\barx,\bary)\) be a formula. For \alpha an ordinal, take variables \(\barx_\sigma\)
    for \(\sigma\in 2^\alpha\), \(\bary_\tau\) for \(\tau\in 2^{<\alpha}\).

    \(D_\alpha=\{\varphi(\barx_\sigma,\bary_\tau):\sigma\text{ extends }\tau 0\}\cup\{\neg\varphi(\barx_\sigma,\bary_\tau):\sigma\text{ extends }\tau 1\}\)

    \(\varphi(\barx,\bary)\) has the *dichotomy property* if
    1. \(D_\omega\) is consistent
    2. \(D_n\) is consistent  for all \(n\in\omega\)
    3. \(D_\alpha\) is consistent for all \alpha


    1-3 are equivalent
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(D_2\) is \(\varphi(x_{00},y)\), \(\varphi(x_{00},y_0)\), \(\varphi(x_{01},y)\), \(\neg\varphi(x_{01},y_0)\) and so on
    #+END_examplle

                         y
                        / \
                      y0  y1
                    / \     /   \
            x00 x01 x10 x11



    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:3.3.8
    Fix \(T,\M\), and an integer \(n<\omega\). Suppose there is a small model \(M\preceq\M\) and a type
     \(p\in S_n(M)\) that is not definable, then some formula \(\varphi(x_1,\dots,x_n,\bary)\) has the dichotomy property
    #+END_proposition

    #+BEGIN_proof
    Because \(p\) is not definable, there is an \(N\succeq M\), \(q_1,q_2\in S_n(N)\),  \(q_1,q_2\sqsupseteq p\)  and \(q_1\neq q_2\). There
    is \(\varphi(\barx,\barb)\in q_1(\barx)\setminus q_2(\barx)\), \(\barb\in N\).

    *Claim* If \(M'\succeq N\), \(p'\in S_n(M')\), \(p'\sqsupseteq p\), then there is
    some \(N'\succeq M'\), \(q_1',q_2'\in S_n(N')\), \(q_1',q_2'\supseteq p'\), \(q_1',q_2'\sqsupseteq p\). and there
    is \(\barb'\in N'\), \(\varphi(\barx,\barb')\in q_1'\), \(\neg\varphi(\barx,\barb')\in q_2\)

    There is \(M^{\calu}\) s.t. \(M\preceq M'\preceq M^{\calu}\), \(p\subseteq p'\subseteq p^{\calu}\). Then \(M'\preceq M^{\calu}\preceq N^{\calu}\)
    and \(p\sqsubseteq p^{\calu}\sqsubseteq q_i^{\calu}\) for \(i=1,2\). Take \(N'=N^{\calu}\), \(q_i'=q_i^{\calu}\), and \(\barb'\) to be
    the image of \(\barb\) under the elementary embedding \(N\to N^{\calu}\)

    Recursively build a tree of
              (M,p)
              /         \
  (M0,p0)   (M1,p1)


    build \((M_\tau,p_\tau,\varphi(x,b_\tau))\) for \(\tau\in 2^{<\omega}\)

    \(M_{()}=M\),
    \(p_\tau\sqsupseteq p\).
    \(M_{\tau 0}=M_{\tau 1}\succeq M_\tau\),
    \(\barb_\tau\in M_{\tau 0}\),
    \(\varphi(\barx,\barb_\tau)\in p_{\tau 0}(\barx)\), \(\neg\varphi(\barx,\barb_\tau)\in p_{\tau 1}(\barx)\).

    Then \varphi has dichotomy
    #+END_proof


    working in \(\M\)
    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If some \(\varphi(x_1,\dots,x_n,\bary)\) has dichotomy property, then for every cardinal \(\lambda\ge\aleph_0\), there
    is \(A\subseteq\M\), \(\abs{A}\le\lambda\), \(\abs{S_n(A)}>\lambda\)
    #+END_proposition

    #+BEGIN_proof
    take smallest cardinal \mu s.t. \(2^\mu>\lambda\), \(\mu\le\lambda\). note that \(\abs{2^{<\mu}}=\abs{\bigcup_{\alpha<\mu}2^\alpha}\le\lambda\).

    \varphi has dichotomy proposition, so \(D_\mu\) is consistent.
    In the monster, there are \(\bara_\sigma\) for \(\sigma\in 2^\mu\), \(\barb_\tau\) for \(\tau\in 2^{<\mu}\) s.t.
    if \(\sigma\) extends \(\tau0\) then \(\M\vDash\varphi(\bara_\sigma,\barb_\tau)\) and if \sigma extends \(\tau1\)
    then \(\M\vDash\neg\varphi(\bara_\sigma,\barb_\tau)\).
    Let \(A=\{\barb_\tau:\tau\in 2^{<\mu}\}\). Then \(\abs{A}\le\lambda\) but \(\tp(a_\sigma/A)\neq\tp(a_{\sigma'}/A)\) for \(\sigma\neq\sigma'\).
    Thus \(\abs{S_n(A)}\ge 2^\mu>\lambda\).
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    for \lambda infinite, TFAE
    1. \(\forall A\subseteq\M\), if \(\abs{A}\le\lambda\), then \(\forall n\), \(\abs{S_n(A)}\le\lambda\)
    2. \(\forall A\subseteq\M\), if \(\abs{A}\le\lambda\), then \(\abs{S_1(A)}\le\lambda\)
    #+END_lemma

    #+BEGIN_proof
    \(2\to 1\): By induction on \(n\), \(\abs{S_{n-1}(A)}\le\lambda\). Then we can find \(\barb_\alpha\in\M^{n-1}\)
    for \(\alpha<\lambda\) s.t.
    \begin{equation*}
    S_{n-1}(A)=\{\tp(\barb_\alpha/A):\alpha<\lambda\}
    \end{equation*}
    For each \alpha, \(\abs{A\barb_\alpha}\le\lambda\Rightarrow\abs{S_1(A\barb_\alpha)}\le\lambda\). So we can find \(c_{\alpha,\beta}\in\M\) for \(\beta<\lambda\)
    s.t.
    \begin{equation*}
    S_1(A\barb_\alpha)=\{\tp(c_{\alpha,\beta}/A\barb_\alpha):\beta<\lambda\} (\text{for }\alpha<\lambda)
    \end{equation*}

    *Claim*: if \(p\in S_n(A)\) then \(p=\tp(\barb_\alpha c_{\alpha,\beta}/A)\) for some \(\alpha,\beta<\lambda\)

    Take \((\barb',c')\in\M^n\) realizing \(p\). Then \(\tp(\barb'/A)=\tp(\barb_\alpha/A)\) for some \(\alpha<\lambda\).
    Moving \((\barb',c')\) by an automorphism in \(\Aut(\M/A)\), we may assume \(\barb'=\barb_\alpha\).
    Then \(\tp(c/A\barb_\alpha)​=\tp(c_{\alpha,\beta}/A\barb_\alpha)\) for some \(\beta<\lambda\). Moving \(c'\) by an
    automorphism in \(\Aut(\M/A\barb_\alpha)\), we may assume \(c'=c_{\alpha,\beta}\)

    By the claim, \(\abs{S_n(A)}\le\lambda^2=\lambda\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(T\) is \lambda-stable if \(\abs{A}\le\lambda\Rightarrow\abs{S_1(A)\le\lambda}\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(\lambda\ge\abs{L}\), TFAE
    1. \(\forall A\subseteq\M\), if \(\abs{A}\le\lambda\), then \(\forall n\), \(\abs{S_n(A)}\le\lambda\)
    2. \(\forall A\subseteq\M\), if \(\abs{A}\le\lambda\), then \(\abs{S_1(A)}\le\lambda\)
    3. If \(M\preceq\M\), \(\abs{M}\le\lambda\Rightarrow\abs{S_1(M)}\le\lambda\)
    4. If \(M\preceq\M\), \(\abs{M}\le\lambda\Rightarrow\abs{S_n(M)}\le\lambda\)
    #+END_proposition

    #+BEGIN_proof
    \(3\to 1\): Let \(A\subseteq\M\), \(\abs{A}\le\lambda\), using downward Löwenheim–Skolem Theorem to get a model
    \(A\subseteq M\preceq\M\) and \(\abs{A}+\abs{L}=\abs{M}\)

    \(4\to 2\): similar
    #+END_proof


    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    strongly minimal theory is \lambda-stable for \(\lambda\ge\abs{L}\)

    Given \(A\subseteq\M\), \(\exists M\preceq\M\), \(\abs{M}\le\lambda\). \(S_1(M)\)=const types + transcendental types, so \(\abs{S_1(M)}=\abs{M}+1\)
    #+END_examplle

    \lambda-stable \(\Rightarrow\) no \varphi has D.P \(\Rightarrow\) all types are definable

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Suppose \(\forall M\preceq\M\), \(\forall p\in S_1(M)\) is definable. Then \(T\) is \lambda-stable for some \lambda
    #+END_lemma

    #+BEGIN_proof
    Take \(\lambda=2^{\abs{L}}>\abs{L}\). Suppose \(M\preceq\M\)  and \(\abs{M}\le\lambda\). \(p\in S_1(M)\) is determined
    by \(\varphi\in L\mapsto  d_p\varphi\in L(M)\), \(\abs{S_1(M)}\le\abs{L(M)}^{\abs{L}}\le\lambda^{\abs{L}}=2^{\abs{L}}\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    TFAE
    1. \(T\) is \lambda-stable for some \lambda
    2. no formula \(\varphi(\barx,\bary)\) has D.P.
    3. no \(\varphi(x,\bary)\) has D.P.
    4. \(M\vDash T\), \(p\in S_1(M)\Rightarrow p\) is definable
    5. \(M\vDash T\), \(p\in S_n(M)\Rightarrow p\) is definable
    #+END_theorem

    #+BEGIN_proof

    #+END_proof
** The dichotomy property and definability of types
    We will prove
    #+BEGIN_center
    If no formula has the dichotomy property, then all types over /arbitrary sets/ are definable
    #+END_center

*** The dichotomy property
    Fix a complete theory \(T\) and monster model \(\M\). Fix a formula \(\varphi(\barx;\bary)\)
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    "\(D_\alpha\) is consistent" if there are \((\bara_\sigma:\sigma\in 2^\alpha)\) and \((\barb_\tau:\tau\in 2^{<\alpha})\) s.t.
    \begin{align*}
    &\sigma\sqsupseteq\tau 0\Rightarrow\M\vDash\varphi(\bara_\sigma,\barb_\tau)\\
    &\sigma\sqsupseteq\tau 1\Rightarrow\M\vDash\neg\varphi(\bara_\sigma,\barb_\tau)
    \end{align*}
    #+END_definition

    #+BEGIN_remark
    "\(D_\alpha\)" is the name for the set of
    formulas \(\{\varphi(\barx_\sigma,\bary_\tau):\sigma\sqsupseteq\tau 0\}\cup\{\neg\varphi(\barx_\sigma,\bary_\tau):\sigma\sqsupseteq\tau 1\}\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:dadt4
    If \(D_n\) is consistent for all \(n<\omega\), then \(D_\omega\) is consistent
    #+END_lemma

    #+BEGIN_proof
    Let \(F\) be a finite fragment of \(D_\omega\). By compactness, it suffices to show that \(F\) is
    consistent. Take \(n\) bigger than the length of \tau for any \(\bary_\tau\) appearing in \(F\).
    Because \(D_n\) is consistent, there are \((\bara^0\sigma:\sigma\in 2^n)\) and \((\barb^0_\tau:\tau\in 2^{<n})\).
    Define
    #+END_proof
*** \texorpdfstring{\(\varphi\)}{φ}-types
    Continue to fix \(T,\M,\varphi(\barx;\bary)\). Let \(n\) be the length of the variable tuple \(\barx\)
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(B\subseteq\M\) is a set and \(\bara\in\M^n\), then \(\tp^\varphi(\bara/B)\) is the partial type
    \begin{equation*}
    \{\varphi(\barx;\barb):\barb\in B,\M\vDash\varphi(\bara,\barb)\}\cup\{\neg\varphi(\barx;\barb):\barb\in B,\M\vDash\neg\varphi(\bara,\barb)\}
    \end{equation*}
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(S_\varphi(B)=\{\tp^\varphi(\bara/B):\bara\in\M^n\}\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A \varphi-type \(p\in S_\varphi(B)\) is *definable* if there is an \(L(B)\)-formula \(\psi(\bary)\) s.t.
    \begin{equation*}
    \forall\barb\in B,\quad\varphi(\barx,\barb)\in p(\barx)\Leftrightarrow\M\vDash\psi(\barb)
    \end{equation*}
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:dadt10
    Suppose \varphi does not have the dichotomy property. Then every \varphi-type over any set is definable
    #+END_theorem

*** Proof of Theorem \ref{dadt10}
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    label:dadt11
    Let \(\Sigma(\barx)\) be a small set of \(L(\M)\)-formulas. Define "\(R_{\varphi,2}(\Sigma(\barx))\ge n\)" by
    recursion on \(n\):
    * \(R_{\varphi,2}(\Sigma(\barx))\ge 0\) iff \(\Sigma(\barx)\) is consistent
    * \(R_{\varphi,2}(\Sigma(\barx))\ge n+1\) iff there is \(\barb\in\M\) s.t.
      \begin{gather*}
      R_{\varphi,2}(\Sigma(\barx)\cup\{\varphi(\barx,\barb)\})\ge n\\
      R_{\varphi,2}(\Sigma(\barx)\cup\{\neg\varphi(\barx,\barb)\})\ge n
      \end{gather*}
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:dadt12
    \(R_{\varphi,2}(\Sigma(\barx))\ge n\) iff there are \((\bara_\sigma:\sigma\in 2^n)\) and \((\barb_\tau:\tau\in 2^{<n})\) s.t.
    * If \sigma extends \(\tau 0\), then \(\varphi(\bara_\sigma,\barb_\tau)\) holds
    * If \sigma extends \(\tau 1\), then \(\neg\varphi(\bara_\sigma,\barb_\tau)\) holds
    * Each \(\bara_\sigma\) satisfies \(\Sigma(\barx)\)
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(R_{\varphi,2}(\Sigma(\barx))\) is the largest \(n\) s.t. \(R_{\varphi,2}(\Sigma(\barx))\ge n\), or \(-\infty\) if there is
    no such \(n\), or \(+\infty\) if \(R_{\varphi,2}(\Sigma(\barx))\ge n\) for all \(n\)
    #+END_definition

    \(R_{\varphi,2}(\Sigma(\barx))\) is called the "\varphi-2-rank" or "\(R_{\varphi,2}\)-rank" of \Sigma

    #+ATTR_LATEX: :options [Monotonicity]
    #+BEGIN_remark
    If \(\Sigma(x)\vdash\Sigma'(x)\), then \(R_{\varphi,2}(\Sigma(\barx))\le R_{\varphi,2}(\Sigma'(\barx))\)
    #+END_remark

    #+BEGIN_remark
    From Lemma ref:dadt12 we see that \(R_{\varphi,2}(\{\barx=\barx\})\ge n\) iff "\(D_n\)" is consistent. By
    Lemma ref:dadt4,
    #+BEGIN_center
    \(R_{\varphi,2}(\{\barx=\barx\})=+\infty\) iff \varphi has the dichotomy property
    #+END_center
    In particular, if \varphi does not have the dichotomy property, then \(R_{\varphi,2}(\{\barx=\barx\})\) is
    finite. By Monotonicity, \(R_{\varphi,2}(\Sigma(\barx))\) is finite for any \(\Sigma(\barx)\)
    #+END_remark

    #+ATTR_LATEX: :options [Definability]
    #+BEGIN_remark
    Suppose \(\Sigma(\barx)\) is a _finite_ partial type over \(A\subseteq\M\) and suppose \(n<\omega\). Then the set
    \begin{equation*}
    \{\barb\in\M:R_{\varphi,2}(\Sigma(\barx)\cup\{\varphi(\barx,\barb)\})\ge n\}
    \end{equation*}
    is \(A\)-definable
    #+END_remark

    Now we can prove Theorem ref:dadt10. Suppose \(p\in S_\varphi(B)\). Take a finite
    subtype \(\Sigma(\barx)\subseteq_fp(\barx)\) minimizing \(R_{\varphi,2}(\Sigma(\barx))\). Then \(\Sigma(\barx)\) is a partial
    type over \(B\). Let \(k=R_{\varphi,2}(\Sigma(\barx))\)

    *Claim*. If \(\varphi(\barx,\barb)\in p(\barx)\), then
    \begin{gather*}
    R_{\varphi,2}(\Sigma(\barx)\cup\{\varphi(\barx,\barb)\})=k\\
    R_{\varphi,2}(\Sigma(\barx)\cup\{\neg\varphi(\barx,\barb)\})<k
    \end{gather*}

    #+BEGIN_proof
    Monotonicity gives
    \begin{gather*}
    R_{\varphi,2}(\Sigma(\barx)\cup\{\varphi(\barx,\barb)\})\le k\\
    R_{\varphi,2}(\Sigma(\barx)\cup\{\neg\varphi(\barx,\barb)\})\le k
    \end{gather*}
    If the first inequality is sharp, then it contradicts the minimality of \(\Sigma(\barx)\). If the
    second inequality is not sharp ,then
    \begin{equation*}
    R_{\varphi,2}(\Sigma(\barx))\ge k+1
    \end{equation*}
    #+END_proof

    *Claim*. If \(\neg\varphi(\barx,\barb)\in p(\barx)\), then
    \begin{gather*}
    R_{\varphi,2}(\Sigma(\barx)\cup\{\varphi(\barx,\barb)\})<k\\
    R_{\varphi,2}(\Sigma(\barx)\cup\{\neg\varphi(\barx,\barb)\})=k
    \end{gather*}

    Combining the two claims, we see that the set
    \begin{equation*}
    \{\barb\in B:\varphi(\barx,\barb)\in p(\barx)\}
    \end{equation*}
    is exactly
    \begin{equation*}
    \{\barb\in B:R_{\varphi,2}(\Sigma(\barx)\cup\{\varphi(\barx,\barb)\})\ge k\}
    \end{equation*}
    By Definability, there is an \(L(B)\)-formula \(\psi(\barx)\) s.t.
    \begin{equation*}
    R_{\varphi,2}(\Sigma(\barx)\cup\{\varphi(\barx,\barb)\})\ge k\Leftrightarrow\M\vDash\psi(\barb)
    \end{equation*}
    Therefore \(p\) is a definable \varphi-type

*** Remarks on the proof
    1. In the proof of theorem ref:dadt10, the finite subtype \(\Sigma(\barx)\subseteq p(\barx)\) chosen to
       minimize \(R_{\varphi,2}(\Sigma(\barx))\) actually has
       \begin{equation*}
       R_{\varphi,2}(\Sigma(\barx))=R_{\varphi,2}(p(\barx))
       \end{equation*}
       This comes from the following
       #+ATTR_LATEX: :options []
       #+BEGIN_fact
       1. If \(n<\omega\) and if \(R_{\varphi,2}(\Sigma_0(\barx))\ge n\) for every finite subtype \(\Sigma_0(\barx)\),
          then \(R_{\varphi,2}(\Sigma(\barx))\ge n\)
       2. \(R_{\varphi,2}(\Sigma(\barx))\) is the minimum of \(R_{\varphi,2}(\Sigma_0(\barx))\) as \(\Sigma_0\) ranges over
          finite subtypes of \Sigma.
       #+END_fact
    2. We have discussed \(R_{\varphi,2}\) for partial types, but we can also define it for definable
       sets. If \(D\) is a definable set, defined by a finite type \(\Sigma(\barx)\),
       then \(R_{\varphi,2}(D):=R_{\varphi,2}(\Sigma(\barx))\). The
*** Consequences of Theorem \ref{dadt10}
    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:dadt18
    Suppose that no formula \(\varphi(x_1,\dots,x_n;\bary)\) has the dichotomy property. For any
    model \(M\vDash T\) and any \(p\in S_n(M)\), \(p\) is definable
    #+END_theorem

    #+BEGIN_proof
    Take \(\bara\in\M\) realizing \(p\). Let \(\varphi(\barx;\bary)\) be a formula. By Theorem
    ref:dadt10, \(\tp^\varphi(\bara/M)\) is definable, therefore \(p\) is definable
    #+END_proof

    #+BEGIN_remark
    When \(A\subseteq\M\) is arbitrary, one says that \(p\in S_n(A)\) is *definable* if for
    any \(\varphi(\barx;\bary)\) there is an \(L(A)\)-formula \(\psi(\bary)\) s.t. for \(\barb\in A\)
    \begin{equation*}
    \varphi(\barx;\barb)\in p(\barx)\Leftrightarrow\M\vDash\psi(\barb)
    \end{equation*}
    #+END_remark

    The proof of Theorem ref:dadt18 shows more generally that
    #+BEGIN_center
    If no formula has the dichotomy property, then any \(p\in S_n(A)\) is definable for any \(A\)
    #+END_center

    Therefore in a stable theory, any type over /any/ set is definable

    #+BEGIN_warning
    Definable types over arbitrary sets are not as well-behaved as definable types over models. For
    example
    1. A definable type over \(A\subseteq\M\) can have more than one \(A\)-definable extension to \(\M\):
       In \(\DLO\), there is only one 1-type over \(\emptyset\). It has two different \(\emptyset\)-definable
       extensions to \(\M\): the types at \(+\infty\) and \(-\infty\)
    2. A definable type over \(A\subseteq\M\) can have no \(A\)-definable extensions to \(\M\):
       In \(\ACF\), \(\tp(\sqrt{2}/\Q)\) is definable  (because \(\ACF\) is stable), but there is
       no \(\Q\)-definable extension to the monster model \(\M\). Indeed, there are exactly two
       extensions to \(\M\), namely \(\tp(\sqrt{2}/\M)\) and \(\tp(-\sqrt{2}/\M)\). These are exchanged
       by some automorphisms in \(\Aut(\M/\Q)\) so neither one can be \(\Q\)-definable
    #+END_warning

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Assume \(T\) is stable and \(M\vDash T\). Let \(D\subseteq M^n\) be \(\emptyset\)-definable. If \(X\subseteq D\) is definable
    (with parameters from \(M\)), then \(X\) is definable over parameters from \(D\)
    #+END_theorem

    #+BEGIN_proof
    Let \(\psi(\bary)\) be a formula defining \(D\) and let \(\varphi(\bara;\bary)\) be a formula
    defining \(X\). Then \(\tp^\varphi(\bara/D)\) is definable by Theorem ref:dadt10. Therefore there is a
    formula \(\theta(\bary)\) with parameters from \(D\) s.t. if \(\barb\in D\), then
    \begin{equation*}
    (M\vDash\varphi(\bara;\barb))\Leftrightarrow\varphi(\barx;\barb)\in\tp^\varphi(\bara/D)\Leftrightarrow(M\vDash\theta(\barb))
    \end{equation*}
    In other words, if \(\psi(\bary)\) holds, then \(\varphi(\bara;\bary)\) is equivalent to \(\theta(\bary)\).
    Therefore \(X\) is defined by \(\psi(\bary)\wedge\theta(\bary)\), a formula with parameters from \(D\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    Let \(M\) be a stable structure and \(D\subseteq M^n\) be \(A\)-definable. Let \(N\) be the structure
    whose domain is \(D\), with an \(m\)-ary relation symbol for each \(A\)-definable \(X\subseteq D^m\).
    Then the definable subsets of \(D^m\) in \(M\) agree with the definable subsets of \(D^m\) in \(N\)
    #+END_fact

** Coheirs
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(M\preceq N\), if \(p\in S_n(M)\), if \(q\in S_n(N)\) , then \(q\) is a *coheir* of \(p\)
    if \(q\supseteq p\) and \(q\) is finitely satisfiable in \(M\) (for any \(\phi(x)\in q(x)\), there
    is \(a\in M\) s..t \(N\vDash\phi(a)\))
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(\Q^{\alg}\preceq\C\), \(q=\tp(\pi/\C)\), \(p=\tp(\pi/\Q^{\alg})\). \(q\supseteq p\), but \(q\) isn't a coheir
    since \(x=\pi\in q(x)\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    If \(M\preceq N\) strongly minimal, \(q(x)\in S_1(N)\), \(p(x)\in S_1(M)\) is the transcendental
    1-type, \(p\subseteq q\), then \(q\) is a coheir of \(p\),

    If \(\varphi(x)\in q(x)\), then \(\varphi(N)\) is cofinite and \(M\) is infinite, so \(\varphi(N)\cap M\neq\emptyset\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:3.10.4
    If \(M\preceq N\), \(\Sigma(\barx)\) partial type over \(N\), \(\Sigma(\barx)\) is f.sat. in \(M\),
    then \(\exists q(\barx)\in S_n(N)\), \(q(\barx)\) is fsat. in \(M\)
    #+END_lemma

    #+BEGIN_proof
    Let \(\Psi(\barx)=\{\psi(\barx)\in L(N):\forall\bara\in M, N\vDash\psi(\bara)\}\)

    If \(\bara\in M\), then \(\bara\) satisfies \(\Psi\)

    *Claim* \(\Sigma(\barx)\) fsat in \(M\) \(\Rightarrow\) \(\Sigma\cup\Psi\) is fsat \(\Rightarrow\) \(q\in S_n(N)\), \(q\supseteq\Sigma\cup\Psi\)

    If \(q\) isn't fast. in \(M\) then \(\varphi(\barx)\in q(\barx)\), \(\varphi(\barx)\) not sat. in \(M\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(p\in S_n(M)\), \(N\succeq M\), then \(\exists q\in S_n(N)\), \(q\) is a coheir of \(p\)
    #+END_theorem

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \(M_1\preceq M_2\preceq M_3\), \(p_1\in S_n(M_1)\), \(p_2\in S_n(M_2)\), \(p_2\) is a coheir of \(p_1\).
    Then \(\exists p_3\in S_n(M_3)\), \(p_3\) is a coheir of \(p_1\)and \(p_2\)
    #+END_theorem
** Coheir Independence
*** Coheir independence
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \(M\) be a small model, \(\bara,\barb\) small tuples (possibly infinite). Then \(\bara\)is
    *coheir independent* from \(\barb\) over \(M\), written
    \begin{equation*}
    \bara\ind_M^u\barb
    \end{equation*}
    if \(\tp(\bara/M\barb)\) is finitely satisfiable in \(M\)
    #+END_definition

    #+BEGIN_remark
    The relation \(A\ind_M^uB\) is finitary w.r.t. the arguments \(A\) and \(B\), in the following
    sense. \(A\ind_M^uB\) holds iff the following does:

    For any finite tuple \(\bara\in A\) and any finite tuple \(\barb\in B\), we
    have \(\bara\ind_M^u\barb\)

    Since a formula \(\varphi(\barx,\bary)\) can only refer to finitely many variables
    #+END_remark

    #+BEGIN_remark
    The relation \(\ind^u\) can be used to define heirs and coheirs, as follows. Suppose \(M,N\) are
    small models with \(M\preceq N\). Suppose \(p\in S_n(M)\) and \(q\in S_n(N)\) with \(q\supseteq p\).
    Take \(\bara\in\M^n\) realizing \(q\)
    1. \(q=\tp(\bara/N)\) is a coheir of \(p=\tp(\bara/M)\) iff \(\bara\ind_M^uN\)
    2. \(q=\tp(\bara/N)\) is an heir of \(p=\tp(\bara/M)\) iff \(N\ind_M^u\bara\)
    #+END_remark
*** Existence
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \(M\) be a small model and \(\bara,\barb\) be tuples, possibly infinite
    1. There is \(\sigma\in\Aut(\M/M)\) s.t. \(\sigma(\bara)\ind_M^u\barb\)
    2. There is \(\sigma\in\Aut(\M/M)\) s.t. \(\bara\ind_M^u\sigma(\barb)\)
    #+END_lemma

    #+BEGIN_proof
    1. Let \alpha be the length of \(\bara\) and \(\barx\) be an \alpha-tuple of variables. Let
       \begin{equation*}
       \Psi(\barx)=\{\psi(\barx)\in L(M\barb):\psi(\barx)\text{ is satisfied by every }\bara'\in M^\alpha\}
       \end{equation*}
       If \(\varphi(\barx)\in\tp(\bara/M)\), then there is \(\bara'\in M^\alpha\) satisfying \(\varphi(\barx)\)
       because \(\tp(\bara/M)\) is finitely satisfiable in \(M\). Then \(\bara'\)
       satisfies \(\{\varphi(\barx)\}\cup\Psi(\barx)\). This shows \(\tp(\bara/M)\cup\Psi(\barx)\) is finitely
       satisfiable, hence realized by some \(\bara'\in\M^\alpha\)

       Then \(\bara'\) realizes \(\tp(\bara/M)\), so \(\tp(\bara'/M)=\tp(\bara/M)\), and there
       is \(\sigma\in\Aut(\M/M)\) s.t. \(\sigma(\bara)=\bara'\). Finally \(\bara'\ind_M^u\barb\) by choice
       of \(\Psi(\barx)\): if \(\varphi(\barx)\in\tp(\bara'/M\barb)\) and \(\varphi(\barx)\) isn't satisfiable
       in \(M\), then \(M\vDash\neg\exists\barx\varphi(\barx)\) and \(M\vDash\forall\barx\neg\varphi(\barx)\), hence
        \(\neg\varphi(\barx)\in\Psi(\barx)\) and \(\bara\) doesn't satisfy \(\varphi(\barx)\), a contradiction

    2. By 1, there is \(\tau\in\Aut(\M/M)\) s.t. \(\tau(\bara)\ind_M^u\barb\). Let \(\sigma=\tau^{-1}\).
       Then \(\sigma(\tau(\bara))\ind_{\sigma(M)}^u\sigma(\barb)\), or equivalently, \(\bara\ind_M^u\sigma(\barb)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    Suppose \(p\in S_n(M)\) and \(N\succeq M\)
    1. There is \(q\in S_n(M)\) s.t. \(q\) is a coheir of \(p\)
    2. There is \(q\in S_n(M)\) s.t. \(q\) is an heir of \(p\)
    #+END_corollary

    #+BEGIN_proof
    1. Take \(\bara\in\M^n\) realizing \(p\). Let \(\barb\) enumerate \(N\). By Lemma, there
       is \(\sigma\in\Aut(\M/M)\) s.t. \(\sigma(\bara)\ind_M^u\barb\), i.e., \(\sigma(\bara)\ind_M^uN\).
       Thus \(\tp(\sigma(\bara)/N)\) is a coheir of \(\tp(\sigma(\bara)/M)=\tp(\bara/M)=p\)
    2. Similarly we have \(N\ind_M^u\sigma(\bara)\), and thus \(\tp(\sigma(\bara)/N)\) is an heir of \(\tp(\sigma(\bara)/M)=\tp(\bara/M)\)
    #+END_proof
*** "u" for "ultrafilter"
    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:co6
    Let \(\bara\) be an \alpha-tuple in \(\M\). Let \(M\) be a small model and \(B\) a small set. TFAE
    1. \(\bara\ind_M^uB\)
    2. There is an ultrafilter \(\calu\) on the set \(M^\alpha\) s.t. for any \(L(MB)\)-formula \(\varphi(\barx)\)
       \begin{equation*}
       \varphi(\barx)\in\tp(\bara/MB)\Leftrightarrow\{\bara'\in M^\alpha:\M\vDash\varphi(\bara')\}\in\calu
       \end{equation*}
    #+END_proposition

    #+BEGIN_proof
    \(\Rightarrow\): For \(\varphi(\barx)\in\tp(\bara/MB)\),  let \(I=M^\alpha\) and \(\calf=\{\varphi(M^\alpha):\varphi(\barx)\in\tp(\bara/MB)\}\).
    We claim that \(\calf\) has FIP. Let \(\calu\) be an ultrafilter on \(M^\alpha\) extending \(\calf\). Then for
    any \(L(MB)\)-formula
    \begin{equation*}
    \varphi(\barx)\in\tp(\bara/MB)\Rightarrow\varphi(M^\alpha)\in\calf\Rightarrow\varphi(M^\alpha)\in\calu\Leftrightarrow\{\bara'\in M:\M\vDash\varphi(\bara')\}\in\calu
    \end{equation*}
    Then
    \begin{equation*}
    \varphi(\barx)\notin\tp(\bara/MB)\Rightarrow\neg\varphi(\barx)\in\tp(\bara/MB)\Rightarrow\varphi(M^\alpha)\notin\calu
    \end{equation*}

    \(\Leftarrow\):
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:co8
    Suppose \(p\in S_n(M)\) and \(N\succeq M\)
    1. If \(q\in S_n(N)\) is a coheir of \(p\), then there is an ultrafilter \(\calu\) on \(M^n\) s.t.
       \begin{equation*}
       q(\barx)=\{\varphi(\barx)\in L(N):\varphi(M^n)\in\calu\}\tag{\star}
       \end{equation*}
    2. Conversely, if \(\calu\) is an ultrafilter on \(M^n\) and we define \(q(\barx)\) according to
       (\(\star\)), then \(q(\barx)\in S_n(N)\) and \(q\) is a coheir of \(p\)
    #+END_proposition

    #+BEGIN_proof
    1. Take \(\bara\) realizing \(q\) and \(p\), then \(\bara\ind_M^uN\). Apply proposition ref:co6
    2. It suffices to show that \(q\) is finitely satisfiable in \(M\) and complete
    #+END_proof

    #+ATTR_LATEX: :options [Coheirs extend]
    #+BEGIN_corollary
    label:co9
    Suppose \(M\preceq N\preceq N'\) and \(p\in S_n(M)\) and \(q\in S_n(N)\) is a coheir of \(p\), then
    is \(q'\in S_n(N')\) with \(q'\supseteq q\) and \(q'\) is a coheir of \(p\)
    #+END_corollary

    #+BEGIN_proof
    By proposition ref:co8 there is an ultrafilter \(\calu\) on \(M^n\) s.t.
    \begin{equation*}
    q(\barx)=\{\varphi(\barx)\in L(N):\varphi(M^n)\in\calu\}
    \end{equation*}
    Take \(q'(\barx)=\{\varphi(\barx)\in L(N'):\varphi(M^n)\in\calu\}\)
    #+END_proof

    #+BEGIN_remark
    Suppose \(q\in S_n(N)\) is an heir of \(p\in S_n(M)\). Then \(N\ind_M^u\bara\) for a
    realization \(\bara\). Proposition ref:co6 gives an ultrafilter \(\calu\) and tells us something.,
    ultimate conclusion is

    There is an ultrapower \(M^{\calu}\succeq N\) s.t. \(p^{\calu}\supseteq q\)
    #+END_remark
*** Symmetry
    Suppose \(q\in S_n(N)\) is an extension of \(p\in S_n(M)\).

    In stable theory, coheir and heir are the same thing, so for any \(q\in S_n(N)\)
    and \(p\in S_n(M)\), \(M\preceq N\)
    \begin{equation*}
    \bara\ind_M^uN\Leftrightarrow N\ind_M^u\bara
    \end{equation*}
    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(T\) is stable, then
    \begin{equation*}
    \bara\ind_M^u\barb\Leftrightarrow\barb\ind_M^u\bara
    \end{equation*}
    #+END_theorem

    #+BEGIN_proof
    It suffices to prove \(\Rightarrow\). Let \alpha be the length of \(\bara\). Take a small model \(N\)
    containing \(M\) and \(\barb\). By the method of ref:co9, one can find a type \(q\in S_\alpha(N)\)
    extending \(\tp(\bara/M\barb)\) finitely satisfiable in \(M\). Take \(\bara'\) realizing \(q\).
    Then \(\bara'\ind_M^uN\). Also \(\tp(\bara'/M\barb)=q\uhr(M\barb)=\tp(\bara/M\barb)\), so there
    is \(\sigma\in\Aut(\M/M\barb)\) s.t. \(\sigma(\bara')=\bara\). Then
    \begin{equation*}
    \bara'\ind_M^uN\Rightarrow\sigma(\bara')\ind_{\sigma(M)}^u\sigma(N)\Leftrightarrow\bara\ind_M^u\sigma(N)
    \end{equation*}
    Replacing \(N\) with \(\sigma(N)\), we may assume \(\bara\ind_M^uN\).  Therefore we
    have \(N\ind_M^u\bara\). As \(\barb\in N\), this implies \(\barb\ind_M^u\bara\)
    #+END_proof

*** Finitely satisfiable types commute with definable types
    Recall that if \(M\preceq N\preceq\M\), then
    \begin{equation*}
    N\ind_M^u\bara\Leftrightarrow\tp(\bara/N)\sqsupseteq\tp(\bara/M)
    \end{equation*}
    Therefore the following lemma generalizes the fact that definable types have unique types
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:ci2.1
    Let \(M\) be a small model. Suppose \(\tp(\bara/M)\) is definable and \(\barb\ind_M^u\bara\).
    Then \(\tp(\bara/M\barb)\) is \(p\uhr M\barb\), where \(p\) is the \(M\)-definable global type
    extending \(\tp(\bara/M)\)
    #+END_lemma

    #+BEGIN_proof
    We must show that for any \(L\)-formula \(\varphi(\barx,\bary,\barz)\) and any \(\barc\in M\),
    \begin{equation*}
    \varphi(\barx,\barb,\barc)\in\tp(\bara/M\barb)\Leftrightarrow\M\vDash(d_p\barx)\varphi(\barx,\barb,\barc)
    \end{equation*}
    Otherwise, these things are true
    \begin{gather*}
    \M\vDash\varphi(\bara,\barb,\barc)\not\Leftrightarrow\M\vDash(d_p(\barx)\varphi(\barx,\barb,\barc)\\
    \M\vDash\varphi(\bara,\barb,\barc)\not\leftrightarrow(d_p\barx)\varphi(\barx,\barb,\barc)\\
    (\varphi(\bara,\bary,\barc)\not\leftrightarrow(d_p\barx)\varphi(\barx,\bary,\barc))\in\tp(\barb/M\bara)
    \end{gather*}
    As \(\barb\ind_M^u\), there is \(\barb'\in M\) s.t.
    \begin{gather*}
    \M\vDash\varphi(\bara,\barb',\barc)\not\leftrightarrow(d_p\barx)\varphi(\barx,\barb',\barc)\\
    \M\vDash\varphi(\bara,\barb',\barc)\not\Leftrightarrow\M\vDash(d_p\barx)\varphi(\barx,\barb',\barc)\\
    \varphi(\barx,\barb',\barc)\in\tp(\bara/M)\not\Leftrightarrow\M\vDash(d_p\barx)\varphi(\barx,\barb',\barc)
    \end{gather*}
    A contradiction
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:ci2.2
    Let \(p\in S_n(\M)\) be finitely satisfiable in a small model \(M\). If \(\bara\vDash p\uhr M\barb\),
    then \(\bara\ind_M^u\barb\)
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:ci2.3
    Let \(p,q\) be global types. Suppose \(p\) is definable over some small set \(A\). (\(p\)
    is \(A\)-invariant) Suppose \(q\) is finitely satisfiable in some small set \(B\) (\(q\)
    is \(B\)-invariant by ref:3.10.17). Then \(p\) and \(q\) commute
    #+END_theorem

    #+BEGIN_proof
    Otherwise, there is an \(L(\M)\)-formula \(\varphi(\barx,\bary)\) s.t.
    \begin{gather*}
    (p\otimes q)(\barx,\bary)\vdash\varphi(\barx,\bary)\\
    (q\otimes p)(\bary,\barx)\vdash\neg\varphi(\barx,\bary)
    \end{gather*}
    The formula \varphi uses only finitely many parameters \(\barc\) from \(\M\). By Löwenheim–Skolem
    Theorem there is a small model \(M\) containing \(AB\barc\). Then \(\varphi(\barx,\bary)\) is
    an \(L(M)\)-formula. Also, \(p\) is \(M\)-definable and \(q\) is finitely satisfiable in \(M\).
    Note that \(p,q\) and \(p\otimes q\), \(q\otimes p\) are \(M\)-invariant types.
    Take \((\bara,\barb)\vDash(p\otimes q)\uhr M\) and \(\bara\vDash p\uhr M\), \(\barb\vDash q\uhr M\bara\). By Lemma
    ref:ci2.2, \(\barb\ind_M^u\bara\)

    Now \(\tp(\bara/M)\) is the definable type \(p\uhr M\), so by Lemma ref:ci2.2
    \begin{equation*}
    \bara\vDash p\uhr M\barb
    \end{equation*}
    Thus \((\barb,\bara)\vDash(q\otimes p)\uhr M\)

    It follows that \((q\otimes p)(\bary,\barx)\) and \((p\otimes q)(\barx,\bary)\) have the same restriction
    to \(M\). Then \varphi leads to a contradiction
    #+END_proof

*** Types commute in stable theories
    Assume the theory \(T\) is stable
    #+ATTR_LATEX: :options [Assuming stability]
    #+BEGIN_proposition
    label:ci2.4
    Let \(p\in S_n(\M)\) be a global type and \(M\) be a small model. TFAE
    1. \(p\) is finitely satisfiable in \(M\)
    2. \(p\) is \(M\)-invariant
    3. \(p\) is \(M\)-definable
    #+END_proposition

    #+BEGIN_proof
    \(1\to 2\): ref:3.10.17

    \(2\to 3\): ref:3.10.19
    #+END_proof

    #+ATTR_LATEX: :options [Assuming stability]
    #+BEGIN_theorem
    Let \(p(\barx)\), \(q(\bary)\) be two invariant global types. Then \(p\) and \(q\) commute
    #+END_theorem

    #+BEGIN_proof
    The types \(p\) and \(q\) are invariant over small sets \(A\) and \(B\) respectively. Take a
    small model \(M\) containing \(A\cup B\). Then \(p\) and \(q\) are \(M\)-invariant. By Proposition
    ref:ci2.4, \(p\) is \(M\)-definable and \(p\) is finitely satisfiable in \(M\). Therefore \(p\)
    and \(q\) commute by Theorem ref:ci2.3
    #+END_proof


*** Morley products and \texorpdfstring{\(\ind^u\)}{indu}
    Let \(M\) be a small model. If \(p\) and \(q\) are \(M\)-definable types, then the Morley
    product \(p\otimes q\) is also \(M\)-definable by ref:3.10.26. Since \(M\)-definable global types
    corresponds to (\(M\)-)definable types over \(M\) (Proposition ref:3.10.15), we can regard \(\otimes\)
    as an operation on definable types over \(M\)

    If \(T\) is stable, then /all/ types over \(M\) are definable, and we get an operation
    \begin{align*}
    S_n(M)\times S_n(M)&\to S_{m+n}(M)\\
    (p,q)&\mapsto p\otimes q
    \end{align*}
    The following theorem shows that, at least in stable theories, there is a very close connection
    between the Morley product \(p\otimes q\) and the coheir independence relation \(\bara\ind_M^u\barb\)

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Assume \(T\) is stable. Let \(M\preceq\M\) be a small model and \(\bara,\barb\) be tuples in \(\M\).
    Then
    \begin{equation*}
    \bara\ind_M^u\barb\Leftrightarrow\tp(\barb,\bara/M)=\tp(\barb/M)\otimes\tp(\bara/M)
    \end{equation*}
    #+END_theorem

    #+BEGIN_proof
    First suppose \(\bara\ind_M^u\barb\). Then \(\tp(\bara/M\barb)\) is finitely satisfiable
    in \(M\). By Lemma ref:3.10.4, there is a global type \(p\) which is finitely satisfiable
    in \(M\) and extends \(\tp(\bara/M\barb)\). By Proposition ref:ci2.4, \(p\) is \(M\)-definable.
    Then \(p\) is the unique \(M\)-definable global extension of the definable
    type \(\tp(\bara/M)\). Let \(q\) be the unique \(M\)-definable global extension of the definable
    type \(\tp(\barb/M)\). Then
    \begin{equation*}
    \barb\vDash q\uhr M \quad\text{ and }\quad\bara\vDash p\uhr M\barb
    \end{equation*}
    because \(p\) extends \(\tp(\bara/M\barb)\). Therefore
    \begin{equation*}
    (\barb,\bara)\vDash(q\otimes p)\uhr M
    \end{equation*}
    or equivalently, \(\tp(\barb,\bara/M)=(q\otimes p)\uhr M\).

    Conversely, suppose \(\tp(\barb,\bara/M)=\tp(\barb/M)\otimes\tp(\bara/M)\). Let \(q\) be the
    unique \(M\)-definable global extension of the definable type \(\tp(\barb/M)\) and let \(p\) be
    the unique \(M\)-definable global extension of the definable type \(\tp(\bara/M)\) by
    ref:3.10.15. Then
    \begin{equation*}
    (\barb,\bara)\vDash(q\otimes p)\uhr M
    \end{equation*}
    or equivalently
    \begin{equation*}
    \barb\vDash q\uhr M \quad\text{ and }\quad\bara\vDash p\uhr M\barb
    \end{equation*}
    By Proposition ref:ci2.4 \(p\) is finitely satisfiable in \(M\), and so
    \begin{equation*}
    \bara\vDash p\uhr M\barb\Rightarrow\bara\ind_M^u\barb
    \end{equation*}
    by Lemma ref:ci2.2
    #+END_proof



** Invariant types
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If \(X\subseteq\M^n\), TFAE
    1. \(\sigma(X)=X\) if \(\sigma\in\Aut(\M/A)\)
    2. If \(\bara,\barb\in\M^n\), \(\bara\equiv_A\barb\Rightarrow(\bara\in X\Leftrightarrow\barb\in X)\)
    3. There is \(f:S_n(A)\to\{0,1\}\) s.t. \(\bara\in X\Leftrightarrow f(\tp(\bara/A))=1\)
    #+END_lemma

    #+BEGIN_proof
    rewrite (2) as
    - If \(\bara,\barb\in\M^n\), \(\sigma\in\Aut(\M/A)\), \(\sigma(\bara)=\sigma(\barb)\),
        then \(\bara\in X\Leftrightarrow\barb\in X\)
    - If \(\bara\in M\), \(\sigma\in\Aut(\M/A)\), \(\bara\in X\Leftrightarrow\sigma(\bara)\in X\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(X\subseteq\M^n\) is *\(A\)-invariant* if \(\forall\sigma\in\Aut(\M/A)\), \(\sigma(X)=X\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    If \(X\) is \(A\)-definable, then \(X\) is \(A\)-invariant
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:3.10.10
    If \(D\subseteq\M^n\) is definable and \(A\)-invariant, then \(D\) is \(A\)-definable
    #+END_lemma

    #+BEGIN_proof
    _Step 1_: If \(\barb\in D\) then \(\tp(\barb/A)\vdash\barx\in D\), by compactness, there
    is \(\varphi(\barx)\in\tp(\barb/A)\) s.t. \(\varphi(\barx)\vdash \barx\in D\), \(\varphi(\M^n)\subseteq D\)

    _Step 2_: So then \(D\) is covered by \(A\)-definable subsets of \(D\). By compactness, \(D\) is
    covered by finitely many of them, which implies \(D\) is \(A\)-definable

    Suppose \(D=\psi\), then \([\psi]=\bigcup[\varphi_i]\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(p\) is *\(A\)-definable* if \(\forall\varphi\), \(\{\barb\in\M:\varphi(\barx,\barb)\in p(\barx)\}\) is \(A\)-definable
    #+END_definition

    #+BEGIN_remark
    1. \(p\) is \(A\)-definable \(\Rightarrow\) \(p\) is \(A\)-invariant
    2. If \(p\) is definable, then \(p\) is \(A\)-invariant \(\Leftrightarrow\) \(p\) is \(A\)-definable
    3. If \(p\) is definable thne \(p\) is \(A\)-definable for some small \(A\)

       Each \(d_p\varphi\) uses only finitely many parameters
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:3.10.15
    Suppose \(M\preceq\M\), small
    1. If \(p\in S_n(M)\) definable and \(p^{\M}\) is its heir over \(\M\), then \(p^{\M}\in S_n(\M)\)
       is \(M\)-definable
    2. \(p\mapsto p^{\M}\) is a bijection from definable types over \(M\) to \(M\)-definable types over \(\M\)
    #+END_proposition

    #+BEGIN_proof
    1. \(p^{\M}\) has the same definition as \(p\), so it's \(M\)-definable
    2. \(q\mapsto q\uhr M\) is an inverse to \(p\mapsto p^{\M}\)
    #+END_proof

    Warning: an \(M\)-invariant type \(p\) is not determined by \(p\uhr M\).
    If \(A\subseteq\M\), \(A\)-definable type \(p\) is not determined by \(p\uhr A\). Only works for models
    CHECK

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:3.10.17
    Suppose \(M\preceq\M\) and \(p\in S_n(M)\)
    1. If \(q\in S_n(\M)\) and \(q\) is a coheir of \(p\), then \(q\) is \(M\)-invariant
    2. \(\exists q\in S_n(\M)\), \(p\subseteq q\) is \(M\)-invariant
    #+END_theorem

    #+BEGIN_proof
    If \(q\) is a coheir of \(p\), but \(q\) is not \(M\)-invariant,
    then \(\exists\barb,\barc\), \(\barb\equiv_M\barc\), \(\varphi(\barx,\barb)\in q\), \(\varphi(\barx,\barc)\notin q\).
    Then \(\varphi(\barx,\barb)\wedge\neg\varphi(\barx,\barc)\in q(\barx)\). Because \(q\) is fsat.
    in \(M\), \(\exists\bara\in M\), \(M\vDash\varphi(\bara,\barb)\wedge\neg\varphi(\bara,\barc)\) , so \(\barb\not\equiv_M\barc\)
    #+END_proof

    In stable theories:
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If \(T\) is stable and \(p\) is \(A\)-invariant, then \(p\) is \(A\)-definable
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:3.10.19
    Suppose \(T\) stable, \(M\preceq\M\) small, \(p\in S_n(M)\). Let \(p^{\M}\) the global heir.
    1. \(p^{\M}\) is the only \(M\)-invariant global type extending \(p\)
    2. \(p^{\M}\) is the only global coheir of \(p\)
    3. If \(M\preceq N\preceq\M\) and \(q\) is the heir of \(p\) over \(N\), then \(q\) is the unique coheir
       of \(p\) over \(N\)
    #+END_theorem

    #+BEGIN_proof
    1. \(M\)-invariant \(\Leftrightarrow\) \(M\)-definable
    2. there is some coheir of \(p\). Any coheir is \(M\)-invariant, so \(p^{\M}\) is the only coheir
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    In a stable theory, coheirs are unique and coheir=heir
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    label:3.10.21
    In a stable theory, "coheir" is transitive
    #+END_corollary
** Morley sequence
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    If \(p,q\) are \(A\)-invariant global types, \(p\in S_n(\M)\), \(q\in S_m(\M)\), then there
    is \(r\in S_{n+m}(A)\) s.t. \((\barb,\barc)\vDash r\) iff
    \begin{equation*}
    \barb\vDash p\uhr A \quad\text{ and }\quad c\vDash q\uhr(A\barb)\tag{\star}
    \end{equation*}
    #+END_lemma

    #+BEGIN_proof
    Let \(X=\{(\barb,\barc):\barb\vDash p\uhr A\text{ and }\barc\vDash q\uhr A\barb\}\). If \((\barb,\barc)\in X\)
    and \(\sigma\in\Aut(\M/A)\), then \(\sigma(\barb)\vDash\sigma(p\uhr A)=p\uhr A\) and \(\sigma(\barc)\vDash q\uhr A\sigma(\barb)\). So
    \(\sigma(\barb,\barc)\in  X\), \(X\) is \(A\)-invariant

    Fix \(\barb_0\vDash p\uhr A\), \(\barc_0\vDash q\uhr A\barb_0\), so \((\barb_0,\barc_0)\in X\).
    Let \(r=\tp(\barb_0,\barc_0/A)\). If \((\barb,\barc)\vDash r\), then \((\barb,\barc)\in X\)

    Conversely, if \((\barb,\barc)\in X\), want \((\barb,\barc)\vDash r\),
    i.e., \((\barb,\barc)\equiv_A(\barb_0,\barc_0)\)

    \(\barb\vDash p\uhr A=\tp(\barb_0/A)\) so \(\barb\equiv_A\barb_0\), \(\exists\sigma\in\Aut(A)\), \(\sigma(\barb)=\barb_0\).
    Replace \((\barb,\barc)\) with \((\sigma(\barb),\sigma(\barc))=(\barb_0,\sigma(\barc))\).

    WMA \(\barb=\barb_0\). Then \(\barc\) and \(\barc_0\) both satisfy \(q\uhr A\barb_0\).
    Move \(\barc\) by \(\tau\in\Aut(\M/A\barb_0)\), we may assume \(\barc=\barc_0\). Then
    \(\barc\equiv_{A\barb_0}\barc_0\Rightarrow \barb\barc\equiv_A\barb_0\barc_0\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(p\in S_n(\M)\), \(q\in S_m(\M)\) and both are \(A\)-invariant, then there
    is \(A\)-invariant \(p\otimes q\in S_{n+m}(\M)\) s.t. for any small \(A'\supseteq A\),
    \begin{equation*}
    (\barb,\barc)\vDash(p\otimes q)\uhr A'\Leftrightarrow b\vDash p\uhr A'\text{ and }\barc\vDash q\uhr A'\barb
    \end{equation*}
    #+END_proposition

    #+BEGIN_proof
    Note \(p,q\) are \(A'\)-invariant for any \(A'\)-invariant, so lemma
    gives \(r_{A'}\in S_{n+m}(A')\) for each \(A'\supseteq A\) s.t. \((\barb,\barc)\vDash r_{A'}\Leftrightarrow\) the condition

    If \(A''\supseteq A'\supseteq A\), if \((\barb,\barc)\vDash r_{A''}\) then \((\barb,\barc)\vDash r_{A'}\)
    so \(r_{A'}\vDash r_{A'}\uhr A'\).

    Let \(p\otimes q=\bigcup_{A'}r_{A'}\), then \(p\otimes q\in S_{n+m}(\M)\) and \(r_{A'}=p\otimes q\uhr A'\)
    #+END_proof

    If \(\sigma\in\Aut(\M/A)\), then \(\sigma(p\otimes q)=\sigma(p)\otimes\sigma(q)=p\otimes q\), so \(p\otimes q\) is \(A\)-invariant

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    If \(p\in S_n(M)\) \(A\)-invariant where \(M\) is \(\abs{A}^+\)-saturated and \(N\succeq M\), then \(p\)
    has a unique \(A\)-invariant extension over \(N\)
    #+END_fact

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    If \(p,q\in S_{n+m}(\M)\) \(A\)-invariant, take \(\barb\vDash p\), \(\barb\in\M_1\succeq\M\),
    take \(\barc\vDash q\uhr\M_1\) then \(\tp(\barb,\barc/\M)=p\otimes q\)
    #+END_fact

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    The *(Morley) product* of invariant types \(p,q\) is \(p\otimes q\)
    #+END_definition

    If \(p,q\) are \(A\)-invariant, then \((\barb,\barc)\vDash(p\otimes q)\uhr A\Leftrightarrow\barb\vDash p\uhr A\)
    and \(\barc\vDash q\uhr A\barb\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\acl(A)=\bigcup\{\varphi(\M):\varphi(x)\in L(A),\abs{\varphi(\M)}<\infty\}\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    In \(\ACF\), if \(K\) a subfield of \(\M\), then \(\acl(K)\) is \(K^{\alg}\)
    #+END_fact

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    In any theory \(T\), \(\acl(-)\) is a finitary closure operation
    #+END_fact

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    If \(T\) is strongly minimal and \(p\in S_1(\M)\) transcendental 1-type, what is \(p\otimes p\)

    \(b\vDash p\uhr A\Leftrightarrow b\notin\acl(A)\)

    Therefore \((b,c)\vDash(p\otimes p)\uhr A\) iff \(b\vDash p\uhr A\) and \(c\vDash p\uhr Ab\)
    iff \(b\notin\acl(A)\) and \(c\notin\acl(Ab)\)

    idea: \(b,c\) are algebraically independent over \(A\)
    #+END_examplle

    In stable theories, \((p\otimes q)(x,y)\) is the "most free" completion of \(p(\barx)\cup q(\bary)\)

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(\M\vDash\ACF\). let \(p_V\) denote generic type of a variety \(V\subseteq\M\)
    \(\{x\in V\}\cup\{x\notin W:W\subsetneq V, W\text{ algebraic}\}\)

    If \(V\subseteq\M^n\), \(W\subseteq \M^m\) varieties, then \(V\times W\) is a variety, and \(p_V\otimes p_W=p_{V\times W}\)
    #+END_examplle

    #+BEGIN_proof
    \(p_V\otimes p_W=p_Z\) for some variety \(Z\subseteq\M^{n+m}\). Take small \(M\preceq\M\) s.t. \(V,W,Z\)
    are \(M\)-definable. Take \(\bara\vDash p_V\uhr M\), take small \(N\preceq\M\), \(N\supseteq M\bara\).
    Take \(\barb\vDash p_W\uhr N\), so \((\bara,\barb)\vDash p_V\otimes p_W\uhr M=p_Z\uhr M\).

    "\(x\in V\in p_V\uhr M\)", \(\bara\in V\), \(\barb\in W\), so \((\bara,\barb)\in V\times W\).

    *Fact*: \(p_Z(\barx)\vdash\barx\in U\Leftrightarrow Z\subseteq U\) for \(U\) algebraic

    So \((\bara,\barb)\in V\otimes W\Leftrightarrow Z\subseteq V\times W\)

    Suppose \(Z\subsetneq V\times W\). Take \((\bara_0,\barb_0)\in V\times W\setminus Z\).
    Let \(Z_{\bara}=\{\bary\in M:(\bara,\bary)\in Z\}\), then \(Z_{\bara}\) is an algebraic set
    over \(N\supseteq M_{\bara}\)

    L
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    invariant types \(p,q\) "commute" if \(p\otimes q(\barx,\bary)=q\otimes p(\bary,\barx)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In \(\ACF\), any two types commutes

    \(p_V\otimes p_W=p_{V\times W}=p_W\otimes p_V\)
    #+END_examplle

    If \(p\) is a definable type and \(\varphi(\barx,\bary)\) is a formula,
    then \((d_p\barx)\varphi(\barx,\bary)\) means \(d\varphi(\bary)\), the formula
    defining \(\{\barb\in\M:\varphi(\barx,\barb)\in p(\barx)\}\)

    \(d_p\barx\) works like quantifier, free variables in \((d_p\barx)\varphi(\barx,\bary)\) are \(\bary\)

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(\M\vDash T\) strongly minimal, let \(p=\) transcendental 1-type, \(\varphi()\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:3.10.26
    If \(p,q\) are \(A\)-definable global types, then \(p\otimes q\) is \(A\)-definable
    and \((d_{p\otimes q}(\barx,\bary))\varphi(\barx,\bary,\barz)\equiv(d_p\barx)(d_q\bary)\varphi(\barx,\bary,\barz)\)
    #+END_proposition

    #+BEGIN_proof
    Fix \(\barc\in\M\), take \(M\preceq\M\) s.t. \(\barc\in M\) and \(M\supseteq A\), so \(p,q\) are \(M\)-definable.
    Take \(\bara\vDash p\uhr M\) and \(\barb\vDash q\uhr M\bara\), so \((\bara,\barb)\vDash(p\otimes q)\uhr M\). So
    \begin{align*}
    \varphi(\barx,\bary,\barc)\in p\otimes q&\Leftrightarrow \varphi(\barx,\bary,\barc)\in p\otimes q\uhr M\\
    &\Leftrightarrow\M\vDash\varphi(\bara,\barb,\barc)\\&\Leftrightarrow\varphi(\bara,\bary,\barc)\in q(\bary)\uhr M\bara\\
    &\Leftrightarrow\varphi(\bara,\bary,\barc)\in q(\bary)\\
    &\Leftrightarrow\M\vDash(d_q\bary)\varphi(\bara,\bary,\barc)\\
    &\Leftrightarrow(d_q\bary)\varphi(\barx,\bary,\barc)\in p(\barx)\\
    &\Leftrightarrow(d_p\barx)(d_q\bary)\varphi(\barx,\bary,\barc)
    \end{align*}
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    in a strongly minimal theory, if \(p\in S_1(\M)\) is transcendental and \(q=p\otimes p\)
    then \((d_q(x,y))\varphi(x,y,\barz)\) is \(\exists^\infty x\exists^\infty y\varphi(x,y,\barz)\)
    #+END_examplle

    Two definable types \(p,q\) commute
    iff \((d_p\barx)(d_q\bary)\varphi(\barx,\bary,\barz)\equiv(d_q\bary)(d_p\barx)\varphi(\barx,\bary,\barz)\)

    Let \(A\)-invariant \(p\in S_n(\M)\)
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *Morley sequence* of \(p\) over \(A\) is a sequence \(\barb_1,\barb_2,\barb_3,\dots\in\M^n\) s.t.
    \begin{equation*}
    \barb_1\vDash p\uhr A,\barb_2\vDash p\uhr A\barb_1,\dots,\barb_i\vDash p\uhr A\barb_1\dots\barb_{i-1}\dots
    \end{equation*}
    #+END_definition

    So \((\barb_1,\dots,\barb_n)\vDash \underbrace{p\otimes\dots\otimes p}_{n\text{ times}}\)

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    If \(T\) is strongly minimal, \(p\) is transcendental 1-type, a Morley sequence over \(A\)
    is \(b_1,b_2,\dots\) s.t. \(b_1\notin\acl(A)\), \(b_2\notin\acl(Ab_1)\),\(\dots\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In \(\DLO\), in \((\R,\le)\), \(1,2,3,4,\dots\) is indiscernible

    An increasing sequence is indiscernible in \(\DLO\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(p\in S_n(\M)\) \(A\)-invariant and \((\barb_i:i<\omega)\) is a Morley sequence of \(p\) over \(A\),
    then it is \(A\)-indiscernible
    #+END_theorem
** Order Property
    #+BEGIN_remark
    If \varphi has O.P., then \(\neg\varphi\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    For any infinite \(\lambda\ge\aleph_0\) there is a linear order \((I,\le)\) and \(S\subseteq I\)
    s.t. \(\abs{I}>\lambda\), \(\abs{S}\le\lambda\), \(S\) is dense in \(I\)
    #+END_lemma

    #+BEGIN_proof
    there is \mu s.t. \(\abs{2^\mu}>\lambda\) and \(\abs{2^{<\mu}}\le\lambda\).

    Let \(I=2^\mu\cup 2^{<\mu}\) and \(S=2^{<\mu}\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(\varphi(\barx,\bary)\) has O.P., then \(T\) is not \lambda-stable for any \lambda
    #+END_theorem

    #+BEGIN_proof
    Take \(I\supseteq S\) s.t. \(S\) dense in \(I\), \(\abs{S}\le\lambda\), \(\abs{I}>\lambda\)

    \(\bara_i,\barb_j\), \(i,j\in\Z\), \(\varphi(\bara_i,\barb_j)\Leftrightarrow i<j\). By compactness, we can take any
    linear order. There is \(\bara_i,\barb_j\) for \(i,j\in I\)
    s.t. \(\M\vDash\varphi(\bara_i,\barb_j)\Leftrightarrow i<j\)

    Let \(C=\{\barb_j:j\in S\}\), \(\abs{C}\le\lambda\).

    *Claim* \(I\setminus S\to S_n(C)\) , \(i\mapsto\tp(\bara_i/C)\) is an injection

    If \(i_1<i_2\), then there is \(j\in S\), \(i_1<j<i_2\)
    then \(\varphi(\bara_i,\barb_j)\wedge\neg\varphi(\bara_{i_2},\barb_j)\), \(\barb_j\in C\),
    so \(\bara_{i_1}\not\equiv_C\bara_{i_2}\)

    \(\abs{S_n(C)}\ge\abs{I\setminus S}>\lambda\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Suppose \(\varphi(\barx,\bary)\) doesn't have O.P. Let \(n_\varphi\) be from Lemma 9.
    Let \(\barb_1,\barb_2,\dots\) be indiscernible (over \(\emptyset\)). Then there is no \(\bara\)
    s.t. \(\M\vDash\varphi(\bara,\barb_i)\) for \(0\le i<n_\varphi\) s.t.
    #+END_lemma

    #+BEGIN_proof
    \(n=n_\varphi\). Suppose \(\bara\) exists, for \(0\le \)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Suppose \(\varphi(x_1,\dots,x_n;\bary)\) doesn't have O.P.. Take \(N>\max(n_\varphi,n_{\neg\varphi})\). let \(p\) be
    an \(A\)-invariant type over \(\M\). Let \(a_1,a_2,\dots\) be a Morley sequence of \(p\) over \(A\)
    1. If \(\varphi(\barx,\barb)\in p(\barx)\), then \(\M\vDash\varphi(\bara_i,\barb)\) for most of \(i<2N\)
    2. If \(\varphi(\barx,\barb)\notin p(\barx)\), then \(\M\vDash\neg\varphi(\bara_i,\barb)\) for most of \(i<2N\)
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    If \(T\) is strongly minimal then \(T\) is stable if \(\varphi(x,\bary)\) has the O.P., then there
    is \(a_i,\barb_i\in\M\) \(\M\vDash\varphi(a_i,\barb_j)\Leftrightarrow i<j\) for \(i,j\in\Z\)

    So \(\varphi(\M,\barb_0)\) is neither finite or cofinite
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(T\) is stable and \(p\) and \(q\) are global types (all types are definable and hence
    invariant for some \(A\)), then \((p\otimes q)(\barx,\bary)=(q\otimes p)(\bary,\barx)\)
    #+END_theorem

    #+BEGIN_proof
    Suppose not.
    Take
    \(\varphi(\barx,\bary)\in L(\M)\).
    \(\varphi(\barx,\bary)\in(p\otimes q)(\barx,\bary)\), \(\varphi(\barx,\bary)\notin(q\otimes p)(\bary,\barx)\) .

    Take \(A\) s.t. \(p,q\) are \(A\)-definable and \(\varphi(\barx,\bary)\in L(A)\)

    Take \(p\otimes q\otimes p\otimes q\otimes\cdots\)

    \(((b_i,c_i):i\in\omega)\) a Morley sequence of \(p\otimes q\) over \(A\)

    If \(i\le j\), \((b_i,c_j)\vDash p\otimes q\uhr A\), \(\M\vDash\varphi(b_i,c_j)\)

    If \(i>j\), \((c_j,b_i)\vDash q\otimes p\uhr A\) \(\M\vDash\neg\varphi(b_i,c_j)\)
    #+END_proof
** Ramsey's theorem and indiscernible sequences
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(X\) set, \(C\) a set of "colors", then \(f:[X]^\kappa\to C\) is a coloring of \kappa-elements subsets of \(X\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(Y\subseteq X\) is *homogeneous* if \(f\uhr[Y]^\kappa\) is constant
    #+END_definition


    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(N\), \(m\), \(n\), \(k\) are cardinals, \(N\to(m)^n_k\) means that
    if \(\abs{X}=N\), \(\abs{C}=k\), \(f:[X]^n\to C\), then there is \(Y\subseteq X\), \(Y\) is homogeneous and
    has size \(m\)
    #+END_definition

    #+ATTR_LATEX: :options [Friends and strangers theorem]
    #+BEGIN_fact
    \(\abs{X}=6\), \(\abs{C}=2\) and \(f:[X]^2\to C\), then there is \(Y\subseteq X\) homogeneous and size 3
    #+END_fact

    #+ATTR_LATEX: :options [Finite Ramsey's theorem]
    #+BEGIN_theorem
    If \(n,m,k\in\omega\) then there is \(N<\omega\) s.t. \(N\to(m)^n_k\)
    #+END_theorem

    #+BEGIN_proof
    Let \(L=\{R_1,\dots,R_k\}\), \(R_i\) is an \(n\)-ary predicate (relation) symbol. \(T\) is
    the \(L\)-theory that says:
    - If \(R_i(\barx)\) then \(\barx\) is distinct
    - If \(\barx\) is distinct then \(R_i(\barx)\) holds for exactly one \(i\)
    - If \(\bary\) is a permutation of \(\barx\), \(R_i(\barx)\leftrightarrow R_i(\bary)\)


    A model of \(T\) is a set \(M\) and a coloring of \([M]^n\)

    Let \varphi be the formula s.t. \(M\vDash\varphi\) \(\Leftrightarrow\) there is a homogeneous \(Y\subseteq M\), \(\abs{Y}=m\)
    \begin{equation*}
    \exists y_1,\dots,y_m\bigwedge_{1\le i_1<\dots<i_n\le m}\bigwedge_{1\le j_1<\dots<j_n\le m}\text{same color}
    \end{equation*}
    Suppose \(N\slashed{\to}(m)^n_k\), then \(\exists M\vDash T\) \(\abs{M}=N\) and \(M\not\vDash\varphi\).
    Suppose \(N\slashed{\to}(m)^n_k\) for any \(N<\omega\), then by compactness, \(T\cup\{\neg\varphi\}\) has infinite
    models. By theorem 17 last week, there is \(M\vDash T\cup\{\neg\varphi\}\), indiscernible sequence  \(a_1,a_2,\dots\in M\)
    not constant, but indiscernibility \(\Rightarrow\) \(\{a_1,a_2,\dots\}\) is homogeneous, \(\{a_1,\dots,a_m\}\) is homogeneous
    #+END_proof

    #+ATTR_LATEX: :options [Infinite Ramsey's theorem]
    #+BEGIN_fact
    \(\aleph_0\to(\aleph_0)^n_k\) for \(n,k\in\omega\)
    #+END_fact

    extracting indiscernibles

    Working \(\M\vDash T\). If \((I,\le)\) is a linear order and \((\bara_i:i\in I)\) is a sequence in \(\M\)
    and if \(B\subseteq\M\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\tp^{\EM}(\bara/B)=\{\varphi(\barx_1,\dots,\barx_n)\in L(B):\forall i_1<\dots<i_n\in I, \M\vDash\varphi(\bara_{i_1},\dots,\bara_{i_n})\}\),
    the *Ehrenfeucht-Mostowski type* over \(B\)
    #+END_definition

    #+BEGIN_remark
    \(\tp^{\EM}\) is really a sequence of partial types over \(B\), \(\Sigma_1,\Sigma_2,\dots\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In \((\R,\le)\), 1,1,2,2,3,3,4,4,\(\dots\)

    \((x_1\le x_2)\in\tp^{\EM}(\dots)\)

    \(x_1<x_2\notin\tp^{\EM}\)
    #+END_examplle

    #+BEGIN_remark
    If \((\bara_i:i\in I)\) is a sequence, \(I_0\subseteq I\),
    then \(\tp^{\EM}((\bara_i:i\in I)/B)\subseteq\tp^{\EM}((\bara_i:i\in I_0)/B)\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(\varphi(\barx_1,\dots,\barx_n)\in L(B)\), \((\bara_i:i\in I)\) is "\varphi-indiscernible"
    if \(\forall i_1<\dots<i_n\), \(\forall j_1<\dots<j_n\),
    \begin{equation*}
    \M\vDash\varphi(\bara_{i_1},\dots,\bara_{i_n})\leftrightarrow\varphi(\bara_{j_1},\dots,\bara_{j_n})
    \end{equation*}
    #+END_definition

    #+BEGIN_remark
    \((\bara_i:i\in I)\) is \(B\)-indiscernible iff it is \varphi-indiscernible for all \(\varphi\in L(B)\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \Delta is a set of formulas, \(\bara\) is *\Delta-indiscernible* if it is \varphi-indiscernible for
    all \(\varphi\in\Delta\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:24-9
    Let \((\bara_i:i\in I)\) be infinite
    1. If \(m<\omega\), \Delta is a finite set of \(L\)-formulas, then there is \Delta-indiscernible subsequence of
       length \(m\)
    2. If \((J,\le)\) is a linear order, \Delta a set of formulas, then there is \((\barb_j:j\in J)\in\M\)
       s.t. \(\barb\) is \Delta-indiscernible and \(\tp^{\EM}(\barb)\supseteq\tp^{\EM}(\bara)\)
    #+END_lemma

    #+BEGIN_proof
    1. By induction on \(\abs{\Delta}\).

       \(\abs{\Delta}=0\), take any subsequence of length \(m\)

       \(\abs{\Delta}>0\), \(\Delta=\Delta_0\cup\{\varphi\}\), \(\varphi(x_1,\dots,x_n)\). Ramsey: there is \(N\to(m)^n_2\), by induction
       there is subsequence \((\barb_i:i<N)\) \(\Delta_0\)-indiscernible. Define \(f:[N]^n\to\{0,1\}\) by
       \begin{equation*}
       f(\{i_1,\dots,i_n\})=
       \begin{cases}
       1&\M\vDash\varphi(b_{i_1},\dots,b_{i_n})\\
       0&\text{otherwise}
       \end{cases}
       \end{equation*}
       there is subsequence \((\barc_i:i<m)\) that is homogeneous, \varphi-indiscernible

    2. By compactness, we may assume \(J\) is finite, \Delta is finite. By part 1
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \((\bara_i:i\in I)\) an infinite sequence, \(B\) is a set of parameters, \((J,\le)\) infinite
    linear order, then there is \(B\)-indiscernible sequence \((\barb_j:j\in J)\) with
    \(\tp^{\EM}(\barb/B)\supseteq\tp^{\EM}(\bara/B)\)
    #+END_theorem

    #+BEGIN_proof
    Apply Lemma ref:24-9 with \(\Delta=\{\text{all the }L(B)\text{-formulas}\}\)
    #+END_proof

    "Extracting indiscernible sequences"

    #+ATTR_LATEX: :options [=Theorem 17 last week]
    #+BEGIN_examplle
    If \(\abs{\M}=\infty\), take distinct \(a_0,a_1,a_2,\dots\in\M\), \(x_1\neq x_2\in\tp^{\EM}(\bara)\).
    Take \(b_0,b_1,\dots\) indiscernible, extracted from \(\bara\),
    then \((x_1\neq x_2)\in\tp^{\EM}(\bara)\subseteq\tp^{\EM}(\barb)\), so \(b_i\neq b_j\) for \(i<j\). So \(\barb\) is
    a non-constant indiscernible sequence
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(\M\succeq(\R,+,\cdot,\le,0,1,-)\). Suppose \(b_1,b_2,b_3,\dots\) is indiscernible, extracted
    from \(1,2,3,\dots\)

    \(x_1>0\in\tp^{\EM}(\bara)\subseteq\tp^{\EM}(\barb)\)

    \(x_2-x_1\ge 1\in\tp^{\EM}(\barb)\)
    #+END_examplle

    #+BEGIN_remark
    \((\bara_i:i\in I)\) is \(B\)-indiscernible iff \(\tp^{\EM}(\bara/B)\) is "complete",
    i.e., \(\forall\varphi(x_1,\dots,x_n)\in L(B)\), \(\varphi\in\tp^{\EM}\) or \(\neg\varphi\in\tp^{\EM}\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \((\bara_i:i\in I)\) is \(B\)-indiscernible, if \((J,\le)\) is a linear order, then there
    is \(B\)-indiscernible \((\barb_j:j\in J)\) with \(\tp^{\EM}(\barb/B)=\tp^{\EM}(\bara/B)\)
    #+END_theorem

    #+BEGIN_remark
    If \((\bara_i:i\in I)\) is \(B\)-indiscernible, then \(\tp(\bara/B)\) is determined
    by \(\tp^{\EM}(\bara/B)\) and \((I,\le)\)

    \(\M\vDash\varphi(a_{i_1},\dots,a_{i_n})\Leftrightarrow\varphi\in\tp^{\EM}(\bara/B)\)

    So if \((\bara_i:i\in I)\), \(\barb_i:i\in I\) both \(B\)-indiscernible
    and \(\tp^{\EM}(\bara/B)=\tp^{\EM}(\barb/B)\), then \(\tp(\bara/B)=\tp(\barb/B)\)
    #+END_remark

    #+ATTR_LATEX: :options [extending indiscernibles]
    #+BEGIN_theorem
    If \((\bara_i:i\in I)\) is \(B\)-indiscernible, if \((J,\le)\) extends \((I,\le)\), then \(\exists\bara_j\)
    for \(j\in J\setminus I\) s.t. \((\bara_j:j\in J)\) is \(B\)-indiscernible
    #+END_theorem

    #+BEGIN_proof
    extract \(B\)-indiscernible \((\barc_j:j\in J)\)
    from \((\bara_i:i\in I)\), \(\tp^{\EM}(\barc/B)=\tp^{\EM}(\bara/B)\)

    the subsequence \((\barc_i:i\in I)\) has same EM-type as

    there is \(\sigma\in\Aut(\M/B)\) s.t. \(\sigma(\barc_i)=\bara_i\) for \(i\in I\). Define \(\bara_j:=\sigma(\barc_j)\)
    for \(j\in J\setminus I\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    label:24-15
    If \(\varphi(\barx,\bary)\in L\), TFAE
    1. \varphi has O.P., \(\bara_i,\barb_i\), \(i\in\Z\), \(\M\vDash\varphi(\bara_i,\barb_j)\Leftrightarrow i<j\)
    2. same as (1) but \((\bara_i\barb_i:i\in\Z)\) is indiscernible
    3. There is an indiscernible \((\bara_i:i\in\Z)\) some \(\barb\)
       s.t. \(\M\vDash\varphi(\bara_i,\barb)\Leftrightarrow i<0\)
    #+END_theorem

    #+BEGIN_proof
    \(1\to 2\): extract an indiscernible sequence from

    \(2\to 3\): take \(\barb=\barb_0\)

    \(3\to 1\): For any \(j\in\Z\), \((\bara_i:i\in\Z)\equiv_B(\bara_{i+j}:i\in\Z)\), there
    is \(\sigma_j\in\Aut(\M)\), \(\sigma_j(\bara_i)=\bara_{i+j}\). Let \(\barb_j=\sigma_j(\barb)\).
    Then \(\bara_i\barb_j=\sigma(\bara_{i-j}\barb)\)

    \(\M\vDash\varphi(\bara_i,\barb_j)\Leftrightarrow\M\vDash\varphi(\bara_{i-j},\barb)\Leftrightarrow i-j<0\Leftrightarrow i<j\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    \(T\) is unstable \(\Leftrightarrow\) there is \(\varphi(\barx,\bary)\) with
    O.P. \(\Leftrightarrow\) \((\bara_i:i\in\Z)\), \(\varphi(\barx,\bary)\), \(\barb\)
    s.t. \(\varphi(\bara_i,\barb)\Leftrightarrow i<0\)
    #+END_corollary

    Total indiscernibility

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In \(\DLO\), 1,2,3,4,\(\dots\) is indiscernible but not totally indiscernible
    #+END_examplle

    In a totally

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(T\) is unstable, then \(\exists\) indiscernible sequence that isn't totally indiscernible
    #+END_proposition

    #+BEGIN_proof
    Take \varphi with O.P., take \((\bara_i\barb_i:i\in\Z)\) witnessing O.P., then \(\varphi(a_1,b_2)\wedge\neg\varphi(a_2,b_1)\),
    so \((\bara_i\barb_i:i\in\Z)\) isn't totally indiscernible
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\tp(a_1,\dots,a_n/B)\) is *symmetric* if \(\forall\) permutation \(\sigma\in S(n)\)
    \(\bara_1,\dots,\bara_n\equiv_B\bara_{\sigma(1)},\dots,\bara_{\sigma(n)}\)
    #+END_definition

    #+BEGIN_remark
    Let \(\sigma_i\) be the permutation swapping \(i\) and \(i+1\) and fixing everything else.

    \(\tp(\bara_1,\dots,\barb_n/B)\) is symmetric iff it holds for each \(\sigma_i\)
    #+END_remark

    #+BEGIN_remark
    Let \((\bara_i:i\in I)\) be \(B\)-indiscernible. Let \(p_n=\tp(\bara_{i_1},\dots,\bara_{i_n}/B)\) for
    any \(i_1<\dots<i_n\). Then \((\bara_i:i\in I)\) is totally \(B\)-indiscernible iff each \(p_n\) is symmetric
    #+END_remark

    #+BEGIN_remark
    If \((\bara_i:i\in I)\) is \(B\)-indiscernible, then \(\tp^{\EM}(\bara/B)\) determines
    whether \(\bara\) is totally \(B\)-indiscernible

    \(\tp^{\EM}\) is \(p_1,p_2,\dots\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \((\bara_i:i\in\Z)\) be \(B\)-indiscernible. Let \(C=\{\bara_i:i\notin\{0,1\}\}\).
    If \(\bara_0\bara_1\equiv_{BC}\bara_1\bara_0\). Then \((\bara_i:i\in\Z)\) is totally \(B\)-indiscernible
    #+END_lemma

    #+BEGIN_proof
    there is \(\sigma_0\in\Aut(\M/BC)\), \(\sigma_0(\bara_0)=\bara_1\), \(\sigma(\bara_1)=\barb_0\)

    By indiscernibility, there is \(\alpha_i\in\Aut(\M/B)\) s.t. \(\alpha_i\) swaps \(\bara_i\), \(\bara_{i+1}\)
    fixes \(\bara_j\) for \(j\notin\{i,i+1\}\). This means \(\bara_1\dots\bara_n\equiv_B\bara_{\sigma_i(1)}\dots\bara_{\sigma_i(n)}\)
    so \(\tp(\bara_1,\dots,\bara_n/B)\) is symmetric
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(\M\) is stable and \(A\subseteq\M\) small, then \(\M\) is stable as an \(L(A)\)-structure
    #+END_proposition

    #+BEGIN_proof
    Otherwise, there is \(L(A)\)-formula \(\varphi(\barx,\bary)\) with the O.P.
    \(\varphi(\barx,\bary,\barc)\) for some \(\barc\in A\), \(\barb_i\barc\) is the new \(\barb\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    TFAE
    1. \(T\) is stable
    2. every indiscernible sequence is totally indiscernible
    3. \(B\)-indiscernible \(\Rightarrow\) totally \(B\)-indiscernible
    #+END_theorem

    #+BEGIN_proof
    \(3\to 2\): trivial

    \(1\to 3\): Suppose \(T\) stable but \((\bara_i:i\in I)\) \(B\)-indiscernible not
    totally \(B\)-indiscernible

    Extract \((\bara_i':i\in I)\) from \((\bara_i:i\in I)\) some
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(T\) is stable, if \((\bara_i:i\in I)\) is indiscernible, if \(D\) is
    definable, \(\{i\in I:\bara_i\in D\}\) is finite or cofinite in \(I\)
    #+END_corollary

    #+BEGIN_proof
    Suppose not. Take \(i_1,i_2,\dots\in I\) s.t. \(a_{i_1},a_{i_2},\dots\notin D\) , \(\)
    #+END_proof


* Fundamental Order and Forking
** The fundamental order
    Fix \(n<\omega\)
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(M\preceq\M\), \(p\in S_n(M)\), \(\varphi(x_1,\dots,x_n;\bary)\). \(p\) *represents* \varphi
    if \(\exists\barb\in M\) \(\varphi(\barx,\barb)\in p(\barx)\). \(p\) *omits* \varphi otherwise

    The *class* of \(p\) is \([p]=\{\varphi:p\text{ represents }\varphi\}\)

    \([p]\le[q]\) if \([p]\supseteq[q]\)

    The *fundamental order* is \(\{[p]:M\preceq\M,p\in S_n(M)\}\), with \(\le\) (depends on \(n\)). \(p\le q\) means \([p]\le[q]\)
    #+END_definition

    #+BEGIN_remark
    \(\le\) is a partial order on the fundamental order but a preorder on the class \(\{p:M\vDash T,p\in S_n(M)\}\)
    #+END_remark

    \([p]\) is not a standard notation

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(n=1\), \(\varphi(x,y):=x=y\). \(p\in S_1(M)\) represents \(p\) iff \(\exists b\in M\), \(x=b\in p(x)\) iff \(p\)
    is a constant type
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(n=1\), \(T=\DLO\), there are four classes:
    1. constant types
    2. types at \(+\infty\)
    3. types at \(-\infty\)
    4. others


    \begin{center}\begin{tikzcd}
    2\ar[rd]&&3\ar[ld]\\
    &4\ar[d]\\
    &1
    \end{tikzcd}\end{center}

    \(x=y\) is represented in 1

    \(x<y\) is represented in 1,3,4 \(\tp(2/\R)\) has \(x<3\), \(\tp(-\infty/\R)\)
    has \(x<0\), \(\tp(\sqrt{2}/\Q)\) has \(x<2\), \(\tp(+\infty/R)\) doesn't have \(x<b\)

    \(x>y\) is represented in 1,2,4

    \(\tp(\sqrt{2}/\Q)\) and \(\tp(0^+/\R)\) have the same class
    #+END_examplle

    Goal: in a stable theory: if \(q\) is an extension of \(p\), then if \(q\sqsupseteq p\), then \([q]=[p]\),
    if \(q\sqsupseteq p\), then \([q]<[p]\)

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:3.31.5
    Suppose \(M\preceq N\), \(p\in S_n(M)\), \(q\in S_n(N)\), \(p\subseteq q\)
    1. \([q]\le[p]\)
    2. \([q]=[p]\) iff for any \(L\)-formula \(\varphi(\barx,\bary)\), if \(\barb\in N\)
       and \(\varphi(\barx,\barb)\in q(\barx)\), then \(\exists\barb'\in M\) \(\varphi(\barx,\barb')\in p\)
    3. if \(q\sqsupseteq p\), then \([q]=[p]\)
    #+END_proposition

    #+BEGIN_proof
    1. every formula \varphi represented by \(p\) is represented by \(q\)
    2. \([q]=[p]\Leftrightarrow[q]\ge[p]\Leftrightarrow[q]\subseteq[p]\Leftrightarrow\) this condition
    3.
    #+END_proof

    #+BEGIN_remark
    Suppose \(M\preceq N\), \(p\in S_n(M)\), \(q\in S_n(N)\), \(p\subseteq q\)
    1. \([q]=[p]\)  means
       that
       \(\forall\varphi(\barx,\bary)\in L\),
       \(\exists\barb\in N\), \(\varphi(\barx,\barb)\in q(\barx)\Rightarrow \exists\barb\in M\varphi(\barx,\barb)\in p(\barx)\)
    2. but \(q\sqsupseteq p\) considers \(L(M)\)-formulas


    \(q\sqsupseteq p\) iff \([q]=[p]\) in \(L(M)\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    \(M,N\preceq\M\), \(p\in S_n(M)\), \(q\in S_n(N)\), then \([p]\ge[q]\) iff \(\exists\) ultrafilter \(\calu\) and
    elementary embedding \(M\to N^{\calu}\) making \(q^{\calu}\supseteq p\)
    #+END_proposition

    #+BEGIN_proof
    \(\Rightarrow\) similar to ref:3.3.2

    \(\Leftarrow\): \([q^{\calu}]=[q]\) because \(q^{\calu}\sqsupseteq q\), \([q^{\calu}]\le[p]\) because \(q^{\calu}\supseteq p\)
    #+END_proof
** The fundamental order in stable theory
    Assume \(T\) is stable
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:3.31.8
    Suppose \(M\preceq N\preceq\M\), \(p\in S_n(M)\), \(q_1,q_2\in S_n(N)\), \(q_1,q_2\supseteq p\) and \([q_1]=[p]=[q_2]\).
    Then \(q_1=q_2\).

    In other words, there is at most one extension of \(p\) to \(N\) with the same class as \(p\)
    #+END_lemma

    #+BEGIN_proof
    similar to ref:3.3.8

    Suppose \(q_1\neq q_2\), \(\exists\varphi(\barx,\barb)\) s.t. \(\varphi\in q_1, \neg\varphi\in q_2\)

    Let \(\beta=[p]\)

    *Claim*: If \(M'\preceq\M\), \(p'\in S_n(M')\), \([p']=\beta\),
     then \(\exists N'\succeq M'\), \(\exists q_1',q_2'\in S_n(N')\), \(q_1',q_2'\supseteq p'\), \([q_1']=[q_2']=\beta\)
     and \(\exists\barb'\in N'\), \(\varphi(\barx,\barb')\in q_1'\) and \(\neg\varphi\in q_2'\)

     \([p']\ge[p]\), so there \(\calu\), elementary embedding \(M'\to M^{\calu}\) s.t. \(p^{\calu}\supseteq p'\).
     Then we have \(M'\to M^{\calu}\to N^{\calu}\)

     \([q_1^{\calu}]=[q_1]=\beta=[q_2]=[q_2^{\calu}]\). Let \(q_i'=q_i^{\calu}\), \(N'=N^{\calu}\)

     Using the claim, we can build a tree of types
     \begin{center}\begin{tikzpicture}
     \Tree [.\(p\) [.\(p_0\) \(p_{00}\), \(p_{01}\) ]
                          [.\(p_1\) \(p_{10}\), \(p_{11}\) ] ]
     \end{tikzpicture}\end{center}
     where \(p_{\sigma 0}\) and \(p_{\sigma 1}\) are extensions of \(p_\sigma\) differing by a
     formula \(\varphi(\barx,\barb_\sigma)\). Then \varphi has the dichotomy property
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:3.31.9
    If \(M\preceq N\), \(p\in S_n(M)\), \(q\in S_n(N)\), \(q\supseteq p\)
    1. \(q\sqsupseteq p\Leftrightarrow[q]=[p]\)
    2. \(q\not\sqsupseteq p\Leftrightarrow[q]<[p]\)
    #+END_proposition

    #+BEGIN_proof
    Let \(q'\) be the heir of \(p\), \(q'\in S_n(N)\)

    If \(q\sqsupseteq p\), then \(q=q'\)

    If \([q]=[p]\), then \([q]=[q']=[p]\) so Lemma ref:3.31.8 shows \(q=q'\)
    #+END_proof
** bounds
    \(T\) is stable

    Fix \(A\subseteq\M\), \(p\in S_n(A)\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(M\preceq\M\), \(M\supseteq A\), then \(\Ex_M(p)=\{[q]:q\in S_n(M), q\supseteq p\}\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Every chain in \(\Ex_M(p)\) has an upper bound
    #+END_lemma

    #+BEGIN_proof
    Let \(F=\{q\in S_n(M):q\supseteq p\}\). Suppose \(\{[q_i]:i\in I\}\) is a chain, \(q_i\in F\), \((I,\le)\) a linear
    order, \([q_i]\le[q_j]\) for \(i\le j\)

    If \(i\le j\), \(q_i\) omits \varphi, then \(q_j\) omits \varphi

    Let \(\Sigma(\barx)=\{\neg\varphi(\barx,\barb):\varphi(\barx,\bary)\text{ omitted by some }q, \barb\in M\}\)

    *Claim*: \(p(\barx)\cup\Sigma(\barx)\) is consistent

    suppose \(\varphi_1,\dots,\varphi_m\), \(\varphi_j\) is omitted by \(q_{i_j}\), \(i_j\in I\), \(\barb_1,\dots,\barb_m\in M\).
    Want \(p\cup\{\neg\varphi_j(\barx,\barb_j):1\le j\le m\}\) consistent

    Take \(q(\barx)\in S_n(M)\) a completion of \(p(\barx)\cup\Sigma(\barx)\). Then \(q\in F\),
    so \([q]\in\Ex_M(p)\).
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\Bd_M(p)=\{\text{maximal }\beta\in\Ex_M(p)\}\)

    Elements of \(\Bd_M(p)\) are called *bounds* of \(p\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    label:3.31.13
    \(\forall\beta\in\Ex_M(p)\), \(\exists\beta'\in\Bd_M(p)\), \(\beta'\ge\beta\), and \(\Bd_M(p)\) is not empty
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(A\preceq\M\), \(p\in S_n(A)\), \(A\) is a model

    *Claim*: \([p]=\max\Ex_M(p)\), so \(\Bd_M(p)=\{[p]\}\)

    Take \(q\in S_n(M)\), \(q\sqsupseteq p\), then \([q]=[p]\), \([q]\in\Ex_M(p)\).
    If \(r\in S_n(M)\), \(r\supseteq p\), then \([r]\le[p]\), so if \(p\in\Ex_M(p)\) then \(\beta\le[p]\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Suppose \(M,N\preceq\M\), \(M,N\supseteq A\), \(p\in S_n(A)\)
    1. \(\forall\beta\in Ex_M(p)\), \(\exists\beta'\in\Ex_N(p)\), \(\beta'\ge\beta\)
    2. \(\Bd_M(p)=\Bd_N(p)\)
    #+END_lemma

    #+BEGIN_proof
    1. Take \(M'\preceq\M\), \(M'\supseteq M\cup N\), \(\beta\in\Ex_M(p)\) means \(\exists q\in S_n(M)\), \(q\supseteq p\), \([q]=\beta\)

       Let \(q'\in S_n(M')\) be \(q'\sqsupseteq q\)

       Let \(r=q'\uhr N\). Then \(r\supseteq p\), so \([r]\in\Ex_N(p)\). \([r]\ge[q']=[q]=\beta\)
    2. suppose \(\beta\in\Bd_M(p)\)
       * by 1, there is \(\beta'\in\Ex_N(p)\) with \(\beta\le\beta'\)
       * by Corollary ref:3.31.13, there is \(\beta''\in\Bd_N(p)\) with \(\beta'\le\beta''\)
       * By 1, there is \(\beta'''\in\Ex_M(p)\) with \(\beta''\le\beta'''\)
       Then \(\beta\le\beta'\le\beta''\le\beta'''\in\Ex_M(p)\). Therefore
       \begin{equation*}
       \beta=\beta'=\beta''=\beta'''
       \end{equation*}
       This shows \(\Bd_M(p)\subseteq\Bd_N(p)\)
    #+END_proof

    Since \(\Bd_M(p)\) doesn't depend on \(M\), we write it as \(\Bd(p)\)
** Theorem of the bound
    \(T\) is stable
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(p\in S_n(\M)\) is *Lascar \(A\)-invariant* if \(p\) is \(M\)-invariant for every \(A\subseteq M\preceq\M\)
    #+END_definition

    weaker than being \(A\)-invariant in stable theory

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:3.31.17
    If \(A\subseteq M\preceq\M\), \(p\in S_n(A)\), \(q\in S_n(M)\), \(q\supseteq p\), \([q]\in\Bd(p)\). Let \(q^{\M}\) be the
    global heir of \(q\). Then \(q^{\M}\) is Lascar \(A\)-invariant
    #+END_lemma

    #+BEGIN_proof
    By ref:3.31.5, \([q^{\M}]=[q]\in\Bd(p)\). If \(q^{\M}\) isn't Lascar \(A\)-invariant, there is
    small \(N\supseteq A\) \(q^{\M}\) isn't \(N\)-invariant, not \(N\)-definable.
    Then \(q^{\M}\not\sqsupseteq q^{\M}\uhr N\) (or else \(q^{\M}\) would be \(N\)-definable ref:3.10.15). By Proposition ref:3.31.9, \([q^{\M}\uhr N]>[q^{\M}]=[q]\)

    Let \(r=q^{\M}\uhr N\), \(r\supseteq p\), so \([r]\in\Ex_N(p)\), \([q]\in\Bd(p)=\Bd_N(p)\) is maximal
    in \(\Ex_N(p)\), but \([r]>[q]\), \([r]\in\Ex_N(p)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:3.31.18
    Fix \(\barb\) and \(A\), then \(\exists M\supseteq A\), \(M\preceq\M\), the global heir of \(\tp(\barb/M)\) is
    Lascar \(A\)-invariant. Also given \(\beta\in\Bd(\tp(\barb/A))\), can make \(\tp(\barb/M)\) and it's
    heir have class \beta
    #+END_lemma

    #+BEGIN_proof
    Take \(\beta\in\Bd(p)\), \(p=\tp(\barb/A)\). Take \(M\supseteq A\) \(M\preceq\M\). Take \(q\in S_n(M)\), \([q]=\beta\).
    Take \(\barb_0\vDash q\), \(\tp(\barb_0/A)=\tp(\barb/A)\). There
    is \(\sigma\in\Aut(\M/A)\), \(\sigma(\barb_0)=\barb\).

    Move \(M,q,b_0\) by \sigma, We may assume \(\barb_0=\barb\), so \(\tp(\barb/M)=q\), \([q]=\beta\).

    By ref:3.31.17, \(q^{\M}\) is Lascar \(A\)-invariant
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:3.31.19
    Fix \(\barb,A\). Suppose \(M_1,M_2\preceq\M\), \(M_1,M_2\supseteq A\). Let \(p_i\in S_n(\M)\) be the heir
    of \(\tp(\barb/M_i)\). Suppose \(p_1,p_2\) are Lascar \(A\)-invariant, then \(p_1=p_2\)
    #+END_lemma

    #+BEGIN_proof
    Suppose \(p_1\neq p_2\). Take \(\varphi(\barx,\barc)\in p_1(\barx)\), \(\neg\varphi(\barx,\barc)\in p_2\).

    Lemma ref:3.31.18 shows there is \(M_3\preceq\M\), \(M_3\supseteq A\) s.t. \(\tp(\barc/M_3)\sqsubseteq r\in S_n(\M)\) and \(r\)
    is Lascar \(A\)-invariant.

    Take \(\bare\vDash r\uhr M_1M_2M_3\barb\). Note \(\barb\vDash p_1\uhr M_1\) and \(\bare\vDash r\uhr M_1\barb\). Then
    \((\barb,\bare)\vDash(p_1\otimes r)\uhr M_1\) since \(p_1,r\) are \(M_1\)-invariant. In stable theory, product
    commutes. Therefore \((\bare,\barb)\vDash(r\otimes p_1)\uhr M_1\). Then \(\barb\vDash p_1\uhr M_1e\).

    \(\bare\vDash r\uhr M_3=\tp(\barc/M_3)\), \(\bare\equiv_{M_3}\barc\), \(p_1\) is \(M_3\)-invariant.
    Hence \(\varphi(\barx,\bare)\in p_1\). So \(\M\vDash\varphi(\barc,\bare)\)

    Same argument with \(p_2\), get \(\M\vDash\neg\varphi(\barc,\bare)\), a contradiction
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    If \(p\in S_n(A)\), \(\abs{\Bd(p)}=1\)
    #+END_theorem

    #+BEGIN_proof
    Take \(\barb\vDash p\), \(\beta_1,\beta_2\in\Bd(p)\). Lemma ref:3.31.18, there is \(A\subseteq M_1,M_2\preceq\M\)
    s.t. \([\tp(\barb/M_i)]=\beta\) if \(p_i=\tp(\barb/M_i)\), \(p_i^{\M}\) is Lascar \(A\)-invariant.

    Lemma ref:3.31.19 \(p_1^{\M}=p_2^{\M}\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\tbd(p)=\)the bound of \(p\)
    #+END_definition

    example
** Non-forking extensions
    Assume stability
    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(A\subseteq B\), \(p\in S_n(A)\), \(q\in S_n(B)\), \(p\subseteq q\), then \(\tbd(q)\le\tbd(p)\)
    #+END_proposition

    #+BEGIN_proof
    Take \(M\supseteq B\), \(M\preceq\M\), \(r\in S_n(M)\) extending \(q\) with \([r]=\tbd(q)\). Then \(r\)
    extends \(p\), so \([r]\in\Ex_M(p)\). As \(\tbd(p)\) is the maximum of \(\Ex_M(p)\) we must have \([r]\le\tbd(p)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(A\subseteq B\), \(p\in S_n(A)\), \(q\in S_n(B)\), \(q\supseteq p\), \(q\) is a *nonforking extension* of \(p\)
    iff \(\tbd(q)=\tbd(p)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:3.31.23
    If \(M\preceq N\) and \(q\in S_n(N)\) extends \(p\in S_n(M)\), then \(q\) is a non-forking extension
    of \(p\) iff \(q\) is an heir of \(p\)
    #+END_proposition

    Proposition ref:3.31.23 ensures the notation \(q\sqsupseteq p\) is unambiguous

    #+BEGIN_proof
    \(\tbd(p)=[p]\) and \(\tbd(q)=[q]\)
    #+END_proof

    #+ATTR_LATEX: :options [Full transitivity]
    #+BEGIN_proposition
    Suppose \(A_1\subseteq A_2\subseteq A_3\) and \(p_i\in S_n(A_i)\) for \(i=1,2,3\) with \(p_1\subseteq p_2\subseteq p_3\).
    Then \(p_1\sqsubseteq p_3\) iff \(p_1\sqsubseteq p_2\) and \(p_2\sqsubseteq p_3\)
    #+END_proposition

    #+ATTR_LATEX: :options [Extension]
    #+BEGIN_proposition
    If \(p\in S_n(A)\) and \(B\supseteq A\), then there is at least one \(q\in S_n(B)\) with \(q\sqsupseteq p\)
    #+END_proposition

    #+BEGIN_proof
    Take a small model \(M\supseteq B\). Then \(\tbd(p)\in\Bd(p)\subseteq\Ex_M(p)\), so there is \(r\in S_n(M)\)
    extending \(p\) with \([r]=\tbd(p)\). Let \(q=r\uhr B\). Then \(\tbd(r)=\tbd(p)\),
    so \(r\sqsupseteq p\). By full transitivity, \(q\sqsupseteq p\)
    #+END_proof

** Forking formulas and Lascar invariance
    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:3.31.26
    If \(A\subseteq M\preceq\M\) and if the global heir of \(\tp(\barb/M)\) is Lascar \(A\)-invariant, then \(\tp(\barb/M)\sqsupseteq\tp(\barb/A)\)
    #+END_lemma

    #+BEGIN_proof
    Let \beta be the bound of \(\tp(\barb/A)\). By Lemma ref:3.31.18 there is a small
    model \(M'\supseteq A\) s.t. the global heir of \(\tp(\barb/M')\) is Lascar \(A\)-invariant and has
    class \beta. By Lemma ref:3.31.19 \(\tp(\barb/M')\) and \(\tp(\barb/M)\) have the same global heir.
    By Proposition ref:3.31.5 they have the same class. Then the class of \(\tp(\barb/M)\)
    is \(\beta=\tbd(\tp(\barb/A))\), implying \(\tp(\barb/M)\sqsupseteq\tp(\barb/A)\)
    #+END_proof

    #+ATTR_LATEX: :options [Forking and Lascar \(A\)-invariance]
    #+BEGIN_proposition
    If \(p\) is a global type and \(A\subseteq\M\), then \(p\sqsupseteq(p\uhr A)\) iff \(p\) is Lascar \(A\)-invariant
    #+END_proposition

    #+BEGIN_proof
    First suppose \(p\sqsupseteq(p\uhr A)\). For any small model \(M\supseteq A\), we have \(p\sqsupseteq(p\uhr M)\) by Full
    transitivity, which then means \(p\) is the heir of \(p\uhr M\) by Proposition ref:3.31.23.
    Then \(p\) is \(M\)-definable, so \(p\) is Lascar \(A\)-invariant

    Conversely, suppose \(p\) is Lascar \(A\)-invariant. Take a small model \(M\supseteq A\) and
    take \(\barb\vDash p\uhr M\). Then \(p\) is \(M\)-definable, so \(p\) is the global heir
    of \(p\uhr M=\tp(\barb/M)\). By Lemma ref:3.31.26, \(\tp(\barb/M)\sqsupseteq\tp(\barb/A)=p\uhr A\).
    But \(p\) is the heir of \(\tp(\barb/M)\), so \(p\sqsupseteq\tp(\barb/M)\sqsupseteq p\uhr A\). By transitivity we
    have \(p\sqsupseteq(p\uhr A)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    label:3.31.28
    If \(A\subseteq B\) and \(q\in S_n(B)\) extends \(p\in S_n(A)\), then \(q\sqsupseteq p\) iff some global extension
    of \(q\) is Lascar \(A\)-invariant
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    An \(L(\M)\)-formula \(\varphi(\barx)\) *forks over* \(A\) if every global type containing it fails to be
    Lascar \(A\)-invariant
    #+END_definition

    #+ATTR_LATEX: :options [Finite Character]
    #+BEGIN_proposition
    If \(A\subseteq B\) and \(q\in S_n(B)\) extends \(p\in S_n(A)\), then \(q\not\sqsupseteq p\) (\(q\) is a forking
    extension of \(p\)) iff some formula in \(q\)
    forks over \(A\)
    #+END_proposition

    #+BEGIN_proof
    For any model \(M\), let \(\Sigma_M(\barx)\) be the global partial type
    \begin{equation*}
    \{\varphi(\barx;\barb)\leftrightarrow\varphi(\barx;\barc):\varphi\in L,\barb\equiv_M\barc\}
    \end{equation*}
    A global type \(p\in S_n(\M)\) extends \(\Sigma_M\) iff it is \(M\)-invariant, iff it
    is \(M\)-definable. Define \(\Sigma_A(\barx)\) to be the union of \(\Sigma_M(\barx)\) for \(M\) ranging
    over small models containing \(A\). Then \(p\in S_n(\M)\) extends \(\Sigma_A(\barx)\) iff it is
    Lascar \(A\)-invariant. Therefore an \(L(\M)\)-formula \(\psi(\barx)\) forks over \(A\)
    iff \(\Sigma_A(\barx)\cup\{\psi(\barx)\}\) is inconsistent. By Corollary ref:3.31.28, \(q\not\sqsupseteq p\)
    iff \(\Sigma_A(\barx)\cup q(\barx)\) is inconsistent. Then the result follows by compactness
    #+END_proof




    *Intuition* if \varphi forks over \(A\), then \(\varphi(\M)\) is "small", and
    \(\{\varphi(\M):\varphi\text{ forks over }A\}\) is an ideal
** The dichotomy property and the fundamental order
    #+BEGIN_lemma
    Assume stability. Suppose \(M\preceq N\preceq\M\), \(p\in S_n(M)\), and \(q_1,q_2\in S_n(N)\) are exteqqeQ
    #+END_lemma
* Algebraic closure and imaginaries
** Many-sorted logic
*** First approximation: many-sorted structures
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *(single sorted) structure* consists of a set \(M\) and a collection of *functions*, *relations* and
    *constants*. Each function is a function \(f:M^{n_f}\to M\) for some number \(n_f\) called the *arity*
    of \(f\). Each relation is a relation \(R\subseteq M^{n_R}\) for some \(n_R\) called the *arity* of \(R\).
    Each constant is an element of \(M\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *many-sorted structure* consists of a collection of *sorts*, *functions*, *relations* and *constants*.
    Each sort is a set. Each function is a function \(f:X_1\times X_2\times\dots\times X_n\to Y\) where \(X_1,X_2,\dots,X_n,Y\)
    are sorts. Each relation is a relation \(R\subseteq X_1\times\dots\times X_n\) where \(X_1,\dots,X_n\) are sorts. Each
    constant is an element of a sort
    #+END_definition

    This approach works if we only need to consider definable sets and formulas within a fixed
    structure. If we want to talk about theories or elementary equivalence, we need to define
    many-sorted languages before we can properly define many-sorted structures.
*** Many-sorted languages
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *many-sorted language* consists of the following data:
    1. A set \(\cals\) of *sorts*
    2. A set \(\calf\) of *function symbols*: for each \(f\in\calf\), a finite non-empty list of
       sorts \((X_1,\dots,X_n,Y)\), called the *signature* of \(f\)
    3. A set \(\calr\) of *relation symbols*: for each \(R\in\calr\), a finite list of sorts \((X_1,\dots,X_n)\),
       called the *signature* of \(R\)
    4. A set \(\calc\) of *constant symbols*: for each \(c\in\calc\), a sort \(X\), called the *signature* of \(c\)
    #+END_definition

** Definable closure
    Work in a monster model \(\M\)

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    If \(\calf\) is a small family of definable \(D\subseteq\M^n\), suppose \(X\subseteq\M^n\) definable. Suppose \(X\) is
    "infinite boolean combination" of \(\calf\), i.e., if \(\bara,\bara\in\M^n\)
    and \(\forall D\in\calf\), \(\bara\in D\Leftrightarrow\barb\in D\), then \(\bara\in X\Leftrightarrow\barb\in X\). Then \(X\) is a (finite)
    boolean combination of sets in \(\calf\)
    #+END_fact

    #+BEGIN_proof
    WLOG, \(\calf\) is closed under finite boolean combination

    - If \(\bara\in X\), \(\exists D\in\calf\), \(\bara\in D\)
    - \(X\) is a finite union of things in \(\calf\)
    #+END_proof

    #+ATTR_LATEX: :options [\ref{3.10.10}]
    #+BEGIN_fact
    If \(D\subseteq\M^n\) definable, \(A\subseteq\M\) small, then \(D\) is \(A\)-definable iff \(D\) is \(A\)-invariant
    #+END_fact

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(D_1,\dots,D_{n+1}\) are \(A\)-definable, and \(f:D_1\times\dots\times D_n\to D_{n+1}\), then \(f\) is
    *\(A\)-definable* if \(\Gamma(f)=\{(\bara,b):b=f(\bara)\}\) is definable
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(A\subseteq\M\), \(\dcl(A)=\{b\in\M:\{b\}\text{ is $A$-definable}\}\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In a field, \(a\div b\in\dcl(\{a,b\})\) because \(\{a\div b\}\) is \(\varphi(\M)\), \(\varphi(x):=bx=a\)
    #+END_examplle

    _Note_: if \(\barb\in\M^n\), \(\barb\in\dcl(A)^n\Leftrightarrow\{\barb\}\subseteq\M^n\) is \(A\)-definable


    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:4.7.5
    If \(\barb\in\M^n\), \(A\subseteq\M\), TFAE
    1. \(\barb\in\dcl(A)\), i.e., \(\{\barb\}\) is \(A\)-definable
    2. \(\forall \sigma\in\Aut(\M/A)\), \(\sigma(\barb)=\barb\), i.e. \(\{\barb\}\) is \(A\)-invariant
    3. \(\barb\) is the only realization of \(\tp(\barb/A)\)
    #+END_proposition

    #+BEGIN_proof
    \(1\Leftrightarrow 2\) by fact since \(\{\barb\}\) is definable

    \(2\Leftrightarrow 3\): let \(S=\{\barc\in\M^n:\barc\equiv_A\barb\}=\{\sigma(\barb):\sigma\in\Aut(\M/A)\}\).
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:4.7.6
    1. \(A\subseteq\dcl(A)\)
    2. \(A\subseteq B\Rightarrow\dcl(A)\subseteq\dcl(B)\)
    3. \(\dcl(\dcl(A))=\dcl(A)\)
    4. \(D\) is \(A\)-definable \(\Leftrightarrow\) \(D\) is \(\dcl(A)\)-definable

    Conditions 1-3 say that \(\dcl(-)\) is an abstract "closure operator"
    #+END_proposition

    #+BEGIN_proof
    4. [@4] If \(D\) is \(\dcl(A)\)-definable, \(\sigma\in\Aut(\M/A)\),  \(b\in\dcl(A)\), \(\sigma(b)=b\) by
       Proposition ref:4.7.5, \(\sigma\in\Aut(\M/\dcl(A))\), \(\sigma(D)=D\), so \(D\) is \(A\)-invariant
    3. [@3] take \(b\in\dcl(\dcl(A))\), \(\{b\}\) is \(\dcl(A)\)-definable, \(\{b\}\) is \(A\)-definable, \(b\in\dcl(A)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(A\) is *definably closed* if \(\dcl(A)=A\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    \(\dcl(A)\) is the smallest definably closed set containing \(A\)
    #+END_proposition

    #+BEGIN_proof
    \(\dcl(A)\) is definably closed

    \(\dcl(A)\supseteq A\)

    Now suppose \(B=\dcl(B)\) and \(B\supseteq A\), by "monotonicity", \(\dcl(B)\supseteq\dcl(A)\), so \(B\supseteq\dcl(A)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    if \(M\vDash\ACF_0\), if \(A\subseteq M\), then \(A=\dcl(A)\) \(\Leftrightarrow\) \(A\) is a subfield of \(M\)

    \(\Rightarrow\): easy
    \(\Leftarrow\): harder

    It fails in \(\ACF_p\), in \(\ACF_p\), \(p>0\), \(K\subseteq M\) is definably
    closed \(\Leftrightarrow\) \(\forall x\in K\), \(\sqrt[p]{x}\in K\)
    #+END_fact

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\bara\), \(\barb\) are *interdefinable* iff \(\dcl(\bara)=\dcl(\barb)\) iff \(\bara\in\dcl(\barb)\)
    and \(\barb\in\dcl(\bara)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:4.7.11
    \(\dcl(\bara)=\dcl(\barb)\) \(\Leftrightarrow\)  \(\Aut(\M/\bara)=\Aut(\M/\barb)\)
    #+END_lemma

    #+BEGIN_proof
    By Proposition ref:4.7.5, \(\dcl(\bara)\subseteq\dcl(\barb)\) \(\Leftrightarrow\) \(\bara\in\dcl(\barb)\Leftrightarrow\Aut(\M/\barb)\subseteq\Aut(\M/\bara)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:4.7.12
    If \(\dcl(\bara)=\dcl(\barb)\), then \(\exists\) \(\emptyset\)-definable bijection \(f:X\to Y\) s.t. \(f(\bara)=\barb\)
    #+END_lemma

    #+BEGIN_proof
    \(\bara\in\dcl(\barb)\), so there is \(L\)-formula \(\varphi_1(\barx,\bary)\)
    s.t. \(\{\bara\}=\varphi_1(\M,\barb)\), also there is \(\{\barb\}=\varphi_2(\bara,\M)\)

    Let \(\varphi=\varphi_1\wedge\varphi_2\), can replace \(\varphi_1,\varphi_2\) with \varphi.

    Let \(\psi(\barx,\bary)\) be \(\varphi(\barx,\bary)\wedge\exists!\barw\;\varphi(\barw,\bary)\wedge\exists!\barz\;\varphi(\barx,\barz)\).
    Then \(\psi(\barx,\bary)\) defines a bijection and \(f(\bara)=\barb\)

    We can extract the definition of \(f(\bara)=\barb\) and fill \(f\) with garbage
    #+END_proof

** Algebraic closure
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(\acl(A)=\bigcup\{D\subseteq\M^1:D\text{ is }A\text{-definable},\abs{D}<\infty\}\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In fields, \(\sqrt{a}\in\acl(a)\) because \(\{\sqrt{a},-\sqrt{a}\}\) is \(\{a\}\)-definable
    #+END_examplle

    _Note_: \(\barb\in\acl(A)\) \(\Leftrightarrow\) there is \(A\)-definable \(D\subseteq\M^n\), \(\barb\in D\), \(\abs{D}<\infty\)

    If \(\barb\in D\subseteq\M^n\), then let \(D_i=\pi_i(D)\), \(\pi_i(\barx)=x\),

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:4.7.14
    If \(\barb\in\M^n\), \(A\subseteq\M\) small, let \(S=\{\barc\in\M^n:\barc\equiv_A\barb\}=\{\sigma(\barb):\sigma\in\Aut(\M/A)\}\)
    1. If \(\barb\in\acl(A)\), then \(S\) is finite and \(A\)-definable
    2. If \(\barb\notin\acl(A)\), then \(S\) is large (\(S\) is not small)
    #+END_proposition

    #+BEGIN_proof
    1. \(\barb\in\acl(A)\), there is \(D\) finite, \(A\)-definable, \(\barb\in D\). \(\sigma(\barb)\in\sigma(D)=D\)
       for \(\sigma\in\Aut(\M/A)\), so \(S\subseteq D\), \(S\) is finite, then \(S\) is definable. Also \(S\) is \(A\)-invariant
    2. If \(\barb\notin\acl(A)\) but \(S\) is small.
       Let \(\Sigma(\barx)=\tp(\barb/A)\cup\{\barx\neq\barc:\barc\in S\}\). \(\Sigma(\barx)\) is inconsistent. By
       Compactness, there
       is \(\psi(\barx)\in\tp(\barb/A)\), \(\barc_1,\dots,\barc_m\in S\), \(\{\psi(\barx),x\neq\barc_1,\dots,x\neq\barc_n\}\) is
       inconsistent. Thus \(D=\psi(\M)\subseteq\{\barc_1,\dots,\barc_m\}\). \(D\)
       is \(A\)-definable, \(\barb\in D\), \(D\) is finite, so \(\barb\in\acl(A)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    1. \(A\subseteq\acl(A)\)
    2. \(A\subseteq B\Rightarrow\acl(A)\subseteq\acl(B)\)
    3. \(\acl(\acl(A))=\acl(A)\)
    #+END_proposition

    #+BEGIN_proof
    3. [@3] Take \(b\in\acl(\acl(A))\), then \(b\in\varphi(\M,\barc)=D\), \(D\) is finite, \(D\)
       is \(\acl(A)\)-definable, \(\barc\in\acl(A)\)

       \(\calf=\{\sigma(D):\sigma\in\Aut(\M/A)\}=\{\varphi(\M,\sigma(\barc)):\sigma\in\Aut(\M/A)\}\) is finite by Proposition
       ref:4.7.14, \(\sigma(D)\) is finite as \(D\) is finite. Therefore \(D'=\bigcup\calf\) is
       finite, \(A\)-invariant, \(b\in D'\) as \(b\in D\in\calf\). Therefore \(b\in\acl(A)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    label:4.7.16
    \(A\) is *algebraically closed* if \(A=\acl(A)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    \(\acl(A)\) is the smallest algebraically closed set containing \(A\)
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(M\preceq\M\), then \(\acl(M)=M\)
    #+END_proposition

    #+BEGIN_proof
    Otherwise, \(\acl(M)\supsetneq M\), take \(b\in\acl(M)\setminus M\). \(S=\{\sigma(b):\sigma\in\Aut(\M/M)\}\). By
    Proposition ref:4.7.14, \(S\) is finite, \(M\)-definable. \(M\) is \(M\)-invariant
    so \(S\cap M=\emptyset\), contradicting to Tarski-Vaught criterion
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(M\vDash\ACF\) and \(K\) is a subfield. TFAE
    1. \(K=\acl(K)\)
    2. \(K\vDash\ACF\)
    3. \(K\preceq M\)
    #+END_proposition

    Idea: in \(\ACF\), field theoretic algebraic closure = model theoretic algebraic closure

    #+BEGIN_proof
    \(1\to 2\):
    Take \(P(x)\),
    \(P\not\equiv 0\), \(M\vDash\ACF\), \(P(x)=c\cdot(x-r_1)\dots(x-r_n)\), \(c\in K\), \(r_1,\dots,r_n\in M\). \(D=\{r_1,\dots,r_n\}\)
    is \(K\)-definable. \(K=\acl(K)\) implies \(D\subseteq\acl(K)=K\)

    \(2\to 3\): q.e.
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    If \(T\) is strongly minimal, \(A\subseteq M\vDash T\)
    \begin{equation*}
    A\preceq M\Leftrightarrow\abs{A}=\infty\text{ and }A=\acl(A)
    \end{equation*}
    #+END_fact


** Imaginaries
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    An *\(A\)-interpretable set* is \(X/E\) where \(X\) is \(A\)-definable and \(E\subseteq X^2\)
    is \(A\)-definable equivalence relation on \(X\)
    #+END_definition

    Interpretable = \(\M\)-interpretable. 0-interpretable = \(\emptyset\)-interpretable

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(M\) is a structure, \(M^{\eq}\) is the expansion of \(M\) by
    - A new sort for every 0-interpretable \(D/E\)
    - Relation symbols for \(D\to D/E\) (i.e., if \(D\subseteq M^n\), add \(R\subseteq M^n\times(D/E)\)
      where \(R(a_1,\dots,a_n,b)\Leftrightarrow\bara\in D,[a]_E=b\)) If \(D\subsetneq M^n\) can't add a function symbol


    \(M\) is called the *home sort* (when \(M\) is one-sorted)
    #+END_definition

    \(M^{\eq}\) is the expansion of \(M\) obtained by adding each 0-interpretable set as a new sort,
    with enough data to connect the new sorts to the old sorts

    If \(\M\) is a monster model, then \(\M^{\eq}\) is a monster model(7) with the "same" automorphism
    group(6) and the "same" small models(5). If we restrict our attention to the original sorts from
    \(M\), then \(\M^{\eq}\) and \(\M\) have the same definable sets(1) (4) and the same partial
    elementary maps(2). However, \(\M^{\eq}\) have some new elements, and the definable sets
    in \(\M^{\eq}\) correspond exactly to the interpretable sets in the original structure \(\M\)
    (8)(9). On the other hand, the new elements of \(\M^{\eq}\) are definable from the old
    elements(3). So *\(\M^{\eq}\) is a way of coverting interdefinable sets into definable sets while*
    *preserving most other things*

    #+ATTR_LATEX: :options []
    #+BEGIN_fact
    label:4.7.22
    1. If \(X\subseteq M^n\), \(X\) is 0-definable in \(M\) \(\Leftrightarrow\) \(X\) is 0-definable in \(M^{\eq}\). In
       other words, \(M^{\eq}\) doesn't define any new sets on the original sorts of \(M\)
    2. If \(A,B\subset M\), \(f:A\to B\) bijection, then \(f\) is a partial elementary map
       in \(M\) \(\Leftrightarrow\) \(f\) is a partial elementary map in \(M^{\eq}\)
    3. In \(M^{\eq}\), \(\dcl(M)=M^{\eq}\)
    4. Consequently, any \(M^{\eq}\)-definable set \(X\subseteq M^n\) is \(M\)-definable in \(M^{\eq}\), and
       therefore \(M\)-definable in \(M\)
    5. If \(N\preceq M\) then \(N^{\eq}\preceq M^{\eq}\) (more
       precisely, \(N^{\eq}\cong\dcl_{M^{\eq}}(N)\preceq M^{\eq}\)) This gives an \(\preceq\)-preserving bijection.

       Moreover, all elementary substructures of \(M\) arise this way. This yields an
       order-preserving bijection between the elementary substructures of \(M\) and the elementary
       substructures of \(M^{\eq}\). In particular, all elementary substructures of \(M^{\eq}\)
       arise this way
    6. If \(\sigma\in\Aut(M)\), \sigma acts on \(M^{\eq}\) in a natural way. \sigma
       induces \(\hat{\sigma}\in\Aut(M^{\eq})\). This gives an isomorphism \(\Aut(M)\cong\Aut(M^{\eq})\)


    5 and 6 come from equivalence of categories \(\Mod T\to\Mod T^{\eq}\)
    7. [@7] \(M\) is \kappa-saturated and strongly \kappa-homogeneous \(\Leftrightarrow\) \(M^{\eq}\) is \kappa-saturated and strongly \kappa-homogeneous
    8. If \(D/E\) is 0-interpretable in \(M\), then \(D/E\) is 0-definable in \(M^{\eq}\)
    9. If \(X\) is 0-definable in \(M^{\eq}\), then there is 0-interpretable \(D/E\) in \(M\) and a
       0-definable bijection \(f:X\to D/E\) in \(M^{\eq}\)


    Ideas (8-9): interpretable in \(M\) \(\Leftrightarrow\) definable in \(M^{\eq}\)
    #+END_fact

    #+BEGIN_proof
    Only some remarks
    1. More generally, one can show that \(X\subseteq  M^n\times\prod_{j=1}^m(D_j/E_j)\) is 0-definable in \(M^{\eq}\)
       iff \(\tilX\subseteq M^n\times\prod_{j=1}^mD_j\) is 0-definable in \(M\)
       where \(\tilX=\{(a_1,\dots,a_n,b_1,\dots,b_m):(a_1,\dots,a_n,[b_1]_E,\dots,[b_M]_{E_M})\in X\}\).
    3. [@3] using the definable functions \(D\to D/E\)
    4. Note (1) means that if \(\barx\) is a tuple of variables in the old sorts of \(M\), then
       any \(L^{\eq}\)-formula \(\phi(x)\) is equivalent to an \(L\)-formula
    5. Behind the scenes, there is a theory \(T^{\eq}\) and \(M\vDash T\Rightarrow M^{\eq}\vDash T^{\eq}\). Moreover,
       all models of \(T^{\eq}\) have the form \(M^{\eq}\) up to isomorphism. Finally, elementary
       embeddings \(M\to N\) correspond bijectively to elementary embeddings \(M^{\eq}\to N^{\eq}\)
    7. [@7] \(\Leftarrow\) is easier by (2). If you just want a monster model \(\M\) s.t. \(\M^{\eq}\) is a
       monster model, you can do the following: take \(M\vDash T\), construct \(M^{\eq}\), take some
       monster elementary extension \(U\succeq M^{\eq}\), then check that \(U\)is \(\M^{\eq}\) for
       some \(\M\succeq M\)

       If \(M\) is \kappa-saturated and strongly \kappa-homogeneous. \kappa-saturation is not hard in terms of a
       compactness-like property: if \(\abs{A}<\kappa\) and a collection of \(A\)-definable sets has FIP,
       then it has non-empty intersection. To transfer this from \(M\) to \(M^{\eq}\), one takes
       the \(A\)-definable sets in \(M^{\eq}\) and lifts them to \(A\)-definable sets in \(M\) using
       the maps \(D\to D/E\)
    9. [@9] This comes down to the following things. First, if \(D/E\) and \(D'/E'\) are two
       interpretable sets, then \((D/E)\times(D'/E')\) "is" an interpretable set, namely \((D\times D')/E''\)
       where \((a,b)E''(c,d)\Leftrightarrow aEc\wedge bE'd\). Secondly if \(X\) is a definable subset of \(D/E\),
       then \(X\) "is" an interpretable set \(D'/E'\), where \(D'=\{a\in D:[a]_E\in X\}\) and \(E'\) is
       the restriction of \(E\) to \(D'\)
    #+END_proof

    From now on, we use the word "interpretable" to mean "definable in \(\M^{\eq}\)" and "definable"
    to mean "definable" in \(\M\)

    An *imaginary* is an element of \(\M^{\eq}\)


** Elimination of imaginaries
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(T\) has *elimination of imaginaries* (EI) if \(\forall a\in\M^{\eq}\), \(\exists\barb\in\M\), \(\dcl(a)=\dcl(\barb)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(T\) has *uniform EI* if
    1. If \(D/E\)  is 0-interpretable, then there is 0-definable \(Y\), there is
       bijection \(f:D/E\to Y\), 0-interpretable (= 0-definable in \(M^{\eq}\))
    2. If \(D/E\) is 0-interpretable, then there is \(Y\) 0-definable, 0-definable
       surjection \(g:D\to Y\) s.t. \(g(x)=g(y)\) iff \(E(x,y)\)


    \(1\Leftrightarrow 2\)
    #+END_definition


    _Note_: uniform EI implies EI

    If \(e\in D/E\), there is \(Y\) 0-definable, bijection \(f:D/E\to Y\), \(e\) interpretable
    with \(f(e)\in\M^n\)

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    label:4.7.25
    If \(T\) has EI, if \(D/E\) is 0-interpretable, then there is
    0-interpretable \(X_i\subseteq D/E\), \(X_i\cap X_j=\emptyset\), \(D/E=\bigcup_{i=1}^nX_i\), each \(X_i\) has 0-interpretable
    bijection to a 0-definable set \(f_i:X_i\to Y_i\)
    #+END_lemma

    #+BEGIN_proof
    Say 0-interpretable \(X\subseteq D/E\) is "good" if there is 0-definable \(Y\),
    0-interpretable bijection \(f:X\to Y\).

    If \(X'\subseteq X\), \(X\) is "good", \(X'\) is 0-interpretable, then \(X'\) is good

    *Claim* \(D/E\) is covered by good sets

    If \(e\in D/E\), E.I. implies there is \(\barb\in\M^m\), \(\dcl^{\eq}(e)=\dcl^{\eq}(\barb)\). Lemma
    ref:4.7.12 implies there is 0-interpretable bijection \(f:X\to Y\), \(f(e)=\barb\), \(X\) is good

    There are at most \(\abs{L}\)-many good sets. By saturation, \(D/E=\bigcup_{i=1}^nX_i\) (class of good
    sets is small)

    Replace \(X_i\) with \(X_i\setminus(X_1\cup\dots\cup X_{i-1})\), we may assume the \(X_I\) are pairwise disjoint
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_theorem
    Suppose \(T\) has one-sort and \(\abs{\dcl(\emptyset)}\ge 2\), then \(T\) has E.I. \(\Leftrightarrow\) \(T\) has uniform E.I.
    #+END_theorem

    #+BEGIN_proof
    \(\Rightarrow\): Take \(D/E\) 0-interpretable. Lemma ref:4.7.25
    gives \(D/E=\coprod_{i=1}^nX_i\), \(f_i:X_i\to Y_i\), \(Y_i\) 0-definable

    Fix \(a,b\in\dcl(\emptyset)\)

    By replacing \(y_i\) with \(y_i\times\{(a,a,\dots,a)\}\). WMA there is \(m\) s.t. \(Y_i\subseteq\M^m\) \(\forall i\).
    Take \(N\gg 0\), \(2^N>n\), take distinct \(\barc_1,\dots,\barc_n\in\{a,b\}^N\)

    Replacing \(Y_i\) with \(Y_i\times\{\barc_i\}\), now \(Y_i\)s are disjoint
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(\DLO\) has E.I., doesnt have uniform E.I.

    \(D=M^2\), \(E\) two class \(\{(x,y):x=y\}\) and \(\{(x,y):x\neq y\}\)

    uniform E.I. would imply \(D/E\leftrightarrow Y\), \(Y\) is 0-definable. But there is no 0-definable \(Y\)
    with two elements
    #+END_examplle

    #+BEGIN_remark
    \(\M^{\eq}\) has uniform E.I.

    If \(D/E\) is 0-interpretable and \(E'\subseteq(D/E)\times(D/E)\) is a 0-interpretable equivalence relation
    on \(D/E\), then \((D/E)/E'\) is also 0-interpretable. In fact, it's \(D/E''\) where
    \begin{equation*}
    E''(\bara,\barb)\Leftrightarrow E'([\bara]_E,[\barb]_E)
    \end{equation*}

    Therefore \(\M^{\eq}\approx(\M^{\eq})^{\eq}\)
    #+END_remark

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(\DLO\) is an example of a theory with elimination of imaginaries but not uniform elimination
    of imaginaries

    Let \(E\) be the equivalence relation on \(\M^2\) with two classes, one of which is the
    line \(y=x\) and the other is its complement. If there was a 0-interpretable bijection
    from \(\M^2/E\) to \(Y\subseteq\M^n\), then \(Y\) would contain two elements, both of which are
    in \(\dcl(\emptyset)\). But \(\dcl(\emptyset)=\emptyset\), so \(Y\) cannot have any elements unless \(n=0\) and
    when \(n=0\) the set \(Y\) can only have one element.
    #+END_examplle
** Codes
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A real tuple or imaginary \(e\)is a *code* for \(D\) ( \(e\) *codes* \(D\)) if \(\{\sigma\in\Aut(\M):\sigma(D)=D\}=\Aut(\M^{\eq}/e)=\Aut(\M/e)\)
    #+END_definition

    #+BEGIN_remark
    If \(e,e'\) code \(D\), then \(\Aut(\M/e)=\Aut(\M/e')\), so \(\dcl^{\eq}(e)=\dcl^{\eq}(e')\) by
    Lemma ref:4.7.11
    #+END_remark

    #+BEGIN_remark
    If \(e\) codes \(D\), then \(D\) is \(A\)-definable  \(\Leftrightarrow\) \(e\in\dcl^{\eq}(A)\)
    #+END_remark

    #+BEGIN_proof
    TFAE
    - \(D\) is \(A\)-definable
    - \(D\) is \(A\)-invariant
    - \(\forall\sigma\in\Aut(\M/A)\), \(\sigma(D)=D\)
    - \(\forall\sigma\in\Aut(\M/A)\), \(\sigma(e)=e\)
    - \(e\in\dcl^{\eq}(A)\)
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Suppose \(T=\ACF\) and \(S=\{r_1,\dots,r_n\}\subseteq\M\). Let \(P(x)=\prod_{i=1}^n(x-r_i)\). Write \(P(x)\)
    as \(x^n+c_{n-1}x^{n-1}+\dots+c_1x+c_0\). Then \((c_0,\dots,c_{n-1})\) is a code for \(S\). Indeed
    \begin{align*}
    \sigma(\barc)=\barc&\Leftrightarrow\sigma(P(x))\equiv P(x)\\
    &\Leftrightarrow\prod_{i=1}^n(x-\sigma(r_i))\equiv\prod_{i=1}^n(x-r_i)\\
    &\Leftrightarrow\{\sigma(r_1),\dots,\sigma(r_n)\}=\{r_1,\dots,r_n\}\\
    &\Leftrightarrow\sigma(S)=S
    \end{align*}
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    If \(D/E\) is 0-interpretable and \(e\in D/E\), then \(e\) is an \(E\)-equivalence
    class \(X=E(\M,\bara)\), and \(\sigma(e)=\sigma(X)\) for all \sigma. Therefore \sigma codes \(X\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_lemma
    Let \(\varphi(\barx,\bary)\) be a formula. Let \(f(\bary)\) be a 0-definable function s.t.
    \begin{equation*}
    \varphi(\M,\barb)=\varphi(\M,\barc)\Leftrightarrow f(\barb)=f(\barc)
    \end{equation*}
    Then \(f(\barb)\) is a code for \(\varphi(\M,\barb)\), for each \(\barb\)
    #+END_lemma

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    label:4.7.34
    TFAE
    1. \(T\) has uniform elimination of imaginaries
    2. For any formula \(\varphi(\barx;\bary)\), there is a 0-definable function \(f_\varphi(\bary)\) s.t.
       \begin{equation*}
       \varphi(\M,\barb)=\varphi(\M,\barc)\Leftrightarrow f_\varphi(\barb)=f_\varphi(\barc)
       \end{equation*}
    #+END_proposition

    #+BEGIN_proof
    \(1\to 2\): apply uniform E.I. to \(\M^n/E\), where \(E(\barb,\barc)\Leftrightarrow(\varphi(\M,\barb)=\varphi(\M,\barc))\)

    \(2\to 1\): given a 0-interpretable set \(D/E\),
    \begin{equation*}
    E(\barb,\barc)\Leftrightarrow E(\M,\barb)=E(\M,\barc)\Leftrightarrow f_E(\barb)=f_E(\barc)
    \end{equation*}
    for \(\barb,\barc\in D\). So we have a 0-definable function on \(D\) satisfying condition 2 of Definition
    #+END_proof

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    If \(T\) has uniform elimination of imaginaries, then every definable set has a code in \(\M\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    Every definable set has a code in \(\M^{\eq}\)
    #+END_corollary

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    TFAE
    1. \(T\) has elimination of imaginaries
    2. Every definable \(D\subseteq\M^n\) has a code in \(\M\)
    #+END_proposition

    #+BEGIN_proof
    \(1\to 2\): given \(D\) take a code \(e\in\M^{\eq}\), then take \(\barb\in\M^m\) interdefinable
    with \(e\). Then
    \begin{equation*}
    \Aut(\M/\barb)=\Aut(\M/e)=\{\sigma\in\Aut(\M):\sigma(D)=D\}
    \end{equation*}
    so \(\barb\) is a code for \(D\)

    \(2\to 1\): if \(e\in D/E\subseteq\M^{\eq}\), then \(e\) codes a definable set \(X\)
    #+END_proof



    #+ATTR_LATEX: :options []
    #+BEGIN_corollary
    \(\dcl^{\eq}(e)\) is the smallest definably closed set defining \(D\)
    #+END_corollary
** Elimination of imaginaries and naming parameters
    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Uniform elimination of imaginaries is preserved by naming parameters
    #+END_proposition


* Appendices :ignore:
  #+LATEX: \appendix
** Metric Spaces
    \(\R_{\ge 0}\) denotes \([0,+\infty]=\{x\in\R:x\ge 0\}\)
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *metric* on a set \(M\) is a function \(d:M\times M\to\R_{\ge 0}\) satisfying the following properties
    1. \(d(x,y)=0\Leftrightarrow x=y\)
    2. \(d(x,y)=d(y,x)\)
    3. \(d(x,z)\le d(x,y)+d(y,z)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(M=\R^2\), \(d(x,y)=\)(the distance from \(x\) to \(y\))
    \begin{equation*}
      d(x_1,x_2;y_1,y_2)=\sqrt{(x_1-y_1)^2+(x_2-y_2)^2}
    \end{equation*}
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    The *Manhattan metric* on \(\R^2\) is given by
    \begin{equation*}
      d(x_1,x_2;y_1,y_2)=\abs{x_1-y_1}+\abs{x_2-y_2}
    \end{equation*}

    measure distances in a city grid
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Let \(M\) be the set of strings. The *edit distance* from \(x\) to \(y\) is the minimum number of
    intersections, deletions, and substitutions to go from \(x\) to \(y\)
    \begin{gather*}
      d(drip,rope)=3\\
      drip\mapsto drop\mapsto rop\mapsto rope
    \end{gather*}
    Edit distance is a metric on \(M\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *metric space* is a pair \((M,d)\) where \(M\) is a set and \(d\) is a metric space
    #+END_definition

    * \((\R^n,d_{Euclidean})\) where \(d_{Euclidean}\) is the usual Euclidean distance
    * \((\R^2,d_{Manhattan})\) where \(d_{Manhattan}\) is the Manhattan distance


    Often we abbreviate \((M,d)\) as \(M\), when \(d\) is clear

    Fix a metric space \((M,d)\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    If \(p\in M\) and \(\epsilon>0\), then
    \begin{align*}
    &B_\epsilon(p)=\{x\in M:d(x,p)<\epsilon\}\\
    &\barB_\epsilon(p)=\{x\in M:d(x,p)\le\epsilon\}\\
    \end{align*}
    \(B_\epsilon(p)\) and \(\barB_\epsilon(p)\) are called the *open* and *closed* balls of radius \epsilon around \(p\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In \(\R^2\) with the Euclidean metric, the open ball of radius 2 around \((0,0)\) the open disk
    \begin{equation*}
    \{(x,y)\in\R^2:x^2+y^2<2^2\}
    \end{equation*}
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In \(\R^2\) with the Manhattan metric, the open ball of radius 1 around \((0,0)\) the open disk
    \begin{equation*}
    \{(x,y)\in\R^2:\abs{x}+\abs{y}\le 1\}
    \end{equation*}
    #+END_examplle

    Suppose \(p\in M\) and \(X\subseteq M\)
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(p\) is an *interior point* of \(X\) if \(X\) contains an open ball of positive radius around \(p\)
    #+END_definition

    In particular, \(p\) must be an element of \(X\)


    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    If \(X=[-1,1]\times[-1,1]\), then \((0,0)\) is an interior point of \(X\), but \((1,0)\)
    and \((0,2)\) are not
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    The *interior* \(\tint(X)\) is the set of interior points
    #+END_definition

    Warning: There are metric spaces where the interior of \(\barB_\epsilon(p)\) isn't \(B_\epsilon(p)\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A set \(X\subseteq M\) is *open* if \(X=\tint(X)\), i.e., every point of \(X\) is an interior point of \(X\)
    #+END_definition

    #+ATTR_LATEX: :options [in \(\R\)]
    #+BEGIN_examplle
    The set \((-1,2)\) is open. The sets \([-1,2]\) and \([-1,2)\) are not; they have interior \((-1,2)\)
    #+END_examplle

    Fact: the interior \(\tint(X)\) is the unique largest open set contained in \(X\)

    Let \(a_1,a_2,\dots\) be a sequence in a metric space \((M,d)\) and let \(p\) be a point
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    "\(\lim_{i\to\infty}a_i=p\)" if for every \(\epsilon>0\), there is \(n\) s.t.
    \begin{equation*}
    \{a_n,a_{n+1},a_{n+2},\dots\}\subseteq B_\epsilon(p)
    \end{equation*}
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Work in \(\R\) with the usual distance. Let \(a_n=1/n\). Then \(\lim_{n\to\infty}a_n=0\)
    but \(\lim_{n\to\infty}a_n\neq 1\)
    #+END_examplle

    Fact: For any sequence \(a_1,a_2,a_3,\cdots\) in \((M,d)\), there is at most one point \(p\)
    s.t. \(\lim_{i\to\infty}a_i=p\)

    If such a \(p\) exists, it is called the *limit*, and written \(\lim_{i\to\infty}a_i\)

    let \(X\) be a set and \(p\) be a point in a metric space \((M,d)\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(p\) is an *accumulation point* of \(X\) if \(p=\lim_{n\to\infty}a_n\) for some sequence \(a_n\) in \(X\)
    #+END_definition

    Equivalently
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(p\) is an accumulation point of \(X\) if for every \(\epsilon>0\), we have \(B_\epsilon(p)\cap X\neq\emptyset\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    The *closure* of \(X\), written \(\cl(X)\) or \(\barX\), is the set of accumulation points
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A set \(X\subseteq M\) is *closed* if \(X=\cl(X)\)
    #+END_definition


    Fact: The closure \(\cl(X)\) is the unique smallest closed set containing \(X\)

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Work in \(\R\) with the distance \(d(x,y)=\abs{x-y}\)

    \(\Q\) is neither closed nor open

    \(\R\) is both closed and open, so is \(emptyset\)
    #+END_examplle

    Let \(X^c\) denote the completement \(M\setminus X\)

    Fact: \(X\) is closed iff \(X^c\) is open

    Fact: \(\tint(X)=\cl(X^c)^c\) and \(\cl(X)=\tint(X^c)^c\)

    Let \((M,d)\) and \((M',d)\) be metric spaces. Let \(f:M\to M'\) be a function
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(f\) is *continuous* if
    \begin{equation*}
    \lim_{n\to\infty}a_n=p\Rightarrow\lim_{n\to\infty}f(a_n)=f(p)
    \end{equation*}
    for \(a_1,a_2,a_3,\dots,p\in M\)
    #+END_definition

    idea: \(f\) is continuous iff \(f\) preserves limits

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    Let \(f:\R\to\R\) be given by
    \begin{equation*}
    f(x)=
    \begin{cases}
    1&\text{if }x>0\\
    -1&\text{if }x\le 0
    \end{cases}
    \end{equation*}
    Then \(\lim_{n\to\infty}1/n=0\), but
    \begin{equation*}
    \lim_{n\to\infty}f(1/n)=\lim_{n\to\infty}1=1\neq-1=f(0)
    \end{equation*}
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Fix \(f:(M,d)\to(M',d)\). The following are equivalent
    1. \(f\) is continuous
    2. For every open set \(U\subseteq M'\), the preimage \(f^{-1}(U)\) is open
    3. For every \(p\in M\), for every \(\epsilon>0\), there is \(\delta>0\) s.t. for every \(x\in M\),
       \begin{equation*}
      d(x,p)<\delta\Rightarrow d(f(x),f(p))<\epsilon
       \end{equation*}
    #+END_proposition

    Fact: The functions \(\sin\), \(\cos\), \(\exp\), \(\sqrt[3]{-}\) and polynomials are continuous

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(f,g:\R\to\R\) are continuous, then \(f+g,f\cdot g,f-g,f\circ g\) are continuous
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(f:\R\to\R\) is continuous and \(f(x)\neq 0\) for all \(x\), then \(1/f(x)\) is continuous.
    If \(f(x)\ge 0\) for all \(x\), then \(\sqrt{f(x)}\) is continuous
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    This function is continuous
    \begin{equation*}
    h(x)=\exp\left( \frac{1}{1+x^2} \right)-\frac{1}{17+\sin(\sqrt[3]{x})}
    \end{equation*}
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A function \(f:M\to M'\) is *Lipschitz continuous* if there is \(c\in\R\) s.t. for any \(x,y\in M\)
    \begin{equation*}
    d(f(x),f(y))\le c\cdot d(x,y)
    \end{equation*}
    #+END_definition

    #+ATTR_LATEX: :options [In \(\R\)]
    #+BEGIN_examplle
    The function \(f(x)=\abs{x}+\abs{x-1}\) is Lipschitz continuous with \(c=2\)
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(f\) is Lipschitz continuous, then \(f\) is continuous
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    The function \(f(x)=x^2\) is continuous but not Lipschitz continuous
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    Let \((M,d)\)be a metric space and \(S\subseteq M\) be a set. Then \((S,d')\) is a metric space,
    where \(d'(x,y)=d(x,y)\) for \(x,y\in S\)
    * \(d'\) is the restriction of \(d\) to \(S\times S\)
    * We say that \((S,d')\) is a *subspace* of \((M,d)\)
    #+END_definition

    Let \((M,d)\), \((M',d)\) be metric spaces, \(S\subseteq M\) and \(f:S\to M'\) be a function

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(f\)  is *continuous* if \(f\) is continuous as a map from the subspace \((S,d')\) to \((M',d)\)
    #+END_definition

    #+ATTR_LATEX: :options [in \(\R\)]
    #+BEGIN_examplle
    Let \(f:(-\infty,0)\cup(0,\infty)\to\R\)  be given by \(f(x)=1/x\). Then \(f\) is continuous
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    An *isometry* or *isomorphism* from \((M,d)\) to \((M',d')\) is a bijection \(f:M\to M'\) s.t. for
    any \(x,y\in M\)
    \begin{equation*}
    d(x,y)=d'(f(x),f(y))
    \end{equation*}
    #+END_definition

    #+ATTR_LATEX: :options [in \(\R^2\)]
    #+BEGIN_examplle
    The map \((x,y)\mapsto(x+1,y-7)\) is an isometry

    So is the map \((x,y)\mapsto(3/5x+4/5y,-4/5x+3/5y)\)

    These two metric spaces are isometric via the isometry \(x\mapsto(x,0)\)
    * \(\R\) with the usual distance
    * The subspace \(\R\times\{0\}\) inside \(\R^2\) with the usual distance
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    The isometries of \(\R^2\) are exactly the rotations, translations, reflections and glide reflections
    #+END_proposition

    Let \(X\) be a non-empty set in a metric space

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    The *diameter* of \(X\), written \(\diam(X)\), is
    \begin{equation*}
    \sup\{d(p,q):p,q\in X\}
    \end{equation*}
    (Possibly \(\diam(X)=+\infty\))
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    In \(\R^2\) with the usual metric, the diameter of \(B_r(p)\) is \(2r\)
    #+END_examplle

    Work in a metric space \(M\)
    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A *Cauchy sequence* is a sequence \(a_1,a_2,a_3,\dots\) s.t.
    \begin{equation*}
    \lim_{n\to\infty}\diam(\{a_n,a_{n+1},a_{n+2},\dots\})=0
    \end{equation*}
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Every sequence which converges to a point in \(M\) is a Cauchy sequence
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Let \(a_1,a_2,a_3,\dots\) be a sequence in a metric space \((M,d)\). The following are equivalent
    * The sequence is a Cauchy sequence
    * There is some metric space \(M'\) s.t. \(M\) is a subspace of \(M'\), and \(\lim_{n\to\infty}a_n\)
      converges in \(M'\)
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    In \(\R\), every Cauchy sequence converges
    #+END_proposition

    This fails in the subspace \(\Q\)

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A metric space \((M,d)\) is *complete* if every Cauchy sequence in \(M\) converges (to a point in \(M\))
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(\R\) is complete. The subspace \(\Q\) and \((-1,1)\) are not complete
    #+END_examplle

    Let \((M,d)\) be a metric space

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    The *completion* of \(M\) is a new metric space \(\barM\). Objects of \(\barM\) are equivalence
    classes of Cauchy sequences in \(M\). Two Cauchy sequences \((a_i)_{i\in\N}\) and \((b_i)_{i\in\N}\) are
    equivalent if \(\lim_{i\to\infty}d(a_i,b_i)=0\). The distance in \(\barM\) between two Cauchy
    sequences \((a_i)_{i\in\N}\) and \((b_i)_{i\in\N}\) is \(\lim_{i\to\infty}d(a_i,b_i)\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    This is well-defined, and \(\barM\) is complete
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If we identify \(c\in M\)with the constant sequence \(c,c,c,c,\dots\) then \(M\) is a dense subspace
    of \(\barM\). If \(M\) is complete, then \(\barM=M\)
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    \(\R\) is the completion of \(\Q\) w.r.t. its usual metric
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    The *\(p\)-adic norm* on \(\Q\) is defined by
    \begin{gather*}
    \abs{0}_p=0\\
    \abs{p^ka/b}_p=p^{-k}\text{ if }a,b\text{ are integers not divisible by }p
    \end{gather*}
    For example, \(\abs{1.3}_5=\abs{5^{-1}\cdot 13/2}_5=5^1\)

    The *\(p\)-adic metric* on \(\Q\) is given by \(d(x,y)=\abs{x-y}_p\). This is an incomplete metric.
    The completion is called \(\Q_p\), the set of *\(p\)-adic numbers*
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    \(C([0,1])\) is the space of continuous functions \(f:[0,1]\to\R\)
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    There is a metric on \(C([0,1])\) where \(d(f,g)=\max\{\abs{f(x)-g(x)}:x\in[0,1]\}\). This
    makes \(C([0,1])\) into a complete metric space.
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A metric space \((M,d)\) is *connected* if the only clopen sets are \(M\) and \(\emptyset\).
    Otherwise \(M\) is disconnected
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_definition
    A set \(X\subseteq M\) is *connected* (resp. *disconnected*) if the subspace \((X,d)\)is connected or
    disconnected as a metric space.
    #+END_definition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    \(X\) is disconnected iff there is a non-constant continuous function \(f:X\to\{0,1\}\)
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    The set \([-10,-1]\cup[1,10]\) is disconnected, as witnessed by
    \begin{equation*}
    f(x)=
    \begin{cases}
    0&x<0\\
    1&x>0
    \end{cases}
    \end{equation*}
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    The set \([-10,10]\setminus\{0\}\) is disconnected
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_examplle
    The set \(\Q\) is disconnected, witnessed by
    \begin{equation*}
    f(x)=
    \begin{cases}
    0&x<\sqrt{2}\\
    1&x>\sqrt{2}
    \end{cases}
    \end{equation*}
    The set \(\R\setminus\Q\) is disconnected by a similar argument
    #+END_examplle

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    If \(X\subseteq\R\) is non-empty, then the following are equivalent
    * \(X\) is connected
    * \(X\) is convex: if \(a,b\in X\), then \([a,b]\subseteq X\)
    * \(X\) is an interval, a set of the form
      \begin{gather*}
      [a,b],(a,b),(a,b],[a,b)\\
      (-\infty,a),(-\infty,a],[a,+\infty),(a,+\infty),(-\infty,\infty)
      \end{gather*}
    #+END_proposition

    #+ATTR_LATEX: :options []
    #+BEGIN_proposition
    Let \(f:M\to M'\) be continuous. If \(X\subseteq M\) is connected, then \(f(X)\subseteq M'\) is connected
    #+END_proposition

    #+ATTR_LATEX: :options [Intermediate Value Theorem]
    #+BEGIN_corollary
    If \(f:[a,b]\to\R\) is continuous and \(f(a)<y<f(b)\), then there is \(x\in[a,b]\) with \(f(x)=y\)
    #+END_corollary

    #+BEGIN_proof
    \(f([a,b])\) is connected, hence convex, so it contains \(y\in[f(a),f(b)]\). Therefore there
    is \(x\in[a,b]\) with \(f(x)=y\)
    #+END_proof

    There are discontinuous functions \(f:\R\to\R\) satisfying the IVT

    classify infinite set with only 1 unary predicate

** Midterm review [1/6]
    * [ ] 2.24 : definable types, heirs
    * [ ] 3.3 : dichotomy property, \lambda-stability, stability
    * [ ] 3.10 : stability, coheirs, invariant types, Morley products
    * [ ] 3.17 : Morley sequences, the order property, indiscernbible sequences
    * [ ] 3.24 : Ramsey's theorem, indiscernbible sequence, EM-types, total indiscernbility
    * [X] 4.7 : definable closure, algebraic closure, elimination of imaginaries
* Problems want to ask
    [[Problem1]]
