% Created 2021-12-05 Sun 11:45
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\graphicspath{{../../books/}}
\input{../preamble.tex}
\makeindex
\author{Qi'ao Chen}
\date{\today}
\title{Stability}
\hypersetup{
 pdfauthor={Qi'ao Chen},
 pdftitle={Stability},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 27.2 (Org mode 9.6)}, 
 pdflang={English}}
\begin{document}

\maketitle
\tableofcontents


\section{Preface}
\label{sec:org356439b}
A combination of various notes from \cite{PillayNoteStability} \cite{ChernNoteStability} \cite{tent2012course}

A monster model \(\fC\)

\cite{PillayNoteStability} has many typos\emoji{ðŸ˜…}
\section{Preliminaries}
\label{sec:orgab08e84}
\subsection{Indiscernibles}
\label{sec:org3ba0de7}
\begin{definition}[]
Let \(I\) be a linear order and \(\fA\) an \(L\)-structure. A family \((a_i)_{i\in I}\) of elements
of \(A\) is called a \textbf{sequence of indiscernibles}  if for all \(L\)-formulas \(\varphi(x_1,\dots,x_n)\) and
all \(i_1<\dots<i_n\) and \(j_1<\dots<j_n\) from \(I\)
\begin{equation*}
\fA\vDash\varphi(a_{i_1},\dots,a_{i_n})\leftrightarrow\varphi(a_{j_1},\dots,a_{j_n})
\end{equation*}
or
\begin{equation*}
\tp(a_{i_1},\dots,a_{i_n})=\tp(a_{j_1},\dots,a_{j_n})
\end{equation*}
\end{definition}

\begin{theorem}[]
Compactness let us ``stretch'' indiscernibles. Let \((a_i:i\in\omega)\) be indiscernibles in \(\fC\),
and \((I,<)\) an ordering. Then there exists an indiscernible \((b_i:i\in I)\) in \(\fC\)
s.t. \(\forall i_1<\dots<i_n\in I\)
\begin{equation*}
\tp(a_1,\dots,a_n)=\tp(b_{i_1},\dots,b_{i_n})
\end{equation*}
\end{theorem}

Indiscernible sequence are a fundamental tool of model theory, and there are many ways to obtain
them.

\begin{theorem}[Ramsey, extended]
Let \(n_1,\dots,n_r<\omega\). For each \(i=1,\dots,r\), let \(X_{i,1}\), \(X_{i,2}\) be a partition
of \([\omega]^{n_i}\). Then there is an infinite subset \(Y\subseteq\omega\) which is homogeneous,
i.e., \(\forall i=1,\dots,r\), either \([Y]^{n_i}\subseteq X_{i,1}\) or \([Y]^{n_i}\subseteq Y_{i,2}\)
\end{theorem}

\begin{proposition}[]
For each \(n\in\omega\), let \(\Sigma_n(x_1,\dots,x_n)\) be a collection of \(L\)-formulas in
variables \(x_1,\dots,x_n\). Suppose that there are \(a_1,a_2,\dots\in\fC\) s.t.
\begin{equation*}
\vDash\Sigma_n(a_{i_1},\dots,a_{i_n}),\quad\forall i_1<\dots<i_n<\omega
\end{equation*}
Then there is an indiscernible \((b_i:i\in\omega)\) in \(\fC\) s.t.
\begin{equation*}
\vDash\Sigma_n(b_{i_1},\dots,b_{i_n}),\quad\forall i_1<\dots<i_n<\omega
\end{equation*}
\end{proposition}

\wu{
we can expand \(\bigcup_{n\in\omega}\Sigma_n\) and obtain the Ehrenfeucht-Mostowski type \(\EM((a_i)_{i\in\omega})\).
This is just the Standard Lemma in Tent
}

\begin{examplle}[]
Suppose \(\Sigma_2=\{x_1\neq x_2\}\). Then the proposition yields the existence of infinite indiscernible sequences
\end{examplle}

\begin{proof}
Consider
\begin{align*}
\Gamma(x_1,x_2,\dots)&=\{\varphi(x_{i_1},\dots,x_{i_n})\leftrightarrow\varphi(x_{j_1},\dots,x_{j_n}):\\
&\quad i_1<\dots<i_n,j_1<\dots<j_n\in\omega,\varphi\in L\}\\
&\cup\bigcup_n\Sigma(x_1,\dots,x_n)
\end{align*}
Let \(\Gamma'(x_1,\dots,x_n)\subseteq_f\Gamma\). Let \(\varphi_1,\dots,\varphi_r\) be the \(L\)-formulas appearing in \(\Gamma'\).
For \(i=1,\dots,r\), let
\begin{align*}
&X_{i,1}=\{(j_1,\dots,j_n):j_1<\dots<j_n\in\omega,\vDash\varphi_i(a_{j_1},\dots,a_{j_n})\}\\
&X_{i,2}=\{(j_1,\dots,j_n):j_1<\dots<j_n\in\omega,\vDash\neg\varphi_i(a_{j_1},\dots,a_{j_n})\}
\end{align*}
By Ramsey's theorem, there exists an infinite \(Y\subseteq\N\) s.t. \(\forall i=1,\dots,r\), \([Y]^{n_i}\) is either
contained in \(X_{i,1}\) or in \(X_{i,2}\). Write \(Y=\{k_1<k_2<\dots\}\). Interpret each \(x_i\)
as \(a_{k_i}\) to satisfy \(\Gamma'\)
\end{proof}

\begin{definition}[]
Let \(M\prec N\prec\fC\) be models, and \(p(\barx)\in S_{\barx}(N)\). We say \(p\) is finitely satisfiable
in \(M\), or \(p(\barx)\) is a \textbf{coheir} of \(p\uhr M\in S_{\barx}(M)\), if
every \(\varphi(\barx)\in p(\barx)\) is satisfied by some \(\bara\in M\)
\end{definition}

\begin{remark}
\(p(\barx)\in S_n(N)\) is finitely satisfiable (f.s.) in \(M\) iff \(p(\barx)\) is in the
topological closure of \(\{\tp(\bara/N):\bara\in M\}\subseteq S_n(N)\)
\end{remark}

\begin{lemma}[]
\label{P2.8}
Suppose \(p(\barx)\in S_{\barx}(M)\) and \(M\prec N\), then there is \(p'(\barx)\in S_{\barx}(N)\)
s.t. \(p\subseteq p'\) and \(p'\) is f.s. in \(M\)
\end{lemma}

\begin{proof}
Consider \(\Gamma(\barx)=p(\barx)\cup\{\neg\varphi(\barx):\varphi(\barx)\in L_N\text{ and not realized in }M\}\). Let
\(\Gamma\supseteq_f\Gamma'=\{\Psi(\barx),\neg\varphi_1(\barx),\dots,\neg\varphi_r(\barx)\}\in p\). Then any solution \(\bara\) of \(\Psi\) in \(M\)
satisfies \(\Gamma'\) as \(M\vDash\forall\barx(\neg\varphi_i(\barx))\)
\end{proof}

\begin{remark}
Let \(i_M:M^{\barx}\to S_{\barx}(M)\) s.t. \(m\mapsto\tp(m/M)\). Define \(i_N:M^{\barx}\to S_{\barx}(N)\)
similarly. Let \(r:S_{\barx}(N)\to S_{\barx}(M)\). Note that \(r\circ i_N=i_M\) and the set of types
in \(S_{\barx}(N)\) that are f.s. in \(M\) is exactly the closure of \(i_N(M^{\barx})\)
in \(S_{\barx}(N)\). Hence its image under \(r\) is closed. However the image must
contain \(i_M(M^{\barx})\) which is dense in \(S_{\barx}(M)\). Therefore it must be onto, which
proves the desired result

\wu{
\(r\) is continuous and \(r(\bbar{i_N(M^n)})\supseteq i_M(M^n)\) is closed. \(\bbar{i_M(M^n)}=S_n(M)\).
Then \(r\) is onto? Then its preimage of \(p\) is what we want \label{Problem2}
}
\end{remark}

\begin{proposition}[]
Let \(p(\barx)\in S_{\barx}(M)\), \(N\succ M\) be \(\abs{M}^+\)-saturated,
and \(p'(\barx)\in S_{\barx}(N)\) a coheir of \(p\). Let \(\bara_1,\bara_2,\dots\in N\) be defined as
follows
\begin{align*}
&\bara_1\text{ realises }p(\barx)\\
&\bara_2\text{ realises }p'(\barx)\uhr(M,\bara_1)\\
&\bara_3\text{ realises }p'(\barx)\uhr(M,\bara_1,\bara_2)\\
&\cdots
\end{align*}
Then \((\bara_i:i\in\omega)\) is indiscernible over \(M\)
\end{proposition}

\begin{proof}
We prove by induction on \(k\) that for any \(n\le k\) and \(i_1<\cdots<i_n\le k\) and \(j_1<\cdots<j_n\le k\), we
have
\begin{equation*}
\tp_M(\bara_{i_1},\dots,\bara_{i_n}/M)=\tp_M(\bara_{j_1},\dots,\bara_{j_n}/M)
\end{equation*}
Assume this is true for \(k\) and consider \(k+1\). Let \(i_1<\cdots<i_n\le k\), \(j_1<\cdots<j_n\le k\). We
need to show that
\begin{equation*}
\tp_M(\bara_{i_1},\dots,\bara_{i_n},\bara_{k+1}/M)=\tp_M(\bara_{j_1},\dots,\bara_{j_n},\bara_{k+1}/M)
\end{equation*}
Consider a formula \(\varphi(\barx_1,\dots,\barx_n,\barx_{n+1})\in L_M\). Assume by contradiction that
\begin{equation*}
M\vDash\varphi(\bara_{i_1},\cdots,\bara_{i_{n}},\bara_{k+1})\wedge\neg\varphi(\bara_{j_1},\cdots,\bara_{j_{n}},\bara_{k+1})
\end{equation*}
But \(\tp(\bara_{k+1}/M,\bara_1,\dots,\bara_k)\) is f.s. in \(M\), so there is \(\bara'\in M\) s.t.
\begin{equation*}
M\vDash\varphi(\bara_{i_1},\cdots,\bara_{i_{n}},\bara')\wedge\neg\varphi(\bara_{j_1},\cdots,\bara_{j_{n}},\bara')
\end{equation*}
contradicting IH
\end{proof}

\subsection{Definability and Generalizations}
\label{sec:org75b3ade}
\begin{definition}[]
\(X\subseteq\fC^n\) is \textbf{definable almost over} \(A\) if there is an \(A\)-definable equivalence
relation \(E\) on \(\fC^n\) with finitely many classes and \(X\) is a union of some \(E\)-classes
\end{definition}

\begin{lemma}[]
\label{P2.11}
Let \(\D\) be a definable class and \(A\) a set of parameters. T.F.A.E.
\begin{enumerate}
\item \(\D\) is definable over \(A\)
\item \(\D\) is invariant under all automorphisms of \(\fC\) which fix \(A\) pointwise
\end{enumerate}
\end{lemma}

\(S\subseteq K^{\alg}\Rightarrow M\setminus S\subseteq K^{\alg}\)

\begin{proof}
\(\Rightarrow\) is easy as for any \(F\in\Aut(\fC/A)\) and \(\D=\varphi(\fC,\bara)\), \(\fC\vDash\varphi(\bars,\bara)\)
iff \(\fC\vDash\varphi(F(\bars),\bara)\). \href{https://math.stackexchange.com/questions/3361635/when-are-automorphism-invariant-subsets-definable}{StackExchange}

\(x\in\D\Leftrightarrow\vDash\varphi(x,\bara)\Leftrightarrow\varphi(F(x),F(\bara))\leftrightarrow\varphi(F(x),\bara)\Leftrightarrow F(x)\in\D\)

\(\Leftarrow\). Another proof from Chernikov. Assume that \(\D=\varphi(\fC,b)\) where \(b\in\fC\), and
let \(p(y)=\tp(b/A)\)

\textbf{Claim 1}. \(p(y)\vdash\forall x(\varphi(x,y)\leftrightarrow\varphi(x,b))\), which says that for any realisations \(b'\), \(\varphi(\fC,b)=\varphi(\fC,b')\)

Indeed, let \(b'\vDash p(y)\) be arbitrary. Then \(\tp(b/A)=\tp(b'/A)\) so there is
some \(\sigma\in\Aut(\fC/A)\) with \(\sigma(b)=b'\). Then \(\sigma(X)=\varphi(\fC,b')\) and by assumption \(\sigma(X)=X\),
thus \(\varphi(\fC,b)=X=\varphi(\fC,b')\).

There is some \(\psi(y)\in p\) (there is a finite subset of \(p(y)\) that does the job and we take
the conjunction) s.t.
\begin{equation*}
\psi(y)\vDash\forall x(\varphi(x,y)\leftrightarrow\varphi(x,b))
\end{equation*}
Let \(\theta(x)\) be the formula \(\exists y(\psi(y)\wedge\varphi(x,y))\). Note that \(\theta(x)\) is an \(L(A)\)-formula,
as \(\psi(y)\) is

\textbf{Claim 2}. \(X=\theta(\fC)\)

If \(a\in X\), then \(\vDash\varphi(a,b)\), and as \(\psi(y)\in\tp(b/A)\) we have \(\vDash\theta(a)\). Conversely,
if \(\vDash\theta(a)\), let \(b'\) be s.t. \(\vDash\psi(b')\wedge\varphi(a,b')\). But by the choice of \(\psi\) this implies that \(\vDash\varphi(a,b)\)

\(\Leftarrow\) Let \(\D\) be defined by \(\varphi\), defined over \(B\supset A\). Consider the maps
\begin{equation*}
\fC\xrightarrow{\tau}S(B)\xrightarrow{\pi}S(A)
\end{equation*}
where \(\tau(c)=\tp(c/B)\) and \(\pi\) is the restriction map. Let \(Y\) be the image of \(\D\)
in \(S(A)\). Since \(Y=\pi[\varphi]\). \(Y\) is closed.
\wu{
Note that \(\tau(\D)=[\varphi]\). \(\tau(\D)=\{\tp(c/B):\fC\vDash\varphi(c)\}\subseteq[\varphi]\). For any \(q(x)\in[\varphi]\), as \(\fC\) is
saturated, \(\fC\vDash q(d)\) and \(d\in\D\). Thus \(q\in\tau(\D)\). \(\pi\) is continuous
}


Assume that \(\D\) is invariant under all automorphisms of \(\fC\) which fix \(A\) pointwise. Since
elements which have the same type over \(A\) are conjugate by an automorphism of \(\fC\), this
means that \(\D\)-membership depends only on the type over \(A\), i.e., \(\D=(\pi\tau)^{-1}(Y)\).
\wu{
For any \(\tp(c/A)=\tp(d/A)\) and \(c\in\D\), as \(c\) and \(d\) are conjugate, \(d\in\D\).

For any \(c\notin\D\), \(\pi\tau(c)\in Y\) iff \(\tp(c/A)\in\pi[\varphi]\) iff there is \(d\in\D\)
s.t. \(\tp(c/A)=\tp(d/A)\) but then \(c\in\D\).
}

This implies that \([\varphi]=\pi^{-1}(Y)\)
\wu{
\(\tau(\D)=[\varphi]=\tau(\tau^{-1}\pi^{-1})(Y)=\pi^{-1}(Y)\)
}
, or \(S(A)\setminus Y=\pi[\neg\varphi]\); hence \(S(A)\setminus Y\) is also closed and
we conclude that \(Y\) is clopen. By Lemma \ref{lemma4.2.3} \(Y=[\psi]\) for some \(L(A)\)-formula \(\psi\).
This \(\psi\) defines \(\D\).
\wu{
For any \(d\in\fC\)
\begin{equation*}
\vDash\psi(d)\Leftrightarrow\tp(d/A)\Leftrightarrow d\in\D
\end{equation*}
}
\end{proof}


A slight generalization of the previous lemma
\begin{lemma}[]
\label{P2.13}
Let \(X\subseteq\fC^n\) be definable. TFAE
\begin{enumerate}
\item \(X\) is almost \(A\)-definable, i.e., there is an \(A\)-definable equivalence relation \(E\)
on \(\fC^n\) with finitely many classes, s.t. \(X\) is a union of \(E\)-classes
\item The set \(\{\sigma(X):\sigma\in\Aut(\fC/A)\}\) is finite
\item The set \(\{\sigma(X):\sigma\in\Aut(\fC/A)\}\) is small
\end{enumerate}
\end{lemma}

\begin{proof}
\(1\to 2\). Let \(\varphi(x_1,x_2)\in L(A)\) be the \(A\)-definable equivalence relation \(E\), and
let \(b_1,\dots,b_n\in M\) be representatives in each equivalence class so that each class can be
written as \([b_i]=\varphi(\fC,b_i)\). Given \(\sigma\in\Aut(\fC/A)\), since \(\varphi(x_1,x_2)\leftrightarrow\varphi(\sigma(x_1),\sigma(x_2))\), the image
of each \([b_i]\) under \(\sigma\) will be
\begin{equation*}
\sigma([b_i])=\{\sigma(x):\varphi(x,b_i)\}=\{x':\varphi(x',\sigma(b_i))\}=\{x:\varphi(x,b_{j_i})\}=[b_{j_1}]
\end{equation*}
for some \(j_i\le n\). Now \(X\) is a disjoint union of some \([b_i]\)'s, so \(\sigma(X)\) is a disjoint
union of some \([b_j]\)'s. Since there are only finitely many equivalence classes, there can
only be finitely many possibilities for disjoint unions of these classes

\(2\to 1\). Let \(X=\varphi(\fC,b)\) and \(p(y)=\tp(b/A)\). Given \(\sigma\in\Aut(\fC/A)\), we
have \(\sigma(X)=\varphi(\fC,\sigma(b))\). Then from assumption, there must be distinct \(b_1,\dots,b_n\) s.t.
\begin{equation*}
\{\sigma(X):\sigma\in\Aut(\fC/A)\}=\{\varphi(\fC,b_i):i\le n\}
\end{equation*}
Now if \(\tp(b'/A)=\tp(b/A)\), then strong homogeneity yields some \(\sigma\in\Aut(\fC/A)\)
s.t. \(\sigma(b)=b'\). Then the above argument again shows that \(\varphi(x,b')\) defines \(\sigma(X)\) for
some \(\sigma\in\Aut(\fC/A)\). Thus \(\sigma(X)=\varphi(\fC,b')=\varphi(\fC,b_i)\) for some \(i\le k\). Therefore
\(p(y)\vdash\bigvee_{i\le k}\forall x(\phi(x,y)\leftrightarrow\phi(x,b_i))\). By compactness there is
some \(\psi(y)\in p\) s.t. \(\psi(y)\vdash\bigvee_{i\le k}\forall x(\phi(x,y)\leftrightarrow\phi(x,b_i))\). Now define \(E(x_1,x_2)\) as
\begin{equation*}
\forall y(\psi(y)\to(\phi(x_1,y)\leftrightarrow\phi(x_2,y)))
\end{equation*}
so it is \(A\)-definable. It is easy to check that \(E\) is an equivalence relation with
finitely many classes, and that \(X\) is a union of \(E\)-classes (\(a_1Ea_2\) iff they agree on
\(\phi(x,b_i)\) for all \(i\le k\), and so \(X=\phi(\fC,b_0)\) is given by the union of all possible
combinations intersected with it)

\(3\to 1\) Assume for contradiction that
\begin{equation*}
\abs{\{\sigma(X):\sigma\in\Aut(\fC/A)\}}=\lambda\ge\omega
\end{equation*}
we can find \(\lambda\)-many elements \((b_i:i<\lambda)\subset\fC\) to represent the distinct images under automorphisms.
Then the set
\begin{equation*}
q(y)=p(y)\cup\{\neg\forall x(\varphi(x,y)\leftrightarrow\varphi(x,b_i)):i<\lambda\}
\end{equation*}
will be finitely satisfiable. Thus \(q(y)\) is realised by some \(b'\). But such \(b'\) has the
same type as \(b\) over \(A\) and so strong homogeneity yields some \(\sigma\in\Aut(\fC/A)\)
s.t. \(\sigma(b)=b'\). Applying such \(\sigma\) on \(X\) gives the image \(\varphi(\fC,b')=\varphi(\fC,b_i)\) for some \(i<\lambda\),
a contradiction
\end{proof}

\begin{proposition}[]
We can identify definable sets with continuous functions in a certain settings
\begin{enumerate}
\item Formulas \(\varphi(\barx),\psi(\barx)\in L_A\) are equivalent iff \([\varphi(\barx)]=[\psi(\barx)]\)
\item The clopen subsets of \(S_{\barx}(A)\) are precisely the basic clopen sets
\setcounter{enumi}{2}
\item Clopen subsets \(X\) of \(S_{\barx}(A)\) correspond exactly to continuous
functions \(f:S_{\barx}(A)\to 2\) (with discrete topology) where \(f(p(\barx))=1\) if \(p(\barx)\in X\) and 0 otherwise
\item The definable subsets of \(\fC^c\) are in one-to-one correspondence with continuous functions
from \(S_{\barx}(A)\) to 2
\end{enumerate}
\end{proposition}

\begin{proof}
\begin{enumerate}
\setcounter{enumi}{2}
\item If \(X\) is clopen, then \(f^{-1}(2)=S_{\barx}(A)\), \(f^{-1}(0)=\emptyset\), \(f^{-1}(\{1\})=X\), \(f^{-1}(\{0\})=X^c\)
\item By 1, definable sets are in one-to-one correspondence with basic clopen subsets. By 2, basic
clopen sets are exactly all of the clopen subsets, so definable sets are in one-to-one
correspondence with clopen sets. By 3, clopen sets are in one-to-one correspondence with
continuous functions \(f:S_{\barx}(A)\to 2\)
\end{enumerate}
\end{proof}


\subsection{Imaginaries and \texorpdfstring{\(T^{\eq}\)}{Teq}}
\label{sec:org844390b}
\begin{definition}[]
The \textbf{definable closure} \(\dcl(A)\) of \(A\) is the set of elements \(c\) for which there is
an \(L(A)\)-formula \(\varphi(x)\) s.t. \(c\) is the unique element satisfying \(\varphi\). Elements or
tuples \(a\) and \(b\) are said to be \textbf{interdefinable} if \(a\in\dcl(b)\) and \(b\in\dcl(a)\).
\end{definition}

\begin{lemma}[]
Assume \(A\subseteq\fC\) and \(\barb\in\fC\)
\begin{enumerate}
\item \(\barb\in\acl(A)\) iff \(\{f(\barb):f\in\Aut(\fC/A)\}\) is finite
\item \(\barb\in\dcl(A)\) iff \(f(\barb)=\barb\) for all \(f\in\Aut(\fC/A)\)
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Suppose \(\barb\in\acl(A)\) with witness \(\exists^{\le k}\varphi(\barx)\). Then \(\varphi(\fC)\) is \(A\)-definable
and hence is \(\Aut(\fC/A)\)-invariant by Lemma \ref{P2.11}

Suppose the finiteness. Since the composition of automorphisms is an automorphism, this set
is \(\Aut(\fC/A)\)-invariant and therefore \(A\)-definable by some \(\varphi(\barx)\).

\item \(\{\barb\}\) is \(\Aut(\fC/A)\)-invariant
\end{enumerate}
\end{proof}

The first motivation to develop \(T^{\eq}\) is dealing with quotient objects, without leaving
the context of first order logic. That is, if \(E\) is some definable equivalence relation on
some definable set \(X\), we want to view \(X/E\) as a definable set

We work in the setting of multi-sorted languages. Let \(L\) be a 1-sorted language and let \(T\)
be a (complete) \(L\)-theory. We shall build a many-sorted
language \(L^{\eq}\)-theory \(T^{\eq}\). We will ensure that in natural sense, \(L^{\eq}\)
contains \(L\) and \(T^{\eq}\) contains \(T\)

First we define \(L^{\eq}\). Consider the set \(L\)-formula \(\varphi(x,y)\), up to equivalence, such
that \(T\) models that \(\varphi\) is an equivalence relation. For each \(\varphi\), define \(s_\varphi\) to be a new sort
in \(L^{\eq}\). Of particular importance is \(s_=\), the sort given by the formula ``\(x=y\)''.
\wu{
= is an equivalence relation
}
This sort \(s_=\) will yield, in each model of \(T^{\eq}\), a model of \(T\)

Also define \(f_\varphi\) to be a function symbol with domain sort \(s^n_=\) (where \(\varphi\) has \(n\) free
variables) and codomain sort \(s_\varphi\)

For each \(m\)-place relation symbol \(R\in L\), make \(R^{\eq}\) an \(m\)-place relation symbol
in \(L^{\eq}\) on \(s_=^m\). Likewise for all constant and function symbols in \(L\). Finally, for
the sake of formality, we put a unique equality symbol \(=_\varphi\) on each sort

\begin{remark}
Let \(N\) be an \(L^{\eq}\) structure. Then \(N\) has interpretations \(s_\varphi(N)\) of each
sort \(s_\varphi\) and \(f_\varphi(N):s_=(N)^{n_{f_\varphi}}\to s_\varphi(N)\) of each function symbol \(f_\varphi\).
Additionally, \(N\) will contain an \(L\)-structure consisting of \(s_=\) and interpretations of
the symbols of \(L\) inside of \(s_=\)
\end{remark}

\begin{definition}[]
\(T^{\eq}\) is the \(L^{\eq}\)-theory which is axiomatised by the following
\begin{enumerate}
\item \(T\), where the quantifiers in the formulas of \(T\) now range over the sort \(s_=\)
\item For each suitable \(L\)-formula \(\varphi(x,y)\), the axiom \(\forall_{s_=}\barx\forall_{s_=}\bary(\varphi(x,y)\leftrightarrow f_\varphi(\barx)=f_\varphi(\bary))\)
\item For each \(L\)-formula \(\varphi\), the axiom \(\forall_{s_\varphi}y\exists_{s_=}\barx(f_\varphi(\barx)=y)\)
\end{enumerate}
\end{definition}

Axioms 2 and 3 simply state that \(f_\varphi\) is the quotient function for the equivalence relation
given by \(\varphi\)

\begin{definition}[]
Let \(M\vDash T\). Then \(M^{\eq}\) is the \(L^{\eq}\) structure s.t. \(s_=(M^{\eq})=M\) and for each
suitable \(L\)-formula \(\varphi(x,y)\) of \(n\) variables, the sort \(s_\varphi(M^{\eq})\) is equal
to \(M^{n_{f_\varphi}}/E\) where \(E\) is the equivalence relation defined by \(\varphi(x,y)\) and \(f_\varphi(M^{\eq})(b)=b/E\)
\end{definition}

\begin{examplle}[Projective planes]
From Hodges.

Suppose \(A\) is a three-dimensional vector space over a finite field, and let \(L\) be the
first-order language of \(A\). Then we can write a formula \(\theta(x,y)\) of \(L\) which expresses
'vectors \(x\) and \(y\) are non-zero and are linearly dependent on each other'. The formula
\(\theta\) is an equivalence formula of \(A\), and the sort \(s_\theta\) is the set of points of the
projective plane \(P\) associated with \(A\)
\end{examplle}

Now \(M^{\eq}\vDash T^{\eq}\). Moreover, passing from \(T\) to \(T^{\eq}\) is a canonical operation,
in the following sense
\begin{lemma}[]
\begin{enumerate}
\item For any \(N\vDash T^{\eq}\), there is an \(M\vDash T\) s.t. \(N\cong M^{\eq}\)
\item Suppose \(M,N\vDash T\) are isomorphic, and let \(h:M\cong N\). Then \(h\) extends uniquely
to \(h^{\eq}:M^{\eq}\cong N^{\eq}\)
\item \(T^{\eq}\) is a complete \(L^{\eq}\)-theory
\item Suppose \(M,N\vDash T\) and let \(\bara\in M\), \(\barb\in N\) with \(\tp_M(\bara)=\tp_N(\barb)\).
Then \(\tp_{M^{\eq}}(\bara)=\tp_{N^{\eq}}(\barb)\)
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Take \(M=s_=(N)\)
\item Let \(h^{\eq}:M^{\eq}\to N^{\eq}\) be defined
as \(h^{\eq}(f_\varphi(M^{\eq})(b))=f_\varphi(N^{\eq})(h(b))\) for each \(\varphi\in L\). This defines a function
on \(M^{\eq}\), because \(f_\varphi(M^{\eq})\) is surjective by the \(T^{\eq}\) axioms.
Moreover \(h^{\eq}\) is well-defined. Suppose \(f_\varphi(M^{\eq})(b)=f_\varphi(M^{\eq})(b')\),
then \(\varphi(b,b')\) and hence \(\varphi(h(b),h(b'))\),
therefore \(f_\varphi(N^{\eq})(h(b))=f_\varphi(N^{\eq})(h(b'))\). Injectivity is the same
since \(\varphi(b,b')\leftrightarrow\varphi(h(b),h(b'))\).
\begin{align*}
f_\varphi(N^{\eq})(h(b))=f_\varphi(N^{\eq})(h(b'))&\Leftrightarrow h(b)/E_\varphi=h(b')/E_\varphi\\
&\Leftrightarrow\varphi(h(b),h(b'))\\
&\Leftrightarrow\varphi(b,b')\\
&\Leftrightarrow f_\varphi(M^{\eq})(b)=f_\varphi(M^{\eq})(b')
\end{align*}
\item Let \(M,N\vDash T^{\eq}\), we want to show that they are elementary equivalent. Assume the
generalized continuum hypothesis. By GCH, there are \(M',N'\vDash T^{\eq}\) which are \(\lambda\) saturated
of size \(\lambda\), for some large \(\lambda\) (strongly inaccessible), which \(M\preceq M'\) and \(N\preceq N'\). Since we
want to show elementary equivalence, we can replace \(M,N\) with \(M'\) and \(N'\). By 1, we
have \(M=M_0^{\eq}\), \(N=N_0^{\eq}\) for some \(M_0,N_0\vDash T\). Furthermore, \(M_0,N_0\)
are \(\lambda\)-saturated of size \(\lambda\). By assumption, \(T\) is complete, so \(M_0\equiv N_0\), and
therefore \(M_0\cong N_0\). By 2, \(M\cong N\), and therefore \(M\equiv N\)

We could simply prove that there is a back and forth system between \(M\) and \(N\), using
such a system between \(M\supset M_0\vDash T\) and \(N\supset N_0\vDash T\)
\label{Problem13}
\wu{
\(M_0\equiv N_0\) iff \(M_0\sim_\omega N_0\). We want to show that \(M\sim_\omega N\). For any \(p\in\omega\),
\begin{itemize}
\item given \(a\in s_=(M)\), choose according to \(M\)

\item given \(a\in s_\varphi(M)\), then there is \(\barb\barc\in s_=(M)\)
s.t. \(f_\varphi(M^{\eq})(\barb\barc)=a\) and \(\varphi(\barb,\barc)\). If \(\barb\in s_=(M^{\eq})^n\),
then there is a local isomorphism \(\barb\mapsto\bard\) as \(M\sim_\omega N\). Take \(b=\bard/E_\varphi\).
\end{itemize}
}
\item Let \(M,N\vDash T\), they are elementary submodels of \(\fC\). Since \(\tp_M(\bara)=\tp_N(\barb)\), there
exists an \(\sigma\in\Aut(\fC/A)\) with \(\sigma(\bara)=\barb\). By 2, this automorphism extends to \(\sigma^{\eq}:\fC^{\eq}\to\fC^{\eq}\)
with \(\sigma^{\eq}(a)=b\), hence \(\tp_{M^{\eq}}(a)=\tp_{\fC^{\eq}}(a)=\tp_{\fC^{\eq}}(b)=\tp_{N^{\eq}}(b)\)
\end{enumerate}
\end{proof}

\begin{corollary}[]
Consider the Strong space \(S_{(s_=)^n}(T^{\eq})\). The forgetful
map \(\pi:S_{(s_=)^n}(T^{\eq})\to S_n(T)\) is a homeomorphism
\end{corollary}

\begin{proof}
Observe that it is continuous and surjective. By 4 of the previous lemma it is injective. Any
continuous bijection from a compact space to a Hausdorff space is a homeomorphism
\end{proof}

\begin{proposition}[]
\label{P2.28}
Let \(\varphi(x_1,\dots,x_k)\) be an \(L^{\eq}\) formula, where \(x_i\) is of sort \(S_{E_i}\). There is
an \(L\)-formula \(\psi(\bary_1,\dots,\bary_k)\) s.t.
\begin{equation*}
T^{\eq}\vDash\forall \bary_1,\dots,\bary_k(\psi(\bary_1,\dots,\bary_k)\leftrightarrow\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k)))
\end{equation*}
\end{proposition}

\begin{proof}
Let \(n\) be the length of \(\bary_1,\dots,\bary_k\). Consider the
set \(\pi[\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k))]\), it is a clopen subset of \(S_n(T)\) by the
previous lemma, hence equal to \(\psi(\bary_1,\dots,\bary_k)\) for some formula \(\psi\).

\wu{
Guess the intuition is \([\varphi]=[\psi]\) iff \(\vDash\varphi\leftrightarrow\psi\).
Consider \(\pi[\psi(\bary_1,\dots,\bary_k)]=\pi[\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k))]\) and as \(\pi\) is
homeomorphism, \([\psi(\bary_1,\dots,\bary_k)]=[\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k))]\)
}
\end{proof}

\wu{
This proposition also shows that \(T^{\eq}\) is complete since \(f_{E_i}\) is surjective

Also, for any \(\barc\in\fC\), \(\barc\in\dcl^{\eq}(\emptyset)\Leftrightarrow\barc\in\dcl(\emptyset)\) , \(\barc\in\acl^{\eq}(\emptyset)\Leftrightarrow\barc\in\acl(\emptyset)\)
}

\begin{corollary}[]
\begin{enumerate}
\item Let \(M,N\vDash T\), and let \(h:M\to N\) be an elementary embedding.
Then \(h^{\eq}:M^{\eq}\to N^{\eq}\) is also an elementary embedding
\item \(\fC^{\eq}\) is also \(\kappa\)-saturated
\end{enumerate}
\end{corollary}

\begin{proof}
\begin{enumerate}
\item \(h:M\to\im(h)\) is an isomorphism and can extend to \(h^{\eq}:M^{\eq}\to(\im(h))^{\eq}\),
and \((\im(h))^{\eq}\subseteq N^{\eq}\)
\item By Proposition \ref{P2.28}
\end{enumerate}
\end{proof}

\begin{remark}
For \(M\vDash T\), a definable set \(X\subseteq M^n\) can be viewed as an element of \(M^{\eq}\).
Suppose \(X\) is defined in \(M\) by \(\varphi(\barx,\bara)\) where \(\bara\in M\). Consider the
equivalence relation \(E_\psi\) defined
by \(\psi(\bary_1,\bary_2)=\forall\barx(\varphi(\barx,\bary_1)\leftrightarrow\varphi(\barx,\bary_2))\)
\wu{
\(\bary_1\sim\bary_2\) iff this \(\varphi(M,\bary_1)=\varphi(M,\bary_2)\),
}
and consider \(c=\bara/E_\psi=f_\psi(\bara)\in M^{\eq}\). Then \(X\) is defined in \(M^{\eq}\)
by \(\chi(\barx,c)=\exists\bary(\varphi(\barx,\bary)\wedge f_\psi(\bary)=c)\). Moreover, if \(c'\in S_\psi(M^{\eq})\)
and \(\forall\barx(\chi(\barx,c)\leftrightarrow\chi(\barx,c'))\), then \(c=c'\). To see this, let \(c'=f_{\psi}(\bara')\),
and let \(X'\) be defined in \(M\) by \(\varphi(\barx,\bara')\). Then \(X'\) is defined in \(M^{\eq}\)
by \(\chi(\barx,c')\), so we have that \(X=X'\) (in \(M^{\eq}\)). And then \(X=X'\) (in \(M\))
so \(c=f_{\psi}(\bara)=f_{\psi'}(\bara')=c'\)
\end{remark}

\begin{definition}[]
With the above considerations in mind, given \(M\vDash T\) and a definable set \(X\subseteq M^n\), we call
such a \(c\in M^{\eq}\) a \textbf{code} for \(X\)
\end{definition}

\begin{remark}
Any automorphism of \(\fC^{\eq}\) fixes a definable set \(X\) set-wise iff it fixes a code
for \(X\). However, the choice of a code for \(X\) will depend on the formula \(\varphi\) used to define
it
\begin{align*}
\sigma(X)=X&\Leftrightarrow\sigma(X)=\{\sigma(x):\varphi(x,b)\}=\{x:\varphi(x,\sigma(b))\}=\{x:\varphi(x,b)\}=X\\
&\Leftrightarrow\forall x(\varphi(x,b)\leftrightarrow\varphi(x,\sigma(b)))\\
&\Leftrightarrow\psi(b,\sigma(b))\Leftrightarrow f_\psi(b)=f_\psi(\sigma(b))
\end{align*}

We can think of \(\fC^{\eq}\) as adjoining codes for all definable equivalence relations
(as \(c/E'\) codes \(E'(x,c)\) for an arbitrary equivalence relation \(E\))
\end{remark}

\begin{definition}[]
Let \(A\subseteq M\vDash T\). Then \(\acl^{\eq}(A)=\{c\in M^{\eq}:c\in\acl_{M^{\eq}}(A)\}\) and \(\dcl^{\eq}(A)\)
is defined similarly
\end{definition}

\begin{remark}
Suppose \(A\subseteq M\prec N\), then \(\acl_{N^{\eq}}(A),\dcl_{N^{\eq}}(A)\subseteq M^{\eq}\), so this notation is unambiguous
\end{remark}

\begin{lemma}[]
\label{P2.35}
Let \(M\vDash T\), a definable subset \(X\) of \(M^n\), and \(A\subseteq M\). Then \(X\) is
almost \(A\)-definable iff \(X\) is definable in \(M^{\eq}\) by a formula with parameters in \(\acl^{\eq}(A)\)
\end{lemma}

\begin{proof}
We can work in \(\fC\), since \(M\prec\fC\). Let \(c\) be a code for \(X\). From \ref{P2.13} \(X\) is
almost \(A\)-definable iff \(\abs{\{\sigma(X):\sigma\in\Aut(\fC/A)\}}<\omega\) iff \(\abs{\{\sigma(c):\sigma\in\Aut(\fC^{\eq}/A)\}}<\omega\)
(note that \(\sigma\) extends uniquely in \(\fC^{\eq}\)),
that is, \(c\in\acl^{\eq}(A)\).

\begin{align*}
\sigma(b)/E=\sigma'(b)/E&\Leftrightarrow\forall x(\varphi(x,\sigma(b))\leftrightarrow\varphi(x,\sigma'(b)))\\
&\Leftrightarrow\sigma(X)=\sigma'(X)
\end{align*}
\end{proof}

\begin{definition}[]
Let \(\bara,\barb\in\fC\) have length \(n\). Let \(\bara,\barb\) have the same strong type
over \(A\) (written as \(\stp_{\fC}(\bara/A)=\stp_{\fC}(\bara/A)\)) if \(E(\bara,\barb)\) for any
finite equivalence relation (finitely many classes) defined over \(A\)
\end{definition}

\begin{remark}
If \(\varphi(\barx)\) is a formula over \(A\), then it defines an equivalence with two
classes \(E(\barx_1,\barx_2)\) iff \((\varphi(\barx_1)\wedge\varphi(\barx_2))\vee(\neg\varphi(\barx_1)\wedge\neg\varphi(\barx_2))\). Hence strong
types are a refinement of types

Hence for any formula if \(\stp(\bara/A)=\stp(\barb/B)\), at least we have \(\varphi(\bara)\leftrightarrow\varphi(\barb)\)
\end{remark}

\begin{lemma}[]
If \(A=M\prec\fC\), then \(\tp_{\fC}(a/M)\vDash\stp_{\fC}(a/M)\)
\end{lemma}

\wu{
\(\tp_{\fC}(a/M)=\tp_{\fC}(b/M)\Rightarrow\stp_{\fC}(a/M)=\stp_{\fC}(b/M)\)
}

\begin{proof}
Let \(E\) be an equivalence relation with finitely many classes, defined over \(M\),
and \(\barb\) another realization of \(\tp_{\fC}(\bara/M)\), we want to show \(E(a,b)\).
Since \(E\) has only finitely many classes, and \(M\) is a model, there are
representants \(e_1,\dots,e_n\) of each \(E\)-class in \(M\). Hence we must have \(E(a,e_i)\) for
some \(i\), and therefore \(E(b,e_i)\), which yields \(E(a,b)\)
\end{proof}

\begin{lemma}[]
Let \(A\subseteq M\vDash T\), and let \(\bara,\barb\in M\). TFAE
\begin{enumerate}
\item \(\stp(\bara/A)=\stp(\barb/A)\)
\item \(\bara,\barb\) satisfy the same formulas almost \(A\)-definable
\item \(\tp_{\fC}(\bara/\acl^{\eq}(A))=\tp_{\fC}(\barb/\acl^{\eq}(A))\)
\end{enumerate}
\end{lemma}

\begin{proof}
\label{Problem3}

\(3\to 2\). \ref{P2.35}. Suppose \(X=\varphi(\fC,\bard)\) is almost \(A\)-definable,
then \(\bara,\barb\in\varphi(\fC,\bard)\) iff \(\bara,\barb\in\theta(\fC):=\exists\bary(\varphi(\fC,\bary)\wedge\bary/E_\psi=\barc)\)
where \(\barc=\bard/E_\psi\in\acl^{\eq}(A)\).

\(2\to 3\)

\(1\to 2\). Let \(X\) be almost definable over \(A\). We want to show that \(\bara\in X\)
iff \(\barb\in X\).

Since \(X\) is almost definable over \(A\), there is an \(A\)-definable equivalence
relation \(E\) with finitely many classes, and \(\barc_1,\dots,\barc_n\) s.t. for all \(\barx\in M\),
we have \(\barx\in X\) iff \(M\vDash E(\barx,\barc_1)\vee\cdots\vee E(\barx,\barc_n)\). Hence \(E(\bara,\barc_i)\)
for some \(i\), so by assumption \(E(\barb,\barc_i)\).

\(2\to 1\). Let \(E\) be an \(A\)-definable equivalence relation with finitely many classes, we
want to show that \(E(\bara,\barb)\). The set \(X=\{\barx\in M:E(\barx,\bara)\}\) is definable
almost over \(A\). But \(\bara\in X\), so \(\barb\in X\), hence \(E(\bara,\barb)\)
\end{proof}


Here is a note from \href{https://math.berkeley.edu/\~scanlon/225af13lectures/20131810Lec15.pdf}{scanlon}
\begin{definition}[]
An \textbf{imaginary element} of \(\fA\) is a class \(a/E\) where \(a\in A^n\) and \(E\) is a definable
equivalence relation on \(A^n\)
\end{definition}

\begin{definition}[]
\(\fA\) \textbf{eliminates imaginaries} if, for every definable equivalence relation \(E\) on \(A^n\) there
exists definable function \(f:A^n\to A^m\) s.t. for \(x,y\in A^n\) we have
\begin{equation*}
xEy\Leftrightarrow f(x)=f(y)
\end{equation*}
\end{definition}

\begin{remark}
The definition give above is what Hodges calls \textbf{uniform elimination of imaginaries}
\end{remark}

\begin{remark}
If \(\fA\) eliminates imaginaries, then for any definable set \(X\) and definable equivalence
relation \(E\) on \(X\), there is a definable set \(Y\) and a definable bijection \(f:X/E\to Y\).
Of course this is not literally true, we should rather say that there is a definable
map \(f':X\to Y\) s.t. \(f'\) is invariant on the equivalence classes defined by \(E\)
\end{remark}

So elimination of imaginaries is saying that quotients exists in the category of definable sets

\begin{remark}
If \(\fA\) eliminates imaginaries then for any imaginaries element \(a/E=\tila\) there is some
tuple \(\hata\in A^m\) s.t. \(\tila\) and \(\hata\) are \textbf{interdefinable}, i.e. there is a
formula \(\varphi(x,y)\) s.t.
\begin{itemize}
\item \(\fA\vDash\varphi(a,\tila)\)
\item If \(a'Ea\) then \(\fA\vDash\varphi(a',\hata)\)
\item If \(\varphi(b,\hata)\) then \(bEa\)
\item If \(\varphi(a,c)\) then \(c=\hata\)
\end{itemize}


To get the formula \(\varphi\) we use the function \(f\) given by the definition of elimination of
imaginaries and let \(\varphi(x,y):=f(x)=y\)
\end{remark}

Almost conversely, if for every \(\fA'\equiv\fA\) every imaginary in \(\fA'\) is interdefinable with a \textbf{real}
(non-imaginary) tuple then \(\fA\) eliminates imaginaries
\begin{equation*}
\{\forall xy(xEy\leftrightarrow f_E(x)=f_E(y))\mid \forall E\}
\end{equation*}

\begin{examplle}[]
For any structure \(\fA\), every imaginary in \(\fA_A\) is interdefinable with a sequence of real elements
\end{examplle}

\begin{examplle}[]
Let \(\fA=(\N,<,\equiv\mod 2)\). Then \(\fA\) eliminates imaginaries. For example, to eliminate the
``odd/even'' equivalence relation, \(E\), we can define \(f:\N\to\N\) by
\begin{equation*}
f(x)=y\Leftrightarrow xEy\wedge\forall z[xEz\to y<z\vee y=z]
\end{equation*}
\end{examplle}

\begin{definition}[]
\(\fA\) has \textbf{definable choice functions} if for any formula \(\theta(\barx,\bary)\) there is a definable
function \(f(\bary)\) s.t.
\begin{equation*}
\forall\bary\exists\barx[\theta(\barx,\bary)\leftrightarrow\theta(f(\bary),\bary)]
\end{equation*}
(i.e., \(f\) is a skolem function for \(\theta\)) and s.t.
\begin{equation*}
\forall\bary\forall\barz[\forall\barx(\theta(\barx,\bary)\leftrightarrow\theta(\barx,\barz))\to f(\bary)=f(\barz)]
\end{equation*}
\end{definition}

\begin{proof}
If \(\fA\) has definable choice functions then \(\fA\) eliminates imaginaries
\end{proof}

\begin{proof}
Given a definable equivalence relation \(E\) on \(A^n\) let \(f\) be a definable choice function
for \(E(\barx,\bary)\). Since \(E\) is an equivalence relation we have \(\forall\bary E(f(\bary),\bary)\) and
\begin{equation*}
\forall\bary\barz[\bary/E=\barz/E\to f(\bary)=f(\barz)]
\end{equation*}
Thus \(f(\bary)=f(\barz)\Leftrightarrow\bary E\barz\)
\end{proof}

\begin{examplle}[]
We now see that \(\fA=(\N,<,\equiv\mod 2)\)  eliminates imaginaries. Basically since \(\fA\) is well
ordered, we can find a least element to witness membership of definable sets, hence we have
definable functions
\end{examplle}

\begin{examplle}[]
\(\fA=(\N,\equiv\mod 2)\) does not eliminate imaginaries

First note that the only definable subsets of \(\N\) are \(\emptyset,\N,2\N,(2n+1)\N\). This is
because \(\fA\) has an automorphisms which switches \((2n+1)\N\) and \(2\N\)

Now suppose \(f:\N\to\N^m\)  eliminates the equivalence relation \(\equiv\mod 2\), i.e.,
\begin{equation*}
f(x)=f(y)\Leftrightarrow y\equiv 2\mod 2
\end{equation*}
The \(\im(f)\) is definable and has cardinality \(2\). Since there are no definable subsets
of \(\N\) of cardinality 2, we must have \(m>1\). Now let \(\pi:\N^m\to\N\) be a projection.
Then \(\pi(\im(f))\) is a finite nonempty definable subset of \(\N\). But no such set exists
\end{examplle}

\begin{proposition}[]
If \(\fA\) eliminates imaginaries, then \(\fA_A\) eliminates imaginaries
\end{proposition}

\begin{proof}
The idea is that an equivalence relation with parameters can be obtained as a fiber of an
equivalence relation in more variables. Let \(E\subseteq A^n\) be an equivalence relation definable
in \(\fA_A\). Let \(\varphi(x,y;z)\in L\) and \(a\in A^l\) be s.t.
\begin{equation*}
xEy\Leftrightarrow\fA\vDash\varphi(x,y;a)
\end{equation*}
We now define
\begin{equation*}
\psi(x,u,y,v)=
\begin{cases}
u=v\wedge"\varphi\text{ defines an equivalence relation}"&\text{or}\\
u\neq v&\text{or}\\
"\varphi(x,y,v)\text{ does not define an equivalence relation}"
\end{cases}
\end{equation*}
Now \(\psi\) defines an equivalence relation on \(A^{n+l}\). Let \(f:A^{n+l}\to A^m\) eliminate \(\psi\),
then \(f(-,a)\) eliminates \(E\)
\end{proof}

Back to \cite{PillayNoteStability}

\begin{definition}[]
\begin{enumerate}
\item \(T\) has elimination of imaginaries (EI) if for any model \(M\vDash T\) and \(e\in M^{\eq}\), there
is a \(\barc\in M\) s.t. \(e\in\dcl_{M^{\eq}}(\barc)\) and \(\barc\in\dcl_{M^{\eq}}(e)\)
\item \(T\) has weak elimination of imaginaries if, as above, except \(\barc\in\acl_{M^{\eq}}(e)\)
(that is, \(e\in\dcl_{M^{\eq}}(\barc)\) and \(\barc\in\acl_{M^{\eq}}(e)\))
\item \(T\) has geometric elimination of imaginaries if, as above,
except \(e\in\acl_{M^{\eq}(\barc)}\) and \(\barc\in\acl_{M^{\eq}}(e)\)
\end{enumerate}
\end{definition}

Note that in particular, elimination of imaginaries imply the existence of codes for definable sets

\begin{proposition}[]
\label{P2.41}
TFAE
\begin{enumerate}
\item \(T\) has EI
\item For some model \(M\vDash T\), we have that for any \(\emptyset\)-definable equivalence relation \(E\),
there is a partition of \(M^n\) into \(\emptyset\)-definable sets \(Y_1,\dots,Y_r\) and for each \(i=1,\dots,r\)
a \(\emptyset\)-definable \(f_i:Y_i\to M^{k_i}\) where \(k_i\ge 1\) s.t. for each \(i=1,\dots,r\), for
all \(\barb_1,\barb_2\in Y_i\), we have \(E(\barb_1,\barb_2)\) iff \(f_i(\barb_1)=f_i(\barb_2)\)
\item For any model \(M\vDash T\), we have that for any \(\emptyset\)-definable equivalence relation \(E\),
there is a partition of \(M^n\) into \(\emptyset\)-definable sets \(Y_1,\dots,Y_r\) and for each \(i=1,\dots,r\)
a \(\emptyset\)-definable \(f_i:Y_i\to M^{k_i}\) where \(k_i\ge 1\) s.t. for each \(i=1,\dots,r\), for
all \(\barb_1,\barb_2\in Y_i\), we have \(E(\barb_1,\barb_2)\) iff \(f_i(\barb_1)=f_i(\barb_2)\)
\item For any model \(M\vDash T\), and any definable \(X\subseteq M^n\) there is
an \(L\)-formula \(\varphi(\barx,\bary)\) and \(\barb\in M\) s.t. \(X\) is defined by \(\varphi(\barx,\barb)\)
and for all \(\barb'\in M\) if \(X\) is defined by \(\varphi(\barx,\barb')\) then \(\barb=\barb'\).
We call such a \(\barb\) a code for \(X\).
\end{enumerate}
\end{proposition}

\wu{
most typos i've ever seen in a proof
}

\begin{proof}
\(2\Leftrightarrow 3\). Since we concern only \(\emptyset\)-definable relations and functions, if it is true in some
model, then it is true in any model

\(1\to 2\). Let \(\pi_E:S_=^n\to S_E\) the canonical definable quotient map. Let \(e\in S_E\). By
assumption, there is \(k\in\N\) and \(\barc\in\fC^k\) s.t. \(e\) and \(\barc\) are interdefinable. In
other words, there is a formula \(\varphi_e(x,\bary)\) over \(\emptyset\) s.t. \(\varphi_e(e,\barc)\).
Moreover, \(\abs{\varphi_e(\fC,\barc)}=\abs{\varphi_e(e,\fC)}=1\)

Let
\begin{align*}
X_e=\{&\barx\in\fC,\vDash\exists!\bary\varphi_e(\pi_E(\barx),\bary)\\&\wedge\forall z(E(\barx,\barz)\leftrightarrow\\&\quad(\forall y(\varphi_e(\pi_E(\barx),\bary)\leftrightarrow\varphi_e(\pi_E(\barz),\bary)))\}
\end{align*}
This means that \(\varphi_e\) defines a function on \(X_e\), and that this function
separates \(E\)-classes.

Then \(\pi^{-1}(\{e\})\subset X_e\).

Since each \(X_e\) contains \(\pi^{-1}(\{e\})\), we get \(\fC^n=\bigcup_{e\in\pi_E(\fC^n)}X_e\), and by compactness,
there are \(e_1,\dots,e_l\) s.t. \(\fC^n=\bigcup_{i=1}^lX_{e_i}\).
\wu{
As each \(X_e\) is \(\emptyset\)-definable. Let \(\barx\in X_e\Leftrightarrow\theta_e(\barx)\). Then \(\fC^n=\bigcup_eX_e\) means
that \(\vDash\forall\barx\bigvee_e\theta_e(\barx)\) and thus \([\bigvee_e\theta_e]=S_n(\emptyset)=\bigcup_e[\theta_e]\). Then by compactness\ldots{}
\(\vDash\forall\barx(\barx=\barx\leftrightarrow\bigvee_{e}\theta_e(\barx))\)
}
Naively, we can pick \(f_i=\varphi_{e_i}\circ\pi_E\), but \(X_{e_i}\) are not disjoint

However we can consider \(Y_1,\dots,Y_r\) to be the atoms of the boolean algebra generated by the \(X_i\).
These are disjoint, and we can pick, for each \(Y_j\), appropriate \(f_i\), to get the result

\(3\to 4\). Let \(X=\varphi(\fC,\bara)\). Consider the \(\emptyset\)-definable equivalence
relation \(E(\bary,\barz)\Leftrightarrow\forall x(\varphi(\barx,\bary)\leftrightarrow\varphi(\barx,\barz))\). Let \(Y_i\) and \(f_i\) be as in 3
and say \(\bara\in Y_1\), and let \(\barb=f_1(\bara)\).
Then \(\exists\bary(f_1(\bary)=\barb\wedge\varphi(\barx,\bary))\) defines \(X\), call this formula \(\psi\)

We have to show that \(\barb\) is unique. Let \(\barb'\) be
s.t. \(\exists\bary(f_1(\bary)=\barb'\wedge\varphi(\barx,\bary))\) also defines \(X\), and let \(\bara_0\) be as
the \(\bary\) in the formula. Then \(\varphi(x,\bara_0)\) defines \(X\), hence \(\bara_0E\bara\),
which implies \(\barb'=f_1(\bara_0)=f_1(\bara)=\barb\)

\(4\to 1\). Let \(e\in \fC^{\eq}\), then \(e=\pi_E(\bara)\) for some \(\bara\in \fC^n\) and
some \(\emptyset\)-definable equivalence relation \(E\)

The set \(X=\{\barx\in\fC^n\mid\vDash E(\barx,\bara)\}\) has a code \(\barb\in\fC^k\), so
that \(X=\psi(\fC^n,\barb)\). We are going to prove interdefinability of \(e\) and \(\barb\) using
automorphisms of \(\fC\)

First suppose that \(\sigma\in\Aut(\fC)\), and fixes \(e\). We
have \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\bara)\leftrightarrow\psi(\barx,\barb))\). Applying \(\sigma\), we
get \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\bara)\leftrightarrow\psi(\barx,\sigma(\barb)))\). But \(\barb\) is a code
for \(X\), hence \(\barb=\sigma(\barb)\). This implies \(\barb\in\dcl(e)\)

Now suppose \(\sigma\in\Aut(\fC)\) and fixes \(\barb\).
Again \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\bara)\leftrightarrow\psi(\barx,\barb))\)
and \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\sigma(\bara))\leftrightarrow\psi(\barx,\barb))\).
But \(\psi(\bara,\barb)\), \(e=\pi_E(\bara)=\pi_E(\sigma(\bara))=\sigma(e)\). Hence \(e\in\dcl(\barb)\)
\end{proof}

Note that condition 2 is somewhat unsatisfying, as we would like to have a quotient function
for \(E\), that is, \(r=1\)

\begin{proposition}[]
Suppose \(T\) eliminates imaginaries. We get \(r=1\) in condition 2 iff \(\dcl(\emptyset)\) has at least
two elements
\end{proposition}

\begin{proof}
First, suppose that \(r=1\). Consider the equivalence on \(\fC^2\) given by \(E((x,y),(x',y'))\)
iff \(x=y\leftrightarrow x'=y'\). In other words, the \(E\) classes are the diagonal and its complement (only
two). Then \(\pi_E(\fC^2)\) has two elements, and they belong to \(\dcl^{\eq}(\emptyset)\). But because \(T\)
eliminates imaginaries, this implies that there is also two elements in \(\dcl(\emptyset)\) by
Proposition \ref{P2.28}

Second, suppose that \(\dcl(\emptyset)\) contains two constants \(a\) and \(b\). Let \(Y_i,f_i\) be as in
condition 2. Using \(a\) and \(b\),we can find some number \(k\) and functions \(g_i:\fC^{k_i}\to\fC^k\)
s.t. \(g_i(\fC^{k_i})\) are pairwise disjoint. We can check that the \(\emptyset\)-definable
function \(f:\fC^n\to\fC^k\) sending \(y\in Y_i\) to \(g_i(f_i(y))\) has all the required properties
\end{proof}

\begin{remark}
Elimination of imaginaries also makes sense for many sorted theories
\end{remark}

\begin{proposition}[Assume \(T\) 1-sorted]
\(T^{\eq}\) has elimination of imaginaries
\end{proposition}

\begin{proof}
Prove a strong version of 2 in Proposition \ref{P2.41}
\wu{
that is, we don't need to distinguish \(Y_1,\dots,Y_r\) and \(f_1,\dots,f_r\).
}
Let \(E'\) be a \(\emptyset\)-definable
equivalence relation on a sort \(s_E\) in some model \(M^{\eq}\) of \(T^{\eq}\). By Proposition
\ref{P2.28} there is an \(L\)-formula \(\psi(\bary_1,\bary_2)\) (\(\bary_i\) the appropriate length)
s.t. for all \(\bara_1,\bara_2\in M\), \(M\vDash\psi(\bara_1,\bara_2)\)
iff \(M^{\eq}\vDash E'(f_E(\bara_1),f_E(\bara_2))\). So \(\psi(\bary_1,\bary_2)\) is an \(L\)-formula
defining an equivalence relation on \(M^k\) for the suitable length \(k\). Consider the
map \(h\), taking \(e\in S_E\) to \(f_\psi(\bara)\) for any \(\bara\in M^k\) s.t. \(f_E(\bara)=e\) for
any \(\bara\in M^k\) s.t. \(f_E(\bara)=e\). Suppose \(f_E(\bara)=e=f_E(\bara')\), we easily see
that \(f_\psi(\bara)=f_\psi(\bara')\), hence the map \(h\) is well-defined, and satisfies 2 of \ref{P2.41}
\end{proof}

\subsection{Examples and counterexamples}
\label{sec:org630644a}
\begin{examplle}[]
The theory of an infinite set has weak elimination of imaginaries but not full elimination of imaginaries
\end{examplle}

\begin{proof}
\label{Problem4}
First, we show that \(T\) has weak elimination of imaginaries. Let \(M\) be an infinite set and
let \(e\in M^{\eq}\) be an imaginary element. Suppose that. Let \(A\subset M\) be a finite set over
which \(X\) is definable ??. Consider the set
\begin{equation*}
\hatA:=\bigcap_{\substack{\sigma\in\Aut(M)\\\sigma(X)=X}}\sigma(A)
\end{equation*}
Since \(A\) is finite, there are \(\sigma_1,\dots,\sigma_n\) s.t. \(\hatA=\bigcap_i\sigma_i(A)\)

To see that \(T\) does not have full elimination of imaginaries, observe that there is never a
code for any finite set. Indeed, if \(M\) is an infinite set, \(X\subset_fM\), and \(\bara\in M\), we
can find a permutation of \(M\) which fixes \(X\) as a set but does not fix \(\bara\),
meaning \(\bara\) could not be a code for \(X\)
\end{proof}

\begin{examplle}[]
Let \(T=\Th(M,<,\dots)\) where < is a total well-ordering. Then \(T\) has elimination of imaginaries
\end{examplle}

\begin{proof}
Every definable set has a least element. We verify (2) in \ref{P2.41}. Let \(E\) be
a \(\emptyset\)-definable equivalence relation on \(M^n\). Let \(f:M^n\to M^n\) s.t. for
any \(\bara\), \(f(\bara)\) is the least element of the \(E\)-class of \(\bara\). Notice
that \(f\) is \(\emptyset\)-definable, and for all \(\bara,\barb\), \(f(\bara)=f(\barb)\)
iff \(E(\bara,\barb)\)
\end{proof}

\begin{lemma}[]
\label{P2.49}
Let \(T\) be strongly minimal and \(\acl(\emptyset)\) be infinite (in some, any model). Then \(T\) has
weak elimination of imaginaries
\end{lemma}

\begin{proof}
Fix a model \(M\). Let \(e\in M^{\eq}\)
\wu{
Ok, now i think the convention for pillay is that \(e\in M^{\eq}\) is automatically imaginary,
}
so \(e=\bara/E\) for some \(\bara\) and \(E\) some \(\emptyset\)-definable equivalence relation.
Let \(A=\acl_{M^{\eq}}(e)\cap M\). \(A\) is infinite as it contains \(\acl(\emptyset)\). \(A\) is infinite
as it contains \(\acl(\emptyset)\).

We first prove that there exists some \(\barb\subset A\) s.t. \(E(\bara,\barb)\).
Let \(X_1=\{y_1\in M:M\vDash\exists y_2\dots y_n(\bary E\bara)\}\). It is definable over \(e\). If \(X_1\) is finite,
any \(b_1\in X_1\) then belongs to \(A\). Otherwise, \(X_1\) is cofinite, hence meets the infinite
set \(A\). Either way, \(X_1\cap A\neq\emptyset\) and we have \(b_1\in X_1\cap A\)

Now let \(X_2=\{y_2\in M:M\vDash\exists y_3\dots y_n(b_1\bary E\bara)\}\). We remark \(X_2\neq\emptyset\) since \(b_1\in X_1\).
Now \(X_2\) is either finite or cofinite since \(T\) is strongly minimal. By the same argument
above, we may find \(b_2\in X_2\cap A\). Then repeating this process, we may find \(\barb\subset A\).
Therefore \(\barb\in\acl_{M^{\eq}}(e)\).

Finally notice that \(e\in\dcl_{M^{\eq}}(\barb)\) since \(\bara/E=\barb/E=e\)
\end{proof}

\begin{examplle}[]
The theory \(\ACF_p\) has elimination of imaginaries, for any \(p\)
\end{examplle}

\begin{proof}
By Lemma \ref{P2.49}, \(\ACF_p\) has weak elimination of imaginaries. Therefore it suffices to
show that every finite set can be coded. Let \(K\) be an algebraically closed field and
let \(X=\{c_1,\dots,c_n\}\subseteq K\). Consider the polynomial
\begin{align*}
P(x)&=\prod_{i=1}^n(x-c_i)\\
&=x^n+e_{n-1}x^{n-1}+\dots+e_1x+e_0
\end{align*}
Then we may take the tuple \(\bare=(e_n,\dots,e_0)\) to be our code for \(X\).
\end{proof}

\section{Stability}
\label{sec:org683a875}
Thoughout this chapter we will fix a complete theory \(T\) in some language \(L\). Moreover, we
will have no problem in working in \(T^{\eq}\) (that is to say, to assume \(T=T^{\eq}\))

For a given theory \(T\), the spectrum functions is given as
\begin{gather*}
I(T,-):Card\to Card\\
I(T,\lambda)=\#\text{ of models of \(T\) or cardinality $\lambda$ (up to isomorphism)}
\end{gather*}

\subsection{Local Stability}
\label{sec:org2f1f951}
\begin{definition}[]
\begin{enumerate}
\item Let \(M\vDash T\). We say \(\varphi(\barx,\bary)\) is \textbf{stable in \(M\)} if it is \textbf{not} the case that there
are \(\bara_i,\barb_i\in M\), for \(i<\omega\), s.t. \textbf{either} for all \(i,j<\omega\), \(M\vDash\varphi(\bara_i,\barb_j)\)
iff \(i\le j\), \textbf{or}, for all \(i,j<\omega\), \(M\vDash\neg\varphi(\bara_i,\barb_j)\) iff \(i\le j\)
\item \(\varphi(\barx,\bary)\) is \textbf{stable} (for \(T\)) if it is stable in \(M\) for all \(M\vDash T\)
\item \(T\) is \textbf{stable} if every \(L\)-formula \(\varphi(\barx,\bary)\) is stable (for \(T\))
\end{enumerate}
\end{definition}

\begin{remark}
A formula \(\varphi(\barx,\bary)\) is stable for \(T\) iff it is not the case that there
are \(\bara_i,\barb_i\in\fC\), for \(i<\omega\), s.t. \(\fC\vDash\varphi(\bara_i,\barb_i)\) iff \(i\le j\) for all \(i,j<\omega\)
\end{remark}

For simplicity, from now onwards we will write tuples simply as \(x\) and \(a\).

\begin{lemma}[]
\begin{enumerate}
\item Suppose \(\varphi(x,y)\) and \(\psi(x,z)\) are stable for \(T\). Then \(\neg\varphi(x,y)\), \((\varphi\vee\psi)(x,yz)\)
and \((\varphi\wedge\psi)(x,yz)\) are also stable
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Enrich the language \(L\) with the tuples of constant symbols \(\barc_i,\bard_i\), \(i\in\omega\), and
consider \(\Sigma=T\cup\{\neg\varphi(\barc_i,\bard_j):i\le j\}\cup\{\varphi(\barc_i,\bard_j):i>j\}\) of formulas in the new
language. For \(\Sigma'\subset_f\Sigma\), let \(n\) be the largest index.
\end{enumerate}
\end{proof}

\section{{\bfseries\sffamily TODO} Problems}
\label{sec:orga564fe2}
\begin{center}
\begin{tabular}{llll}
 & \ref{Problem2} & \ref{Problem3} & \ref{Problem4}\\
 &  & \\
\end{tabular}
\end{center}

\section{Index}
\label{sec:org28aa420}

This is a functional link that will open a buffer of clickable index entries:

\renewcommand{\indexname}{}
\printindex

\section{References}
\label{sec:orgf2844ea}

\label{bibliographystyle link}
\bibliographystyle{unsrtnat}

\label{bibliography link}
\bibliography{../references}
\end{document}
