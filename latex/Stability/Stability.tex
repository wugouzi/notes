% Created 2022-02-21 Mon 11:01
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\graphicspath{{../../books/}}
\input{../preamble.tex}
\makeindex
\DeclareMathOperator{\GP}{\tf{GP}}
\author{Qi'ao Chen}
\date{\today}
\title{Stability}
\hypersetup{
 pdfauthor={Qi'ao Chen},
 pdftitle={Stability},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 28.0.90 (Org mode 9.6)}, 
 pdflang={English}}
\begin{document}

\maketitle
\tableofcontents


\section{Preface}
\label{sec:orgf4e9f1a}
A combination of various notes from \cite{PillayNoteStability} \cite{ChernNoteStability}
\cite{tent2012course} \cite{DriesNoteStability}

A monster model \(\fC\)

\cite{PillayNoteStability} has many typos\emoji{ðŸ˜…}
\section{Preliminaries}
\label{sec:org1064ff0}
\subsection{Indiscernibles}
\label{sec:org5e538c9}
\begin{definition}[]
Let \(I\) be a linear order and \(\fA\) an \(L\)-structure. A family \((a_i)_{i\in I}\) of elements
of \(A\) is called a \textbf{sequence of indiscernibles}  if for all \(L\)-formulas \(\varphi(x_1,\dots,x_n)\) and
all \(i_1<\dots<i_n\) and \(j_1<\dots<j_n\) from \(I\)
\begin{equation*}
\fA\vDash\varphi(a_{i_1},\dots,a_{i_n})\leftrightarrow\varphi(a_{j_1},\dots,a_{j_n})
\end{equation*}
or
\begin{equation*}
\tp(a_{i_1},\dots,a_{i_n})=\tp(a_{j_1},\dots,a_{j_n})
\end{equation*}
\end{definition}

\begin{theorem}[]
Compactness let us ``stretch'' indiscernibles. Let \((a_i:i\in\omega)\) be indiscernibles in \(\fC\),
and \((I,<)\) an ordering. Then there exists an indiscernible \((b_i:i\in I)\) in \(\fC\)
s.t. \(\forall i_1<\dots<i_n\in I\)
\begin{equation*}
\tp(a_1,\dots,a_n)=\tp(b_{i_1},\dots,b_{i_n})
\end{equation*}
\end{theorem}

Indiscernible sequence are a fundamental tool of model theory, and there are many ways to obtain
them.

\begin{theorem}[Ramsey, extended]
Let \(n_1,\dots,n_r<\omega\). For each \(i=1,\dots,r\), let \(X_{i,1}\), \(X_{i,2}\) be a partition
of \([\omega]^{n_i}\). Then there is an infinite subset \(Y\subseteq\omega\) which is homogeneous,
i.e., \(\forall i=1,\dots,r\), either \([Y]^{n_i}\subseteq X_{i,1}\) or \([Y]^{n_i}\subseteq Y_{i,2}\)
\end{theorem}

\begin{proposition}[]
For each \(n\in\omega\), let \(\Sigma_n(x_1,\dots,x_n)\) be a collection of \(L\)-formulas in
variables \(x_1,\dots,x_n\). Suppose that there are \(a_1,a_2,\dots\in\fC\) s.t.
\begin{equation*}
\vDash\Sigma_n(a_{i_1},\dots,a_{i_n}),\quad\forall i_1<\dots<i_n<\omega
\end{equation*}
Then there is an indiscernible \((b_i:i\in\omega)\) in \(\fC\) s.t.
\begin{equation*}
\vDash\Sigma_n(b_{i_1},\dots,b_{i_n}),\quad\forall i_1<\dots<i_n<\omega
\end{equation*}
\end{proposition}

\wu{
we can expand \(\bigcup_{n\in\omega}\Sigma_n\) and obtain the Ehrenfeucht-Mostowski type \(\EM((a_i)_{i\in\omega})\).
This is just the Standard Lemma in Tent
}

\begin{examplle}[]
Suppose \(\Sigma_2=\{x_1\neq x_2\}\). Then the proposition yields the existence of infinite indiscernible sequences
\end{examplle}

\begin{proof}
Consider
\begin{align*}
\Gamma(x_1,x_2,\dots)&=\{\varphi(x_{i_1},\dots,x_{i_n})\leftrightarrow\varphi(x_{j_1},\dots,x_{j_n}):\\
&\quad i_1<\dots<i_n,j_1<\dots<j_n\in\omega,\varphi\in L\}\\
&\cup\bigcup_n\Sigma(x_1,\dots,x_n)
\end{align*}
Let \(\Gamma'(x_1,\dots,x_n)\subseteq_f\Gamma\). Let \(\varphi_1,\dots,\varphi_r\) be the \(L\)-formulas appearing in \(\Gamma'\).
For \(i=1,\dots,r\), let
\begin{align*}
&X_{i,1}=\{(j_1,\dots,j_n):j_1<\dots<j_n\in\omega,\vDash\varphi_i(a_{j_1},\dots,a_{j_n})\}\\
&X_{i,2}=\{(j_1,\dots,j_n):j_1<\dots<j_n\in\omega,\vDash\neg\varphi_i(a_{j_1},\dots,a_{j_n})\}
\end{align*}
By Ramsey's theorem, there exists an infinite \(Y\subseteq\N\) s.t. \(\forall i=1,\dots,r\), \([Y]^{n_i}\) is either
contained in \(X_{i,1}\) or in \(X_{i,2}\). Write \(Y=\{k_1<k_2<\dots\}\). Interpret each \(x_i\)
as \(a_{k_i}\) to satisfy \(\Gamma'\)
\end{proof}

\begin{definition}[]
Let \(M\prec N\prec\fC\) be models, and \(p(\barx)\in S_{\barx}(N)\). We say \(p\) is finitely satisfiable
in \(M\), or \(p(\barx)\) is a \textbf{coheir} of \(p\uhr M\in S_{\barx}(M)\), if
every \(\varphi(\barx)\in p(\barx)\) is satisfied by some \(\bara\in M\)
\end{definition}

\begin{remark}
\(p(\barx)\in S_n(N)\) is finitely satisfiable (f.s.) in \(M\) iff \(p(\barx)\) is in the
topological closure of \(\{\tp(\bara/N):\bara\in M\}\subseteq S_n(N)\)
\end{remark}

\begin{lemma}[]
\label{P2.8}
Suppose \(p(\barx)\in S_{\barx}(M)\) and \(M\prec N\), then there is \(p'(\barx)\in S_{\barx}(N)\)
s.t. \(p\subseteq p'\) and \(p'\) is f.s. in \(M\)
\end{lemma}

\begin{proof}
Consider \(\Gamma(\barx)=p(\barx)\cup\{\neg\varphi(\barx):\varphi(\barx)\in L_N\text{ and not realized in }M\}\). Let
\(\Gamma\supseteq_f\Gamma'=\{\Psi(\barx),\neg\varphi_1(\barx),\dots,\neg\varphi_r(\barx)\}\in p\). Then any solution \(\bara\) of \(\Psi\) in \(M\)
satisfies \(\Gamma'\) as \(M\vDash\forall\barx(\neg\varphi_i(\barx))\)
\end{proof}

\begin{remark}
Let \(i_M:M^{\barx}\to S_{\barx}(M)\) s.t. \(m\mapsto\tp(m/M)\). Define \(i_N:M^{\barx}\to S_{\barx}(N)\)
similarly. Let \(r:S_{\barx}(N)\to S_{\barx}(M)\). Note that \(r\circ i_N=i_M\) and the set of types
in \(S_{\barx}(N)\) that are f.s. in \(M\) is exactly the closure of \(i_N(M^{\barx})\)
in \(S_{\barx}(N)\). Hence its image under \(r\) is closed. However the image must
contain \(i_M(M^{\barx})\) which is dense in \(S_{\barx}(M)\). Therefore it must be onto, which
proves the desired result

\wu{
\(r\) is continuous and \(r(\bbar{i_N(M^n)})\supseteq i_M(M^n)\) is closed. \(\bbar{i_M(M^n)}=S_n(M)\).
Then \(r\) is onto? Then its preimage of \(p\) is what we want \label{Problem2}
}
\end{remark}

\begin{proposition}[]
Let \(p(\barx)\in S_{\barx}(M)\), \(N\succ M\) be \(\abs{M}^+\)-saturated,
and \(p'(\barx)\in S_{\barx}(N)\) a coheir of \(p\). Let \(\bara_1,\bara_2,\dots\in N\) be defined as
follows
\begin{align*}
&\bara_1\text{ realises }p(\barx)\\
&\bara_2\text{ realises }p'(\barx)\uhr(M,\bara_1)\\
&\bara_3\text{ realises }p'(\barx)\uhr(M,\bara_1,\bara_2)\\
&\cdots
\end{align*}
Then \((\bara_i:i\in\omega)\) is indiscernible over \(M\)
\end{proposition}

\begin{proof}
We prove by induction on \(k\) that for any \(n\le k\) and \(i_1<\cdots<i_n\le k\) and \(j_1<\cdots<j_n\le k\), we
have
\begin{equation*}
\tp_M(\bara_{i_1},\dots,\bara_{i_n}/M)=\tp_M(\bara_{j_1},\dots,\bara_{j_n}/M)
\end{equation*}
Assume this is true for \(k\) and consider \(k+1\). Let \(i_1<\cdots<i_n\le k\), \(j_1<\cdots<j_n\le k\). We
need to show that
\begin{equation*}
\tp_M(\bara_{i_1},\dots,\bara_{i_n},\bara_{k+1}/M)=\tp_M(\bara_{j_1},\dots,\bara_{j_n},\bara_{k+1}/M)
\end{equation*}
Consider a formula \(\varphi(\barx_1,\dots,\barx_n,\barx_{n+1})\in L_M\). Assume by contradiction that
\begin{equation*}
M\vDash\varphi(\bara_{i_1},\cdots,\bara_{i_{n}},\bara_{k+1})\wedge\neg\varphi(\bara_{j_1},\cdots,\bara_{j_{n}},\bara_{k+1})
\end{equation*}
But \(\tp(\bara_{k+1}/M,\bara_1,\dots,\bara_k)\) is f.s. in \(M\), so there is \(\bara'\in M\) s.t.
\begin{equation*}
M\vDash\varphi(\bara_{i_1},\cdots,\bara_{i_{n}},\bara')\wedge\neg\varphi(\bara_{j_1},\cdots,\bara_{j_{n}},\bara')
\end{equation*}
contradicting IH
\end{proof}

\subsection{Definability and Generalizations}
\label{sec:orgade066b}
\begin{definition}[]
\(X\subseteq\fC^n\) is \textbf{definable almost over} \(A\) if there is an \(A\)-definable equivalence
relation \(E\) on \(\fC^n\) with finitely many classes and \(X\) is a union of some \(E\)-classes
\end{definition}

\begin{lemma}[]
\label{P2.11}
\label{C1.2.6}
Let \(\D\) be a definable class and \(A\) a set of parameters. T.F.A.E.
\begin{enumerate}
\item \(\D\) is definable over \(A\)
\item \(\D\) is invariant under all automorphisms of \(\fC\) which fix \(A\) pointwise
\end{enumerate}
\end{lemma}

\(S\subseteq K^{\alg}\Rightarrow M\setminus S\subseteq K^{\alg}\)

\begin{proof}
\(\Rightarrow\) is easy as for any \(F\in\Aut(\fC/A)\) and \(\D=\varphi(\fC,\bara)\), \(\fC\vDash\varphi(\bars,\bara)\)
iff \(\fC\vDash\varphi(F(\bars),\bara)\). \href{https://math.stackexchange.com/questions/3361635/when-are-automorphism-invariant-subsets-definable}{StackExchange}

\(x\in\D\Leftrightarrow\vDash\varphi(x,\bara)\Leftrightarrow\varphi(F(x),F(\bara))\leftrightarrow\varphi(F(x),\bara)\Leftrightarrow F(x)\in\D\)

\(\Leftarrow\). Another proof from Chernikov. Assume that \(\D=\varphi(\fC,b)\) where \(b\in\fC\), and
let \(p(y)=\tp(b/A)\)

\textbf{Claim 1}. \(p(y)\vdash\forall x(\varphi(x,y)\leftrightarrow\varphi(x,b))\), which says that for any realisations \(b'\), \(\varphi(\fC,b)=\varphi(\fC,b')\)

Indeed, let \(b'\vDash p(y)\) be arbitrary. Then \(\tp(b/A)=\tp(b'/A)\) so there is
some \(\sigma\in\Aut(\fC/A)\) with \(\sigma(b)=b'\). Then \(\sigma(X)=\varphi(\fC,b')\) and by assumption \(\sigma(X)=X\),
thus \(\varphi(\fC,b)=X=\varphi(\fC,b')\).

There is some \(\psi(y)\in p\) (there is a finite subset of \(p(y)\) that does the job and we take
the conjunction) s.t.
\begin{equation*}
\psi(y)\vDash\forall x(\varphi(x,y)\leftrightarrow\varphi(x,b))
\end{equation*}
Let \(\theta(x)\) be the formula \(\exists y(\psi(y)\wedge\varphi(x,y))\). Note that \(\theta(x)\) is an \(L(A)\)-formula,
as \(\psi(y)\) is

\textbf{Claim 2}. \(X=\theta(\fC)\)

If \(a\in X\), then \(\vDash\varphi(a,b)\), and as \(\psi(y)\in\tp(b/A)\) we have \(\vDash\theta(a)\). Conversely,
if \(\vDash\theta(a)\), let \(b'\) be s.t. \(\vDash\psi(b')\wedge\varphi(a,b')\). But by the choice of \(\psi\) this implies that \(\vDash\varphi(a,b)\)

\(\Leftarrow\) Let \(\D\) be defined by \(\varphi\), defined over \(B\supset A\). Consider the maps
\begin{equation*}
\fC\xrightarrow{\tau}S(B)\xrightarrow{\pi}S(A)
\end{equation*}
where \(\tau(c)=\tp(c/B)\) and \(\pi\) is the restriction map. Let \(Y\) be the image of \(\D\)
in \(S(A)\). Since \(Y=\pi[\varphi]\). \(Y\) is closed.
\wu{
Note that \(\tau(\D)=[\varphi]\). \(\tau(\D)=\{\tp(c/B):\fC\vDash\varphi(c)\}\subseteq[\varphi]\). For any \(q(x)\in[\varphi]\), as \(\fC\) is
saturated, \(\fC\vDash q(d)\) and \(d\in\D\). Thus \(q\in\tau(\D)\). \(\pi\) is continuous
}


Assume that \(\D\) is invariant under all automorphisms of \(\fC\) which fix \(A\) pointwise. Since
elements which have the same type over \(A\) are conjugate by an automorphism of \(\fC\), this
means that \(\D\)-membership depends only on the type over \(A\), i.e., \(\D=(\pi\tau)^{-1}(Y)\).
\wu{
For any \(\tp(c/A)=\tp(d/A)\) and \(c\in\D\), as \(c\) and \(d\) are conjugate, \(d\in\D\).

For any \(c\notin\D\), \(\pi\tau(c)\in Y\) iff \(\tp(c/A)\in\pi[\varphi]\) iff there is \(d\in\D\)
s.t. \(\tp(c/A)=\tp(d/A)\) but then \(c\in\D\).
}

This implies that \([\varphi]=\pi^{-1}(Y)\)
\wu{
\(\tau(\D)=[\varphi]=\tau(\tau^{-1}\pi^{-1})(Y)=\pi^{-1}(Y)\)
}
, or \(S(A)\setminus Y=\pi[\neg\varphi]\); hence \(S(A)\setminus Y\) is also closed and
we conclude that \(Y\) is clopen. By Lemma \ref{lemma4.2.3} \(Y=[\psi]\) for some \(L(A)\)-formula \(\psi\).
This \(\psi\) defines \(\D\).
\wu{
For any \(d\in\fC\)
\begin{equation*}
\vDash\psi(d)\Leftrightarrow\tp(d/A)\Leftrightarrow d\in\D
\end{equation*}
}
\end{proof}


A slight generalization of the previous lemma
\begin{lemma}[]
\label{P2.13}
Let \(X\subseteq\fC^n\) be definable. TFAE
\begin{enumerate}
\item \(X\) is almost \(A\)-definable, i.e., there is an \(A\)-definable equivalence relation \(E\)
on \(\fC^n\) with finitely many classes, s.t. \(X\) is a union of \(E\)-classes
\item The set \(\{\sigma(X):\sigma\in\Aut(\fC/A)\}\) is finite
\item The set \(\{\sigma(X):\sigma\in\Aut(\fC/A)\}\) is small
\end{enumerate}
\end{lemma}

\begin{proof}
\(1\to 2\). Let \(\varphi(x_1,x_2)\in L(A)\) be the \(A\)-definable equivalence relation \(E\), and
let \(b_1,\dots,b_n\in M\) be representatives in each equivalence class so that each class can be
written as \([b_i]=\varphi(\fC,b_i)\). Given \(\sigma\in\Aut(\fC/A)\), since \(\varphi(x_1,x_2)\leftrightarrow\varphi(\sigma(x_1),\sigma(x_2))\), the image
of each \([b_i]\) under \(\sigma\) will be
\begin{equation*}
\sigma([b_i])=\{\sigma(x):\varphi(x,b_i)\}=\{x':\varphi(x',\sigma(b_i))\}=\{x:\varphi(x,b_{j_i})\}=[b_{j_1}]
\end{equation*}
for some \(j_i\le n\). Now \(X\) is a disjoint union of some \([b_i]\)'s, so \(\sigma(X)\) is a disjoint
union of some \([b_j]\)'s. Since there are only finitely many equivalence classes, there can
only be finitely many possibilities for disjoint unions of these classes

\(2\to 1\). Let \(X=\varphi(\fC,b)\) and \(p(y)=\tp(b/A)\). Given \(\sigma\in\Aut(\fC/A)\), we
have \(\sigma(X)=\varphi(\fC,\sigma(b))\). Then from assumption, there must be distinct \(b_1,\dots,b_n\) s.t.
\begin{equation*}
\{\sigma(X):\sigma\in\Aut(\fC/A)\}=\{\varphi(\fC,b_i):i\le n\}
\end{equation*}
Now if \(\tp(b'/A)=\tp(b/A)\), then strong homogeneity yields some \(\sigma\in\Aut(\fC/A)\)
s.t. \(\sigma(b)=b'\). Then the above argument again shows that \(\varphi(x,b')\) defines \(\sigma(X)\) for
some \(\sigma\in\Aut(\fC/A)\). Thus \(\sigma(X)=\varphi(\fC,b')=\varphi(\fC,b_i)\) for some \(i\le k\). Therefore
\(p(y)\vdash\bigvee_{i\le k}\forall x(\phi(x,y)\leftrightarrow\phi(x,b_i))\). By compactness there is
some \(\psi(y)\in p\) s.t. \(\psi(y)\vdash\bigvee_{i\le k}\forall x(\phi(x,y)\leftrightarrow\phi(x,b_i))\). Now define \(E(x_1,x_2)\) as
\begin{equation*}
\forall y(\psi(y)\to(\phi(x_1,y)\leftrightarrow\phi(x_2,y)))
\end{equation*}
so it is \(A\)-definable. It is easy to check that \(E\) is an equivalence relation with
finitely many classes, and that \(X\) is a union of \(E\)-classes (\(a_1Ea_2\) iff they agree on
\(\phi(x,b_i)\) for all \(i\le k\), and so \(X=\phi(\fC,b_0)\) is given by the union of all possible
combinations intersected with it)

\(3\to 1\) Assume for contradiction that
\begin{equation*}
\abs{\{\sigma(X):\sigma\in\Aut(\fC/A)\}}=\lambda\ge\omega
\end{equation*}
we can find \(\lambda\)-many elements \((b_i:i<\lambda)\subset\fC\) to represent the distinct images under automorphisms.
Then the set
\begin{equation*}
q(y)=p(y)\cup\{\neg\forall x(\varphi(x,y)\leftrightarrow\varphi(x,b_i)):i<\lambda\}
\end{equation*}
will be finitely satisfiable. Thus \(q(y)\) is realised by some \(b'\). But such \(b'\) has the
same type as \(b\) over \(A\) and so strong homogeneity yields some \(\sigma\in\Aut(\fC/A)\)
s.t. \(\sigma(b)=b'\). Applying such \(\sigma\) on \(X\) gives the image \(\varphi(\fC,b')=\varphi(\fC,b_i)\) for some \(i<\lambda\),
a contradiction
\end{proof}

\begin{proposition}[]
We can identify definable sets with continuous functions in a certain settings
\begin{enumerate}
\item Formulas \(\varphi(\barx),\psi(\barx)\in L_A\) are equivalent iff \([\varphi(\barx)]=[\psi(\barx)]\)
\item The clopen subsets of \(S_{\barx}(A)\) are precisely the basic clopen sets
\setcounter{enumi}{2}
\item Clopen subsets \(X\) of \(S_{\barx}(A)\) correspond exactly to continuous
functions \(f:S_{\barx}(A)\to 2\) (with discrete topology) where \(f(p(\barx))=1\) if \(p(\barx)\in X\) and 0 otherwise
\item The definable subsets of \(\fC^c\) are in one-to-one correspondence with continuous functions
from \(S_{\barx}(A)\) to 2
\end{enumerate}
\end{proposition}

\begin{proof}
\begin{enumerate}
\setcounter{enumi}{2}
\item If \(X\) is clopen, then \(f^{-1}(2)=S_{\barx}(A)\), \(f^{-1}(0)=\emptyset\), \(f^{-1}(\{1\})=X\), \(f^{-1}(\{0\})=X^c\)
\item By 1, definable sets are in one-to-one correspondence with basic clopen subsets. By 2, basic
clopen sets are exactly all of the clopen subsets, so definable sets are in one-to-one
correspondence with clopen sets. By 3, clopen sets are in one-to-one correspondence with
continuous functions \(f:S_{\barx}(A)\to 2\)
\end{enumerate}
\end{proof}


\subsection{Imaginaries and \texorpdfstring{\(T^{\eq}\)}{Teq}}
\label{sec:orgf4d8f51}

A \textbf{multi-sorted} structure is a family of sets \((M_s)_{s\in S}\) equipped with relations
\begin{equation*}
R\subseteq M_{s_1}\times\cdots\times M_{s_m},\quad(s_1,\dots,s_m\in S)
\end{equation*}
A multi-sorted language \(L\) is a  triple \((S,L^r,L^f)\) and \(S\) are the sorts of \(L\)

\(M_s\) is the underlying set of sort \(s\). Elements of \(M_s\) are also called ``elements
of \(\calm\)'' of sort \(s\) Given any tuple \(\bars=(s_i)_{i\in I}\) of sorts in \(S\), we
let \(M_{\bars}=\prod_{i\in I}M_{s_i}\)

Given a variable \(x=(x_i)_{i\in I}\) of \(L\), with \(x_i\) of sorts \(s_i\) for \(i\in I\), we define
the \textbf{\(x\)-set of} \(\calm\) to be the product set
\begin{equation*}
M_x:=M_{\bars}=\prod_iM_{s_i},\quad \bars=(s_i)_{i\in I}
\end{equation*}
\(x=(x_i)_{i\in I}\) and \(y=(y_j)_{j\in J}\) is \textbf{disjoint} if \(x_i\neq y_j\) for all \(i\in I\)
and \(j\in J\), and in that case we put \(M_{x,y}=M_x\times M_y\). If in addition \(I=J\) and \(x_i\)
and \(y_i\) have the same sort for \(i\in I\) (so that \(M_x=M_y\)), we call \(x\) and \(y\)
\textbf{disjoint and similar}

\begin{definition}[]
The \textbf{definable closure} \(\dcl(A)\) of \(A\) is the set of elements \(c\) for which there is
an \(L(A)\)-formula \(\varphi(x)\) s.t. \(c\) is the unique element satisfying \(\varphi\). Elements or
tuples \(a\) and \(b\) are said to be \textbf{interdefinable} if \(a\in\dcl(b)\) and \(b\in\dcl(a)\).
\end{definition}

\begin{lemma}[]
Assume \(A\subseteq\fC\) and \(\barb\in\fC\)
\begin{enumerate}
\item \(\barb\in\acl(A)\) iff \(\{f(\barb):f\in\Aut(\fC/A)\}\) is finite
\item \(\barb\in\dcl(A)\) iff \(f(\barb)=\barb\) for all \(f\in\Aut(\fC/A)\)
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Suppose \(\barb\in\acl(A)\) with witness \(\exists^{\le k}\varphi(\barx)\). Then \(\varphi(\fC)\) is \(A\)-definable
and hence is \(\Aut(\fC/A)\)-invariant by Lemma \ref{P2.11}

Suppose the finiteness. Since the composition of automorphisms is an automorphism, this set
is \(\Aut(\fC/A)\)-invariant and therefore \(A\)-definable by some \(\varphi(\barx)\).

\item \(\{\barb\}\) is \(\Aut(\fC/A)\)-invariant
\end{enumerate}
\end{proof}

The first motivation to develop \(T^{\eq}\) is dealing with quotient objects, without leaving
the context of first order logic. That is, if \(E\) is some definable equivalence relation on
some definable set \(X\), we want to view \(X/E\) as a definable set

We work in the setting of multi-sorted languages. Let \(L\) be a 1-sorted language and let \(T\)
be a (complete) \(L\)-theory. We shall build a many-sorted
language \(L^{\eq}\)-theory \(T^{\eq}\). We will ensure that in natural sense, \(L^{\eq}\)
contains \(L\) and \(T^{\eq}\) contains \(T\)

First we define \(L^{\eq}\). Consider the set \(L\)-formula \(\varphi(x,y)\), up to equivalence, such
that \(T\) models that \(\varphi\) is an equivalence relation. For each \(\varphi\), define \(s_\varphi\) to be a new sort
in \(L^{\eq}\). Of particular importance is \(s_=\), the sort given by the formula ``\(x=y\)''.
\wu{
= is an equivalence relation
}
This sort \(s_=\) will yield, in each model of \(T^{\eq}\), a model of \(T\)

Also define \(f_\varphi\) to be a function symbol with domain sort \(s^n_=\) (where \(\varphi\) has \(n\) free
variables) and codomain sort \(s_\varphi\)

For each \(m\)-place relation symbol \(R\in L\), make \(R^{\eq}\) an \(m\)-place relation symbol
in \(L^{\eq}\) on \(s_=^m\). Likewise for all constant and function symbols in \(L\). Finally, for
the sake of formality, we put a unique equality symbol \(=_\varphi\) on each sort

\begin{remark}
Let \(N\) be an \(L^{\eq}\) structure. Then \(N\) has interpretations \(s_\varphi(N)\) of each
sort \(s_\varphi\) and \(f_\varphi(N):s_=(N)^{n_{f_\varphi}}\to s_\varphi(N)\) of each function symbol \(f_\varphi\).
Additionally, \(N\) will contain an \(L\)-structure consisting of \(s_=\) and interpretations of
the symbols of \(L\) inside of \(s_=\)
\end{remark}

\begin{definition}[]
\(T^{\eq}\) is the \(L^{\eq}\)-theory which is axiomatised by the following
\begin{enumerate}
\item \(T\), where the quantifiers in the formulas of \(T\) now range over the sort \(s_=\)
\item For each suitable \(L\)-formula \(\varphi(x,y)\), the axiom \(\forall_{s_=}\barx\forall_{s_=}\bary(\varphi(x,y)\leftrightarrow f_\varphi(\barx)=f_\varphi(\bary))\)
\item For each \(L\)-formula \(\varphi\), the axiom \(\forall_{s_\varphi}y\exists_{s_=}\barx(f_\varphi(\barx)=y)\)
\end{enumerate}
\end{definition}

Axioms 2 and 3 simply state that \(f_\varphi\) is the quotient function for the equivalence relation
given by \(\varphi\)

\begin{definition}[]
Let \(M\vDash T\). Then \(M^{\eq}\) is the \(L^{\eq}\) structure s.t. \(s_=(M^{\eq})=M\) and for each
suitable \(L\)-formula \(\varphi(x,y)\) of \(n\) variables, the sort \(s_\varphi(M^{\eq})\) is equal
to \(M^{n_{f_\varphi}}/E\) where \(E\) is the equivalence relation defined by \(\varphi(x,y)\) and \(f_\varphi(M^{\eq})(b)=b/E\)
\end{definition}

\begin{examplle}[Projective planes]
From Hodges.

Suppose \(A\) is a three-dimensional vector space over a finite field, and let \(L\) be the
first-order language of \(A\). Then we can write a formula \(\theta(x,y)\) of \(L\) which expresses
'vectors \(x\) and \(y\) are non-zero and are linearly dependent on each other'. The formula
\(\theta\) is an equivalence formula of \(A\), and the sort \(s_\theta\) is the set of points of the
projective plane \(P\) associated with \(A\)
\end{examplle}

Now \(M^{\eq}\vDash T^{\eq}\). Moreover, passing from \(T\) to \(T^{\eq}\) is a canonical operation,
in the following sense
\begin{lemma}[]
\begin{enumerate}
\item For any \(N\vDash T^{\eq}\), there is an \(M\vDash T\) s.t. \(N\cong M^{\eq}\)
\item Suppose \(M,N\vDash T\) are isomorphic, and let \(h:M\cong N\). Then \(h\) extends uniquely
to \(h^{\eq}:M^{\eq}\cong N^{\eq}\)
\item \(T^{\eq}\) is a complete \(L^{\eq}\)-theory
\item Suppose \(M,N\vDash T\) and let \(\bara\in M\), \(\barb\in N\) with \(\tp_M(\bara)=\tp_N(\barb)\).
Then \(\tp_{M^{\eq}}(\bara)=\tp_{N^{\eq}}(\barb)\)
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Take \(M=s_=(N)\)
\item Let \(h^{\eq}:M^{\eq}\to N^{\eq}\) be defined
as \(h^{\eq}(f_\varphi(M^{\eq})(b))=f_\varphi(N^{\eq})(h(b))\) for each \(\varphi\in L\). This defines a function
on \(M^{\eq}\), because \(f_\varphi(M^{\eq})\) is surjective by the \(T^{\eq}\) axioms.
Moreover \(h^{\eq}\) is well-defined. Suppose \(f_\varphi(M^{\eq})(b)=f_\varphi(M^{\eq})(b')\),
then \(\varphi(b,b')\) and hence \(\varphi(h(b),h(b'))\),
therefore \(f_\varphi(N^{\eq})(h(b))=f_\varphi(N^{\eq})(h(b'))\). Injectivity is the same
since \(\varphi(b,b')\leftrightarrow\varphi(h(b),h(b'))\).
\begin{align*}
f_\varphi(N^{\eq})(h(b))=f_\varphi(N^{\eq})(h(b'))&\Leftrightarrow h(b)/E_\varphi=h(b')/E_\varphi\\
&\Leftrightarrow\varphi(h(b),h(b'))\\
&\Leftrightarrow\varphi(b,b')\\
&\Leftrightarrow f_\varphi(M^{\eq})(b)=f_\varphi(M^{\eq})(b')
\end{align*}
\item Let \(M,N\vDash T^{\eq}\), we want to show that they are elementary equivalent. Assume the
generalized continuum hypothesis. By GCH, there are \(M',N'\vDash T^{\eq}\) which are \(\lambda\) saturated
of size \(\lambda\), for some large \(\lambda\) (strongly inaccessible), which \(M\preceq M'\) and \(N\preceq N'\). Since we
want to show elementary equivalence, we can replace \(M,N\) with \(M'\) and \(N'\). By 1, we
have \(M=M_0^{\eq}\), \(N=N_0^{\eq}\) for some \(M_0,N_0\vDash T\). Furthermore, \(M_0,N_0\)
are \(\lambda\)-saturated of size \(\lambda\). By assumption, \(T\) is complete, so \(M_0\equiv N_0\), and
therefore \(M_0\cong N_0\). By 2, \(M\cong N\), and therefore \(M\equiv N\)

We could simply prove that there is a back and forth system between \(M\) and \(N\), using
such a system between \(M\supset M_0\vDash T\) and \(N\supset N_0\vDash T\)
\label{Problem13}
\wu{
\(M_0\equiv N_0\) iff \(M_0\sim_\omega N_0\). We want to show that \(M\sim_\omega N\). For any \(p\in\omega\),
\begin{itemize}
\item given \(a\in s_=(M)\), choose according to \(M\)

\item given \(a\in s_\varphi(M)\), then there is \(\barb\barc\in s_=(M)\)
s.t. \(f_\varphi(M^{\eq})(\barb\barc)=a\) and \(\varphi(\barb,\barc)\). If \(\barb\in s_=(M^{\eq})^n\),
then there is a local isomorphism \(\barb\mapsto\bard\) as \(M\sim_\omega N\). Take \(b=\bard/E_\varphi\).
\end{itemize}
}
\item Let \(M,N\vDash T\), they are elementary submodels of \(\fC\). Since \(\tp_M(\bara)=\tp_N(\barb)\), there
exists an \(\sigma\in\Aut(\fC/A)\) with \(\sigma(\bara)=\barb\). By 2, this automorphism extends to \(\sigma^{\eq}:\fC^{\eq}\to\fC^{\eq}\)
with \(\sigma^{\eq}(a)=b\), hence \(\tp_{M^{\eq}}(a)=\tp_{\fC^{\eq}}(a)=\tp_{\fC^{\eq}}(b)=\tp_{N^{\eq}}(b)\)
\end{enumerate}
\end{proof}

\begin{corollary}[]
Consider the Strong space \(S_{(s_=)^n}(T^{\eq})\). The forgetful
map \(\pi:S_{(s_=)^n}(T^{\eq})\to S_n(T)\) is a homeomorphism
\end{corollary}

\begin{proof}
Observe that it is continuous and surjective. By 4 of the previous lemma it is injective. Any
continuous bijection from a compact space to a Hausdorff space is a homeomorphism
\end{proof}

\begin{proposition}[]
\label{P2.28}
Let \(\varphi(x_1,\dots,x_k)\) be an \(L^{\eq}\) formula, where \(x_i\) is of sort \(S_{E_i}\). There is
an \(L\)-formula \(\psi(\bary_1,\dots,\bary_k)\) s.t.
\begin{equation*}
T^{\eq}\vDash\forall \bary_1,\dots,\bary_k(\psi(\bary_1,\dots,\bary_k)\leftrightarrow\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k)))
\end{equation*}
\end{proposition}

\begin{proof}
Let \(n\) be the length of \(\bary_1,\dots,\bary_k\). Consider the
set \(\pi[\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k))]\), it is a clopen subset of \(S_n(T)\) by the
previous lemma, hence equal to \(\psi(\bary_1,\dots,\bary_k)\) for some formula \(\psi\).

\wu{
Guess the intuition is \([\varphi]=[\psi]\) iff \(\vDash\varphi\leftrightarrow\psi\).
Consider \(\pi[\psi(\bary_1,\dots,\bary_k)]=\pi[\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k))]\) and as \(\pi\) is
homeomorphism, \([\psi(\bary_1,\dots,\bary_k)]=[\varphi(f_{E_1}(\bary_1),\dots,f_{E_k}(\bary_k))]\)
}
\end{proof}

\wu{
This proposition also shows that \(T^{\eq}\) is complete since \(f_{E_i}\) is surjective

Also, for any \(\barc\in\fC\), \(\barc\in\dcl^{\eq}(\emptyset)\Leftrightarrow\barc\in\dcl(\emptyset)\) , \(\barc\in\acl^{\eq}(\emptyset)\Leftrightarrow\barc\in\acl(\emptyset)\)
}

\begin{corollary}[]
\begin{enumerate}
\item Let \(M,N\vDash T\), and let \(h:M\to N\) be an elementary embedding.
Then \(h^{\eq}:M^{\eq}\to N^{\eq}\) is also an elementary embedding
\item \(\fC^{\eq}\) is also \(\kappa\)-saturated
\end{enumerate}
\end{corollary}

\begin{proof}
\begin{enumerate}
\item \(h:M\to\im(h)\) is an isomorphism and can extend to \(h^{\eq}:M^{\eq}\to(\im(h))^{\eq}\),
and \((\im(h))^{\eq}\subseteq N^{\eq}\)
\item By Proposition \ref{P2.28}
\end{enumerate}
\end{proof}

\begin{remark}
For \(M\vDash T\), a definable set \(X\subseteq M^n\) can be viewed as an element of \(M^{\eq}\).
Suppose \(X\) is defined in \(M\) by \(\varphi(\barx,\bara)\) where \(\bara\in M\). Consider the
equivalence relation \(E_\psi\) defined
by \(\psi(\bary_1,\bary_2)=\forall\barx(\varphi(\barx,\bary_1)\leftrightarrow\varphi(\barx,\bary_2))\)
\wu{
\(\bary_1\sim\bary_2\) iff this \(\varphi(M,\bary_1)=\varphi(M,\bary_2)\),
}
and consider \(c=\bara/E_\psi=f_\psi(\bara)\in M^{\eq}\). Then \(X\) is defined in \(M^{\eq}\)
by \(\chi(\barx,c)=\exists\bary(\varphi(\barx,\bary)\wedge f_\psi(\bary)=c)\). Moreover, if \(c'\in S_\psi(M^{\eq})\)
and \(\forall\barx(\chi(\barx,c)\leftrightarrow\chi(\barx,c'))\), then \(c=c'\). To see this, let \(c'=f_{\psi}(\bara')\),
and let \(X'\) be defined in \(M\) by \(\varphi(\barx,\bara')\). Then \(X'\) is defined in \(M^{\eq}\)
by \(\chi(\barx,c')\), so we have that \(X=X'\) (in \(M^{\eq}\)). And then \(X=X'\) (in \(M\))
so \(c=f_{\psi}(\bara)=f_{\psi'}(\bara')=c'\)
\end{remark}

\begin{definition}[]
With the above considerations in mind, given \(M\vDash T\) and a definable set \(X\subseteq M^n\), we call
such a \(c\in M^{\eq}\) a \textbf{code} for \(X\)
\end{definition}

\begin{remark}
Any automorphism of \(\fC^{\eq}\) fixes a definable set \(X\) set-wise iff it fixes a code
for \(X\). However, the choice of a code for \(X\) will depend on the formula \(\varphi\) used to define
it
\begin{align*}
\sigma(X)=X&\Leftrightarrow\sigma(X)=\{\sigma(x):\varphi(x,b)\}=\{x:\varphi(x,\sigma(b))\}=\{x:\varphi(x,b)\}=X\\
&\Leftrightarrow\forall x(\varphi(x,b)\leftrightarrow\varphi(x,\sigma(b)))\\
&\Leftrightarrow\psi(b,\sigma(b))\Leftrightarrow f_\psi(b)=f_\psi(\sigma(b))
\end{align*}

We can think of \(\fC^{\eq}\) as adjoining codes for all definable equivalence relations
(as \(c/E'\) codes \(E'(x,c)\) for an arbitrary equivalence relation \(E\))
\end{remark}

\begin{definition}[]
Let \(A\subseteq M\vDash T\). Then \(\acl^{\eq}(A)=\{c\in M^{\eq}:c\in\acl_{M^{\eq}}(A)\}\) and \(\dcl^{\eq}(A)\)
is defined similarly
\end{definition}

\begin{remark}
Suppose \(A\subseteq M\prec N\), then \(\acl_{N^{\eq}}(A),\dcl_{N^{\eq}}(A)\subseteq M^{\eq}\), so this notation is unambiguous
\end{remark}

\begin{lemma}[]
\label{P2.35}
Let \(M\vDash T\), a definable subset \(X\) of \(M^n\), and \(A\subseteq M\). Then \(X\) is
almost \(A\)-definable iff \(X\) is definable in \(M^{\eq}\) by a formula with parameters in \(\acl^{\eq}(A)\)
\end{lemma}

\begin{proof}
We can work in \(\fC\), since \(M\prec\fC\). Let \(c\) be a code for \(X\). From \ref{P2.13} \(X\) is
almost \(A\)-definable iff \(\abs{\{\sigma(X):\sigma\in\Aut(\fC/A)\}}<\omega\) iff \(\abs{\{\sigma(c):\sigma\in\Aut(\fC^{\eq}/A)\}}<\omega\)
(note that \(\sigma\) extends uniquely in \(\fC^{\eq}\)),
that is, \(c\in\acl^{\eq}(A)\).

\begin{align*}
\sigma(b)/E=\sigma'(b)/E&\Leftrightarrow\forall x(\varphi(x,\sigma(b))\leftrightarrow\varphi(x,\sigma'(b)))\\
&\Leftrightarrow\sigma(X)=\sigma'(X)
\end{align*}
\end{proof}

\begin{definition}[]
Let \(\bara,\barb\in\fC\) have length \(n\). Let \(\bara,\barb\) have the same strong type
over \(A\) (written as \(\stp_{\fC}(\bara/A)=\stp_{\fC}(\bara/A)\)) if \(E(\bara,\barb)\) for any
finite equivalence relation (finitely many classes) defined over \(A\)
\end{definition}

\begin{remark}
If \(\varphi(\barx)\) is a formula over \(A\), then it defines an equivalence with two
classes \(E(\barx_1,\barx_2)\) iff \((\varphi(\barx_1)\wedge\varphi(\barx_2))\vee(\neg\varphi(\barx_1)\wedge\neg\varphi(\barx_2))\). Hence strong
types are a refinement of types

Hence for any formula if \(\stp(\bara/A)=\stp(\barb/B)\), at least we have \(\varphi(\bara)\leftrightarrow\varphi(\barb)\)
\end{remark}

\begin{lemma}[]
If \(A=M\prec\fC\), then \(\tp_{\fC}(a/M)\vDash\stp_{\fC}(a/M)\)
\end{lemma}

\wu{
\(\tp_{\fC}(a/M)=\tp_{\fC}(b/M)\Rightarrow\stp_{\fC}(a/M)=\stp_{\fC}(b/M)\)
}

\begin{proof}
Let \(E\) be an equivalence relation with finitely many classes, defined over \(M\),
and \(\barb\) another realization of \(\tp_{\fC}(\bara/M)\), we want to show \(E(a,b)\).
Since \(E\) has only finitely many classes, and \(M\) is a model, there are
representants \(e_1,\dots,e_n\) of each \(E\)-class in \(M\). Hence we must have \(E(a,e_i)\) for
some \(i\), and therefore \(E(b,e_i)\), which yields \(E(a,b)\)
\end{proof}

\begin{lemma}[]
Let \(A\subseteq M\vDash T\), and let \(\bara,\barb\in M\). TFAE
\begin{enumerate}
\item \(\stp(\bara/A)=\stp(\barb/A)\)
\item \(\bara,\barb\) satisfy the same formulas almost \(A\)-definable
\item \(\tp_{\fC}(\bara/\acl^{\eq}(A))=\tp_{\fC}(\barb/\acl^{\eq}(A))\)
\end{enumerate}
\end{lemma}

\begin{proof}
\label{Problem3}

\(3\to 2\). \ref{P2.35}. Suppose \(X=\varphi(\fC,\bard)\) is almost \(A\)-definable,
then \(\bara,\barb\in\varphi(\fC,\bard)\) iff \(\bara,\barb\in\theta(\fC):=\exists\bary(\varphi(\fC,\bary)\wedge\bary/E_\psi=\barc)\)
where \(\barc=\bard/E_\psi\in\acl^{\eq}(A)\).

\(2\to 3\)

\(1\to 2\). Let \(X\) be almost definable over \(A\). We want to show that \(\bara\in X\)
iff \(\barb\in X\).

Since \(X\) is almost definable over \(A\), there is an \(A\)-definable equivalence
relation \(E\) with finitely many classes, and \(\barc_1,\dots,\barc_n\) s.t. for all \(\barx\in M\),
we have \(\barx\in X\) iff \(M\vDash E(\barx,\barc_1)\vee\cdots\vee E(\barx,\barc_n)\). Hence \(E(\bara,\barc_i)\)
for some \(i\), so by assumption \(E(\barb,\barc_i)\).

\(2\to 1\). Let \(E\) be an \(A\)-definable equivalence relation with finitely many classes, we
want to show that \(E(\bara,\barb)\). The set \(X=\{\barx\in M:E(\barx,\bara)\}\) is definable
almost over \(A\). But \(\bara\in X\), so \(\barb\in X\), hence \(E(\bara,\barb)\)
\end{proof}


Here is a note from \href{https://math.berkeley.edu/\~scanlon/225af13lectures/20131810Lec15.pdf}{scanlon}
\begin{definition}[]
An \textbf{imaginary element} of \(\fA\) is a class \(a/E\) where \(a\in A^n\) and \(E\) is a definable
equivalence relation on \(A^n\)
\end{definition}

\begin{definition}[]
\(\fA\) \textbf{eliminates imaginaries} if, for every definable equivalence relation \(E\) on \(A^n\) there
exists definable function \(f:A^n\to A^m\) s.t. for \(x,y\in A^n\) we have
\begin{equation*}
xEy\Leftrightarrow f(x)=f(y)
\end{equation*}
\end{definition}

\begin{remark}
The definition give above is what Hodges calls \textbf{uniform elimination of imaginaries}
\end{remark}

\begin{remark}
If \(\fA\) eliminates imaginaries, then for any definable set \(X\) and definable equivalence
relation \(E\) on \(X\), there is a definable set \(Y\) and a definable bijection \(f:X/E\to Y\).
Of course this is not literally true, we should rather say that there is a definable
map \(f':X\to Y\) s.t. \(f'\) is invariant on the equivalence classes defined by \(E\)
\end{remark}

So elimination of imaginaries is saying that quotients exists in the category of definable sets

\begin{remark}
If \(\fA\) eliminates imaginaries then for any imaginaries element \(a/E=\tila\) there is some
tuple \(\hata\in A^m\) s.t. \(\tila\) and \(\hata\) are \textbf{interdefinable}, i.e. there is a
formula \(\varphi(x,y)\) s.t.
\begin{itemize}
\item \(\fA\vDash\varphi(a,\tila)\)
\item If \(a'Ea\) then \(\fA\vDash\varphi(a',\hata)\)
\item If \(\varphi(b,\hata)\) then \(bEa\)
\item If \(\varphi(a,c)\) then \(c=\hata\)
\end{itemize}


To get the formula \(\varphi\) we use the function \(f\) given by the definition of elimination of
imaginaries and let \(\varphi(x,y):=f(x)=y\)
\end{remark}

Almost conversely, if for every \(\fA'\equiv\fA\) every imaginary in \(\fA'\) is interdefinable with a \textbf{real}
(non-imaginary) tuple then \(\fA\) eliminates imaginaries
\begin{equation*}
\{\forall xy(xEy\leftrightarrow f_E(x)=f_E(y))\mid \forall E\}
\end{equation*}

\begin{examplle}[]
For any structure \(\fA\), every imaginary in \(\fA_A\) is interdefinable with a sequence of real elements
\end{examplle}

\begin{examplle}[]
Let \(\fA=(\N,<,\equiv\mod 2)\). Then \(\fA\) eliminates imaginaries. For example, to eliminate the
``odd/even'' equivalence relation, \(E\), we can define \(f:\N\to\N\) by
\begin{equation*}
f(x)=y\Leftrightarrow xEy\wedge\forall z[xEz\to y<z\vee y=z]
\end{equation*}
\end{examplle}

\begin{definition}[]
\(\fA\) has \textbf{definable choice functions} if for any formula \(\theta(\barx,\bary)\) there is a definable
function \(f(\bary)\) s.t.
\begin{equation*}
\forall\bary\exists\barx[\theta(\barx,\bary)\leftrightarrow\theta(f(\bary),\bary)]
\end{equation*}
(i.e., \(f\) is a skolem function for \(\theta\)) and s.t.
\begin{equation*}
\forall\bary\forall\barz[\forall\barx(\theta(\barx,\bary)\leftrightarrow\theta(\barx,\barz))\to f(\bary)=f(\barz)]
\end{equation*}
\end{definition}

\begin{proof}
If \(\fA\) has definable choice functions then \(\fA\) eliminates imaginaries
\end{proof}

\begin{proof}
Given a definable equivalence relation \(E\) on \(A^n\) let \(f\) be a definable choice function
for \(E(\barx,\bary)\). Since \(E\) is an equivalence relation we have \(\forall\bary E(f(\bary),\bary)\) and
\begin{equation*}
\forall\bary\barz[\bary/E=\barz/E\to f(\bary)=f(\barz)]
\end{equation*}
Thus \(f(\bary)=f(\barz)\Leftrightarrow\bary E\barz\)
\end{proof}

\begin{examplle}[]
We now see that \(\fA=(\N,<,\equiv\mod 2)\)  eliminates imaginaries. Basically since \(\fA\) is well
ordered, we can find a least element to witness membership of definable sets, hence we have
definable functions
\end{examplle}

\begin{examplle}[]
\(\fA=(\N,\equiv\mod 2)\) does not eliminate imaginaries

First note that the only definable subsets of \(\N\) are \(\emptyset,\N,2\N,(2n+1)\N\). This is
because \(\fA\) has an automorphisms which switches \((2n+1)\N\) and \(2\N\)

Now suppose \(f:\N\to\N^m\)  eliminates the equivalence relation \(\equiv\mod 2\), i.e.,
\begin{equation*}
f(x)=f(y)\Leftrightarrow y\equiv 2\mod 2
\end{equation*}
The \(\im(f)\) is definable and has cardinality \(2\). Since there are no definable subsets
of \(\N\) of cardinality 2, we must have \(m>1\). Now let \(\pi:\N^m\to\N\) be a projection.
Then \(\pi(\im(f))\) is a finite nonempty definable subset of \(\N\). But no such set exists
\end{examplle}

\begin{proposition}[]
If \(\fA\) eliminates imaginaries, then \(\fA_A\) eliminates imaginaries
\end{proposition}

\begin{proof}
The idea is that an equivalence relation with parameters can be obtained as a fiber of an
equivalence relation in more variables. Let \(E\subseteq A^n\) be an equivalence relation definable
in \(\fA_A\). Let \(\varphi(x,y;z)\in L\) and \(a\in A^l\) be s.t.
\begin{equation*}
xEy\Leftrightarrow\fA\vDash\varphi(x,y;a)
\end{equation*}
We now define
\begin{equation*}
\psi(x,u,y,v)=
\begin{cases}
u=v\wedge"\varphi\text{ defines an equivalence relation}"&\text{or}\\
u\neq v&\text{or}\\
"\varphi(x,y,v)\text{ does not define an equivalence relation}"
\end{cases}
\end{equation*}
Now \(\psi\) defines an equivalence relation on \(A^{n+l}\). Let \(f:A^{n+l}\to A^m\) eliminate \(\psi\),
then \(f(-,a)\) eliminates \(E\)
\end{proof}

Back to \cite{PillayNoteStability}

\begin{definition}[]
\begin{enumerate}
\item \(T\) has elimination of imaginaries (EI) if for any model \(M\vDash T\) and \(e\in M^{\eq}\), there
is a \(\barc\in M\) s.t. \(e\in\dcl_{M^{\eq}}(\barc)\) and \(\barc\in\dcl_{M^{\eq}}(e)\)
\item \(T\) has weak elimination of imaginaries if, as above, except \(\barc\in\acl_{M^{\eq}}(e)\)
(that is, \(e\in\dcl_{M^{\eq}}(\barc)\) and \(\barc\in\acl_{M^{\eq}}(e)\))
\item \(T\) has geometric elimination of imaginaries if, as above,
except \(e\in\acl_{M^{\eq}(\barc)}\) and \(\barc\in\acl_{M^{\eq}}(e)\)
\end{enumerate}
\end{definition}

Note that in particular, elimination of imaginaries imply the existence of codes for definable sets

\begin{proposition}[]
\label{P2.41}
TFAE
\begin{enumerate}
\item \(T\) has EI
\item For some model \(M\vDash T\), we have that for any \(\emptyset\)-definable equivalence relation \(E\),
there is a partition of \(M^n\) into \(\emptyset\)-definable sets \(Y_1,\dots,Y_r\) and for each \(i=1,\dots,r\)
a \(\emptyset\)-definable \(f_i:Y_i\to M^{k_i}\) where \(k_i\ge 1\) s.t. for each \(i=1,\dots,r\), for
all \(\barb_1,\barb_2\in Y_i\), we have \(E(\barb_1,\barb_2)\) iff \(f_i(\barb_1)=f_i(\barb_2)\)
\item For any model \(M\vDash T\), we have that for any \(\emptyset\)-definable equivalence relation \(E\),
there is a partition of \(M^n\) into \(\emptyset\)-definable sets \(Y_1,\dots,Y_r\) and for each \(i=1,\dots,r\)
a \(\emptyset\)-definable \(f_i:Y_i\to M^{k_i}\) where \(k_i\ge 1\) s.t. for each \(i=1,\dots,r\), for
all \(\barb_1,\barb_2\in Y_i\), we have \(E(\barb_1,\barb_2)\) iff \(f_i(\barb_1)=f_i(\barb_2)\)
\item For any model \(M\vDash T\), and any definable \(X\subseteq M^n\) there is
an \(L\)-formula \(\varphi(\barx,\bary)\) and \(\barb\in M\) s.t. \(X\) is defined by \(\varphi(\barx,\barb)\)
and for all \(\barb'\in M\) if \(X\) is defined by \(\varphi(\barx,\barb')\) then \(\barb=\barb'\).
We call such a \(\barb\) a code for \(X\).
\end{enumerate}
\end{proposition}

\wu{
most typos i've ever seen in a proof
}

\begin{proof}
\(2\Leftrightarrow 3\). Since we concern only \(\emptyset\)-definable relations and functions, if it is true in some
model, then it is true in any model

\(1\to 2\). Let \(\pi_E:S_=^n\to S_E\) the canonical definable quotient map. Let \(e\in S_E\). By
assumption, there is \(k\in\N\) and \(\barc\in\fC^k\) s.t. \(e\) and \(\barc\) are interdefinable. In
other words, there is a formula \(\varphi_e(x,\bary)\) over \(\emptyset\) s.t. \(\varphi_e(e,\barc)\).
Moreover, \(\abs{\varphi_e(\fC,\barc)}=\abs{\varphi_e(e,\fC)}=1\)

Let
\begin{align*}
X_e=\{&\barx\in\fC,\vDash\exists!\bary\varphi_e(\pi_E(\barx),\bary)\\&\wedge\forall z(E(\barx,\barz)\leftrightarrow\\&\quad(\forall y(\varphi_e(\pi_E(\barx),\bary)\leftrightarrow\varphi_e(\pi_E(\barz),\bary)))\}
\end{align*}
This means that \(\varphi_e\) defines a function on \(X_e\), and that this function
separates \(E\)-classes.

Then \(\pi^{-1}(\{e\})\subset X_e\).

Since each \(X_e\) contains \(\pi^{-1}(\{e\})\), we get \(\fC^n=\bigcup_{e\in\pi_E(\fC^n)}X_e\), and by compactness,
there are \(e_1,\dots,e_l\) s.t. \(\fC^n=\bigcup_{i=1}^lX_{e_i}\).
\wu{
As each \(X_e\) is \(\emptyset\)-definable. Let \(\barx\in X_e\Leftrightarrow\theta_e(\barx)\). Suppose there is no such \(l\),
then \(\{x=x\}\cup\{\neg\theta_e(x)\}\) is satisfiable and realised since \(\fC\) is saturated
}
Naively, we can pick \(f_i=\varphi_{e_i}\circ\pi_E\), but \(X_{e_i}\) are not disjoint

However we can consider \(Y_1,\dots,Y_r\) to be the atoms of the boolean algebra generated by the \(X_i\).
These are disjoint, and we can pick, for each \(Y_j\), appropriate \(f_i\), to get the result

\(3\to 4\). Let \(X=\varphi(\fC,\bara)\). Consider the \(\emptyset\)-definable equivalence
relation \(E(\bary,\barz)\Leftrightarrow\forall x(\varphi(\barx,\bary)\leftrightarrow\varphi(\barx,\barz))\). Let \(Y_i\) and \(f_i\) be as in 3
and say \(\bara\in Y_1\), and let \(\barb=f_1(\bara)\).
Then \(\exists\bary(f_1(\bary)=\barb\wedge\varphi(\barx,\bary))\) defines \(X\), call this formula \(\psi\)

We have to show that \(\barb\) is unique. Let \(\barb'\) be
s.t. \(\exists\bary(f_1(\bary)=\barb'\wedge\varphi(\barx,\bary))\) also defines \(X\), and let \(\bara_0\) be as
the \(\bary\) in the formula. Then \(\varphi(x,\bara_0)\) defines \(X\), hence \(\bara_0E\bara\),
which implies \(\barb'=f_1(\bara_0)=f_1(\bara)=\barb\)

\(4\to 1\). Let \(e\in \fC^{\eq}\), then \(e=\pi_E(\bara)\) for some \(\bara\in \fC^n\) and
some \(\emptyset\)-definable equivalence relation \(E\)

The set \(X=\{\barx\in\fC^n\mid\vDash E(\barx,\bara)\}\) has a code \(\barb\in\fC^k\), so
that \(X=\psi(\fC^n,\barb)\). We are going to prove interdefinability of \(e\) and \(\barb\) using
automorphisms of \(\fC\)

First suppose that \(\sigma\in\Aut(\fC)\), and fixes \(e\). We
have \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\bara)\leftrightarrow\psi(\barx,\barb))\). Applying \(\sigma\), we
get \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\bara)\leftrightarrow\psi(\barx,\sigma(\barb)))\). But \(\barb\) is a code
for \(X\), hence \(\barb=\sigma(\barb)\). This implies \(\barb\in\dcl(e)\)

Now suppose \(\sigma\in\Aut(\fC)\) and fixes \(\barb\).
Again \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\bara)\leftrightarrow\psi(\barx,\barb))\)
and \(\fC^{\eq}\vDash\forall\barx(\pi_E(\barx)=\pi_E(\sigma(\bara))\leftrightarrow\psi(\barx,\barb))\).
But \(\psi(\bara,\barb)\), \(e=\pi_E(\bara)=\pi_E(\sigma(\bara))=\sigma(e)\). Hence \(e\in\dcl(\barb)\)
\end{proof}

Note that condition 2 is somewhat unsatisfying, as we would like to have a quotient function
for \(E\), that is, \(r=1\)

\begin{proposition}[]
Suppose \(T\) eliminates imaginaries. We get \(r=1\) in condition 2 iff \(\dcl(\emptyset)\) has at least
two elements
\end{proposition}

\begin{proof}
First, suppose that \(r=1\). Consider the equivalence on \(\fC^2\) given by \(E((x,y),(x',y'))\)
iff \(x=y\leftrightarrow x'=y'\). In other words, the \(E\) classes are the diagonal and its complement (only
two). Then \(\pi_E(\fC^2)\) has two elements, and they belong to \(\dcl^{\eq}(\emptyset)\). But because \(T\)
eliminates imaginaries, this implies that there is also two elements in \(\dcl(\emptyset)\) by
Proposition \ref{P2.28}

Second, suppose that \(\dcl(\emptyset)\) contains two constants \(a\) and \(b\). Let \(Y_i,f_i\) be as in
condition 2. Using \(a\) and \(b\),we can find some number \(k\) and functions \(g_i:\fC^{k_i}\to\fC^k\)
s.t. \(g_i(\fC^{k_i})\) are pairwise disjoint. We can check that the \(\emptyset\)-definable
function \(f:\fC^n\to\fC^k\) sending \(y\in Y_i\) to \(g_i(f_i(y))\) has all the required properties
\end{proof}

\begin{remark}
Elimination of imaginaries also makes sense for many sorted theories
\end{remark}

\begin{proposition}[Assume \(T\) 1-sorted]
\(T^{\eq}\) has elimination of imaginaries
\end{proposition}

\begin{proof}
Prove a strong version of 2 in Proposition \ref{P2.41}
\wu{
that is, we don't need to distinguish \(Y_1,\dots,Y_r\) and \(f_1,\dots,f_r\).
}
Let \(E'\) be a \(\emptyset\)-definable
equivalence relation on a sort \(s_E\) in some model \(M^{\eq}\) of \(T^{\eq}\). By Proposition
\ref{P2.28} there is an \(L\)-formula \(\psi(\bary_1,\bary_2)\) (\(\bary_i\) the appropriate length)
s.t. for all \(\bara_1,\bara_2\in M\), \(M\vDash\psi(\bara_1,\bara_2)\)
iff \(M^{\eq}\vDash E'(f_E(\bara_1),f_E(\bara_2))\). So \(\psi(\bary_1,\bary_2)\) is an \(L\)-formula
defining an equivalence relation on \(M^k\) for the suitable length \(k\). Consider the
map \(h\), taking \(e\in S_E\) to \(f_\psi(\bara)\) for any \(\bara\in M^k\) s.t. \(f_E(\bara)=e\) for
any \(\bara\in M^k\) s.t. \(f_E(\bara)=e\). Suppose \(f_E(\bara)=e=f_E(\bara')\), we easily see
that \(f_\psi(\bara)=f_\psi(\bara')\), hence the map \(h\) is well-defined, and satisfies 2 of \ref{P2.41}
\end{proof}

\subsection{Examples and counterexamples}
\label{sec:org12c3a81}
\begin{examplle}[]
The theory of an infinite set has weak elimination of imaginaries but not full elimination of imaginaries
\end{examplle}

\begin{proof}
\label{Problem4}
First, we show that \(T\) has weak elimination of imaginaries. Let \(M\) be an infinite set and
let \(e\in M^{\eq}\) be an imaginary element. Suppose that. Let \(A\subset M\) be a finite set over
which \(X\) is definable ??. Consider the set
\begin{equation*}
\hatA:=\bigcap_{\substack{\sigma\in\Aut(M)\\\sigma(X)=X}}\sigma(A)
\end{equation*}
Since \(A\) is finite, there are \(\sigma_1,\dots,\sigma_n\) s.t. \(\hatA=\bigcap_i\sigma_i(A)\)

To see that \(T\) does not have full elimination of imaginaries, observe that there is never a
code for any finite set. Indeed, if \(M\) is an infinite set, \(X\subset_fM\), and \(\bara\in M\), we
can find a permutation of \(M\) which fixes \(X\) as a set but does not fix \(\bara\),
meaning \(\bara\) could not be a code for \(X\)
\end{proof}

\begin{examplle}[]
Let \(T=\Th(M,<,\dots)\) where < is a total well-ordering. Then \(T\) has elimination of imaginaries
\end{examplle}

\begin{proof}
Every definable set has a least element. We verify (2) in \ref{P2.41}. Let \(E\) be
a \(\emptyset\)-definable equivalence relation on \(M^n\). Let \(f:M^n\to M^n\) s.t. for
any \(\bara\), \(f(\bara)\) is the least element of the \(E\)-class of \(\bara\). Notice
that \(f\) is \(\emptyset\)-definable, and for all \(\bara,\barb\), \(f(\bara)=f(\barb)\)
iff \(E(\bara,\barb)\)
\end{proof}

\begin{lemma}[]
\label{P2.49}
Let \(T\) be strongly minimal and \(\acl(\emptyset)\) be infinite (in some, any model). Then \(T\) has
weak elimination of imaginaries
\end{lemma}

\begin{proof}
Fix a model \(M\). Let \(e\in M^{\eq}\)
\wu{
Ok, now i think the convention for pillay is that \(e\in M^{\eq}\) is automatically imaginary,
}
so \(e=\bara/E\) for some \(\bara\) and \(E\) some \(\emptyset\)-definable equivalence relation.
Let \(A=\acl_{M^{\eq}}(e)\cap M\). \(A\) is infinite as it contains \(\acl(\emptyset)\). \(A\) is infinite
as it contains \(\acl(\emptyset)\).

We first prove that there exists some \(\barb\subset A\) s.t. \(E(\bara,\barb)\).
Let \(X_1=\{y_1\in M:M\vDash\exists y_2\dots y_n(\bary E\bara)\}\). It is definable over \(e\). If \(X_1\) is finite,
any \(b_1\in X_1\) then belongs to \(A\). Otherwise, \(X_1\) is cofinite, hence meets the infinite
set \(A\). Either way, \(X_1\cap A\neq\emptyset\) and we have \(b_1\in X_1\cap A\)

Now let \(X_2=\{y_2\in M:M\vDash\exists y_3\dots y_n(b_1\bary E\bara)\}\). We remark \(X_2\neq\emptyset\) since \(b_1\in X_1\).
Now \(X_2\) is either finite or cofinite since \(T\) is strongly minimal. By the same argument
above, we may find \(b_2\in X_2\cap A\). Then repeating this process, we may find \(\barb\subset A\).
Therefore \(\barb\in\acl_{M^{\eq}}(e)\).

Finally notice that \(e\in\dcl_{M^{\eq}}(\barb)\) since \(\bara/E=\barb/E=e\)
\end{proof}

\begin{examplle}[]
The theory \(\ACF_p\) has elimination of imaginaries, for any \(p\)
\end{examplle}

\begin{proof}
By Lemma \ref{P2.49}, \(\ACF_p\) has weak elimination of imaginaries. Therefore it suffices to
show that every finite set can be coded. Let \(K\) be an algebraically closed field and
let \(X=\{c_1,\dots,c_n\}\subseteq K\). Consider the polynomial
\begin{align*}
P(x)&=\prod_{i=1}^n(x-c_i)\\
&=x^n+e_{n-1}x^{n-1}+\dots+e_1x+e_0
\end{align*}
Then we may take the tuple \(\bare=(e_n,\dots,e_0)\) to be our code for \(X\).
\end{proof}

\section{Stability}
\label{sec:org25a3c4d}
\subsection{Historic remarks and motivations}
\label{sec:orgb1b08b8}
Thoughout this chapter we will fix a complete theory \(T\) in some language \(L\). Moreover, we
will have no problem in working in \(T^{\eq}\) (that is to say, to assume \(T=T^{\eq}\))

For a given theory \(T\), the spectrum functions is given as
\begin{gather*}
I(T,-):Card\to Card\\
I(T,\lambda)=\#\text{ of models of \(T\) or cardinality $\lambda$ (up to isomorphism)}
\end{gather*}
\begin{conjecture}[Morley]
Let \(T\) be countable, then function \(I_T(\kappa)\) is non-decreasing on uncountable cardinals
\end{conjecture}

One of such dividing lines is stability
\subsection{Counting types and stability}
\label{sec:org3ff84bf}
\begin{definition}[]
For a complete first order theory \(T\), let \(f_T:Card\to Card\) be defined
by \(f_T(\kappa)=\sup\{\abs{S_1(M)}:M\vDash T,\abs{M}=\kappa\}\), for \(\kappa\) an infinite cardinal
\end{definition}

\begin{exercise}
Show that
\begin{equation*}
f_T(\kappa)=\sup\{\abs{S_n(M)}:M\vDash T,\abs{M}=\kappa,n\in\omega\}
\end{equation*}
gives an equivalent definition
\end{exercise}

It is easy to see that \(\kappa\le f_T(\kappa)\le 2^{\kappa+\abs{T}}\)

\begin{fact}[Keisler, Shelah \cite{keisler1976six}]
Let \(T\) be an arbitrary complete theory in a countable language. Then \(f_T(\kappa)\) is one of the
following functions (and all of these options occur for some \(T\)):
\begin{equation*}
\kappa,\kappa+2^{\aleph_0},\kappa^{\aleph_0},\ded\kappa,(\ded\kappa)^{\aleph_0},2^\kappa
\end{equation*}
Here, \(\ded\kappa=\sup\{\abs{I}:I\text{ is a linear order with a dense subset of size }\kappa\}\),
equivalently \(\sup\{\lambda:\text{ there is a linear order of size $\kappa$ with $\lambda$ cuts}\}\)
\end{fact}

\(\ded\) is called the \textbf{Dedekind function}

\begin{lemma}[]
\(\kappa<\ded\kappa\le 2^\kappa\)
\end{lemma}

\begin{proof}
Let \(\mu\) be minimal s.t. \(2^\mu>\kappa\), and consider the tree \(2^{<\mu}\). Take the lexicographic
ordering \(I\) on it, then \(\abs{I}=2^{<\mu}\le\kappa\) by the minimality of \(\mu\), but there are at
least \(2^\mu>\kappa\) cuts

Every cut is \textbf{uniquely} determined by the subset of elements in its lower half
\end{proof}

\begin{definition}[]
Let \(M\vDash T\)
\begin{enumerate}
\item A formula \(\phi(x,y)\) with its variables partitioned into two groups \(x,y\), has the
\textbf{\(k\)-order property}, \(k\in\omega\), if there are some \(a_i\in M_x\), \(b_i\in M_y\) for \(i<k\)
s.t. \(M\vDash\phi(a_i,b_j)\Leftrightarrow i<j\)
\item \(\phi(x,y)\) has the \textbf{order property} if it has the \(k\)-order property for all \(k\in\omega\)
\item A formula \(\phi(x,y)\) is \textbf{stable} if there is some \(k\in\omega\) s.t. it does not have the \(k\)-order property
\item A theory is \textbf{stable} if it implies that all formulas are stable
\end{enumerate}
\end{definition}

\begin{proposition}[]
\label{C2.2.8}
Assume that \(T\) is unstable, then \(f_T(\kappa)\ge\ded\kappa\) for all cardinals \(\kappa\ge\abs{T}\)
\end{proposition}

\begin{proof}
Fix a cardinal \(\kappa\). Let \(\phi(x,y)\in L\) be a formula that has the \(k\)-order property for
all \(k\in\omega\). Then by compactness we have:

\textbf{Claim}. Let \(I\) be an arbitrary linear order. Then we can find some \(\calm\vDash T\) and \(a_ib_i:i\in I\)
 from \(M\) s.t. \(\calm\vDash\phi(a_i,b_j)\Leftrightarrow i<j\), for all \(i,j\in I\)

\wu{
Consider
 \begin{equation*}
T'=T\cup\{\phi(a_i,b_j):i<j\}\cup\{\neg\phi(a_i,b_j):i\\ge j\}
 \end{equation*}
}

Let \(I\) be an arbitrary dense linear order of size \(\kappa\), and let \((a_ib_i:i\in I)\) in \(\calm\) be as
given by the claim. By LÃ¶wenheimâ€“Skolem Theorem, we can assume that \(\abs{\calm}=\kappa\)

Given a cut \(C=(A,B)\) in \(I\), consider the set of \(L(M)\)-formulas
 \begin{equation*}
\Phi_C=\{\phi(x,b_j):j\in B\}\cup\{\neg\phi(x,b_j):j\in A\}
 \end{equation*}
Note that by compactness it is a partial type, let \(p_C\in S_x(M)\) be a complete type over \(M\)
extending \(\Phi_C(x)\). Given two cuts \(C_1,C_2\), we have \(p_{C_1}\neq p_{C_2}\). As \(I\) was
arbitrary, this shows that \(\sup\{\abs{S_x(M)}:M\vDash T,\abs{M}=\kappa\}\ge\ded\kappa\). Note that we may
have \(\abs{x}>1\), however using Exercise \ref{C2.2.2} we get \(f_T(\kappa)\ge\ded\kappa\)
\end{proof}

\begin{fact}[Ramsey]
\(\aleph_0\to(\aleph_0)^n_k\) holds for all \(n,k\in\omega\) (i.e., for any coloring of subsets of \(\N\) of size
\(n\) in \(k\) colors, there is some infinite subset \(I\) of \(\N\) s.t. all \(n\)-element
subsets of \(I\) have the same color)
\end{fact}

\begin{lemma}[]
Let \(\phi(x,y)\), \(\psi(x,z)\) be stable formulas (where \(y,z\) are not necessarily disjoint tuples
of variables). Then
\begin{enumerate}
\item \(\neg\phi(x,y)\) is stable
\item Let \(\phi^*(y,x):=\phi(x,y)\), i.e., we switch the roles of the variables. Then \(\phi^*(y,x)\) is
stable
\item \(\theta(x,yz):=\phi(x,y)\wedge\psi(x,z)\) and \(\theta'(x,yz):=\phi(x,y)\vee\psi(x,z)\) are stable
\item If \(y=uv\) and \(c\in M_v\), then \(\theta(x,u):=\phi(x,uc)\) is stable
\item If \(T\) is stable, then every \(L^{\eq}\)-formula is stable as well
\item The formula \(\varphi(x,y)\) is stable for \(T\) iff there is \(n<\omega\) s.t. \(\varphi(x,y)\)
is \(n\)-stable: it is not the case that there are \(a_i,b_i\) (in \(\fC\), or in
some/any \(M\vDash T\)), \(i< n\), s.t. \(\vDash\varphi(a_i,b_i)\) iff \(i< j\) for all \(i,j< n\)
\item There are \(T\), \(M\vDash T\) and \(\varphi(x,y)\) s.t. \(\varphi(x,y)\) is stable in \(M\) but it is not
stable for \(T\)
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Suppose \(\neg\phi(x,y)\) is unstable, then there is \(I=(a_i,b_i)_{i\in\omega}\)
s.t. \(\vDash\neg\varphi(a_i,b_j)\Leftrightarrow i<j\), equivalently, \(\vDash\varphi(a_i,b_j)\Leftrightarrow i\ge j\).
Then add constants \((a_i,b_i)_{i\in\omega}\) and consider
\begin{equation*}
\Gamma=T\cup\{\varphi(a_i,b_j):i<j\}\cup\{\neg\varphi(a_i,b_j):i\ge j\}
\end{equation*}
For any finite subset \(\Gamma'\subset_f\Gamma\), we can reverse the order of \(I\): suppose \(n\) is the
maximum index and then let \(i'=n-i\), \(j'=n+1-j\). Then \(i'<j'\Leftrightarrow n-i<n+1-j\Leftrightarrow i\ge j\).
Hence \(I\) satisfies this, and hence \(\varphi(x,y)\) is unstable
\item Suppose \(\varphi^*(y,x)\) is not stable, then \(\neg\varphi^*(y,x)\) is also unstable. Let \(a_i,b_i\) be
witnesses in \(\fC\) of the latter. Then \(a'_i=b_i\) and \(b_i'=a_{i+1}\), \(i<\omega\), witness the
instability of \(\varphi(x,y)\) as \(j+1>i\)
\item Suppose that \(\theta'(x,yz)\) is unstable, i.e., there are \((a_i,b_ib_i':i\in\N)\)
s.t. \(\vDash\phi(a_i,b_j)\vee\psi(a_i,b_j')\Leftrightarrow i<j\) for all \(i,j\in\N\).
Let
\begin{equation*}
P:=\{(i,j)\in\N^2:i<j,\vDash\phi(a_i,b_j)\},Q:=\{(i,j)\in\N^2:i<j,\vDash\psi(a_i,b_j')\}
\end{equation*}
then \(P\cup Q=\{(i,j)\in\N^2:i<j\}\). By Ramsey there is an infinite \(I\subseteq\N\) s.t. either all
increasing pairs from \(I\) belong to \(P\), or all increasing pairs from \(I\) belong
to \(Q\)
\setcounter{enumi}{6}
\item Consider the graph \(G\), disjoint union of all finite graphs. Then the edge
relation \(E\) is stable in \(G\). Indeed, if it wasn't, we would have a vertex \(x_0\) and
infinitely many vertices \(\{y_i:i\in\N\}\) s.t. \(E(x_0,y_i)\) for all \(i\), which is impossible

But by 6, edge relation is not stable in \(\Th(G)\)
\end{enumerate}
\end{proof}

\begin{lemma}[]
\label{y2.9}
Let \(X\) be a set and \(Y_1,\dots,Y_n\) are subsets of \(X\). Define
\begin{equation*}
E(x,y):=\bigwedge_{i=1}^n(x\in X_i\Leftrightarrow y\in X_i)
\end{equation*}
Then \(E\) is an equivalence relation on \(X\) and \(Z\subseteq X\) is a boolean combination of \(X_i\)'s
iff
\begin{equation*}
E(x,y)\Rightarrow (x\in Z\Leftrightarrow y\in Z)
\end{equation*}
\end{lemma}

\begin{proof}
\(E\) is an equivalence relation is obvious

\(\Rightarrow\): obvious

\(\Leftarrow\): Let \(U\) be the set of all boolean combination of \(X_i\)'s. Let \(V\) be all the set \(Z\)
satisfying \(E(x,y)\Rightarrow(x\in Z\Leftrightarrow y\in Z)\). We want to show that \(U\subseteq V\). First each \(X_i\) satisfies
the condition.
\end{proof}

\begin{theorem}[ErdÅ‘s-Makkai]
Let \(B\) be an infinite set and \(\calf\subseteq\calp(B)\) a collection of subsets of \(B\)
with \(\abs{B}<\abs{\calf}\). Then there are sequences \((b_i:i<\omega)\) of elements of \(B\)
and \((S_i:i<\omega)\) of elements of \(\calf\) s.t. one of the following holds
\begin{enumerate}
\item \(b_i\in S_j\Leftrightarrow j<i(\forall i,j\in\omega)\)
\item \(b_i\in S_j\Leftrightarrow i<j(\forall i,j\in\omega)\)
\end{enumerate}
\end{theorem}

\begin{proof}
Choose \(\calf'\subseteq\calf\) with \(\abs{\calf'}=\abs{B}\), s.t. any two finite subsets \(B_0,B_1\) of \(B\),
if n\(\exists S\in\calf\) with \(B_0\subseteq S\), \(B_1\subseteq B\setminus S\), then there is some \(S'\in\calf'\)
with \(B_0\subseteq S'\), \(B_1\subseteq B\setminus S'\) (possible as there are at most \(\abs{B}\)-many pairs of finite
subsets of \(B\))

By assumption there is some \(S^*\in\calf\) which is not a Boolean combination of elements of \(\calf'\)
(again there are at most \(\abs{B}\)-many different Boolean combinations of sets from \(\calf'\))

We choose by induction sequences \((b_i':i<\omega)\) in \(S^*\), \((b_i'':i<\omega)\) in \(B\setminus S^*\)
and \((S_i:i<\omega)\) in \(\calf'\) s.t.
\begin{itemize}
\item \(\{b_0',\dots,b_n'\}\subseteq S_n\) and \(\{b_0'',\dots,b_n''\}\subseteq B\setminus S_n\)
\item \(\forall i<n(b_n'\in S_i\Leftrightarrow b_n''\in S_i)\)
\end{itemize}


Assume \((b_i':i<n)\), \((b_i'':i<n)\) and \((S_i:i<n)\) have already been constructed.
Since \(S^*\) is not a Boolean combination of \(S_0,\dots,S_{n-1}\), there
are \(b_n'\in S^*\), \(b_n''\in B\setminus S^*\) s.t. for all \(i<n\)
\begin{equation*}
b_n'\in S_i\Leftrightarrow b_n''\in S_i
\end{equation*}
by Lemma \ref{y2.9}

By the choice of \(\calf'\), there is some \(S_n\in\calf'\) with \(\{b_0',\dots,b_n'\}\subseteq S_n\)
and \(\{b_0'',\dots,b_n''\}\subseteq B\setminus S_n\).



Now by Ramsey theorem we may assume that either \(b_n'\in S_i\) for all \(i<n<\omega\) or \(b_n'\notin S_i\)
for all \(i<n<\omega\) (for \(\{x,y\}\subset[\N]^2\) and assume \(x<y\), color it according to
whether \(b_y'\in S_x\). Thus by Ramsey, there is an infinite \(I\subseteq\omega\) s.t.
\begin{itemize}
\item either \(\forall n>j\in I(b_n'\in S_j) \Rightarrow \forall i,j\in I(b_i''\in S_j\Leftrightarrow i>j)\)
\item or \(\forall n>j\in I(b_n'\notin S_j) \Rightarrow \forall i,j\in I(a_i'\in S_j\Leftrightarrow i\le j)\)
\end{itemize}


Note that if \(b_i''\in S_j\) and \(i\le j\), then as \(\{b_0'',\dots,b_i''\}\subseteq B\setminus S_j\), \(b_i''\notin S_j\)

In the first case we set \(b_i=b_i''\) and get 1, in the
second case we set \(b_i=b_{i+1}'\) and get 2.
\end{proof}

\begin{definition}[]
Fix \(\varphi(x,y)\in L\). By a \textbf{complete \(\varphi\)-type over} \(A\subseteq M_y\), we mean a maximal consistent collection
of formulas of the form \(\varphi(x,b)\), \(\neg\varphi(x,b)\) where \(b\) ranges over \(A\). Let \(S_\varphi(A)\) be
the space of all complete \(\varphi\)-types over \(A\)
\end{definition}


\begin{proposition}[]
\label{C2.2.13}
Assume that \(\abs{S_\varphi(B)}>\abs{B}\) for some infinite set of parameters \(B\). Then \(\varphi(x,y)\)
is unstable
\end{proposition}

\begin{proof}
For \(a\in\M_x\), \(\tp_\varphi(a/B)\) is determined by \(\varphi(a,B)=\{b\in B\mid\vDash\phi(a,b)\}\). Then
\(\abs{S_\varphi(B)}>\abs{B}\Rightarrow\abs\{\phi(a,B)\mid a\in\M_x\}>\abs{B}\). By ErdÅ‘s-Makkai, there are
sequences \((a_i)_{i<\omega}\) and \((b_i)_{i<\omega}\) s.t.
\begin{equation*}
\text{either }\vDash\phi(a_i,b_j)\Leftrightarrow i<j,\text{ or }\vDash\phi(a_i,b_j)\Leftrightarrow j<i
\end{equation*}
\end{proof}

\begin{remark}
\begin{enumerate}
\item By a \textbf{\(\varphi\)-formula over \(M\)} we mean a Boolean combination of instances (over \(M\)) of
\(\varphi\) and \(\neg\varphi\). For example, \((\varphi(x,c)\wedge\varphi(x,b))\vee\neg\varphi(x,d)\) is a \(\varphi\)-formula
\item Any type \(p(x)\in S_\varphi(M)\) decides any \(\varphi\)-formula \(\psi(x)\) over \(M\), that is to
say \(p(x)\vDash\psi(x)\) or \(p(x)\vDash\neg\psi(x)\), so in fact \(p(x)\) extends to a unique maximal
consistent set of \(\varphi\)-formulas over \(M\)
\item By defining the basic open sets of \(S_\varphi(M)\) to be \(\{p(x)\in S_\varphi(M):\psi(x)\in p\}\) for \(\psi\) a
\(\varphi\)-formula, \(S_\varphi(M)\) becomes a compact totally disconnected space, where in addition the
clopen sets are precisely given by \(\varphi\)-formulas, i.e., they are the basic clopen sets
\item Any \(p(x)\in S_\varphi(M)\) extends to some \(q(x)\in S_x(M)\) s.t. \(p=q\uhr\varphi\), where \(q\uhr\varphi\) is
the set of \(\varphi\)-formulas in \(q(x)\) (or instances of \(\varphi\), \(\neg\varphi\) in \(q(x)\))
\end{enumerate}
\end{remark}


\subsection{Local ranks and definability of types}
\label{sec:org50ef1ce}
\begin{definition}[]
We define \textbf{Shelah's local 2-rank} taking values in \(\{-\infty\}\cup\omega\cup\{+\infty\}\) by induction on \(n\in\omega\). Let
\(\Delta\) be a set of \(L\)-formulas, and \(\theta(x)\) a partial type over \(\fC\)
\begin{itemize}
\item \(R_\Delta(\theta(x))\ge 0\) iff \(\theta(x)\) is consistent (\(-\infty\) otherwise)
\item \(R_\Delta(\theta(x))\ge n+1\) if for some \(\phi(x,y)\in\Delta\) and \(a\in\fC_y\) we have both \(R_\Delta(\theta(x)\wedge\phi(x,a))\ge n\)
and \(R_\Delta(\theta(x)\wedge\neg\phi(x,a))\ge n\)
\item \(R_\Delta(\theta(x))=n\) if \(R_\Delta(\theta(x))\ge n\) and \(R_\Delta(\theta(x))\not\ge n+1\), and \(R_\Delta(\theta(x))=\infty\) if
for \(n\in\omega\), \(R_\Delta(\theta(x))\ge n\)
\end{itemize}


If \(\phi(x,y)\) is a formula, we write \(R_\phi\) instead of \(R_{\{\phi\}}\)
\end{definition}

\begin{proposition}[]
\label{C2.3.2}
\(\phi(x,y)\) is stable iff \(R_\phi(x=x)\) is finite (and so also \(R_\phi(\theta(x))\) is finite for any
partial type \(\theta\)). Here \(x=(x_i:i\in I)\) is a tuple of variables and \(x=x\) is an abuse of
notation for \(\bigwedge_{i\in I}x_i=x_i\)
\end{proposition}

\begin{proof}
If \(\phi(x,y)\) is unstable, i.e., it has the \(k\)-order property for all \(k\in\omega\), by
compactness, we find \((a_ib_i:i\in[0,1])\) s.t. \(\vDash\phi(a_i,b_j)\Leftrightarrow i<j\). We know both \(\phi(x,b_{1/2})\)
and \(\neg\phi(x,b_{1/2})\) contain dense subsequences of \(a_i\)'s. Each of these sets can be split
again

Conversely, suppose the rank is infinite, then we can find an infinite tree of
parameters \(B=(B_\eta:\eta\in 2^{<\omega})\) s.t. for every \(\eta\in 2^\omega\) there set of
formulas \(\{\phi^{\eta(i)}(x,b_{\eta\mid i}):i<\omega\}\) is consistent where \(\phi^1=\phi\) and \(\phi^0=\neg\phi\) (rank being \(\ge k\) guarantees that we can
find such a tree of height \(k\), and then use compactness to find one of infinite height). This
gives us that \(\abs{S_\phi(B)}>\abs{B}\), which by Proposition \ref{C2.2.13} implies that \(\phi(x,y)\)
is unstable
\end{proof}

\begin{definition}[]
\begin{enumerate}
\item Let \(\phi(x,y)\in L\) be given. A type \(p(x)\in S_\phi(A)\) is \textbf{definable over} \(B\) if there is
some \(L(B)\)-formula \(\psi(y)\) s.t. \(\forall a\in A\)
\begin{equation*}
\phi(x,a)\in p\Leftrightarrow\;\vDash\psi(a)
\end{equation*}
\item A type \(p\in S_x(A)\) is definable over \(B\) if \(p\mid\phi\) is definable over \(B\) for
all \(\phi(x,y)\in L\)

\(\forall\phi(x,y)\in L,\;\exists\psi(y)\in L(B),\;\forall a\in A\) s.t.
\begin{equation*}
\phi(x,a)\in p\Leftrightarrow\vDash\;\psi(a)
\end{equation*}
\item A type is \textbf{definable} if it is definable over its domain
\item types in \(T\) are \textbf{uniformly definable} if for every \(\phi(x,y)\) there is some \(\psi(y,z)\) s.t.
every type can be defined by an instance of \(\psi(y,z)\), i.e., for any \(A\) and \(p\in S_\phi(A)\)
there is some \(b\in A\) s.t. \(\phi(x,a)\in p\Leftrightarrow\;\vDash\psi(a,b)\) for all \(a\in A\)
\end{enumerate}
\end{definition}

\begin{remark}
Another way to think about it:

Given a set \(A\subseteq\fC_x\), \(B\subseteq A\) is \textbf{externally definable} (as a subset of \(A\)) if there is some
definable (over \(\fC\)) set \(X\) s.t. \(B=X\cap A\)

Assume moreover that we have \(X=\phi(c,\fC)\) above. Then \(\tp_\phi(c/A)\) is definable iff \(B\) is
internally definable, i.e., \(B=A\cap Y\) for some \(A\)-definable \(Y\). A set is called \textbf{stably
embedded} if every externally definable subset of it is internally definable.
\wu{
\(\phi(x,a)\in\tp_\phi(c/A)\Leftrightarrow\vDash\phi(c,a)\Leftrightarrow a\in X\Leftrightarrow\vDash\psi(a)\). Thus \(X=\phi(c,\fC)=\psi(\fC)\)
}
\end{remark}

\begin{examplle}[]
Consider \((\Q,<)\vDash\DLO\) and let \(p=\tp(\pi/\Q)\). Then \(x<y\in p(y)\Leftrightarrow x<\pi\). By QE, \(p\) is not definable
\end{examplle}

\begin{lemma}[]
\label{C2.3.7}
\begin{enumerate}
\item The set \(\{e\in\M^k:R_\phi(\theta(x,e))\ge n\}\) is definable, for all \(n\in\omega\)
\item If \(R_\phi(\theta(x))=n\), then for any \(a\in \M_y\), at most one of \(\theta(x)\wedge\phi(x,a)\), \(\theta(x)\wedge\neg\phi(x,a)\)
has \(R_\phi\)-rank \(n\)
\end{enumerate}
\end{lemma}

\begin{proof}
\begin{enumerate}
\item Let \(S_n(\theta)=\{e:R_\phi(\theta(x,e))\ge n\}\) and suppose it is defined by \(\psi_{n,\theta}(x)\). Induction on \(n\)
to show that \(S_n(\theta)\) is definable for any \(\theta\).
For \(n=0\), consider \(\psi_{0,\theta}(x):=\exists y(\theta(y,x))\). Then \(e\in R_0(\theta)\) iff \(\theta(x,e)\) is consistent
iff \(\vDash\exists x(\theta(x,e))\) iff \(e\in\psi_{0,\theta}(\fC)\).

Now for \(n\), \(e\in S_n(\theta)\) iff \(\exists a(R_\phi(\theta(x,e)\wedge\phi(x,a))\ge n-1\wedge R_\phi(\theta(x,e)\wedge\neg\phi(x,a))\ge n-1)\)
\end{enumerate}
\end{proof}

\begin{proposition}[]
\label{C2.3.8}
Let \(\phi(x,y)\) be a stable formula. Then all \(\phi\)-types are uniformly definable
\end{proposition}

\begin{proof}
Suppose that \(R_\phi(x=x)=n\in\omega\). Let \(p\in S_\phi(A)\). Then there is \(\chi(x)\in p\) s.t.
\(R_\phi(\chi(x))=\min\{R_\phi(\varphi(x))\mid\varphi\in p\}\). For each \(b\in A_y\) either \(\phi(x,b)\in p\) or \(\neg\phi(x,b)\in p\).
Either \(R_\phi(\chi(x)\wedge\phi(x,b))<n\) or \(R_\phi(\chi(x)\wedge\neg\phi(x,b))<n\).

\(R_\phi(\chi(x))\) is minimal \(\Rightarrow(\phi(x,b)\in p\Leftrightarrow R_\phi(\chi(x)\wedge\phi(x,b))=n)\)
\end{proof}


Summary
\begin{theorem}[]
\label{y3.8}
TFAE
\begin{enumerate}
\item \(\phi(x,y)\) is stable
\item \(R_\phi(x=x)<\omega\)
\item All \(\phi\)-types are uniformly definable
\item All \(\phi\)-types over models are definable
\item \(\abs{S_\phi(M)}\le\kappa\) for all \(\kappa\ge\abs{L}\) and \(M\vDash T\) with \(\abs{M}=\kappa\)
\item There is some \(\kappa\) s.t. \(\abs{S_\phi(M)}<\ded\kappa\) for all \(M\vDash T\) with \(\abs{M}=\kappa\)
\end{enumerate}
\end{theorem}

\begin{proof}
\(1\leftrightarrow 2\) \ref{C2.3.2}. \(1\to 3\) \ref{C2.3.8}. \(3\to 4\) obvious.

\(4\to 5\). There are \(\abs{L}+\kappa=\kappa\) possible formulas defining \(S_\phi(M)\) over \(M\)

\(6\to 1\) \ref{C2.2.8}
\end{proof}

Global case:
\begin{theorem}[]
\label{y3.9}
Let \(T\) be a complete theory. TFAE:
\begin{enumerate}
\item \(T\) is stable
\item There is NO sequence of tuples \((c_i)_{i\in\omega}\) from \(\M\) and formula \(\phi(z_1,z_2)\in L(M)\) s.t.
\begin{equation*}
\vDash\phi(c_i,c_j)\Leftrightarrow i<j
\end{equation*}
\item \(f_T(\kappa)\le\kappa^{\abs{T}}\) for all infinite cardinals \(\kappa\)
\item There is some \(\kappa\) s.t. \(f_T(\kappa)\le\kappa\)
\item There is some \(\kappa\) s.t. \(f_T(\kappa)<\ded\kappa\)
\item All formulas of the form \(\phi(x,y)\) where \(x\) is a singleton variable are stable
\item All types over models are definable
\end{enumerate}
\end{theorem}

\begin{proof}
\(1\to 2\): definition

\(2\to 1\): Let \(\psi(x,y)\) be a formula with order property witnessed by sequence
\begin{equation*}
\{(a_i,b_i)\mid i<\omega\}
\end{equation*}
Let \(\phi(x_1y_1,x_2y_2):=\psi(x_1,y_2)\) and \(c_i:a_ib_i\). Then \(\vDash\phi(c_ic_j)\Leftrightarrow i<j\)

\(1\to 3\): \(S_x(M)\to\prod_{\phi\in L}S_\phi(M)\) is injective

\(3\to 4\), \(4\to 5\): obvious

\(5\to 1\): \ref{C2.2.8}

\(6\leftrightarrow 1\): Fix some \(\kappa\), then \(S_1(M)\le\kappa\) for all \(M\) with \(\abs{M}=\kappa\) iff \(S_n(M)\le\kappa\) for all \(M\)
with \(\abs{M}=\kappa\)

\(1\leftrightarrow 7\): \ref{y3.8}
\end{proof}

\begin{examplle}[]
\begin{itemize}
\item stability \(\Leftrightarrow\) all types over all models are definable
\item some unstable theories have certain special models over which all types are definable
\item \(\calm=(\R,+,\times,0,1)\), all types over \(\R\) are uniformly definable
\end{itemize}
\end{examplle}

As we will see later, a theory \(T\) iff all types over \textbf{all} models of \(T\) are definable.

Note that there are unstable theories for which all the types over a certain models are
definable. For instance, in the case of dense linear orders, all types over \(\R\) are definable

Indeed, by quantifier elimination, any non-realised 1-type over any model of \(\DLO\)
corresponds to a cut in its order. But in the case of \(\R\), the order is complete, so for any
cut, there will in fact exist a real number \(r\) s.t. the cut is of the
form \((\{l\in\R,l<r\},\{d\in\R,d>r\})\). Using this real number \(r\), one can easily show definability
of 1-types over \(\R\)

\begin{proposition}[]
Fix a model \(M\vDash T\) and an \(L\)-formula \(\varphi(x,y)\). TFAE
\begin{enumerate}
\item \(\varphi(x,y)\) is stable in \(M\)
\item Whenever \(M^*\succ M\) is \(\abs{M}^+\)-saturated and \(\tp(a^*/M^*)\) is finitely satisfiable
in \(M\), then \(\tp_\varphi(a^*/M^*)\) is definable over \(M\) and, moreover, it is defined by
some \(\varphi\)-formula \(\varphi^*\), i.e., a Boolean combination of \(\varphi(a,y)\)'s, \(a\in M\)
\end{enumerate}
\end{proposition}

1\#+BEGIN\textsubscript{proof}
\(1\to 2\). Fix some \(p^*(x)=\tp_\varphi(a^*/M^*)\) finitely satisfiable in \(M\). We want to
prove \(\tp_\varphi(a^*/M^*)\) is definable over \(M\) by a \(\varphi^*\)-formula. Note first that,
as \(p^*\) is finitely satisfiable in \(M\), whether or not some \(\varphi(x,b)\), \(b\in M^*\), is
in \(p^*\) depends only on \(\tp(b/M)\); in fact, even only
on \(\tp_{\varphi^*}(b/M)=q(y)\in S_{\varphi^*}(M)\)

Suppose we had \(b'\in M^*\) s.t. \(\tp_{\varphi^*}(b'/M)=\tp_{\varphi^*}(b/M)\), but \(\varphi(x,b)\in p^*\)
and \(\neg\varphi(x,b')\in p^*\). Then we would have \(\vDash\)
\#+END\textsubscript{proof}
\subsection{Cantor-Bendixson Rank}
\label{sec:orgb6a6a50}
\begin{definition}[Cantor-Bendixson Rank]
Let \(X\) be a topological space. The \textbf{Cantor-Bendixson rank} is a function \(CB_X:X\to On\cup\{\infty\}\).
Let \(p\in X\), then:
\begin{enumerate}
\item \(CB_X(p)\ge 0\)
\item \(CB_X(p)=\alpha\) if \(CB_X(p)\ge\alpha\) and \(p\) is isolated in the (closed)
subspace \(\{q\in X:CB_X(q)\ge\alpha\}\)
\item \(CB_X(p)=\infty\) if \(CB_X(p)>\alpha\) for every ordinal \(\alpha\)
\end{enumerate}
\end{definition}

For example, \(CB_X(p)=0\) if \(p\) is isolated, equivalently if \(\{p\}\) is open. \(CB_X(p)\ge 1\)
otherwise

Note that 2 claims that the subspace \(\{q\in X:CB_X(q)\ge\alpha\}\) is closed for all \(\alpha\). This is a
consequence of the fact that the set of isolated points of any topological space form an open
set, as a union of open sets


\begin{proposition}[]
\label{P3.11}
\label{Problem5}
Suppose \(X\) is compact and \(CB_X(p)<\infty\) for every \(p\) in \(X\). Then there exists a maximal
element \(\alpha\) of \(\{CB_X(p):p\in X\}\) and \(\{p\in X:CB_X(p)=\alpha\}\) is finite and non empty
\end{proposition}

\begin{proof}
Assume there is no maximal element. Then, for each ordinal \(\alpha\) there exists some \(p_\alpha\) in \(X\)
s.t. \(CB_X(p_\alpha)>\alpha\). The set \(\{p_\alpha:\alpha\in On\}\) must have a limit point \(p\) in the
compact set \(X\), which cannot be isolated in any of the \(\{q\in X:CB_X(q)\ge\alpha\}\).
Hence \(CB_X(p)=\infty\), a contradiction

Let \(\alpha=\sup\{CB_X(p):p\in X\}\). We want to show that \(X_\alpha=\{p\in X:CB_X(p)=\alpha\}\) is non-empty. We
only need to consider the limit case. Assume it is empty and for each \(\beta<\alpha\), \(X_{<\beta}=\{p\in X:CB_X(p)<\beta\}\).
Since \(\calc=\{X_\beta:\beta<\alpha\}\) is an open cover of \(X\) which clearly has no finite subcover as \(\alpha\) is a
limit ordinal, a contradiction

\(\{p\in X:CB_X(p)\}\ge\alpha\) is closed, so compact. Since \(\alpha\) is maximal, all points
in \(\{p\in X:CB_X(p)\ge\alpha\}\) are isolated. Therefore \(\{p\in X:CB_X(p)\ge\alpha\}\) is finite
\end{proof}

\begin{lemma}[]
Suppose \(\varphi(x,y)\) is stable in \(T\). Let \(M\vDash T\), \(X=S_\varphi(M)\). Then \(CB_X(p)<\infty\) for
each \(p\in X\)
\end{lemma}

\begin{proof}
\(X_\alpha=\{p\in X:CB_X(p)\ge\alpha\}\). If \(\exists q\in X\) s.t. \(CB_X(q)=\infty\), then for some \(\alpha\), \(X_\alpha\neq\emptyset\) and has
no isolated points. If not, then each \(X_\alpha\) has at least one isolation point and we could
conclude that \(CB_X(p)\le\abs{X}\) for any \(p\in X\)

Now fix an \(\alpha\). Since there are no isolated points in \(X_\alpha\), we can find \(p_0,p_1\in X_\alpha\)
where \(p_0\neq p_1\). Since \(S_\varphi(M)\) is Hausdorff, we can find \(\psi_0(x)\) s.t. \(\psi_0(x)\in p_0\)
and \(\neg\psi_0(x)\in p_1\). Notice that \(\{p:p\in X_\alpha\}\cap[\psi_0(x)]\) and \(\{p:p\in X_\alpha\}\cap[\psi_1(x)]\) have no
isolated points. Thus we could build a tree and \(\abs{S_\varphi(M')}\ge 2^{\aleph_0}\) for some countable
model \(M'\) by LÃ¶wenheimâ€“Skolem Theorem since there is only countable many parameters
\end{proof}

\subsection{Indiscernible sequences and stability}
\label{sec:org0508622}
\begin{definition}[]
Given a linear order \(I\), a sequence of tuples \((a_i:i\in I)\) with \(a_i\in\fC_x\) is \textbf{indiscernible}
over a set of parameters \(A\) if \(a_{i_0}\dots a_{i_n}\equiv_A a_{j_0}\dots a_{j_n}\) for all \(i_0<\cdots<i_n\)
and \(j_0<\cdots< j_n\) from \(I\) and all \(n\in\omega\)
\end{definition}

\begin{examplle}[]
\begin{enumerate}
\item A constant sequence is indiscernible over any set
\item A subsequence of a \(A\)-indiscernible sequence is \(A\)-indiscernible
\item In the theory of equality, any sequence of singletons is indiscernible
\item Any increasing sequence of singletons in a dense linear order is indiscernible
\item Any basis in a vector space is an indiscernible sequence
\end{enumerate}
\end{examplle}

\begin{definition}[]
For any sequence \(\bara=(a_i\mid i\in I)\) and a set of parameters \(B\), we define \(\EM(\bara/B)\),
the Ehrenfeucht-Mostowski type of the sequence \(\bara\) over \(B\), as a partial type
over \(B\) in countably many variables indexed by \(\omega\) and given by the following collection of
formulas
\begin{equation*}
\{\phi(x_0,\dots,x_n)\in L(B)\mid\forall i_0<\dots<i_n,\vDash\phi(a_{i_0},\dots,a_{i_n}),n\in\omega\}
\end{equation*}
\end{definition}

\begin{exercise}
For any sequence \(\bara=(a_i\mid i\in I)\) and a set of parameters \(B\). If \(J\) is an infinite
linear order, then there is a sequence \(\barb=(b_i\mid i\in J)\) which realises \(\EM(\bara/A)\)
\end{exercise}

\begin{exercise}
If \(\bara=(a_i\mid i\in I)\) is an \(A\)-indiscernible sequence. Then \(\EM(\bara/A)\) is a complete
\(\omega\)-type over \(A\)
\end{exercise}

Let \(\bara=(a_i\mid i\in I)\) and \(\barb=(b_j\mid j\in J)\) be \(A\)-indiscernible sequences. We
denote \(\bara\equiv_{\EM,A}\barb\) if \(\EM(\bara/A)=\EM(\barb/A)\in S_\omega(A)\)

\begin{proposition}[]
\label{C2.4.4}
\label{y4.6}
Let \(\bara=(a_i:i\in J)\) be an arbitrary sequence in \(\fC\), where \(J\) is an arbitrary linear
order and \(A\) is a small set of parameters. Then for any small linear order \(I\) we can find (in \(\M\))
an \(A\)-indiscernible sequence \((b_i:i\in I)\) realize the EM-type of \(\bara\) over \(A\)
\end{proposition}

\begin{corollary}[]
If \((a_i:i\in I)\) is an \(A\)-indiscernible sequence and \(J\supseteq I\) is an arbitrary linear order,
then there is an \(A\)-indiscernible sequence \((b_j:j\in J)\) s.t. \(b_i=a_i\) for all \(i\in I\)
(everything involved is small)
\end{corollary}

\begin{proof}
Let \((b_j:j\in J)\) be an arbitrary \(A\)-indiscernible sequence in \(\fC\) based on \(I\),
obtained by \ref{C2.4.4}. In particular
\begin{equation*}
(b_j:j\in I)\equiv_A(a_j:i\in I)
\end{equation*}
which by strong homogeneity of \(\fC\) implies that there is some \(\sigma\in\Aut(\fC/A)\)
s.t. \(\sigma(b_j)=a_j\). Then define \(b_j'=\sigma(b_j)\) for all \(j\in J\)
\end{proof}

\begin{lemma}[]
If \(\bara=(a_i\mid i\in I)\) is an infinite \(A\)-indiscernible sequence, then for all \(S\subseteq I\)
and \(i\in I\setminus S\), \(a_i\notin\acl(A,a_{j\in S})\)
\end{lemma}

\begin{proof}
\(a_i\in\acl(A,a_{j\in S})\Leftrightarrow\exists S_0\subseteq_f S(a_i\in\acl(A,a_{j\in S_0}))\). Let \((b_i\mid i\in\Q)\equiv_{\EM,A}(a_i\mid i\in I)\).
Then for any \(i_0<\dots<i_n\in I\) and \(j_0<\dots<j_n\in\Q\)
\begin{equation*}
a_{i_k}\in\acl(A,\{a_{i_s}\mid s\neq k,s\le n\})\Leftrightarrow b_{j_k}\in\acl(A,\{b_{j_s}\mid s\neq k,s\le n\})
\end{equation*}
WLOG, we assume that \(I=(\Q,<)\).

Suppose that
\begin{equation*}
a_{i_k}\in\acl(A,\{a_{i_s}\mid s\neq k,s\le n\})
\end{equation*}
and \(\phi(x_0,\dots,x_k,\dots,x_n)\in L(A)\) witness the property. Then for any \(q\in\Q\) realizing the same
cut of \(a_{i_k}\) over \(\{a_{i_s}\mid s\neq k,s\le n\}\) we have
\begin{equation*}
\vDash\phi(a_{i_0},\dots,a_q,\dots,a_{i_n})
\end{equation*}
So \(\phi(a_{i_0},\dots,\M,\dots,a_{i_n})\) is infinite, a contradiction
\end{proof}

\begin{exercise}
\label{Problem1}
Start with the sequence \(\bara=(1,2,3,\dots)\) in \((\C,+,\times,0,1)\vDash\ACF_0\). Give an explicit example of an
indiscernible sequence realizing \(\EM(\bara)\)
\end{exercise}

\begin{proof}
\(x\in\R_{>0}\Leftrightarrow\exists y\; x=y^2\wedge x\neq 0\). And in \(\R_{>0}\) we can define an
order \(x>y\Leftrightarrow\exists z(x=y+z^2\wedge z\neq 0)\). Note that \(\EM_{\R_{>0}}(\bara)\subseteq\EM_{\C}(\bara)\).

Thus \(\barb\) should be an increasing sequence of reals greater than or equal to 1.
\end{proof}

\begin{proposition}[]
\label{C2.4.8}
Let \(\kappa\), \(\lambda\) be small cardinals and let \((a_i)_{i\in\lambda}\) be a sequence of tuples with \(\abs{a_i}<\kappa\)
and a set \(B\) be given. If \(\lambda\ge\beth_{(2^{\kappa+\abs{B}+\abs{T}})^+}\) there is a \(B\)-indiscernible
sequence \((a_i')_{i\in\omega}\) s.t. for every \(n\in\omega\) there are \(i_0<\dots<i_n\in\kappa\)
s.t. \(a_0'\dots a_n'\equiv_Ba_{i_0}\dots a_{i_n}\)

Let \(A\) be a set of parameters, and \(\lambda\ge\abs{S_\kappa(A)}\) (for
example, \(\lambda=2^{\abs{T}+\abs{A}+\kappa}\)). Set \(\mu=\beth_{\lambda^+}\). Then for any sequence \((a_i:i<\mu)\) of
\(\kappa\)-tuples there is an \(A\)-indiscernible sequence \((b_i:i<\omega)\) s.t. for all \(n<\omega\) there
are \(i_0<\dots<i_{n-1}<\mu\) for which \(b_0\dots b_{n-1}\equiv_Aa_{i_0}\dots a_{i_{n-1}}\)
\end{proposition}

\begin{proof}
We construct by induction a sequence of types \(p_n\), each one a complete \(n\times\kappa\)-type over \(A\),
s.t. for all \(n\)
\begin{enumerate}
\item for any \(i_0<\dots<i_{m-1}<n\) we have \(p_n(x_0,\dots,x_{n-1})\vdash p_m(x_{i_0},\dots,x_{i_{m-1}})\)
\item For all \(\eta<\mu\) there is \(I\subseteq\mu\), \(\abs{I}=\eta\) s.t. every \(n\) elements in order
from \(a_I\) satisfy \(p_n\)
\end{enumerate}


For \(n=0\) there is nothing to do. Given \(p_n\), consider the set of all \((n+1)\times\kappa\)-types
over \(A\) that satisfy the first condition. If there is \(q\in S\) that also satisfies the
second,we are done. If not, then for each \(q\in S\) there is an \(\eta_q<\mu\) that witnesses it.
As \(\abs{S}\le\lambda<\cf(\mu)=\lambda^+\), we have that \(\eta=\lambda+\sup\{\eta_q:q\in S\}<\mu\) is such that for all \(q\in S\),
for all \(I\subseteq\mu\) with \(\abs{I}=\eta\), not all \((n+1)\)-sub-tuples in order from \(a_I\)
satisfy \(q\). As \(\eta<\mu\), \(\eta<\beth_\theta\) for some \(\theta<\lambda^+\). \label{Problem7} Write \(\nu=\beth_{\theta+n+1}\). Then on the one
hand, \(\nu<\mu\). On the other, \(\nu\ge\beth_n(\eta)^+\). By the inductive hypothesis, there
is \(I\subseteq\mu\), \(\abs{I}=\nu\) s.t. all \(n\)-tuples in order in \(a_I\) satisfy \(p_n\). As there
are at most \(\lambda\) possible \(A\)-types for \((n+1)\)-tuples and \(\lambda\le\eta\), the ErdÅ‘s-Rado theorem gives
us \(I'\subseteq I\) with \(\abs{I'}=\eta^+\) where all \((n+1)\)-tuples in order have the same type
over \(A\). This gives the wanted contradiction. Take \(p_\omega\) as the limit of \(p_n\)
\end{proof}


\begin{definition}[]
A sequence \((a_i\mid i\in I)\) is \textbf{totally indiscernible over} \(A\)
if \(a_{i_0}\dots a_{i_n}\equiv_Aa_{j_0}\dots a_{j_n}\) for any \(i_0\neq\dots\neq i_n\), \(j_0\neq\dots\neq j_n\) from \(I\)
\end{definition}

\begin{theorem}[]
\(T\) is stable iff every indiscernible sequence is totally indiscernible
\end{theorem}

\begin{proof}
\(\Rightarrow\): Suppose \(T\) is stable and \((a_i\mid i\in I)\) is indiscernible over \(A\).
If \((a_i\mid i\in I)\) is not totally indiscernible, then there are  \(i_0\neq\dots\neq i_n\), \(j_0\neq\dots\neq j_n\)
from \(I\) s.t. \(a_{i_0}\dots a_{i_n}\not\equiv_Aa_{j_0}\dots a_{j_n}\)which implies they are in different orders. WLOG, assume that \(I=(\Q,<)\)
and \(i_0=0,\dots,i_n=n\). Then there is \(\sigma\in S_{n+1}\) s.t.
\begin{equation*}
a_{\sigma(0)}\dots a_{\sigma(n)}\equiv_Aa_{j_0}\dots a_{j_n}
\end{equation*}
\(\sigma=\tau_m\dots\tau_1\), where \(\tau_1,\dots,\tau_m\) are transpositions. Then there is \(0<k<m\)
s.t. \(a_{\tau_k(0),\dots,a_{\tau_k(n)}}\not\equiv_A a_0\dots a_n\). Assume \(\tau_k=(s,s+1)\), then there is
an \(L(A)\)-formula \(\psi(x_0,\dots,x_n)\) s.t.
\begin{equation*}
\vDash\psi(a_0,\dots,a_s,a_{s+1},\dots,s_n)\wedge\neg\psi(a_0,\dots,a_{s+1},a_s,\dots,s_n)
\end{equation*}

Let \(\phi(x,y):=\psi(a_0,\dots,a_{s-1},x,y,a_{s+2},\dots,a_n)\). Then for
all \(s<q\), \(r<s+1\), \(\vDash\phi(a_q,q_r)\Leftrightarrow q<r\), contradicting \ref{y3.9}

\(\Leftarrow\): Assume \(T\) is unstable. Then suppose that \(\barc=(c_i\mid i\in\omega)\) witnesses the order
property of \(\phi(x,y)\). Let \(\bara=(a_i\mid i\in\omega)\) be an indiscernible sequence based on \(\barc\).
Then
\begin{equation*}
\vDash\phi(a_i,a_j)\Leftrightarrow i<j
\end{equation*}
so \(\bara\) is not totally indiscernible
\end{proof}

\begin{proposition}[]
\label{y4.13}
For any stable formula \(\phi(x,y)\), in an arbitrary theory, there is some \(k_\phi\in\omega\) depending just
on \(\phi\) s.t. for any indiscernible sequence \(I\subseteq\M_x\) and any \(b\in\M_y\),
either \(\abs{\phi(I,b)}\le k_\phi\) or \(\abs{\neg\phi(I,b)}\le k_\phi\)
\end{proposition}

\begin{proof}
Suppose that \(\abs{\phi(I,b)}>k\) and \(\abs{\neg\phi(I,b)}>k\). By compactness, we assume
that \(I=\omega\). Then either \(\phi(I,b)\) or \(\neg\phi(I,b)\) is infinite. Assume that \(\neg\phi(I,b)\) is
infinite. Then there is a subsequence \(J=\{n_0<n_1<\dots\}\subseteq\omega\)  s.t.
\begin{equation*}
\vDash\phi(a_{n_i},b)\Leftrightarrow i\le k
\end{equation*}
by \(\vDash\neg\phi(a_{n_i},b)\Leftrightarrow i>k\).

Let \(c_i=a_{n_i}\) and \(b_k=b\) we have
\begin{equation*}
\vDash\bigwedge_{i\le k}\phi(c_i,b_k)\wedge\bigwedge_{i=k+1}^{2k}\neg\phi(c_i,b_k)
\end{equation*}
Since \((c_i)_{i<\omega}\) is indiscernible, we have
\begin{equation*}
\vDash\exists y\left(
\bigwedge_{i\le k}\phi(c_i,y)\wedge\bigwedge_{i=k+1}^{2k}\neg\phi(c_i,y) \right)\to\exists y
\left( \bigwedge_{i\le j}\phi(c_i,y)\wedge\bigwedge_{i=j+1}^k\neg\phi(c_i,y) \right)
\end{equation*}
for each \(j<k\) (pick \(k\) elements from \(2k\) and choose by indiscernibility)

Let
\begin{equation*}
b_j\vDash\bigwedge_{i\le j}\phi(c_i,y)\wedge\bigwedge_{i=j+1}^k\neg\phi(c_i,y)
\end{equation*}
Then \(\vDash\phi(c_i,b_j)\Leftrightarrow i\le j\), so \(\phi\) has \(k\)-order property. Since \(\phi\) is stable, \(k_\phi\) exists
\end{proof}

\begin{corollary}[]
In a stable theory, we can define the average type of an indiscernible
sequence \(\barb=(b_i)_{i\in I}\) over a set of parameters \(A\) as
\begin{equation*}
\Av(\barb/A)=\{\phi(x)\in L(A)\mid\;\vDash\phi(b_i)\text{ for all but finitely many }i\in I\}
\end{equation*}
By proposition \ref{y4.13} it is a complete consistent type over \(A\)
\end{corollary}


\subsection{Stable=NIP\texorpdfstring{\(\cap\)}{âˆ©}NSOP and the classification picture}
\label{sec:org7ca3ea9}
\begin{definition}[NSOP]
\begin{itemize}
\item A (partitioned) formula \(\phi(x,y)\in L\) has the \textbf{strict order property}, or \textbf{SOP}, if there is an
infinite sequence \((b_i)_{i\in\omega}\) s.t. \(\phi(\M,b_i)\subsetneq\phi(\M,b_j)\) for all \(i<j\in\omega\)
\item A theory \(T\) has \textbf{SOP} if some formula does
\item \(T\) is \textbf{NSOP} if it does not have the strict order property
\end{itemize}
\end{definition}

\begin{remark}
\begin{itemize}
\item SOP implies order property by picking an element in each \(\phi(\M,b_{i+1})\setminus\phi(\M,b_i)\)
\item If \(\phi(x,y)\) has SOP, then by \ref{y4.6} we can choose an indiscernible sequence \((b_i)_{i\in\omega}\)
satisfying the condition above
\item \(\DLO\) has SOP
\item \(T\) is NSOP iff all formulas with parameters are NSOP iff all formulas \(\phi(x,y)\) with \(x\)
singleton are NSOP
\end{itemize}
\end{remark}

\begin{exercise}
\label{Problem6}
\(T\) has SOP iff there is a definable partial order with infinite chains
\end{exercise}

\begin{proof}

\end{proof}

\begin{definition}[NIP]
A (partitioned) formula \(\phi(x,y)\) has the \textbf{independence property}, or \textbf{IP}, if (in \(\M\)) there are
infinite sequences \((b_i)_{i\in\omega}\) and \((a_s)_{s\subseteq\omega}\) s.t.
\begin{equation*}
\vDash\phi(a_s,b_i)\Leftrightarrow i\in s
\end{equation*}
\wu{
Thus we can define any subset of \((b_i)_{i\in\omega}\) and there is no special subset
}

A theory \(T\) has \textbf{IP} if some formula does, otherwise \(T\) is \textbf{NIP}
\end{definition}

\begin{remark}
\begin{itemize}
\item If we have arbitrary long finite sequences \((b_i)_{i<n}\) satisfying the condition above for a
fixed formula \(\phi(x,y)\) then by compactness we can find an infinite sequence satisfying the
condition above, hence \(\phi(x,y)\) has IP
\item If \(\phi(x,y)\) has IP, then by Ramsey and compactness we can choose an indiscernible
sequence \((b_i)_{i\in\omega}\) in the definition above
\end{itemize}
\end{remark}

\begin{lemma}[]
\label{y5.6}
A formula \(\phi(x,y)\) has IP iff there is an indiscernible sequence \(\barb=(b_n)_{n\in\omega}\) and a
parameter \(c\) s.t.
\begin{equation*}
\vDash\phi(c,b_n)\Leftrightarrow n\text{ is even}
\end{equation*}
\end{lemma}

\begin{proof}
\(\Rightarrow\): Suppose \(\phi(x,y)\) has IP. There are \(\barb=(b_n)_{n\in\omega}\) and \(\bara=(a_s)_{s\subseteq\omega}\)
s.t. \(\phi(a_s,b_n)\Leftrightarrow n\in s\). We may assume that \(\barb\) is indiscernible and
let \(s=\{0,2,4,\dots\}\). Let \(c=a_s\), then \(\vDash\phi(c,b_n)\Leftrightarrow n\) is even

\(\Leftarrow\):
\end{proof}

\begin{theorem}[Shelah]
\(T\) is unstable iff
\end{theorem}



\subsection{Examples of stable theories}
\label{sec:org648ed97}
\begin{examplle}[]
The theory of a countable number of equivalence relations \(E_n\) for \(n=0,1,2,\dots,\)
\begin{itemize}
\item Each equivalence relation has an infinite number of equivalence classes
\item Each equivalence class of \(E_n\) is the union of an infinite number of different classes
of \(E_{n+1}\)
\end{itemize}


This theory has QE by Back-and-Forth

So 1-types are determined by specifying the class w.r.t. each of the equivalence relation, which
implies that over an set \(A\), a type \(p\in S_1(A)\) is determined by the function
\begin{equation*}
f:\omega\to A\cup\{\infty\}
\end{equation*}
where \(f(n)=a\) if \(\exists a\in A\) s.t. \(E_n(x,a)\in p\), otherwise \(f(n)=\infty\)

There are at most \(\abs{A}^{\aleph_0}\) many 1-types (\ref{y3.9})
\end{examplle}

\begin{examplle}[Modules are stable]

\end{examplle}


\begin{examplle}[]
\(\ACF_0\) and \(\ACF_p\) are stable

All strongly minimal theories are stable
\end{examplle}

\subsection{Number of types and definabibility of types is NIP}
\label{sec:orgf71aa15}
\begin{lemma}[]
\label{6.1}
If \(F\subseteq 2^\lambda\) and \(\abs{F}>\ded\lambda\), then for each \(n<\omega\) there is some \(I\subseteq\lambda\)
s.t. \(\abs{I}=n\) and \(F\uhr I=2^I\)
\end{lemma}

\begin{proof}
Consider each element of \(2^\lambda\) as a \(\{0,1\}\)-sequence of length \(\lambda\), then \(2^\lambda\) is a dense
linear order. For \(f<g\in F\), there is \(\alpha<\lambda\) s.t. \(f\uhr\alpha=g\uhr\alpha\) and \(f(\alpha)<g(\alpha)\). So
each \(f\in F\) realize a cut
over \((\bigcup_{\alpha<\lambda}F\uhr\alpha)\subseteq 2^{<\lambda}\). \(\abs{F}>\ded\lambda\Rightarrow\abs{\bigcup_{\alpha<\lambda}F\uhr\alpha}>\lambda\Rightarrow\abs{F\uhr\alpha}>\lambda\) for
some \(\alpha\)

Let \(\lambda\) and \(F\) be a counterexample s.t. \(\lambda\) is minimal. By the minimality of \(\lambda\), we
have \(\abs{F\uhr\alpha}\le\ded\lambda\) for each \(\alpha<\lambda\)

For each \(f\in F\uhr\alpha\), let
\begin{align*}
&\Ext_F(f):=\{g\in F:f\subseteq g\}\\
&G_\alpha:=\{f\in F\uhr\alpha:\abs{\Ext_F(f)}>\ded\lambda\}\\
&G:=\{f\in F:\forall\alpha<\lambda(f\uhr\alpha\in G_\alpha)\}
\end{align*}
Then \(F\setminus G=\bigcup_{\alpha<\lambda}\bigcup_{f\in F\uhr\alpha\setminus G_\alpha}\Ext_F(f)\). \(\abs{F\setminus G}\le\lambda\times\ded\lambda\times\ded\lambda\le\ded\lambda\), which
implies \(\abs{G}=\abs{F}\), we may assume that \(F=G\). Namely, for each \(f\in F\)
and \(\alpha<\lambda\), \(\abs{\Ext_F(f\uhr\alpha)}>\ded\lambda\). We now prove by induction on \(n<\omega\) that:
\begin{center}
\(\forall n<\omega,\forall\alpha<\lambda,\forall h\in F\uhr\alpha\), there is \(I\subseteq\lambda\) with \(\abs{I}=n\) s.t. \(\Ext_F(h)\uhr I=2^I\)
\end{center}

It is for \(n=0\) since \(\Ext_F(h)\neq\emptyset\).

We now consider the case of \(n+1\). \(\abs{\Ext_F(h)}>\ded\lambda\Rightarrow\abs{\Ext_F(h)\uhr\alpha}>\lambda\) for
some \(\alpha<\lambda\). For each \(g\in\Ext_F(h)\uhr\alpha\) there is \(I_g\subseteq\lambda\) with \(\abs{I_g}=n\)
s.t. \(\Ext_F(g)\uhr I_g=2^{I_g}\). There are at most \(\lambda\)-many \(I_g\)'s for \(g\in\Ext_F(h)\), thus
there are \(f,g\in\Ext_F(h)\) s.t. \(I_g=I_h\). Let \(a\in f\triangle g\) (\(f(a)\neq g(a)\))
and \(I=I_g\cup\{a\}\), then \(\Ext_F(h)\uhr I=2^I\)
\end{proof}

\begin{proposition}[]
\begin{enumerate}
\item If \(\phi(x,y)\) has IP, then for each cardinal \(\kappa\) there is a set \(A\) of cardinality \(\kappa\) s.t. \(\abs{S_\phi(A)}=2^\kappa\)
\item If \(\phi(x,y)\) has NIP, then for each cardinal \(\kappa\) and a set \(A\) of cardinality \(\kappa\), we have \(\abs{S_\phi(A)}\le\ded\kappa\)
\end{enumerate}
\end{proposition}

\begin{proof}
\begin{enumerate}
\item If \(\phi(x;y)\) has IP. Let \(C=\{c_i:i<\kappa\}\) and \(\{d_S\mid S\subseteq\kappa\}\) be two sets of new constants. By
compactness
\begin{equation*}
\{\phi(c_i,d_S):i\in S\}\cup\{\neg\phi(c_j,d_S):j\notin S\}
\end{equation*}
is consistent, then \(S_1(C)=2^{\abs{C}}\)
\item Suppose that \(\abs{S_\phi(A)}>\ded\kappa\). \(S_\phi(A)=\{\tp_\phi(a/A):a\in\M\}\) and \(\tp_\phi(a/A)\) is determined
by \(\phi(a,A)\subseteq A\). Hence we are considering \(T=\{\phi(a,A)\subseteq A:a\in\M\}\subseteq 2^A\).
By Lemma \ref{6.1}, for each \(n<\omega\), there is a finite subset \(B\subseteq A\)
with \(\abs{B}=n\) s.t.
\begin{equation*}
\{\phi(a,B):a\in\M\}=\calp(B)
\end{equation*}
For each \(S\subseteq B\), there is \(a_S\) s.t. \(\vDash\phi(a_S,b)\Leftrightarrow b\in S\) for all \(b\in B\). By
compactness, \(\phi\) has IP
\end{enumerate}
\end{proof}

\begin{lemma}[]
A formula \(\phi(x;y)\) is NIP iff there are some \(d,c\in\omega\) s.t. for any finite set \(A\)
with \(\abs{A}=n\) we have \(\abs{S_\phi(A)}\le cn^d\). In fact, \(d\) can be taken to be the maximal
size of a set that can be shattered by instances of \(\phi(x;y)\)
\end{lemma}

\section{Forking Calculus}
\label{sec:orgae92296}

\subsection{Keisler measures and generically prime ideals}
\label{sec:orgcdc8054}
\begin{definition}[]
\begin{enumerate}
\item A \textbf{Keisler measure} (\textbf{over a set of parameters} \(A\)) is a finitely-additive probability measure
on the Boolean algebra of \(A\)-definable subsets of \(\M_x\). That is, a Keisler measure
over \(A\) is a map \(\mu:\Def_x(A)\to[0,1]\) s.t.
\begin{enumerate}
\item \(\mu(\M_x)=1\)
\item \(\mu(P\cup Q)=\mu(P)+\mu(Q)\) for all disjoint \(P,Q\in\Def_x(A)\)
\end{enumerate}
\item A Keisler measure \(\mu\) is \textbf{invariant over} \(A\) if \(a\equiv_Ab\) implies \(\mu(\phi(x,a))=\mu(\phi(x,b))\)
\end{enumerate}
\end{definition}

A type can be thought of as a \(\{0,1\}\)-measure

\begin{definition}[]
A set \(I\subseteq\Def_x(A)\) is an \textbf{ideal} if
\begin{enumerate}
\item \(\emptyset\in I\)
\item \(\phi(x,a)\vdash\psi(x,b)\) and \(\psi(x,b)\in I\) implies \(\phi(x,a)\in I\)
\item \(\phi(x,a)\in I\) and \(\psi(x,b)\in I\) implies \(\phi(x,a)\vee\psi(x,b)\in I\)
\end{enumerate}
\end{definition}

\begin{lemma}[Extension of a type avoiding an ideal]
If a partial type \(\pi(x)\) over a set \(A\) doesn't imply a formula from an ideal \(\cali\), then
for any set \(B\supseteq A\) there is a complete type \(p(x)\) over \(B\) not containing any formulas
from \(\cali\)
\end{lemma}

\begin{proof}
We claim that the set of formulas
\begin{equation*}
\tau(x):=\pi(x)\cup\{\neg\phi(x,b):b\in B\text{ and }\phi(x,b)\in\cali\}
\end{equation*}
is consistent. If not, then by compactness there are finitely many formulas \(\phi_i(x,b_i)\in\cali\)
s.t. \(\pi(x)\vdash\bigvee\phi_i(x,b_i)\). As \(\cali\) is an ideal, this is a contradiction

Hence any complete type \(p(x)\) over \(B\) extending \(\tau(x)\) satisfies the requirement
\end{proof}

An ideal \(I\) is \textbf{invariant over} \(A\) if \(\phi(x,a)\in I\) and \(a\equiv_Ab\) implies \(\phi(x,b)\in I\). As
usual, an ideal \(I\) in \(\Def(\M)\) is \textbf{prime} if whenever \(\phi(x,a)\wedge\psi(x,b)\in I\), then
either \(\phi(x,a)\in I\) or \(\psi(x,b)\in I\). However, in the Boolean algebra \(\Def_x(\M)\), prime
ideals correspond to complete types in \(S_x(\M)\) (as for any \(\phi(x,b)\), \(\phi(x,b)\wedge\neg\phi(x,b)=\emptyset\),
so either \(\phi(x,b)\) or \(\neg\phi(x,b)\) has to belong to \(I\)). We introduce weaker version

\begin{definition}[]
Given a cardinal \(\kappa\), we say that an ideal \(\cali\) in \(\Def_x(A)\) is \textbf{\(\kappa\)-prime} if for any
family \((S_i)_{i<\kappa}\) of \(A\)-definable sets with \(S_i\notin\cali\) for all \(i<\kappa\), there are
some \(i<j<\kappa\) s.t. \(S_i\cap S_j\notin\cali\). We say that an ideal \(\cali\) is \textbf{generically prime} if it is
\(\kappa\)-prime for some \(\kappa\)
\end{definition}

\begin{examplle}[]
\begin{enumerate}
\item An ideal is prime iff it is 2-prime
\item Let \(\mu\) be an arbitrary finitely-additive probability measure on \(X\), and let \(0_\mu\) be its
0-ideal containing all 0-measure elements. Then \(0_\mu\) is \(\aleph_1\)-prime. Indeed,
take \(J=\aleph_1\) and assume we are given a
family \((S_i:i\in J)\) of sets of positive measure, say \(\mu(S_i)>\frac{1}{n_i}\) for
some \(n_i\in\omega\). Then by pigeon-hole there is some \(n\in\omega\) and some infinite \(J'\subseteq J\)
s.t. \(\mu(S_i)>\frac{1}{n}\) for all \(i\in J'\). \label{Problem7}
\end{enumerate}
\end{examplle}

\begin{proposition}[]
\label{C3.1.7}
Let \(I\) be an \(A\)-invariant ideal in \(\Def_x(\M)\). TFAE
\begin{enumerate}
\item \(I\) is S1, i.e., for any \(A\)-indiscernible sequence \((b_i)_{i\in\omega}\) and any
formula \(\phi(x,y)\), if \(\phi(x,b_0)\notin I\) then \(\phi(x,b_0)\wedge\phi(x,b_1)\notin I\)
\item \(I\) is generically prime
\item \(I\) is \((2^{\abs{A}+\abs{T}})^+\)-prime
\end{enumerate}
\end{proposition}

\begin{proof}
Assume that we have an \(A\)-indiscernible sequence \((a_i)_{i\in\omega}\) s.t. \(\phi(x,a_0)\wedge\phi(x,a_1)\in I\)
but \(\phi(x,a_0)\notin I\). By compactness, indiscernibility and invariance of \(I\), for any \(\kappa\) we can
find a sequence \((a_i)_{i\in\kappa}\) s.t. \(\phi(x,a_i)\notin I\) and \(\phi(x,a_i)\wedge\phi(x,a_j)\in I\) for
all \(i\neq j\in\kappa\), thus \(I\) is not generically prime
\wu{
By indiscernibility, \(\phi(x,a_i)\notin I\) for any \(i\in\omega\). \(\phi(x,a_i)\wedge\phi(x,a_j)\in I\) for all \(i\neq j\in\omega\)
by indiscernibility. And we can extend \(\omega\) to \(\kappa\) by compactness
}

Conversely, assume that \(I\) is not generically prime. Then for any \(\kappa\) we can
find \((\phi_i(x,a_i))_{i\in\kappa}\) with \(\phi_i(x,a_i)\notin I\) and \(\phi_i(x,a_i)\wedge\phi_j(x,a_j)\in I\). Taking \(\kappa\) large
enough and applying \ref{C2.4.8} we find an \(A\)-indiscernible sequence starting with \(a_i,a_j\)
for some \(i\neq j\) and s.t.
\(\phi_i=\phi_j\)
\end{proof}


\subsection{Dividing and forking}
\label{sec:org7dbb68b}
\begin{definition}[]
\label{C3.2.1}
\begin{enumerate}
\item A formula \(\phi(x,a)\) \textbf{divides} over \(B\) if there is a sequence \((a_i)_{i\in\omega}\) and \(k\in\omega\)
s.t. \(a_i\equiv_Ba\) and \(\{\phi(x,a_i)\}_{i\in\omega}\) is \(k\)-inconsistent. Equivalently, if there is
a \(B\)-indiscernible sequence \((a_i)_{i\in\omega}\) starting with \(a\) and
s.t. \(\{\phi(x,a_i)_{i\in\omega}\}\) is inconsistent (by compactness and \ref{C2.4.8} )
\wu{
Tent Lemma 7.1.4

}
\item A formula \(\phi(x,a)\) \textbf{forks} over \(B\) if it belongs to the ideal generated by the formulas
dividing over \(B\), i.e., if there are \(\psi_i(x,c_i)\) dividing over \(B\) for \(i<n\) and s.t.
\begin{equation*}
\phi(x,a)\vdash\bigvee_{i<n}\psi_i(x,c_i)
\end{equation*}
\item We denote by \(\bF(B)\) the ideal of formulas forking over \(B\). It is invariant over \(B\)
\wu{
If \(\phi(x,b)\) divides over \(B\) and given a \(\sigma\in\Aut(\calu/B)\), then \(\sigma(b)\equiv_Bb\) and
hence \(\phi(x,\sigma(b))\) divides over \(B\)
}
\end{enumerate}
\end{definition}

\begin{examplle}[]
Let \(T\) be \(\DLO\), then \(a<x\) does not divide over \(\emptyset\), but \(a<x<b\) does
\end{examplle}

\begin{examplle}[]
In general there are formulas which fork, but don't divide. Consider the unit circle around the
origin on the plane, and a ternary relation \(R(x,y,z)\) on it which holds iff \(y\) is
between \(x\) and \(z\), ordered clock-wise. Let \(T\) be the theory of this relation. Check
\begin{enumerate}
\item This theory has QE
\item There is a unique 2-type \(p(x,y)\) over \(\emptyset\) consistent with ``\(x\neq y\)''.
\wu{
There is no constant and we can talk nothing:D
}
\item \(R(a,y,c)\) divides over \(\emptyset\) for any \(a,c\)
\item The formula ``\(x=x\)'' forks over  \(\emptyset\)(but it does not divide - no formula can divide
over its own parameters)
\end{enumerate}
\end{examplle}

\begin{definition}[]
A (partial) type \textbf{does not divide} (fork) over \(B\) if it does not imply any formula which
divides (resp. forks) over \(B\)
\end{definition}

Note: if \(a\notin\acl(A)\) then \(\tp(a/Aa)\) divides over \(A\) (take \(x=a\)). Also, if \(\pi(x)\) is consistent
and defined over \(\acl(A)\), then it doesn't divide over \(A\)

\begin{exercise}
Let \(p\in S_x(\M)\) be a global type, and assume that it doesn't divide over a small set \(A\).
Then it doesn't fork over \(A\)
\end{exercise}

\begin{proposition}[]
\label{C3.2.6}
\(\bF(B)\) is contained in every generically prime \(B\)-invariant ideal
\end{proposition}

\begin{proof}
It is enough to show that if \(\varphi(x,a)\) divides over \(B\) and \(I\) is generically prime ideal,
then \(\varphi(x,a)\in I\). We use the equivalence from Proposition \ref{C3.1.7}. Let \((a_i)_{i\in\omega}\) be
indiscernible over \(B\) with \(a_0=a\) and \(\{\varphi(x,a_i)_{i\in\omega}\}\) inconsistent.
If \(\varphi(x,a_0)\notin I\), then by induction using that \(I\) is generically prime (and that
if \((a_i)_{i\in\omega}\) is indiscernible over \(B\), then \((a_{2i}a_{2i+1})_{i\in\omega}\) is indiscernible
over \(B\)), we see that \(\bigwedge_{i<k}\varphi(x,a_i)\notin I\) for all \(k\in\omega\). But as \(\emptyset\in I\) this would imply
that \(\{\varphi(x,a_i)\}\) is consistent, a contradiction
\end{proof}

Note that any intersection of \(B\)-invariant generically prime ideals is still \(B\)-invariant
and generically prime

\begin{definition}[]
\begin{enumerate}
\item Let \(\GP(A)\) be the smallest generically prime ideal invariant over \(A\)
\item Let \(\bzero(A)\) be the ideal of formulas which have measure 0 w.r.t. every \(A\)-invariant
Keisler measure
\end{enumerate}
\end{definition}

Summing up the previous observations, we have
\begin{proposition}[]
In any theory and for any set \(A\), \(\bF(A)\subseteq\GP(A)\subseteq\bzero(A)\)
\end{proposition}

\begin{examplle}[]
There are theories with \(\bF(A)\subsetneq\GP(A)\), equivalently theories
\end{examplle}




\subsection{Special extensions of types}
\label{sec:orgbfa1b0d}
\begin{itemize}
\item Let \(A\subseteq B\) and \(p\in S_x(A)\). Then there is some \(q\in S_x(B)\) with \(p\subseteq q\) (as \(p\) is a
filter in \(\Def_x(B)\), so extends to an ultrafilter)
\item We would like to be able to choose a ``generic'' extension \(q\) of \(p\), s.t. it doesn't add
any new conditions on \(q\) w.r.t. the new parameters from \(B\) which were not already
present w.r.t. the parameters from \(A\)
\end{itemize}


\begin{definition}[]
A global type \(p(x)\in S(\M)\) is called \textbf{invariant} over \(C\) if it is invariant under all
automorphisms of \(\M\) fixing \(C\).
\end{definition}

Applying Proposition \ref{C3.2.6} to \(\{0,1\}\)-measures, every global type invariant over \(A\) is
non-forking over \(A\)

\begin{definition}[]
Let \(A\subseteq B\), \(p\in S_x(A)\) and \(q\in S_x(B)\) extending \(p\) be given (so \(p=q\uhr\Def_x(A)\),
which also denote as \(p=q|A\))
\begin{enumerate}
\item \(q\) is an \textbf{heir} of \(p\) (or ``an heir over \(A\)'') if for every formula \(\phi(x,y)\in L(A)\),
if \(\phi(x,b)\in q\) for some \(b\in B\), then \(\phi(x,b')\in p\) for some \(b'\in A\). Note that
if \(q\) is an heir of \(p\), then in fact \(A\) has to be a model of \(T\)
\wu{

}
\item \(q\) is a \textbf{coheir} of \(p\) (``coheir over \(A\)'', ``finitely satisfiable in \(A\)'') if for
any \(\phi(x,b)\in q\) there is some \(a\in A\) s.t. \(\vDash\phi(a,b)\)
\end{enumerate}
\end{definition}

\begin{exercise}
\label{exC3.3.3}
\(A\subseteq B\)
\begin{enumerate}
\item If a type \(q\in S(B)\) is definable over \(A\) or is finitely satisfiable in \(A\), then it
\textbf{does not split} over \(A\), i.e., for all \(a\equiv_Aa'\) from \(B\) and \(\phi(x,y)\in L(A)\) we have
that \(\phi(x,a)\in q\Leftrightarrow\phi(x,a')\in q\). In particular, if \(B=\M\) then \(q\) is \(A\)-invariant
\item If \(A\) is a model of \(T\) and \(q\in S(B)\) is definable over \(A\), then it is an heir over \(A\)
\item If \(B=\M\) and \(q\in S(B)\) is \(A\)-invariant then it doesn't fork over \(A\)
\item \(\tp(a/Mc)\) is an heir of \(\tp(a/M)\) iff \(\tp(c/Ma)\) is a coheir of \(\tp(b/M)\)
\end{enumerate}
\end{exercise}

\begin{proof}
\begin{enumerate}
\item Obvious
\item \(\phi(x,b)\in q\Leftarrow\vDash d\phi(b)\Rightarrow\vDash\exists xd\phi(x)\Rightarrow A\vDash d\phi(a)\) for some \(a\in A\)
\item \(L(xB)\setminus p\) is an \(A\)-invariant prime ideal and \(\bF(B)\subseteq L(xB)\setminus p\) by \ref{C3.2.6}
\item \(\tp(a/Mc)\) is an heir of \(\tp(a/M)\)
iff \(\forall\phi(x,y)\in L(M)\), \(\phi(x,b)\in\tp(a/Mc)\Rightarrow\exists b'.\phi(x,b')\in\tp(a/M)\) iff
\(\forall \phi(x,y)\in L(M)\), \(\phi(x,c)\in\tp(a/Mc)\Rightarrow\exists b'\;\phi(x,b')\in\tp(a/M)\) iff \(\tp(c/Ma)\) is a coheir
of \(\tp(b/M)\)
\end{enumerate}
\end{proof}

\begin{examplle}[]
Let \(M=(\Q,<)\) and consider the type \(p\in S_x(M)\) given by \(p=\{a<x:a\in M\}\). Now consider two
global extensions \(q_1,q_2\in S_x(\M)\) of \(p\):
\begin{itemize}
\item \(q_1(x)=\{a<x:a\in\M\}\)
\item \(q_2(x)=p(x)\cup\{x<b:M<b\in\M\}\)
\end{itemize}


\(q_1\) is \(M\)-definable, so it is an heir of \(p\), but not a heir of \(p\). On the other
hand, \(q_2\) is a coheir of \(p\), but it is not an heir over \(M\)
\end{examplle}

\begin{remark}
Note the space of \(A\)-invariant global types is a closed subset of \(S(\M)\) (as it
equals \(\bigcap_{\phi\in L,a\equiv_Ab\in\M}\la\phi(x,a)\leftrightarrow\phi(x,b)\)), thus compact. Similarly, the space of types finitely
satisfiable in \(A\) is a closed subset of \(A\) - it
equals \(\bigcap_{\phi(x,a)\in L(M),\phi(A,a)=\emptyset}\la\neg\phi(x,a)\ra\). It can also be described as the closure of the
set of types realized in \(A\), i.e., of \(\{\tp(a/\M):a\in A\}\)
\end{remark}

\begin{exercise}
\begin{enumerate}
\item If \(\pi(x)\) is finitely satisfiable in \(A\), then there exists a complete global type
extending \(\pi(x)\) and finitely satisfiable in \(A\)
\item Every global type finitely satisfiable in \(A\) is invariant over \(A\)
\end{enumerate}
\end{exercise}

\begin{proof}
\begin{enumerate}
\item Let \(p=\pi(x)\cup\{\phi(x):\pi(x)\cup\{\phi(x)\}\text{ is finitely satisfiable in }A\}\)
\end{enumerate}
\end{proof}

\begin{proposition}[]
\label{C3.3.7}
Let \(p\in S_x(M)\) be arbitrary, where \(M\vDash T\) is a small model
\begin{enumerate}
\item There is a global coheir \(q\) of \(p\)
\item There is a global heir \(r\) of \(p\)
\end{enumerate}
\end{proposition}

\begin{proof}
\begin{enumerate}
\item Let \(A\subseteq\M_x\) be small and let \(\calu\) be an ultrafilter on \(\calp(A)\). We can define a global
type \(q_{\calu}\in S_x(\M)\) in the following way. For a formula \(\phi(x,b)\in L(\M)\) we
define \(\phi(x,b)\in q_{\calu}\Leftrightarrow\phi(A,b)\in\calu\). Then \(q_{\calu}\) is finitely satisfiable in \(A\).

Conversely, every global type \(q\) finitely satisfiable in \(A\) is of the form \(q_{\calu}\)
for some ultrafilter \(\calu\) on \(\calp(A)\)

Now any \(p\in S_x(M)\) is finitely satisfiable in \(M\) since \(M\prec\M\). It follows
that \(\{\phi(M):\phi(x)\in p\}\) is a filter, so extends to some ultrafilter \(\calu\) on \(\calp(M)\). Then
the global type \(q_{\calu}\) is a coheir of \(p\)

\item It is enough to show that the following set of formulas is consistent
\begin{equation*}
s(x):=p(x)\cup\{\phi(x,c):c\in\M,\phi(x,y)\in L(M),\phi(x,m)\in p\text{ for all }m\in M\}
\end{equation*}
As then any complete type \(r(x)\in S_x(\M)\) with \(r\supseteq s\) is an heir of \(p\).
\wu{
If for \(\phi(x,b)\in r\), for all \(b'\in M\), \(\phi(x,b')\notin p\), then \(\neg\phi(x,b)\in r\).
}

Assume it is not consistent, then by compactness there are formulas \(\phi(x,c)\in p\)
and \(\phi_i(x,c_i)\), \(i<n\) from \(s(x)\) s.t. \(\vDash\phi(x,c)\to\bigvee_{i<n}\neg\phi_i(x,c_i)\).
As \(\phi(x,c)\in L(M)\) and \(M\prec\M\), it follows that there are \(m_i\), \(i<n\)
s.t. \(M\vDash\phi(x,c)\to\bigvee_{i<n}\neg\phi_i(x,m_i)\). But by definition of \(s(x)\) we have \(\phi_i(x,m_i)\in p\) for
all \(i<n\), as well as \(\phi(x,c)\in p\) - thus their conjunction is consistent, a contradiction
\end{enumerate}
\end{proof}

\begin{proposition}[]
\label{C3.3.8}
Let \(p\in S_x(M)\) be a definable type. Then it has a unique global heir \(q\supseteq p\) which is
definable over \(M\)
\end{proposition}

\begin{proof}
First we show that \(p\) has a global \(M\)-definable extension. As \(p(x)\) is definable, it
follows that for every \(\phi(x,y)\in L\) there is some \(d\phi(y)\in L(M)\) s.t. \(\phi(x,a)\in p\Leftrightarrow\vDash d\phi(a)\),
for all \(a\in M\). Consider the following set of formulas
\begin{equation*}
q(x):=\{\phi(x,a):\phi(x,y)\in L,a\in\M_y,\vDash d\phi(a)\}
\end{equation*}

By compactness, it is enough to show that for any \(\phi_1(x,y_1),\phi_2(x,y_2)\)
\begin{equation*}
\vDash\forall y_1y_2\exists x(\phi_1(x,y_1)\wedge\phi_2(x,y_2))
\end{equation*}
As \(M\prec\M\), this is equivalent to
\begin{equation*}
M\vDash\forall y_1y_2\exists(\phi_1(x,y_1)\wedge\phi_2(x_2,y_2))
\end{equation*}
But for any \(a_1,a_2\in M\), \(\phi_1(x,a_1)\wedge\phi_2(x,a_2)\Leftrightarrow\vDash d\phi(a_1)\wedge d\phi(a_2)\). Thus this holds.

Assume that \(q,r\) are two global types extending \(p\) which are both definable over \(M\).
This implies that for their corresponding defining schemas \((d_q(\phi))_{\phi(x,y)\in L}\)
and \((d_r\phi(y))_{\phi(x,y)\in L}\) we must have \(d_q\phi(M)=d_r\phi(M)\)
\wu{
and hence \(M\vDash\forall y(\phi(x,y)\leftrightarrow d\phi(y))\)
}
. But again as \(M\prec\M\), this implies
that \(d_q\phi(\M)=d_r\phi(\M)\), and so \(q=r\)

By Exercise \ref{exC3.3.3}, \(q(x)\) is an heir of \(p(x)\). Now if \(q\neq q'\) is another global
type extending \(p\), then for some \(\phi(x,b)\in q'\) we have \(\neg\phi(x,b)\in q\) and
so \(\not\vDash d\phi(b)\), and so \((\phi(x,b)\wedge\neg d\phi(b))\in q'\). But as there can be no \(m\in M\)
with \(\vDash\phi(x.m)\wedge\neg d\phi(m)\) and as \(\phi(x,y)\wedge\neg d\phi(y)\in L\), it follows that \(q'\) is not a heir of \(p\)
\end{proof}

\begin{proposition}[]
Let \(p\in S_x(\M)\) be a global \(A\)-invariant type
\begin{enumerate}
\item If \(p\) is definable, then in fact it is definable over \(A\)
\item If \(p\) is finitely satisfiable in some small set, then in fact it is finitely satisfiable
in any model \(M\supseteq A\)
\end{enumerate}
\end{proposition}

\begin{proof}
\begin{enumerate}
\item As \(p\) is definable, for any formula \(\phi(x,y)\in L\) there is some \(d\phi(y)\in L(\M)\) s.t. for
any \(b\in\M\) we have \(\phi(x,b)\in p\Leftarrow b\in d\phi(\M)\). As \(p\) is \(A\)-invariant, the definable
set \(d\phi(\M)\) is also \(\Aut(\M/A)\)-invariant. But then the set \(d\phi(\M)\) is in
fact \(A\)-definable by Lemma \ref{C1.2.6}
\item Suppose \(p\) is finitely satisfiable in some small model \(N\). Let \(M\) be an arbitrary
small model containing \(A\). Let \(\phi(x,b)\in p\) be arbitrary. Consider the type \(\tp(N/M)\).
By Proposition \ref{C3.3.7}, this type has a global coheir \(r(x)\), let \(N_1\vDash r|Mb\). Then by \label{Problem9}
invariance \(p\) is finitely satisfiable in \(N_1\), in particular \(\phi(N_1,b)\neq\emptyset\). But as the
type \(\tp(N_1/Mb)\) is finitely satisfiable in \(M\), it follows that \(\phi(M,b)\neq\emptyset\)
\end{enumerate}
\end{proof}




\subsection{Tensor product of invariant types and Morley sequences}
\label{sec:orgca92db9}
\begin{definition}[]
Let \(p\in S_x(\M)\), \(q\in S_y(\M)\) be two global, \(A\)-invariant types. Then we define their
tensor product \(p\otimes q\in S_{xy}(\M)\) as follows:

given a formula \(\phi(x,y)\in L(B)\), \(A\subseteq B\subseteq\M\), we set \(\phi(x,y)\in p\otimes q\Leftrightarrow\phi(x,b)\in p\) for some
(equivalently, any, by invariance of \(p\)) \(b\in\M_y\) s.t. \(b\vDash q|B\)
since \(b\vDash q|B\Rightarrow\tp(b/B)=q|B\)
\end{definition}

For any small \(B\supseteq A\), \(ab\vDash p\otimes q\) iff \(b\vDash q|B\) and \(a\vDash p|Bb\).

\begin{remark}
\begin{enumerate}
\item Note that \(p\otimes q\) is a complete type, as
\begin{equation*}
p\otimes q=\bigcup_{A\subseteq B\subset_{small}\M}\{\tp(ab/B):a\vDash p|Bb,b\vDash q|B\}
\end{equation*}
\item If both \(p\) and \(q\) are \(A\)-invariant, then so is \(p\otimes q\).
\wu{
If \(\phi(x,y,c)\in p\otimes q\), then there is \(\phi(x,b,c)\in p\) and \(b\vDash q|c\). Since \(p\)  and \(q\)
are \(A\)-invariant, for any \(\sigma(\M/A)\), \(\phi(x,\sigma(b),\sigma(c))\in p\)
and \(\tp(\sigma(b)/\sigma(c))=\sigma(q|c)=q|\sigma(c)\Rightarrow\sigma(b)\vDash q|\sigma(c)\). Hence \(\phi(x,y,\sigma(c))\in p\otimes q\)
}
\item The operation \(\otimes\) is associative, i.e., \(p\otimes(q\otimes r)=(p\otimes q)\otimes r\). For any small \(B\), both
products restricted to \(B\) are equal to \(\tp(abc/B)\)
for \(c\vDash r|B\), \(b\vDash q|Bc\), \(a\vDash q|Bbc\)
\item \(\otimes\) need not be commutative. Let \(T\) be \(\DLO\), and let \(p=q\) be the type at \(+\infty\),
it is \(\emptyset\)-invariant. Then \(p(x)\otimes q(y)\vdash x>y\), while \(q(y)\otimes p(x)\vdash x<y\)
\item In fact, in the definition of the tensor product, we have only used that \(p\) is invariant
\end{enumerate}
\end{remark}

\begin{definition}[]
Let \(p\in S_x(\M)\) be a global \(A\)-invariant type. Then for any \(n\in\omega\) we define by
induction \(p^{(1)}(x_0):=p(x_0)\) and \(p^{(n+1)}(x_0,\dots,x_n):=p(x_n)\otimes p^{(n)}(x_0,\dots,x_{n-1})\).
We also let \(p^{(\omega)}=(x_0,x_1,\dots):=\bigcup_{n\in\omega}p^{(n)}(x_0,\dots,x_{n-1})\). For any set \(B\supseteq A\), a
sequence \((a_i:i\in\omega)\vDash p^{(\omega)}|B\) is called a \textbf{Morley sequence} of \(p\) over \(B\) (indexed by \(\omega\))
\end{definition}

\begin{remark}
\begin{enumerate}
\item We can define \(p^{(I)}\) for an arbitrary order type \(I\) in a natural way
\item Note that for any \((a_i:i<\omega)\), \((b_i:i<\omega)\vDash p^{(\omega)}|B\)
\begin{equation*}
(a_i:i<\omega)\equiv_B(b_i:i<\omega)
\end{equation*}
as \(\tp((a_i)_{i<\omega}/B)=\tp((b_i)_{i<\omega}/B)\). In particular, any Morley sequence of \(p\)
over \(B\) is \(B\)-indiscernible, by the associativity of \(\otimes\)

For any \(i_1<\dots<i_n\) and \(j_1<\dots<j_n\), let \(l_m=\max(i_m,j_m)\) for \(1\le m\le n\). Then
\begin{equation*}
i_1\dots i_n\equiv_Bl_1\dots l_n\equiv_B j_1\dots j_n
\end{equation*}
\end{enumerate}
\end{remark}

\begin{lemma}[]
\label{C3.4.5}
TFAE
\begin{enumerate}
\item \(\tp(a/Ab)\) doesn't divide over \(A\)
\item For every infinite \(A\)-indiscernible sequence \(I\) s.t. \(b\in I\), there is
some \(a'\equiv_{Ab}a\) s.t. \(I\) is \(Aa'\)-indiscernible
\item For every infinite \(A\)-indiscernible sequence \(I\) s.t. \(b\in I\), there is
some \(J\equiv_{Ab}I\) s.t. \(J\) is \(Aa\)-indiscernible
\end{enumerate}
\end{lemma}

\begin{proof}
\(2\leftrightarrow 3\): by an \(A\)-automorphism

\(1\to 3\):
\end{proof}

\begin{corollary}[]
If \(\tp(a/B)\) does not divide over \(A\subseteq B\) and \(\tp(b/Ba)\) does not divide over \(Aa\),
then \(\tp(ab/B)\) does not divide over \(A\)
\end{corollary}

\begin{proof}
By Lemma \ref{C3.4.5}. Let \(I\) be an arbitrary \(A\)-indiscernible sequence starting with \(B\).
Then we can find \(I'\equiv_BI\) with \(I'\) \(Aa\)-indiscernible and \(I''\equiv_{Ba}I'\)
with \(I''\) \(abB\)-indiscernible. In particular \(I''\equiv_BI\)
\end{proof}

\begin{corollary}[]
If \(\phi(x,a)\) \(k\)-divides over \(A\) and \(\tp(b/Aa)\) does not divide over \(A\),
then \(\phi(x,a)\) \(k\)-divides over \(Ab\)
\end{corollary}

\begin{proof}
Let \(I=(a_i:i\in\omega)\) be an infinite \(A\)-indiscernible sequence s.t. \(a_0=a\)
and \(\{\phi(x,a_i):i\in\omega\}\) is \(k\)-inconsistent. By assumption and Lemma \ref{C3.4.5} there
is \(J\equiv_{Aa}I\) which is \(Ab\)-indiscernible. Then \(J\) witnesses
that \(\phi(x,a)\) \(k\)-divides over \(Ab\)
\end{proof}

\begin{proposition}[]
\label{C3.4.8}
Let \(p\in S_x(\M)\) be a global type, and let \(M\) be a small model. TFAE
\begin{enumerate}
\item If \(p\) is definable over \(A\), then \(p\) does not divide over \(A\)
\item If \(T\) is stable and \(p\) does not divide over \(M\), then \(p\) is definable over \(M\)
\end{enumerate}
\end{proposition}

\begin{proof}
(1) is obvious

Assume that \(T\) is stable and that \(p\) does not divide over \(M\).
We will show that \(p\) is an heir of \(p|M\), which is enough (as \(p|M\) is a definable type
by stability and Theorem \ref{C2.3.8}, which using Proposition \ref{C3.3.8} implies that \(p\) is
definable over \(M\))
So let \(\phi(x,y)\in L(M)\) be given and assume that \(\phi(x,b)\in p\). We want to show
that \(\phi(x,b')\in p\) for some \(b'\in M\).
Let \(I=(b_i:i\in\omega)\) be a Morley sequence of a global coheir extension of \(\tp(b/M)\) over \(M\)
starting with \(b_0=b\) (exists by Proposition \ref{C3.3.7} and take the automorphism to
shift \(b_0\) to \(b\) )
Let \(a\vDash p|Mb\). Since \(\tp(a/Mb)\) doesn't divide over \(M\), by Lemma \ref{C3.4.5}, we may
assume that \(I\) is indiscernible over \(Ma\).
\wu{
Condition of Morley sequence is in \(\EM\)-type.
}
So we have \(\vDash\phi(a,b_i)\) for all \(i\in\omega\). Again by stability and Theorem \ref{C2.3.8}, the
type \(q=\tp(a/MI)\) is definable. Let \(n\in\omega\) be s.t. all of the parameters of \(d\phi(y)\) are
in \(M\cup\{b_0,\dots,b_{n-1}\}\). Since \(\tp(b_n/b_{<n}M)\) is a coheir of \(\tp(b/M)\)
and \(\vDash d\phi(b_n)\) (as \(\vDash\phi(a,b_n)\)), it follows that there is some \(b'\in M\)
with \(\vDash d_q\phi(b')\). This implies that \(\vDash\phi(a,b')\), and so \(\phi(x,b')\in\tp(a/M)=p|M\), as wanted
\end{proof}


\subsection{Forking and dividing in simple theories}
\label{sec:org832fc04}
\begin{definition}[]
A theory \(T\) is \textbf{simple} if every type \(p\in S_x(A)\) does not divide over some
subset \(A_0\subseteq A\) of size \(\abs{A}\le\abs{T}\)
\end{definition}

\begin{exercise}
\label{Problem10}
\begin{enumerate}
\item Show that if \(T\) is stable then it is simple, and that if \(T\) is simple then it is NSOP
\item Show that the theory of a random graph is simple
\end{enumerate}
\end{exercise}

\begin{proof}
\begin{enumerate}
\item 
\end{enumerate}
\end{proof}

Note that, according to Definition \ref{C3.2.1}, it is possible that a formula \(\phi(x,a)\) divides
over \(A\), witnessed by a certain \(A\)-indiscernible sequence \(I=(a_i)\), yet there is some
other \(A\)-indiscernible sequence \(J=(b_i)\) s.t. \(b_0=a\) but \(\{\phi(x,b_i)\}\) is consistent.
However, we can isolate a class of indiscernible sequences which always witness that a formula
divides
\wu{
Consider the trivial indiscernible sequence \(\bara=aaaaaaa\dots\)
}

\begin{lemma}[Kim's lemma for simple theories]
Let \(T\) be simple. Assume that \(\phi(x,a)\) divides over \(A\) and let \((a_i:i\in\omega)\) be
an \(A\)-indiscernible sequence s.t. moreover \(\tp(a_i/a_{<i}A)\) does not divide over \(A\), for
all \(i\) (such a sequence is also called a Morley sequence in the type \(\tp(a/A)\)).
Then \(\{\phi(x,a_i):i\in\omega\}\) is inconsistent
\end{lemma}

\begin{proof}
WLOG, \(A=\emptyset\). Assume that \(\phi(x,a)\) divides over \(A\), but for some Morley sequence \((a_i)\)
in \(\tp(a/\emptyset)\) we have \(\{\phi(x,a_i)\}\) is consistent. Let \(X\) be a linear
order \(\left( \abs{T}^+ \right)\), i.e., the reverse order for \(\abs{T}^+\). We may assume that
in fact our sequence is \((a_i:i\in X)\) (by compactness, as dividing is \(\Aut(\M)\)-invariant)
\end{proof}

\section{{\bfseries\sffamily TODO} Problems}
\label{sec:org907c1ce}
\begin{center}
\begin{tabular}{lllll}
\ref{Problem1} & \ref{Problem2} & \ref{Problem3} & \ref{Problem4} & \ref{Problem5}\\
\ref{Problem6} & \ref{Problem7} &  & \ref{Problem9} & \ref{Problem10}\\
\end{tabular}
\end{center}

\section{Index}
\label{sec:org38bc5f2}

\renewcommand{\indexname}{}
\printindex

\section{References}
\label{sec:orge65c70e}

\label{bibliographystyle link}
\bibliographystyle{unsrtnat}

\label{bibliography link}
\bibliography{../references}
\end{document}
